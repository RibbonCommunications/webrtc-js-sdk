/*! For license information please see webrtc.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebRTC=t():e.WebRTC=t()}(self,(()=>(()=>{var e={5007:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=u(r(93117)),o=u(r(5902)),a=u(r(98953)),i=u(r(8786)),s=u(r(26662)),c=u(r(5168)),l=u(r(97002));function u(e){return e&&e.__esModule?e:{default:e}}r(15701);const d=[{name:"logs",fn:a.default},{name:"config",fn:n.default},{name:"events",fn:o.default}],f=[{name:"webrtc",fn:l.default},{name:"notifications",fn:s.default},{name:"connectivity",fn:i.default},{name:"request",fn:c.default}];t.default={corePlugins:d,commonPlugins:f}},30744:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(0,n.factory)(t,e)};var n=r(37984)},81948:(e,t,r)=>{"use strict";var n=y(r(30744)),o=y(r(5007)),a=y(r(63702)),i=y(r(29799)),s=y(r(41768)),c=y(r(31270)),l=y(r(72937)),u=y(r(55318)),d=y(r(2195)),f=y(r(24011)),p=y(r(1940)),g=y(r(93914)),E=y(r(31486)),_=r(40449);function y(e){return e&&e.__esModule?e:{default:e}}const v=[...o.default.corePlugins,{name:"authentication",fn:a.default},{name:"subscription",fn:i.default},...o.default.commonPlugins,{name:"proxy",fn:E.default},{name:"call",fn:s.default},{name:"callHistory",fn:c.default},{name:"clickToCall",fn:l.default},{name:"messaging",fn:u.default},{name:"mwi",fn:d.default},{name:"presence",fn:f.default},{name:"sipEvents",fn:p.default},{name:"users",fn:g.default}];function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(0,n.default)(e,[...v,...t])}S.create=S,S.sdpHandlers={createCodecRemover:_.createCodecRemover},e.exports=S},97082:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USER_DETAILS_RECEIVED=t.UPDATE_HMAC_TOKEN=t.SET_CREDENTIALS_FINISH=t.SET_CONNECTION_INFO=t.RESUBSCRIPTION_FINISHED=t.GET_USER_DETAILS=t.DISCONNECT_FINISHED=t.CONNECTION_OCCURRED=t.AUTHORIZATION_ERROR=void 0;const r="@@KANDY/";t.SET_CONNECTION_INFO=r+"SET_CONNECTION_INFO",t.CONNECTION_OCCURRED=r+"CONNECTION_OCCURRED",t.GET_USER_DETAILS=r+"GET_USER_DETAILS",t.USER_DETAILS_RECEIVED=r+"USER_DETAILS_RECEIVED",t.DISCONNECT_FINISHED=r+"DISCONNECT_FINISHED",t.RESUBSCRIPTION_FINISHED=r+"RESUBSCRIPTION_FINISHED",t.SET_CREDENTIALS_FINISH=r+"SET_CREDENTIALS_FINISH",t.AUTHORIZATION_ERROR=r+"AUTHORIZATION_ERROR",t.UPDATE_HMAC_TOKEN=r+"UPDATE_HMAC_TOKEN"},44130:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCredentialsFinished=function(e){let{userInfo:t,connection:r,error:o}=e;var a={type:n.SET_CREDENTIALS_FINISH,meta:{isSensitive:!0}};return o?(a.error=!0,a.payload=o):a.payload={userInfo:t,connection:r},a},t.updateHmacToken=function(e){return{type:n.UPDATE_HMAC_TOKEN,payload:e,meta:{isSensitive:!0}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(97082));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},27177:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,emitEvent:r,context:i,AuthenticationOperations:s,API_LOG_TAG:c}=e,l=t.getLogger("AUTH");return{getUserInfo:function(){return l.debug(c+"getUserInfo"),(0,o.getUserInfo)(i.getState())},disconnectReasons:a.CHANGE_REASONS,setCredentials:function(e){let{username:t,password:o,authname:a,hmacToken:i,bearerAccessToken:u}=e;l.debug(c+"setCredentials: ",t);try{s.setCredentials({username:t,password:o,authname:a,hmacToken:i,bearerAccessToken:u})}catch(e){return void r(n.AUTH_ERROR,{error:e})}r(n.AUTH_CHANGE,{})},setCredentialsAsync:function(e){let{username:t,password:r,authname:n,hmacToken:o,bearerAccessToken:a}=e;l.debug(c+"setCredentialsAsync: ",t),s.setCredentials({username:t,password:r,authname:n,hmacToken:o,bearerAccessToken:a})}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(9516)),o=r(87075),a=r(22191);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},9516:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AUTH_ERROR=t.AUTH_CHANGE=void 0,t.AUTH_CHANGE="auth:change",t.AUTH_ERROR="auth:error"},57761:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createAPI",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"name",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"reducer",{enumerable:!0,get:function(){return n.default}});var n=i(r(45207)),o=i(r(4826)),a=i(r(27177));function i(e){return e&&e.__esModule?e:{default:e}}},4826:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="authentication"},45207:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(97082)),o=r(45775);function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}const i={};i[n.SET_CREDENTIALS_FINISH]={next:(e,t)=>({...e,error:void 0,connection:{...e.connection,...t.payload.connection},userInfo:t.payload.userInfo}),throw:(e,t)=>({...e,error:t.payload})},i[n.UPDATE_HMAC_TOKEN]={next(e,t){const{"x-token":r,...n}=e.connection.requestOptions.headers,o={...n,"x-session":t.payload};return{...e,connection:{...e.connection,requestOptions:{...e.connection.requestOptions,headers:o}}}}};const s=(0,o.handleActions)(i,{isConnected:!1,isPending:!1});t.default=s},87075:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAuthConfig=a,t.getConnectionInfo=i,t.getDomain=function(e){const{username:t="",identity:r=t}=s(e),[,n=""]=r.split("@");return n},t.getIdentity=function(e){const t=s(e);return t.identity||t.username||""},t.getRequestInfo=function(e){const{subscription:t}=a(e);let{server:r}=a(e),{userInfo:n}=(0,o.default)(e.authentication);r||(r={protocol:t.protocol,base:t.server,port:t.port,version:t.version}),n||(n={});let s={baseURL:`${r.protocol}://${r.base}:${r.port}`,version:r.version,username:n.username};const c=i(e);return c&&c.requestOptions&&(s.requestOptions=c.requestOptions),s},t.getServiceUnavailableMaxRetries=function(e){return e.config.authentication.subscription.serviceUnavailableMaxRetries},t.getUserInfo=s;var n,o=(n=r(89321))&&n.__esModule?n:{default:n};function a(e){return(0,o.default)(e.config.authentication)}function i(e){return e.authentication.connection?(0,o.default)(e.authentication.connection):void 0}function s(e){return(0,o.default)(e.authentication.userInfo)||{}}},63702:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{logManager:r}=e.container,n=r.getLogger("AUTH"),l=c.validation.schema({server:c.validation.schema({protocol:(0,c.enums)(["http","https"]),base:c.validation.string(),port:c.validation.positive(),version:(0,c.enums)(["1"])})}),u=(0,c.parse)("authentication",l);t=(0,s.default)({server:{protocol:"https",base:null,port:443,version:"1"}},t),u(t),t.server.base||n.error("No server configuration provided. Please provide proper authentication configurations."),e.defer((function(e){const{context:r}=e;r.dispatch((0,i.update)(t,o.name))}));for(const t in a)a[t](e);return{api:o.createAPI,capabilities:["auth","userCredentialsAuth","hmacTokenAuth","bearerAccessTokenAuth"],name:o.name,reducer:o.reducer}};var n,o=r(57761),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(50805)),i=r(87310),s=(n=r(7485))&&n.__esModule?n:{default:n},c=r(52932);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}},50805:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("AuthenticationOperations.setCredentials",(()=>(0,o.default)(e.container)))};var n,o=(n=r(62527))&&n.__esModule?n:{default:n}},62527:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,context:r}=e,l=t.getLogger("AUTH");return function(e){let{username:t,password:u,authname:d,hmacToken:f,bearerAccessToken:p,anonUsername:g,realm:E}=e;const{username:_}=(0,o.getUserInfo)(r.getState()),y=(0,a.getSubscribedServices)(r.getState());if(_!==t&&y.length>0){const e=new i.default({message:"Cannot change credentials while previous user has an active subscription.",code:i.authCodes.INVALID_STATE});throw r.dispatch(n.setCredentialsFinished({error:e})),e}const v=[u,f,p].filter((e=>Boolean(e))).length;if(t&&v>=2){const e=new i.default({message:"Multiple methods of authentication detected. Use only one authorization method: Basic authorization (using a password) or Bearer authorization or HMAC authorization.",code:i.authCodes.INVALID_CREDENTIALS});throw r.dispatch(n.setCredentialsFinished({error:e})),e}const S={headers:{"Content-Type":"application/json",Accept:"application/json"},...E&&{queryParams:{tokenrealm:E}}};if(t&&f)l.info("Setting the info for hmacToken scenario."),S.headers["x-token"]=f;else if(d&&u)l.info("Setting the info for authname/password scenario."),S.headers.Authorization="Basic "+s.default.encode(c.default.encode(d+":"+u));else if(t&&p)l.info("Setting the info for bearerAccessToken/username scenario."),S.headers.Authorization=`Bearer ${p}`;else if(t&&u)l.info("Setting the info for username/password scenario."),S.headers.Authorization="Basic "+s.default.encode(c.default.encode(t+":"+u));else if(!t||!g){l.info("Unexpected credentials scenario.");const e=new i.default({message:"This credentials signature is not valid.",code:i.authCodes.INVALID_CREDENTIALS});throw r.dispatch(n.setCredentialsFinished({error:e})),e}const O=(0,o.getAuthConfig)(r.getState());r.dispatch(n.setCredentialsFinished({userInfo:{username:g||t,isAnonymous:!!g},connection:{server:{server:O.server.base,port:O.server.port,protocol:O.server.protocol,version:O.server.version},username:t,bearerAccessToken:p,requestOptions:S}}))}};var n=d(r(44130)),o=r(87075),a=r(56512),i=d(r(75412)),s=l(r(86125)),c=l(r(82094));function l(e){return e&&e.__esModule?e:{default:e}}function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},73313:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=[],r=()=>Boolean(a());function o(e,r){return t.find((t=>t[e]===r))}function a(){return t.find((e=>e.isNegotiation&&e.tracker.status!==n.OP_STATUS.FINISHED||e.type===n.OPERATIONS.END))}return{add:function(a){const i=`${a.isLocal?"local":"remote"} ${a.type}`;if(e.debug(`Operations: Tracking ${i} operation with ${t.length} other on-going operations.`),a.isNegotiation&&r()){const t=o("isNegotiation",!0);throw e.info(`Cannot track new negotiation because of ${t.status} ${t.type} operation.`),new Error("Cannot track two blocking operations!")}if(o("id",a.id))throw e.warn("Cannot track operation that was previously tracked."),new Error("Operation is already being tracked!");if(a.status!==n.OP_STATUS.NOT_STARTED)throw e.warn("Cannot track operation that was previously started."),new Error("Operation was already started!");t.push(a)},remove:function(r){const a=`${r.isLocal?"local":"remote"} ${r.type}`;if(e.debug(`Operations: Done tracking ${a} operation with ${t.length-1} other on-going operations.`),!o("id",r.id))throw e.warn("Cannot stop tracking operation that was not previously tracked."),new Error("Operation is not being tracked!");if(!(r.tracker.status===n.OP_STATUS.FINISHED||r.isLocal&&[n.OPERATIONS.JOIN,n.OPERATIONS.DIRECT_TRANSFER,n.OPERATIONS.CONSULTATIVE_TRANSFER].includes(r.type)))throw e.warn("Cannot stop tracking operation that has not finished."),new Error(`Cannot remove on-going ${a} operation! (${r.tracker.status})`);const i=t.findIndex((e=>e.id===r.id));t.splice(i,1)},toState:()=>{},getById:e=>o("id",e),getByType:e=>o("type",e),getNegotiation:()=>o("isNegotiation",!0),getPending:function(){return t.filter((e=>e.tracker.status===n.OP_STATUS.PENDING))},getBlocking:a,getAll:function(){return t},get isBlocked(){return r()}}},r(97107),r(62234),r(69375);var n=r(59090)},3226:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,n,o,i){const d={status:a.OP_STATUS.NOT_STARTED},f=e.logManager.getLogger("CALL",t),p=`${o.isLocal?"local":"remote"} ${o.type}`;return o.type===a.OPERATIONS.JOIN&&i&&i.isJoinedCall&&(d.status=a.OP_STATUS.ONGOING),d.start=()=>{if(f.info(`Operations: Starting ${p} operation. Performing local changes.`),d.status!==a.OP_STATUS.NOT_STARTED)throw f.debug(`Cannot start ${p} operation; already started.`),new Error("Operation tracking has already been started.");s(e,t,r,n,o),d.status=a.OP_STATUS.ONGOING},d.update=i=>{if(f.info(`Operations: Updating ${p} operation. Waiting on remote response.`),d.status!==a.OP_STATUS.ONGOING)throw f.debug(`Cannot update ${p} operation; already pending.`),new Error("Operation tracking cannot be updated.");c(e,t,r,n,o,i),d.status=a.OP_STATUS.PENDING},d.resume=()=>{if(f.info(`Operations: Resuming ${p} operation. Finishing negotiation.`),d.status!==a.OP_STATUS.PENDING)throw f.debug(`Cannot resume ${p} operation; not pending a remote input.`),new Error("Operation tracking cannot be resumed.");l(e,t,r,n,o),d.status=a.OP_STATUS.RESOLVING},d.finish=i=>{if(f.info(`Operations: Finishing ${p} operation as ${i?"failure":"success"}.`),![a.OP_STATUS.ONGOING,a.OP_STATUS.PENDING,a.OP_STATUS.RESOLVING].includes(d.status))throw f.debug(`Cannot finish ${p} operation; already finished.`),new Error("Operation tracking cannot be finished.");u(e,t,r,n,o,i,d.status),d.status=a.OP_STATUS.FINISHED},d},t.finishOperation=u,t.resumeOperation=l,t.startOperation=s,t.updateOperation=c,r(97107),r(62234);var n=r(35),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),a=r(59090);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function s(e,t,r,i,s){const{context:c,emitEvent:l}=e,{type:u,isNegotiation:d}=s;c.dispatch(n.callActions.operationUpdate(t,u,s.isLocal,{transition:a.OP_TRANSITIONS.START,eventId:i,isBlocking:d,operationId:r})),l(o.CALL_OPERATION,{callId:t,operationId:r,isLocal:s.isLocal,operation:u,transition:a.OP_TRANSITIONS.START,previous:void 0})}function c(e,t,r,i,s,c){const{context:l,emitEvent:u}=e;l.dispatch(n.callActions.operationUpdate(t,s.type,s.isLocal,{transition:a.OP_TRANSITIONS.UPDATE,operationData:c&&c.operationData?c.operationData:void 0,eventId:i,operationId:r})),u(o.CALL_OPERATION,{callId:t,operationId:r,isLocal:s.isLocal,operation:s.type,transition:a.OP_TRANSITIONS.UPDATE,previous:{operation:s.type,status:a.OP_STATUS.ONGOING}})}function l(e,t,r,i,s){const{context:c,emitEvent:l}=e;c.dispatch(n.callActions.operationUpdate(t,s.type,s.isLocal,{transition:a.OP_TRANSITIONS.RESUME,eventId:i,operationId:r})),l(o.CALL_OPERATION,{callId:t,operationId:r,isLocal:s.isLocal,operation:s.type,transition:a.OP_TRANSITIONS.RESUME,previous:{operation:s.type,status:a.OP_STATUS.PENDING}})}function u(e,t,r,i,s,c,l){const{context:u,emitEvent:d}=e;u.dispatch(n.callActions.operationUpdate(t,s.type,s.isLocal,{transition:a.OP_TRANSITIONS.FINISH,eventId:i,operationId:r})),d(o.CALL_OPERATION,{callId:t,operationId:r,isLocal:s.isLocal,operation:s.type,transition:a.OP_TRANSITIONS.FINISH,error:c,previous:{operation:s.type,status:l}})}},53229:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const{context:n}=e,o=t.calls.reduce(((e,t)=>(e[t.callId]=!1,e)),{});let a=!1;function i(){return t.calls.every((e=>!0===o[e.callId]))}function s(e){if(!a&&(a=!0,t.reportEvent.endEvent(e),t.tracker.finish(e),e))throw e}const c={sessionComplete:async function(e,t){if(o[e.id]=!0,await r.remoteSuccess(e,t),i())return s()},sessionFail:async function(e,t){return s(await r.remoteFailure(e,t))},callEnd:async function(e,t){if(o[e.id]=!0,await r.remoteSuccess(e,t),i())return s()}};return{start:async function(e){t.tracker.start();const o=r.validate(n.getState(),e);if(o)throw t.reportEvent.endEvent(o),t.tracker.finish(o),o;try{t.tracker.update(),await r.signalling(e)}catch(e){throw t.reportEvent.endEvent(e),t.tracker.finish(e),e}},receiveResponse:async function(e,r){const n=r.eventType;if(!n)throw new Error(`No event type provided for ${t.type} feedback!`);if(void 0===c[n])throw new Error(`No ${n} on the flow!`);return c[n](e,r)}}},r(97107)},41534:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){async function n(e,n){await r.remoteSuccess(e,n),t.reportEvent.endEvent(),t.tracker.finish()}async function a(e,n){const o=await r.remoteFailure(e,n);throw t.reportEvent.endEvent(o),t.tracker.finish(o),o}return{start:(0,o.default)(e,t,r).start,receiveResponse:async function(e,t){return("sessionComplete"===t.eventType?n:a)(e,t)}}};var n,o=(n=r(98307))&&n.__esModule?n:{default:n}},52068:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const{context:i,logManager:s}=e,c=t.calls.reduce(((e,t)=>(e[t.callId]=!1,e)),{});let l=!1;function u(){return t.calls.every((e=>!0===c[e.callId]))}const d={respondCallUpdate:async function(e,o){c[e.id]=!0;const i=e.wrtcsSessionId,l=s.getLogger("CALL",e?e.id:void 0);if(t.tracker.resume(),e.state===n.CALL_STATES.ENDED)return void l.info("Join response for ended call. Ignoring.",{wrtcsSessionId:i});l.info(`Processing remote response for local ${t.type} operation.`);const d=(0,a.getMediaState)(e);l.debug(`Current call info; State: ${e.state}, MediaState: ${d}.`);try{await r.remoteAnswer(e,o)}catch(e){f(e)}u()&&f()},callEnd:async function(e,n){let a;await t.calls.map((async e=>{const t=(0,o.getCallById)(i.getState(),e.callId);if("joined"===e.role)return r.joinedFailure(t,n);a=await r.remoteFailure(t,n)})),f(a)},sessionComplete:async function(e,t){c[e.id]=!0,await r.remoteSuccess(e,t),u()&&f()},sessionFail:async function(e,t){f(await r.remoteFailure(e,t))}};function f(e){if(!l&&(l=!0,t.reportEvent.endEvent(e),t.tracker.finish(e),e))throw e}return{start:async function(e,n){t.tracker.start();const o=r.validate(i.getState(),e);o&&f(o);try{const o=await r.localOffer(e,...n);t.tracker.update(),await r.signalling(e,o)}catch(e){f(e)}},receiveResponse:async function(e,r){const n=r.eventType;if(!n)throw new Error(`No event type provided for ${t.type} feedback!`);if(void 0===d[n])throw new Error(`No ${n} on the flow!`);return d[n](e,r)}}},r(97107);var n=r(77126),o=r(40481),a=r(73520)},98307:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const{context:u,emitEvent:d,logManager:f}=e;let p,g=!1,E=!1;async function _(e,l){g=!0;const p=e.wrtcsSessionId,E=f.getLogger("CALL",e?e.id:void 0);if(t.tracker.resume(),e.state!==n.CALL_STATES.ENDED){if(l.sdp||49!==l.code||!l.retryAfter){if(l.customParameters){const t=l.customParameters,r=t.map((e=>e.name));E.debug(`Received custom parameters as part of the Call: ${r}.`),u.dispatch(a.callActions.customParametersReceived(e.id,{customParameters:t})),d(i.CUSTOM_PARAMETERS,{callId:e.id,customParameters:t})}return await async function(e,n){const o=f.getLogger("CALL",e.id);o.info(`Processing remote response for local ${t.type} operation.`);const a=(0,s.getMediaState)(e);o.debug(`Current call info; State: ${e.state}, MediaState: ${a}.`);try{await r.remoteAnswer(e,n)}catch(e){throw t.reportEvent.endEvent(e),t.tracker.finish(e),e}t.reportEvent.endEvent(),t.tracker.finish()}(e,l)}await async function(e,n){const a=f.getLogger("CALL",e.id);a.debug(`Response indicates an error scenario (${n.message}). Aborting operation.`);const i=new c.default({message:"Operation failed on remote side; aborting local operation by reverting it.",code:c.callCodes.GENERIC_ERROR});if(t.reportEvent.endEvent(i),r.rollback){let n;if(t.type===o.OPERATIONS.ADD_MEDIA||t.type===o.OPERATIONS.ADD_BASIC_MEDIA){const r=e.currentOperations.find((e=>e.id===t.id));r&&r.operationData&&(n=r.operationData)}try{await r.rollback(e.webrtcSessionId,n)}catch(e){throw a.info(`Rollbacking back local ${t.type} failed. Error: ${e.message}`),t.tracker.finish(e),e}}t.tracker.finish(i)}(e,l)}else E.info("Update response for ended call. Ignoring.",{wrtcsSessionId:p})}return{start:async function(e,n){if(t.status!==o.OP_STATUS.NOT_STARTED)throw new Error("Flow cannot be started a second time.");return async function(e,n){if(t.tracker.start(),r.validate){const o=r.validate(u.getState(),e,...n);if(o)throw t.reportEvent.endEvent(o),t.tracker.finish(o),o}try{const a=await r.localOffer(e,...n);if(t.tracker.update(a),await r.signalling(e,a),E=!0,p&&t.status===o.OP_STATUS.PENDING){const{params:t,promise:r}=p,n=(0,l.getCallById)(u.getState(),e);p=void 0,_(n,t).then(r.resolve).catch(r.reject)}return a}catch(e){if(t.status===o.OP_STATUS.FINISHED||g)return;throw t.reportEvent.endEvent(e),t.tracker.finish(e),e}}(e,n)},receiveResponse:async function(e,r){if(t.status!==o.OP_STATUS.PENDING)throw new Error("Cannot receive response in current state.");if(g||p)throw new Error("Negotiations should only receive one response.");if(E)return _(e,r);{const n=f.getLogger("CALL",e.id);return n.debug(`Received negotiation answer for local ${t.type} too early; delaying processing.`),Promise.race([new Promise(((e,t)=>{p={params:r,promise:{resolve:e,reject:t}}})),new Promise((e=>setTimeout((()=>{p&&e(new Error("timeout"))}),500)))]).then((t=>t&&"timeout"===t.message?(n.debug("Timed-out waiting for signaling response; attempting to process."),p=void 0,_(e,r)):t))}}}},r(97107);var n=r(77126),o=r(59090),a=r(35),i=d(r(51918)),s=r(73520),c=d(r(75412)),l=r(40481);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},89536:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const{context:n}=e;return{start:async function(e,o){if(t.tracker.start(),r.validate){const a=r.validate(n.getState(),e,...o);if(a)throw t.reportEvent.endEvent(a),t.tracker.finish(a),a}try{const n=await r.localOffer(e,...o);return r.signalling&&(t.tracker.update(),await r.signalling(e,...o,n)),t.reportEvent.endEvent(),t.tracker.finish(),n}catch(e){throw t.reportEvent.endEvent(e),t.tracker.finish(e),e}}}}},8922:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const{context:n,Callstack:c,emitEvent:l,logManager:u}=e;return{start:async function(e,d,f){const p=u.getLogger("CALL",d.callId);if(p.info("Received new incoming call; initiating.",{wrtcsSessionId:e}),(0,o.getCallByWrtcsSessionId)(n.getState(),e))return void p.warn("Local call already exists; ignoring incoming call.");const g=!d.sdp;let E=null;if(g||(E={audio:!1,video:!1},s.default.parse(d.sdp).media.forEach((e=>{E[e.type]=!0}))),n.dispatch(a.callActions.callIncoming(d.callId,{remoteParticipant:{displayName:d.remoteName,displayNumber:d.remoteNumber},to:d.calleeNumber,from:d.remoteNumber,wrtcsSessionId:e,isSlowStart:g,mediaOffered:E})),t.tracker.start(),l(i.CALL_INCOMING,{callId:d.callId,mediaOffered:E}),d.customParameters){const e=d.customParameters,t=e.map((e=>e.name));p.debug(`Received custom parameters as part of the Call: ${t}.`),n.dispatch(a.callActions.customParametersReceived(d.callId,{customParameters:e})),l(i.CUSTOM_PARAMETERS,{callId:d.callId,customParameters:e})}try{await r.remoteOffer(e,d)}catch(e){return t.tracker.finish(e),void t.reportEvent.endEvent(e)}if(f&&"push"===f.toLowerCase())try{await c.operations.resyncCallState.stages.signalling(d.callId)}catch(e){}t.tracker.finish(),t.reportEvent.endEvent()}}};var n,o=r(40481),a=r(35),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),s=(n=r(54722))&&n.__esModule?n:{default:n};function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}},29749:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const{context:s,emitEvent:c,logManager:l}=e;return{start:async function(e,u,d){const f=l.getLogger("CALL",e?e.id:void 0);if(f.info("Received new update call request; handling.",{wrtcsSessionId:e.wrtcsSessionId}),d.customParameters){const t=d.customParameters,r=t.map((e=>e.name));f.debug(`Received custom parameters as part of the Call: ${r}.`),s.dispatch(o.callActions.customParametersReceived(e.id,{customParameters:t})),c(n.CUSTOM_PARAMETERS,{callId:e.id,customParameters:t})}return await async function(e,n,o){const c=l.getLogger("CALL",e.id);t.tracker.start(),e=(0,a.getCallById)(s.getState(),e.id);try{const a=(0,i.getMediaState)(e);c.info(`Processing update request as remote ${n.remoteOp} operation in ${a} scenario.`);const s=await r.remoteOffer(e,o,n);t.tracker.update(s),await r.signalling(e,o,s)}catch(e){throw t.reportEvent.setError(e),t.reportEvent.endEvent(),t.tracker.finish(e),e}t.reportEvent.endEvent(),t.tracker.finish()}(e,u,d)}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),o=r(35),a=r(40481),i=r(73520);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},46883:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createEnded=function(e,t,r){const{start:o}=a(0,t,r);return{start:async function(e,t,r){await o(e,t),r&&(r.reportEvent.endEvent(),r.tracker.status!==n.OP_STATUS.FINISHED&&r.tracker.finish())}}},t.createGeneric=a,t.createPending=function(e,t,r){return{start:async function(e,n,a){const i=t.reportEvent.addEvent(o.REPORTER_OPERATION_EVENTS_MAP[n]);try{await r[n](e.wrtcsSessionId,...a),i.endEvent()}catch(e){i.endEvent(e)}}}};var n=r(59090),o=r(84581);function a(e,t,r){return{start:async function(e,n){t.tracker.start(),await r.remoteOffer(e.wrtcsSessionId,n),t.tracker.finish(),t.reportEvent.endEvent()}}}},11352:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.callManager=y,t.default=function(e){(0,c.default)(e),(0,l.default)(e),(0,u.default)(e),e.factory("CallManager",(()=>y(e.container)))},r(97107),r(62234);var n=r(77126),o=r(59090),a=r(40481),i=r(29127),s=E(r(73313)),c=E(r(67230)),l=E(r(24638)),u=E(r(82998)),d=r(45590),f=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=g(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412)),p=r(84596);function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(g=function(e){return e?r:t})(e)}function E(e){return e&&e.__esModule?e:{default:e}}function _(e,t){if(!(0,a.getCallById)(e,t)&&!(0,a.getCallByWrtcsSessionId)(e,t))throw new f.default({code:f.callCodes.INVALID_PARAM,message:`Call does not exist: ${t}`})}function y(e){const{context:t,Callstack:r,CallReporter:c,logManager:l,CallRequests:u,TimerTracker:g}=e,E={},y={getTracker:e=>E[e],getCallIds:()=>Object.keys(E)};async function v(e,r){const n=(0,a.getCallByWrtcsSessionId)(t.getState(),e),i=l.getLogger("CALL",n?n.id:void 0);if(!n)return void i.info("Update response for unknown wrtcsSession. Ignoring.",{wrtcsSessionId:e});i.info("Received new update call response; handling.",{wrtcsSessionId:e});const s=await async function(e){return(0,a.getCallById)(t.getState(),e).currentOperations.find(((e,t,r)=>e.isLocal&&e.isBlocking||!e.isLocal&&e.type===o.OPERATIONS.SLOW_START&&e.isBlocking||e.isLocal&&e.type===o.OPERATIONS.JOIN&&1===r.length))}(n.id);if(!s)return void i.warn("Received negotiation answer without a matching offer; ignoring.");const c=E[n.id].getByType(s.type);if(c)try{await c.receiveResponse(n,r)}catch(e){i.info(`Failed handling ${c.type} response.`,e.message),c.deferred.reject(e)}finally{E[n.id].remove(c),(c.type!==o.OPERATIONS.JOIN||c.type===o.OPERATIONS.JOIN&&c.status===o.OP_STATUS.FINISHED)&&c.deferred.resolve()}else i.warn("Received negotiation answer without a matching offer; ignoring.")}async function S(e,r){const n=t.getState(),i=(0,a.getCallByWrtcsSessionId)(n,e);_(n,i.id);const s=E[i.id].getAll().find((e=>e.isLocal&&[o.OPERATIONS.JOIN,o.OPERATIONS.CONSULTATIVE_TRANSFER,o.OPERATIONS.DIRECT_TRANSFER].includes(e.type)));if(!s)throw new Error(`Complex response entry cannot be used for notification ${r.eventType}`);try{await s.receiveResponse(i,r)}catch(e){s.deferred.reject(e)}E[i.id].remove(s),s.type===o.OPERATIONS.JOIN&&i.id===s.data.priCallId&&E[s.data.joinedCallId].getById(s.id)&&E[s.data.joinedCallId].remove(s),s.status===o.OP_STATUS.FINISHED&&s.deferred.resolve()}var O;return y.make=function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return new Promise(((n,a)=>{e.CallReporter.createReport("CALL",t);const i=r.operations.make.local(t,{resolve:n,reject:a});E[t]=(0,s.default)(l.getLogger("CALL",t)),E[t].add(i),i.start(t,o).then(n).catch(a)}))},y.establishOffer=async function(t,n,o){const a=(0,p.v4)();e.CallReporter.createReport("CALL",a),E[a]=(0,s.default)(l.getLogger("CALL",a));const i=r.operations.make.remote(a);E[a].add(i),n.callId=a,await i.start(t,n,o),E[a].remove(i)},y.negotiationOffer=async function(e,s){let c=(0,a.getCallByWrtcsSessionId)(t.getState(),e);const d=l.getLogger("CALL",c?c.id:void 0);if(d.info("Received new update call request; handling.",{wrtcsSessionId:e}),!c)throw d.info("Update request is for unknown wrtcsSession. Ignoring.",{wrtcsSessionId:e}),new f.default({code:f.callCodes.INVALID_STATE,message:"Cannot process new remote operation for call that does not exist."});if(c.state===n.CALL_STATES.ENDED)throw d.info("Update request is for ended call. Ignoring.",{wrtcsSessionId:e}),new f.default({code:f.callCodes.INVALID_STATE,message:"Cannot process new remote operation for Ended call."});let p;const g=!s.sdp;p=g?{remoteOp:o.OPERATIONS.SLOW_START}:await r.utils.getRemoteOperationInfo(c,s.sdp);const _=i.operationMap[p.remoteOp],y=r.operations[_].remote(c.id);if(await async function e(r){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!E[r.id].isBlocked)return!1;if(n>=3e3)return!0;const{isLocal:i,type:s}=E[r.id].getBlocking();return d.debug(`Received new remote operation during ${i?"local":"remote"} ${s} operation. Delaying handling.`),!(!i&&s!==o.OPERATIONS.END)||(await new Promise((e=>setTimeout(e,250))),e((0,a.getCallById)(t.getState(),r.id),n+250))}(c)){y.tracker.start(),d.warn("Received new remote operation during on-going operation; cannot process."),u.updateSessionResponse({statusCode:491,wrtcsSessionId:e}).then((()=>{})).catch((e=>{d.warn(`Failed to reply for a remote session update. Error: ${e.message}`)}));const t=new f.default({code:f.callCodes.GLARE,message:`Cannot process new remote ${p.remoteOp} negotiation due to glare scenario.`});throw y.reportEvent.setError(t),y.reportEvent.endEvent(),y.tracker.finish(t),t}E[c.id].add(y);try{c=(0,a.getCallByWrtcsSessionId)(t.getState(),e),await y.start(c,p,s)}catch(e){throw E[c.id].remove(y),e}g||E[c.id].remove(y)},y.negotiationAnswer=v,[o.OPERATIONS.SLOW_ANSWER,o.OPERATIONS.HOLD,o.OPERATIONS.UNHOLD,o.OPERATIONS.ADD_MEDIA,o.OPERATIONS.REMOVE_MEDIA,o.OPERATIONS.ADD_BASIC_MEDIA,o.OPERATIONS.REMOVE_BASIC_MEDIA,o.OPERATIONS.MEDIA_RESTART,o.OPERATIONS.DIRECT_TRANSFER,o.OPERATIONS.ANSWER,o.OPERATIONS.REJECT,o.OPERATIONS.IGNORE,o.OPERATIONS.FORWARD_CALL,o.OPERATIONS.END,o.OPERATIONS.REPLACE_TRACK,o.OPERATIONS.RESYNC,o.OPERATIONS.PLAY_AUDIO,o.OPERATIONS.SEND_RINGING_FEEDBACK,o.OPERATIONS.SEND_CUSTOM_PARAMETERS,o.OPERATIONS.SEND_DTMF,o.OPERATIONS.GET_STATS].forEach((e=>{const n=i.operationMap[e];y[n]=function(e){return function(n){for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];return new Promise(((i,c)=>{_(t.getState(),n);const l=r.operations[e].local(n,{resolve:i,reject:c});if(E[n].getByType(o.OPERATIONS.END))throw new f.default({code:f.callCodes.GLARE,message:`Cannot start new local ${l.type} operation while call is ending.`});if(l.isNegotiation&&(E[n].isBlocked||E[n].getByType(o.OPERATIONS.ANSWER)||E[n].getByType(o.OPERATIONS.SLOW_ANSWER)))throw new f.default({code:f.callCodes.GLARE,message:`Cannot start new local ${l.type} negotiation due to glare scenario.`});E[n].add(l),l.start(n,s).then((e=>{if(l.isNegotiation){const e=(0,d.getRESTTimeout)(t.getState())+15e3,r=(e,r)=>{let n;try{n=t.getState()}catch(e){return}const i=(0,a.getCallById)(n,e),s=i.currentOperations.find((e=>e.id===r));s&&s.status===o.OP_STATUS.PENDING&&v(i.wrtcsSessionId,{code:49,retryAfter:1e4})};g.create("callNegotiation",r,e,{id:n,params:[n,l.id]})}else E[n].remove(l),i(e)})).catch((e=>{E[n].remove(l),c(e)}))}))}}(n)})),["CALL_STATUS_RINGING","RECEIVE_EARLY_MEDIA"].forEach((e=>{const r=i.notificationMap[e];y[r]=function(e){return async function(r){_(t.getState(),r);const n=(0,a.getCallByWrtcsSessionId)(t.getState(),r),i=l.getLogger("CALL",n?n.id:void 0),s=E[n.id].getPending().find((e=>e.isLocal&&[o.OPERATIONS.MAKE,o.OPERATIONS.MAKE_ANONYMOUS].includes(e.type)));if(s){for(var c=arguments.length,u=new Array(c>1?c-1:0),d=1;d<c;d++)u[d-1]=arguments[d];await s.receiveUpdate(n,e,u)}else i.debug(`Received ${e} notification for non-make operation; ignoring.`)}}(r)})),y[i.notificationMap.CALL_CANCELLED]=(O=i.notificationMap.CALL_CANCELLED,async function(e,n){const o=t.getState();_(o,e);const i=(0,a.getCallByWrtcsSessionId)(o,e),s=r.operations[O](i.id);E[i.id].add(s),await s.start(i,n),E[i.id].remove(s)}),y[i.notificationMap.CALL_STATUS_ENDED]=async function(e,n){const i=t.getState();_(i,e);const s=(0,a.getCallByWrtcsSessionId)(i,e),c=E[s.id].getAll().filter((e=>[o.OPERATIONS.CONSULTATIVE_TRANSFER,o.OPERATIONS.JOIN].includes(e.type)))[0];if(c){const{type:e,calls:t}=c;if(e===o.OPERATIONS.CONSULTATIVE_TRANSFER&&t.some((e=>{let{role:t}=e;return"secondary"===t})))await c.receiveResponse(s,n),E[s.id].remove(c);else if(e===o.OPERATIONS.JOIN&&t.find((e=>"joined"===e.role&&e.callId===s.id))){let e;try{await c.receiveResponse(s,n)}catch(t){e=t}t.forEach((e=>{E[e.callId].remove(c)})),e?c.deferred.reject(e):c.deferred.resolve()}}else{const e=r.operations.end.remote(s.id);E[s.id].add(e);const t=E[s.id].getPending()[0];await e.start(s,n,t),E[s.id].remove(e)}},["CALL_STATUS_FAILED","SESSION_STATUS_ENDED"].forEach((e=>{const t=i.notificationMap[e];y[t]=S})),[o.OPERATIONS.CONSULTATIVE_TRANSFER,o.OPERATIONS.JOIN].forEach((e=>{const n=i.operationMap[e];y[n]=function(e){return function(n){for(var a=arguments.length,i=new Array(a>1?a-1:0),u=1;u<a;u++)i[u-1]=arguments[u];return new Promise(((a,u)=>{const d=n.map((e=>e.id)),[p,g,y]=d;_(t.getState(),p),_(t.getState(),g),y&&c.createReport("CALL",y);const v=r.operations[e].local(n,{resolve:a,reject:u});if(E[p].isBlocked||E[g].isBlocked){const e=E[p].isBlocked?p:g;u(new f.default({code:f.callCodes.GLARE,message:`Cannot start new local ${v.type} operation due to glare scenario for call ${e}.`}))}else if(E[p].add(v),E[g].add(v),v.type===o.OPERATIONS.JOIN){const e=(0,s.default)(l.getLogger("CALL",y));E[y]=e,E[y].add(v),v.start(n,i).catch(u)}else v.type===o.OPERATIONS.CONSULTATIVE_TRANSFER?v.start(n).catch(u):u(new Error(`Dual-call entry cannot be used for ${v.type}`))}))}}(n)})),y}},82998:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.instanceFactory("Callstack.models.MultiCall",((t,r,n)=>{const{type:s,isNegotiation:c,stages:l,createFlow:u}=r;r.isLocal=!0;const d=(0,i.v4)(),{callInfo:f,deferred:p,data:g}=n,E=a.REPORTER_OPERATION_EVENTS_MAP[s+"_LOCAL"]||a.REPORTER_OPERATION_EVENTS_MAP[s],_=f.map((t=>{let{id:n,role:a}=t;const i=e.container.CallReporter.getReport(n).addEvent(E);return{callId:n,role:a,reportEvent:i,tracker:(0,o.default)(e.container,n,d,i.id,r,{isJoinedCall:"joined"===a})}})),y={type:s,isNegotiation:c,isLocal:!0,start:void 0,receiveResponse:void 0,calls:_,id:d,data:{...g},tracker:{start:()=>_.forEach((e=>{"joined"!==e.role&&e.tracker.start()})),update:e=>_.forEach((t=>t.tracker.update(e))),resume:()=>_.forEach((e=>e.tracker.resume())),finish:e=>_.forEach((t=>t.tracker.finish(e)))},get status(){return _[0].tracker.status},reportEvent:{addEvent:e=>_.forEach((t=>t.reportEvent.addEvent(e))),setError:e=>_.forEach((t=>t.reportEvent.setError(e))),endEvent:e=>_.forEach((t=>t.reportEvent.endEvent(e)))},deferred:p},v=u(e.container,y,l);return Object.assign(y,v),y}))};var n,o=(n=r(3226))&&n.__esModule?n:{default:n},a=r(84581),i=r(84596)},67230:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.instanceFactory("Callstack.models.Negotiation",((t,r,c)=>{const l=r.createFlow??(r.isLocal?o.default:a.default),{type:u,isLocal:d,stages:f}=r,p=(0,s.v4)(),{callId:g,deferred:E,data:_}=c,y=i.REPORTER_OPERATION_EVENTS_MAP[u+(d?"_LOCAL":"_REMOTE")]||i.REPORTER_OPERATION_EVENTS_MAP[u],v=e.container.CallReporter.getReport(g).addEvent(y);r.isNegotiation=!0;const S=(0,n.default)(e.container,g,p,v.id,r),O={type:u,isNegotiation:!0,isLocal:d,start:void 0,receiveResponse:void 0,receiveUpdate:void 0,callId:g,id:p,data:{..._},tracker:S,get status(){return S.status},reportEvent:v,deferred:E},h=l(e.container,O,f);return Object.assign(O,h),O}))};var n=c(r(3226)),o=c(r(98307)),a=c(r(29749)),i=r(84581),s=r(84596);function c(e){return e&&e.__esModule?e:{default:e}}},24638:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.instanceFactory("Callstack.models.Update",((t,r,c)=>{!function(e,t){const{validate:r,localOffer:n,remoteOffer:o}=t;if(e&&!Boolean(r)&&!Boolean(n))throw new Error("Missing local stage for Update operation.");if(!e&&!o)throw new Error("Missing remote stage for Update operation.")}(r.isLocal,r.stages);const l=r.createFlow??(r.isLocal?o.default:a.createGeneric),{type:u,isLocal:d,stages:f}=r,p=(0,s.v4)(),{callId:g,data:E}=c,_=i.REPORTER_OPERATION_EVENTS_MAP[u+(d?"_LOCAL":"_REMOTE")]||i.REPORTER_OPERATION_EVENTS_MAP[u],y=e.container.CallReporter.getReport(g).addEvent(_);r.isNegotiation=!1;const v=(0,n.default)(e.container,g,p,y.id,r),S={type:u,isNegotiation:!1,isLocal:d,start:void 0,callId:g,id:p,data:{...E},tracker:v,get status(){return v.status},reportEvent:y},O=l(e.container,S,f);return Object.assign(S,O),S}))},r(97107);var n=c(r(3226)),o=c(r(89536)),a=r(46883),i=r(84581),s=r(84596);function c(e){return e&&e.__esModule?e:{default:e}}},29127:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.operationMap=t.notificationMap=void 0;var n=r(59090);t.operationMap={[n.OPERATIONS.MAKE]:"make",[n.OPERATIONS.MAKE_ANONYMOUS]:"makeAnonymousCall",[n.OPERATIONS.ANSWER]:"answer",SLOW_ANSWER:"answerSlow",[n.OPERATIONS.REJECT]:"reject",[n.OPERATIONS.IGNORE]:"ignore",[n.OPERATIONS.FORWARD_CALL]:"forward",[n.OPERATIONS.END]:"end",[n.OPERATIONS.DIRECT_TRANSFER]:"directTransfer",[n.OPERATIONS.CONSULTATIVE_TRANSFER]:"consultativeTransfer",[n.OPERATIONS.JOIN]:"join",[n.OPERATIONS.HOLD]:"hold",[n.OPERATIONS.UNHOLD]:"unhold",[n.OPERATIONS.ADD_MEDIA]:"addMedia",[n.OPERATIONS.REMOVE_MEDIA]:"removeMedia",[n.OPERATIONS.ADD_BASIC_MEDIA]:"addBasicMedia",[n.OPERATIONS.REMOVE_BASIC_MEDIA]:"removeBasicMedia",[n.OPERATIONS.REPLACE_TRACK]:"replaceTrack",[n.OPERATIONS.MEDIA_RESTART]:"iceRestart",[n.OPERATIONS.RESYNC]:"resyncCallState",[n.OPERATIONS.PLAY_AUDIO]:"playAudioFile",[n.OPERATIONS.SEND_RINGING_FEEDBACK]:"sendRingingFeedback",[n.OPERATIONS.SEND_CUSTOM_PARAMETERS]:"sendCustomParameters",[n.OPERATIONS.SEND_DTMF]:"sendDtmf",[n.OPERATIONS.GET_STATS]:"getStats",[n.OPERATIONS.GET_AVAILABLE_CODECS]:"getAvailableCodecs",[n.OPERATIONS.START_MOH]:"startMOH",[n.OPERATIONS.STOP_MOH]:"stopMOH",[n.OPERATIONS.SLOW_START]:"slowStart",UNKNOWN:"genericRemote",NO_CHANGE:"genericRemote",[n.OPERATIONS.GENERIC_REMOTE]:"genericRemote"},t.notificationMap={CALL_STATUS_ENDED:"callStatusUpdateEnded",CALL_CANCELLED:"callCancelled",CALL_STATUS_RINGING:"callStatusUpdateRinging",CALL_STATUS_FAILED:"callStatusUpdateFailed",RECEIVE_EARLY_MEDIA:"receiveEarlyMedia",SESSION_STATUS_ENDED:"sessionStatusUpdateEnded"}},41600:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(const t in n)n[t](e);(0,s.default)(e),(0,o.default)(e),(0,a.default)(e),(0,c.default)(e),(0,i.default)(e)};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(74043)),o=l(r(52410)),a=l(r(15156)),i=l(r(11352)),s=l(r(58384)),c=l(r(63858));function l(e){return e&&e.__esModule?e:{default:e}}function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}},14102:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.container.Callstack.operations;return async function(e){if(!a(e))return!1;t.sendCallAudit(e.payload.id,{wrtcsSessionId:e.payload.wrtcsSessionId})}},t.shouldHandlePattern=a;var n=r(21836),o=r(77126);function a(e){const t=[n.UPDATE_CALL,n.PENDING_JOIN,n.PENDING_MAKE_CALL];return!e.error&&-1!==t.indexOf(e.type)&&(e.payload.state===o.CALL_STATES.INITIATED||e.payload.state===o.CALL_STATES.RINGING)}},63604:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,Callstack:r,CallRequests:c,CallstackWebrtc:l,emitEvent:d}=e.container;return async function(f){if(!u(f))return;if(!(0,i.getOptions)(e.getState()).resyncOnConnect)return;const p=(0,i.getCalls)(e.getState()).filter((e=>e.state!==s.CALL_STATES.CANCELLED&&e.state!==s.CALL_STATES.ENDED));function g(e){return 0===e.currentOperations.length}for(const u of p){const f=t.getLogger("CALL",u.id),p=u.state;if(g(u))try{const t=await c.getSession({wrtcsSessionId:u.wrtcsSessionId,id:u.id}),n=(0,i.getCallById)(e.getState(),u.id);g(n)&&(n.state!==s.CALL_STATES.RINGING&&p===s.CALL_STATES.RINGING||await r.operations.resyncCallState(u.id,t))}catch(t){const r=(0,i.getCallById)(e.getState(),u.id);g(r)&&(r.state!==s.CALL_STATES.RINGING&&p===s.CALL_STATES.RINGING||(47===t.code?(await l.closeCall(u.webrtcSessionId),f.info(`Call re-sync found that call is ended. Changing to ${s.CALL_STATES.ENDED}.`),e.dispatch(n.callActions.endCallFinish(u.id,{isLocal:!0,error:t})),d(o.CALL_OPERATION,{callId:u.id,isLocal:!0,operation:a.OPERATIONS.END,transition:a.OP_TRANSITIONS.FINISH,previous:{},error:t}),d(o.CALL_TRACKS_REMOVED,{callId:u.id,trackIds:[...u.localTracks,...u.remoteTracks]}),d(o.CALL_STATE_CHANGE,{callId:u.id,previous:{state:u.state,localHold:u.localHold,remoteHold:u.remoteHold},error:t})):f.debug(`Call re-sync failure (${t.code}).`,t)))}}}},t.shouldHandlePattern=u;var n=r(35),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),a=r(59090),i=r(40481),s=r(77126),c=r(9719);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e){return e.type===c.WS_CONNECT_FINISHED}},70216:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.container.Callstack.operations;return async function(e){if(!o(e))return;const{id:r,...n}=e.payload;await t.callIceCollectionCheck(r,n)}},t.shouldHandlePattern=o;var n=r(81997);function o(e){return e.type===n.SESSION_ICE_GATHERING_STATE_CHANGE||e.type===n.SESSION_ICE_CANDIDATE_COLLECTED||e.type===n.SESSION_ICE_COLLECTION_SCHEDULED_CHECK}},54493:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(63604)),o=s(r(70216)),a=s(r(43621)),i=s(r(14102));function s(e){return e&&e.__esModule?e:{default:e}}const c=[n.default,o.default,a.default,i.default];t.default=c},43621:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.container.Callstack;return async function(e){a(e)&&t.operations.normalizeIceFailure(e.payload.id,e.payload.iceConnectionState)}},t.shouldHandlePattern=a;var n=r(81997),o=r(77126);function a(e){return e.type===n.SESSION_ICE_CONNECTION_STATE_CHANGE&&e.payload.iceConnectionState===o.CALL_MEDIA_CONNECTION_STATES.DISCONNECTED}},2893:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async function(t){return o(e,t)}},t.signalling=o;var n=r(40481);async function o(e,t){const{context:r,CallRequests:o,logManager:a}=e,i=t[0].id,s=t[1].id,c=a.getLogger("CALL",i);c.info("Performing consultative transfer on call.");const l=(0,n.getCallById)(r.getState(),i),u=(0,n.getCallById)(r.getState(),s),d={id:i,wrtcsSessionId:l.wrtcsSessionId,otherWrtcsSessionId:u.wrtcsSessionId,destination:"outgoing"===u.direction?u.to:u.from};try{await o.consultativeTransferSessions(d)}catch(e){throw c.info("Failed to consultative transfer call."),e}c.info("Finished local portion of consultative transfer. Waiting on remote response.")}},4899:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.operations.consultativeTransfer",(()=>{const t=e.container.Callstack.models.MultiCall;return{local:function(r,l){return t.instance({type:c.OPERATIONS.CONSULTATIVE_TRANSFER,isNegotiation:!0,stages:{validate:i.default,signalling:(0,n.default)(e.container),remoteSuccess:(0,o.default)(e.container),remoteFailure:(0,a.default)(e.container)},createFlow:s.default},{callInfo:r,deferred:l})}}}))};var n=l(r(2893)),o=l(r(18666)),a=l(r(99475)),i=l(r(11257)),s=l(r(53229)),c=r(59090);function l(e){return e&&e.__esModule?e:{default:e}}},99475:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r}=e;return function(e,i){const s=i.reasonText||o.COMPLEX_OPERATION_MESSAGES.CONSULTATIVE_TRANSFER_FAILURE,c=i.statusCode||o.STATUS_CODES.CONSULTATIVE_TRANSFER_FAILURE,l=r.getLogger("CALL",e.id);l.info("Received call operation failed notice; handling.",{wrtcsSessionId:e.wrtcsSessionId}),l.debug(`Processing as a local consultative transfer failure (${c}).`),l.info("Finished handling call operation failed notice.");const u=new a.default({message:`Consultative transfer operation failed: ${s} (${c})`,code:a.callCodes.GENERIC_ERROR});return t.dispatch(n.callActions.consultativeTransferFinish(e.id,{error:u,transition:{reasonText:s,statusCode:c}})),u}};var n=r(35),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},18666:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,CallRequests:r,CallstackWebrtc:s,emitEvent:c,logManager:l}=e;return async function(e,u){const d=l.getLogger("CALL",e.id);d.info("Received session status completed notice; handling.",{wrtcsSessionId:e.wrtcsSessionId});const{reasonText:f,statusCode:p}=u;if(f){let e;e=p||0===p?p:a.STATUS_CODES.CONSULTATIVE_TRANSFER_SUCCESS,d.debug(`Session completed notice caused by ${f} (${e}).`)}d.info(`Ending webRTC session with id: ${e.webrtcSessionId}, locally ...`),await s.closeCall(e.webrtcSessionId),t.dispatch(n.callActions.consultativeTransferFinish(e.id,{transition:{reasonText:a.COMPLEX_OPERATION_MESSAGES.CONSULTATIVE_TRANSFER_SUCCESS,statusCode:a.STATUS_CODES.CONSULTATIVE_TRANSFER_SUCCESS}}));try{d.debug("Ending call session on server-side."),await r.endSession({callId:e.id,wrtcsSessionId:e.wrtcsSessionId,isAnonymous:e.isAnonymous,account:e.account})}catch(e){d.debug(`Error received when attempting to end the session: ${e}.`)}finally{d.info(`Finished ending call. Changing call state to ${a.CALL_STATES.ENDED}.`),t.dispatch(n.callActions.endCallFinish(e.id,(0,i.generateEndParams)(e.state,!0,u))),c(o.CALL_TRACKS_REMOVED,{callId:e.id,trackIds:[...e.localTracks,...e.remoteTracks]}),c(o.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold}})}}};var n=r(35),o=r(51918),a=r(77126),i=r(69752)},11257:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=(0,n.getCallById)(e,t[0].id),i=(0,n.getCallById)(e,t[1].id);return r&&i?r.state!==o.CALL_STATES.ON_HOLD?new a.default({code:a.callCodes.INVALID_STATE,message:`Call is in an invalid state: state=${r.state}. It should be: state=${o.CALL_STATES.ON_HOLD}.`}):i.state!==o.CALL_STATES.ON_HOLD?new a.default({code:a.callCodes.INVALID_STATE,message:`Call is in an invalid state: state=${i.state}. It should be: state=${o.CALL_STATES.ON_HOLD}.`}):void 0:new a.default({code:a.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."})};var n=r(40481),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},12509:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.operations.join",(()=>{const t=e.container.Callstack.models.MultiCall;return{local:function(r,d){const f=(0,n.default)(e.container);return t.instance({type:u.OPERATIONS.JOIN,isNegotiation:!1,stages:{validate:o.default,localOffer:f.localChanges,signalling:f.signalling,remoteAnswer:(0,a.default)(e.container),remoteSuccess:(0,i.default)(e.container),remoteFailure:(0,s.default)(e.container),joinedFailure:(0,c.default)(e.container)},createFlow:l.default},{callInfo:r,deferred:d})}}}))};var n=d(r(61397)),o=d(r(61727)),a=d(r(51185)),i=d(r(50332)),s=d(r(76857)),c=d(r(69584)),l=d(r(52068)),u=r(59090);function d(e){return e&&e.__esModule?e:{default:e}}},61397:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{localChanges:(t,r)=>async function(e,t,r){const{CallReporter:u,Callstack:d,context:f,emitEvent:p,logManager:g}=e,{setupOutgoingSession:E}=d.utils,_=t[0].id,y=t[1].id,v=t[2].id,S=g.getLogger("CALL",_);S.info(`Performing join on calls ${_} and ${y}.`);const O=(0,s.getCallById)(f.getState(),_),h=(0,s.getCallById)(f.getState(),y),T=O.remoteParticipant.displayName,I=h.remoteParticipant.displayName;let C;T&&I?C=`${T},${I}`:T?C=`${T},`:I&&(C=`,${I}`);const m=`${O.direction===n.CALL_DIRECTION.OUTGOING?O.to:O.from},${h.direction===n.CALL_DIRECTION.OUTGOING?h.to:h.from}`,A={video:!1,audio:O.mediaConstraints&&O.mediaConstraints.audio||!0},b=(0,a.checkBandwidthControls)(O.bandwidth),R=O.dscpControls,N=(0,s.getTurnInfo)(f.getState()),{trickleIceMode:P,defaultPeerConfig:w,removeBundling:M,serverTurnCredentials:L}=(0,s.getOptions)(f.getState()),D=u.getReport(v).findLastOngoingEvent(l.REPORTER_OPERATION_EVENTS_MAP.JOIN),k=O.currentOperations.find((e=>e.type===c.OPERATIONS.JOIN));let j;f.dispatch(o.callActions.joinStart(v,{mediaConstraints:A,participantAddress:m,participantName:C,from:r,usedCallIds:[O.id,h.id],customParameters:O.customParameters,dscpControls:R,bandwidth:b,eventId:D.id,operationId:k.id}));try{j=await E(A,{defaultPeerConfig:w,turnInfo:N,trickleIceMode:P,dscpControls:R,removeBundling:M,bandwidth:b,callId:v,serverTurnCredentials:L})}catch(e){throw S.info(`Failed to initiate call. Changing to ${n.CALL_STATES.ENDED}.`),f.dispatch(o.callActions.joinFinish(v,{usedCallIds:[O.id,h.id],error:e})),p(i.CALL_STATE_CHANGE,{callId:v,previous:{state:n.CALL_STATES.INITIATING,localHold:!1,remoteHold:!1},error:e}),p(i.CALL_OPERATION,{callId:v,isLocal:!0,operation:c.OPERATIONS.JOIN,transition:c.OP_TRANSITIONS.FINISH,previous:void 0,error:e}),e}return{webrtcInfo:j}}(e,t,r),signalling:(t,r)=>async function(e,t,r){const{CallRequests:a,CallstackWebrtc:l,context:d,emitEvent:f,logManager:p}=e,{webrtcInfo:g}=r,E=t[0].id,_=t[1].id,y=t[2].id,v=p.getLogger("CALL",E),S=(0,s.getCallById)(d.getState(),E),O=(0,s.getCallById)(d.getState(),_),{offerSdp:h,sessionId:T,mediaIds:I}=g,C={id:E,wrtcsSessionId:S.wrtcsSessionId,otherWrtcsSessionId:O.wrtcsSessionId,sdp:h,customParameters:S.customParameters};let m;try{m=await a.joinSessions(C)}catch(e){throw v.info("Failed to join call."),d.dispatch(o.callActions.joinFinish(y,{error:e,usedCallIds:[E,_]})),f(i.CALL_STATE_CHANGE,{callId:y,previous:{state:n.CALL_STATES.INITIATING,localHold:!1,remoteHold:!1},error:e}),f(i.CALL_OPERATION,{callId:y,isLocal:!0,operation:c.OPERATIONS.JOIN,transition:c.OP_TRANSITIONS.FINISH,previous:void 0,error:e}),await l.closeCall(T),e}v.info("Finished local portion of join. Waiting on remote response.");const A=(0,u.getSessionById)(d.getState(),T);d.dispatch(o.callActions.pendingJoin(y,{wrtcsSessionId:m,webrtcSessionId:T,mediaIds:I,usedCallIds:[S.id,O.id],localTracks:A.localTracks,state:n.CALL_STATES.INITIATED})),f(i.CALL_JOIN,{callId:y}),f(i.CALL_TRACKS_ADDED,{callId:y,trackIds:A.localTracks})}(e,t,r)}};var n=r(77126),o=r(35),a=r(69752),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),s=r(40481),c=r(59090),l=r(84581),u=r(69260);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}},69584:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,CallstackWebrtc:r,emitEvent:s,logManager:c}=e;return async function(e,l){const u=l.reasonText||o.COMPLEX_OPERATION_MESSAGES.JOIN_FAILURE,d=l.statusCode||o.STATUS_CODES.JOIN_FAILURE,f=c.getLogger("CALL",e.id);f.info("Received call operation failed notice; handling.",{wrtcsSessionId:e.wrtcsSessionId}),f.debug(`Processing as a local join failure (${d}).`),await r.closeCall(e.webrtcSessionId);const p=new i.default({message:`Join operation failed: ${u} (${d})`,code:i.callCodes.GENERIC_ERROR});return t.dispatch(n.callActions.endCallFinish(e.id,{error:p})),s(a.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:!0,remoteHold:!1},error:p}),f.info("Finished handling call operation failed notice."),p}};var n=r(35),o=r(77126),a=c(r(51918)),i=c(r(75412));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function c(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},51185:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(80621))&&n.__esModule?n:{default:n};t.default=o.default},76857:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r}=e;return function(e,i){const s=i.reasonText||o.COMPLEX_OPERATION_MESSAGES.JOIN_FAILURE,c=i.statusCode||o.STATUS_CODES.JOIN_FAILURE,l=r.getLogger("CALL",e.id);l.info("Received call operation failed notice; handling.",{wrtcsSessionId:e.wrtcsSessionId}),l.debug(`Processing as a local join failure (${c}).`),l.info("Finished handling call operation failed notice.");const u=new a.default({message:`Join operation failed: ${s} (${c})`,code:a.callCodes.GENERIC_ERROR});return t.dispatch(n.callActions.joinFinish(e.id,{error:u,transition:{reasonText:s,statusCode:c}})),u}};var n=r(35),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},50332:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,CallRequests:r,CallstackWebrtc:s,emitEvent:c,logManager:l}=e;return async function(e,u){const d=l.getLogger("CALL",e.id);d.info("Received session status completed notice; handling.",{wrtcsSessionId:e.wrtcsSessionId});const{reasonText:f,statusCode:p}=u;if(f){let e;e=p||0===p?p:o.STATUS_CODES.JOIN_SUCCESS,d.debug(`Session completed notice caused by ${f} (${e}).`)}d.info(`Ending webRTC session with id: ${e.webrtcSessionId}, locally ...`),await s.closeCall(e.webrtcSessionId),t.dispatch(n.callActions.joinFinish(e.id,{transition:{reasonText:o.COMPLEX_OPERATION_MESSAGES.JOIN_SUCCESS,statusCode:o.STATUS_CODES.JOIN_SUCCESS}}));try{d.debug("Ending call session on server-side."),await r.endSession({callId:e.id,wrtcsSessionId:e.wrtcsSessionId,isAnonymous:e.isAnonymous,account:e.account})}catch(e){d.debug(`Error received when attempting to end the session: ${e}`)}finally{d.info(`Finished ending call. Changing call state to ${o.CALL_STATES.ENDED}.`),t.dispatch(n.callActions.endCallFinish(e.id,(0,i.generateEndParams)(e.state,!0,u))),c(a.CALL_TRACKS_REMOVED,{callId:e.id,trackIds:[...e.localTracks,...e.remoteTracks]}),c(a.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold}})}}};var n=r(35),o=r(77126),a=r(51918),i=r(69752)},61727:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const i=(0,o.getCallById)(e,t[0].id),s=(0,o.getCallById)(e,t[1].id);return i&&s?i.state!==n.CALL_STATES.ON_HOLD?new a.default({code:a.callCodes.INVALID_STATE,message:`Call is in an invalid state: state=${i.state}. It should be: state=${n.CALL_STATES.ON_HOLD}.`}):s.state!==n.CALL_STATES.ON_HOLD?new a.default({code:a.callCodes.INVALID_STATE,message:`Call is in an invalid state: state=${s.state}. It should be: state=${n.CALL_STATES.ON_HOLD}.`}):void 0:new a.default({code:a.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."})};var n=r(77126),o=r(40481),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},74043:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createAddMedia",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"createAnswer",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"createCallCancelled",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"createConsultTransfer",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"createDirectTransfer",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"createEnd",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"createForward",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"createGenericRemote",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(t,"createGetCodecs",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(t,"createGetStats",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(t,"createHold",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,"createIceCollectionCheck",{enumerable:!0,get:function(){return I.default}}),Object.defineProperty(t,"createIceRestart",{enumerable:!0,get:function(){return O.default}}),Object.defineProperty(t,"createIgnore",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"createJoin",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"createMake",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"createMoH",{enumerable:!0,get:function(){return N.default}}),Object.defineProperty(t,"createNormalizeIceFailure",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"createPlayAudioFile",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(t,"createReject",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"createRemoveMedia",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"createReplaceTrack",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(t,"createResyncCallState",{enumerable:!0,get:function(){return T.default}}),Object.defineProperty(t,"createSendCallAudit",{enumerable:!0,get:function(){return A.default}}),Object.defineProperty(t,"createSendCustom",{enumerable:!0,get:function(){return b.default}}),Object.defineProperty(t,"createSendDtmf",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"createSendRingingFeedback",{enumerable:!0,get:function(){return R.default}}),Object.defineProperty(t,"createSlowStart",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(t,"createUnhold",{enumerable:!0,get:function(){return E.default}});var n=M(r(4899)),o=M(r(6521)),a=M(r(12509)),i=M(r(67337)),s=M(r(30373)),c=M(r(68336)),l=M(r(99568)),u=M(r(67801)),d=M(r(29072)),f=M(r(89974)),p=M(r(75170)),g=M(r(58998)),E=M(r(82489)),_=M(r(33841)),y=M(r(18284)),v=M(r(75071)),S=M(r(94793)),O=M(r(1441)),h=M(r(25654)),T=M(r(85514)),I=M(r(11228)),C=M(r(97236)),m=M(r(6231)),A=M(r(28450)),b=M(r(21506)),R=M(r(14990)),N=M(r(32466)),P=M(r(9638)),w=M(r(58422));function M(e){return e&&e.__esModule?e:{default:e}}},84989:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,WebRTC:r}=e;return async function(e){const n=t.getLogger("CALL");if("audio"!==e&&"video"!==e){const t=`Cannot retrieve codecs for media kind ${e}. Only 'audio' or 'video' kind supported.`;throw n.info(t),new o.default({message:t})}n.info(`Retrieving list of available codecs for media kind '${e}'.`);const a=await r.webrtcManager.getAvailableCodecs(e);return n.debug("Successfully retrieved codec list:",a),a}};var n,o=(n=r(75412))&&n.__esModule?n:{default:n}},94793:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.operations.getAvailableCodecs",(()=>(0,o.default)(e.container)))};var n,o=(n=r(84989))&&n.__esModule?n:{default:n}},90103:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{CallReporter:t,context:r,emitEvent:l,logManager:u,WebRTC:d}=e;return async function(e,f){let p=(0,n.getCallByWebrtcSessionId)(r.getState(),e);const g=(0,n.getOptions)(r.getState()),E=u.getLogger("CALL",p?p.id:""),_=t.getReport(p.id).findLastOngoingEvent(Object.values(i.ICE_COLLECTION_OPERATIONS));let y,v;if(_){const e=_.timeline.find((e=>e.type===i.REPORT_EVENTS.PROCESS_MEDIA_LOCAL));if(e){const t=f.iceCandidates.filter((e=>"rtp"===e.component&&"relay"===e.type));if(y=e.timeline.find((e=>e.type===i.REPORT_EVENTS.ICE_COLLECTION)),y||(y=e.addEvent(i.REPORT_EVENTS.ICE_COLLECTION)),t.length>0){const e=y.getData("relayCandidates")||[];t.forEach((r=>{if(!e.includes(r)){const e=y.addEvent(i.REPORT_EVENTS.RELAY_CANDIDATE_COLLECTED);e.addData("address",r.address),e.addData("port",r.port),e.endEvent(),y.addData("relayCandidates",t)}}))}}}else E.error("ICE collection process could not determine current operation.");E.debug("Calling ICE collection check function for reason:",f.reason);try{const e=p.currentOperations.find((e=>{if(_)return e.eventId===_.id}));v=g.iceCollectionCheckFunction({callId:p.id,callOperation:e?e.type:"UNKNOWN",...f},{iceCollectionIdealTimeout:g.iceCollectionIdealTimeout,iceCollectionMaxTimeout:g.iceCollectionMaxTimeout}),"object"==typeof v&&Object.values(a.ICE_COLLECTION_RESULT_TYPES).includes(v.type)?v.type===a.ICE_COLLECTION_RESULT_TYPES.ERROR&&(v={type:a.ICE_COLLECTION_RESULT_TYPES.ERROR,error:new c.default({message:v.error,code:c.callCodes.GENERIC_ERROR})}):(E.error("Configured IceCollectionCheckFunction returned an invalid result type. Ending call.",v),v={type:a.ICE_COLLECTION_RESULT_TYPES.ERROR,error:new c.default({code:c.callCodes.INVALID_PARAM,message:"Malformed IceCollectionCheckResult provided by configured IceCollectionCheckFunction."})})}catch(e){E.info("Error thrown by the iceCollectionCheckFunction. Ending call.",e),v={type:a.ICE_COLLECTION_RESULT_TYPES.ERROR,error:new c.default({code:c.callCodes.UNKNOWN_ERROR,message:"Configured IceCollectionCheckFunction threw an error during ICE collection."})}}const S=await d.sessionManager.get(e);S&&(E.debug("Handling ICE collection check result:",v.type),await S.iceCollectionCheckResult(v),y&&!y.isEnded()&&v.type!==a.ICE_COLLECTION_RESULT_TYPES.WAIT&&(v.type===a.ICE_COLLECTION_RESULT_TYPES.ERROR&&y.setError(v),y.endEvent()),p=(0,n.getCallByWebrtcSessionId)(r.getState(),e),v.type===a.ICE_COLLECTION_RESULT_TYPES.ERROR&&p.state!==a.CALL_STATES.ENDED&&(r.dispatch(o.callActions.endCallFinish(p.id,{isLocal:!0,error:v.error})),l(s.CALL_STATE_CHANGE,{callId:p.id,previous:{state:p.state,localHold:p.localHold,remoteHold:p.remoteHold},error:v.error})))}},r(62234);var n=r(40481),o=r(35),a=r(77126),i=r(84581),s=r(51918),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}},11228:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.operations.callIceCollectionCheck",(()=>(0,o.default)(e.container)))};var n,o=(n=r(90103))&&n.__esModule?n:{default:n}},6231:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.operations.normalizeIceFailure",(()=>(0,o.default)(e.container)))};var n,o=(n=r(11935))&&n.__esModule?n:{default:n}},11935:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,logManager:l,Notifications:u}=e;return async function(e,d){const f=(0,n.getCallByWebrtcSessionId)(t.getState(),e);var p;if((p=f)&&![o.CALL_STATES.ENDED,o.CALL_STATES.CANCELLED].includes(p.state)&&d===o.CALL_MEDIA_CONNECTION_STATES.DISCONNECTED)try{await u.takeAction((t=>t.type===a.SESSION_ICE_CONNECTION_STATE_CHANGE&&t.payload.id===e&&t.payload.iceConnectionState!==o.CALL_MEDIA_CONNECTION_STATES.DISCONNECTED||t.type===i.END_CALL_FINISH&&t.payload.id===f.id),1e4)}catch(a){const i=(0,n.getCallByWebrtcSessionId)(t.getState(),e);l.getLogger("CALL",i.id).debug("Call has remained in disconnected media connection state too long. Manually transitioning to failed state."),t.dispatch(s.sessionIceConnectionStateChange(i.webrtcSessionId,{iceConnectionState:o.CALL_MEDIA_CONNECTION_STATES.FAILED})),r(c.MEDIA_CONNECTION_CHANGE,{callId:i.id,previous:{state:i.mediaConnectionState}})}}},r(62234);var n=r(40481),o=r(77126),a=r(81997),i=r(21836),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(48377)),c=r(51918);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}},28450:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.operations.sendCallAudit",(()=>(0,o.default)(e.container).sendCallAudit))};var n,o=(n=r(99051))&&n.__esModule?n:{default:n}},99051:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,CallstackWebrtc:r,CallRequests:c,TimerTracker:l,logManager:u,emitEvent:d}=e;let f,p,g;function E(e){return Date.now()-e}function _(e,t){return{triggerTimeout:new Promise(((t,r)=>{f=l.create("call",t,4e3,{id:e.id,params:[{timeout:4e3}]})})),triggerAudit:new Promise(((r,n)=>{l.clear(f);const o=e.isCaller?t:e.wrtcsSessionId;c.auditCall({wrtcsSessionId:o,isAnonymous:e.isAnonymous,account:e.account,id:e.id}).then((e=>{r({audit:{status:e.status}})})).catch((e=>{let t="Retry";e&&42===e.code&&(t="Closed"),r({audit:{status:t,error:e}})}))}))}}async function y(e,c,l,u){const f=(0,n.getOptions)(t.getState());if(p=Math.max(1e4,f.callAuditTimer),g=Math.min(5e3,.45*f.callAuditTimer),"Retry"===e.audit.status){const t=e.audit.error,r=E(l);return u.debug(`Call audit failed, caused by ${t.message} (${t.code}); will retry failed audit for call in: ${g-r} ms`),g-r}if("Closed"===e.audit.status){u.info(`Ending audit loop and Call due to Closed status. Changing to ${o.CALL_STATES.ENDED}.`),await r.closeCall(c.webrtcSessionId);const l=(0,n.getCallById)(t.getState(),c.id);return l.state!==o.CALL_STATES.ENDED&&l.state!==o.CALL_STATES.CANCELLED&&(t.dispatch(a.callActions.endCallFinish(c.id,{isLocal:!0,transition:{statusCode:9909,reasonText:"Call has ended due to call audit failure."}})),d(i.CALL_OPERATION,{callId:c.id,isLocal:!0,operation:s.OPERATIONS.END,transition:s.OP_TRANSITIONS.FINISH,previous:{},error:void 0}),d(i.CALL_TRACKS_REMOVED,{callId:c.id,trackIds:[...c.localTracks,...c.remoteTracks]}),d(i.CALL_STATE_CHANGE,{callId:c.id,previous:{state:c.state,localHold:c.localHold,remoteHold:c.remoteHold},transition:{statusCode:9909,reasonText:"Call has ended due to call audit failure."},error:e.audit.error})),-1}{const t=E(l);return u.debug(`Call audit status is ${e.audit.status}. Will retry in ${p-t} ms`),p-t}}async function v(e,r){const a=u.getLogger("CALL",e||"");let i;try{i=t.getState()}catch(e){return void a.debug("Failed to run repeating task; state has likely been destroyed")}const s=(0,n.getCallById)(i,e);if([o.CALL_STATES.ENDED,o.CALL_STATES.CANCELLED].includes(s.state))return void a.info(`Call is in ${s.state} state; stopping audit loop.`);const c=_(s,r),d=Date.now();return Promise.race([c.triggerTimeout,c.triggerAudit]).then((e=>e.timeout?(a.debug("Audit request timed out, retrying in 1 second."),1e3):e.audit?y(e,s,d,a):(a.debug("Audit loop encountered an unknown scenario; ending."),-1))).then((t=>{t>=0&&l.create("call",(function(){v(e,r)}),t,{id:e})}))}return{sendCallAudit:async function(e,r){const o=r.wrtcsSessionId,a=(0,n.getCallById)(t.getState(),e),i=u.getLogger("CALL",a?e:"");a?(i.info("Starting audit loop for new call."),v(e,o)):i.debug(`Call ${e} not found; no audit loop needed.`)},prepareRaceTriggers:_,handleAuditResult:y,repeatingTask:v,errorDelay:g,successDelay:p}},r(62234);var n=r(40481),o=r(77126),a=r(35),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),s=r(59090);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}},75170:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.addMedia",(()=>{const t=(0,n.default)(e.container),r=(0,c.default)(e.container);return{local:{validate:o.default,localOffer:t.localChanges,signalling:t.signalling,remoteAnswer:(0,l.default)(e.container),rollback:(0,i.default)(e.container)},remote:{remoteOffer:r.localChanges,signalling:r.signalling}}})),e.factory("Callstack.stages.addBasicMedia",(()=>{const t=(0,n.default)(e.container);return{local:{validate:s.default,localOffer:t.localChanges,signalling:t.signalling,remoteAnswer:(0,l.default)(e.container),rollback:(0,i.default)(e.container)}}})),e.factory("Callstack.operations.addMedia",(()=>{const t=e.container.Callstack,r=t.models.Negotiation;function n(e){return(n,o)=>{const a=t.stages.addMedia[e?"local":"remote"];return r.instance({type:u.OPERATIONS.ADD_MEDIA,isLocal:e,stages:a},{callId:n,deferred:o})}}return{local:n(!0),remote:n(!1)}})),e.factory("Callstack.operations.addBasicMedia",(()=>{const t=e.container.Callstack.models.Negotiation;return{local:(r,n)=>t.instance({type:u.OPERATIONS.ADD_BASIC_MEDIA,isLocal:!0,stages:e.container.Callstack.stages.addBasicMedia.local},{callId:r,deferred:n})}})),e.factory("Callstack.utils.webrtcAddMedia",(()=>(0,a.default)(e.container))),e.factory("Callstack.utils.rollbackAddMedia",(()=>(0,i.default)(e.container)))};var n=d(r(48349)),o=d(r(1306)),a=d(r(49676)),i=d(r(17077)),s=d(r(35730)),c=d(r(34705)),l=d(r(12540)),u=r(59090);function d(e){return e&&e.__esModule?e:{default:e}}},48349:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{localChanges:(t,r,n)=>s(e,t,r,n),signalling:(t,r)=>c(e,t,r)}},t.localChanges=s,t.signalling=c;var n=r(35),o=r(51918),a=r(40481),i=r(37654);async function s(e,t,r,n){const{context:o,Callstack:i,logManager:s}=e,c=s.getLogger("CALL",t);c.info("Adding media to call.");const l=(0,a.getCallById)(o.getState(),t),{bandwidth:u,dscpControls:d}=n,{webrtcSessionId:f,bandwidth:p}=l,g={audio:u&&u.audio?u.audio:p.audio,video:u&&u.video?u.video:p.video},{sdp:E,medias:_}=await i.utils.webrtcAddMedia(r,{sessionId:f,bandwidth:g,dscpControls:d}),y={local:!0,mediaIds:_.map((e=>e.id)),tracks:_.reduce(((e,t)=>e.concat(t.tracks.map((e=>e.id)))),[]),bandwidth:g};return c.info("Finished local portion of adding media. Waiting on remote response."),{operationData:y,sdp:E}}async function c(e,t,r){const{context:s,CallRequests:c,Callstack:l,CallstackWebrtc:u,emitEvent:d,logManager:f}=e,{operationData:p,sdp:g}=r,E=(0,a.getCallById)(e.context.getState(),t),_=f.getLogger("CALL",E.id);try{await c.updateSession({wrtcsSessionId:E.wrtcsSessionId,id:E.id,offer:g,isAnonymous:E.isAnonymous,account:E.account,customParameters:E.customParameters,customBodies:E.customBodies})}catch(e){let t;_.info("Failed to add media to call.");try{await l.utils.rollbackAddMedia(E.webrtcSessionId,p)}catch(e){_.debug("Automatic add media rollback failed:",e),t=e}const r=(0,i.getBrowserDetails)().browser;if(t||"chrome"===r){if("safari"===r||"chrome"===r)throw _.info("Ending call due to unrecoverable state after call add media failure."),await u.closeCall(E.webrtcSessionId),s.dispatch(n.callActions.endCallFinish(E.id,{isLocal:!0,transition:{reasonText:"Call has ended due to call add media failure."}})),d(o.CALL_TRACKS_REMOVED,{callId:E.id,trackIds:[...E.localTracks,...E.remoteTracks]}),d(o.CALL_STATE_CHANGE,{callId:E.id,previous:{state:E.state,localHold:E.localHold,remoteHold:E.remoteHold},error:e}),e;_.info("Unable to reset state after add media operation failure, future operations may not work as intended.")}throw e}}},12540:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,emitEvent:c,CallstackWebrtc:l,CallReporter:u}=e;return async function(e,d){const f=r.getLogger("CALL",e.id),p=u.getReport(e.id),g=e.currentOperations.find((e=>e.isLocal&&[a.OPERATIONS.ADD_MEDIA,a.OPERATIONS.ADD_BASIC_MEDIA].includes(e.type))),E=p.getEvent(g.eventId).addEvent(i.REPORT_EVENTS.PROCESS_MEDIA_REMOTE);E.addData("operation",i.REPORTER_OPERATION_EVENTS_MAP.ADD_MEDIA);try{const t={sessionId:e.webrtcSessionId,answerSdp:d.sdp};await l.receivedAnswer(t,e)}catch(r){throw t.dispatch(n.callActions.endCallFinish(e.id,{error:r})),c(o.CALL_TRACKS_REMOVED,{callId:e.id,trackIds:[...e.localTracks,...e.remoteTracks]}),c(o.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold},error:r}),E.setError(r),E.endEvent(),r}f.info(`Finished processing remote response to local ${g.type}. Changing state based on operation.`);const _=g.operationData.mediaIds.map((e=>(0,s.getMediaById)(t.getState(),e)));let y=[];_.forEach((e=>{y=y.concat(e.tracks)})),c(o.CALL_ADDED_MEDIA,{callId:e.id,local:!0,tracks:y,mediaId:g.operationData.mediaIds}),t.dispatch(n.callActions.addMediaFinish(e.id,{bandwidth:g.operationData.bandwidth,localTracks:y})),c(o.CALL_TRACKS_ADDED,{callId:e.id,trackIds:y}),E.endEvent()}},r(62234);var n=r(35),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),a=r(59090),i=r(84581),s=r(69260);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}},1306:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,s){const c=(0,o.getCallById)(e,t);if(!c)return new i.default({code:i.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."});if(c.state!==n.CALL_STATES.CONNECTED)return new i.default({code:i.callCodes.INVALID_STATE,message:`Invalid call state: ${c.state}. It should be: ${n.CALL_STATES.CONNECTED}.`});try{(0,a.validateMediaConstraints)(r)}catch(e){return e}if(r&&r.medias)try{(0,a.validateDetachedMedia)(r.medias)}catch(e){return e}return r&&r.medias&&c.localTracks.some((e=>r.medias.map((e=>e.media.tracks)).reduce(((e,t)=>e.concat(t)),[]).includes(e)))?new i.default({code:i.callCodes.INVALID_PARAM,message:"One or more of the tracks id's being added already exists on the call."}):void 0},r(62234);var n=r(77126),o=r(40481),a=r(9066),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},35730:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,n,c){const l=(0,a.getCallById)(e,t),u=l?l.localTracks.map((t=>(0,s.getTrackById)(e,t))).filter((e=>e.kind===r)):void 0,d=(0,o.default)(e,t,n,c);return d||(u.length>=1?new i.default({code:i.callCodes.INVALID_PARAM,message:`Too many ${r} tracks for basic scenario!`}):void 0)};var n,o=(n=r(1306))&&n.__esModule?n:{default:n},a=r(40481),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412)),s=r(69260);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}},34705:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r}=e;return{localChanges:(t,r,n)=>f(e,t,r,n),signalling:async(n,o,a)=>{try{const{remoteTracks:i}=await p(e,n,a);t.dispatch(s.callActions.remoteAddMediaFinish(n.id,{remote:!0,remoteParticipant:{displayNumber:o.remoteNumber,displayName:o.remoteName},remoteTracks:i})),r(c.CALL_TRACKS_ADDED,{callId:n.id,trackIds:i})}catch(e){throw t.dispatch(s.callActions.remoteAddMediaFinish(n.id,{remote:!0,error:e})),e}}}},t.localChanges=f,t.signalling=p,r(97107),r(62234);var n=r(73520),o=d(r(48151)),a=d(r(29819)),i=r(77126),s=r(35),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),l=r(59090);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function d(e){return e&&e.__esModule?e:{default:e}}async function f(e,t,r,o){const{WebRTC:s,CallstackWebrtc:c,CallstackSDP:l,logManager:u}=e,d=u.getLogger("CALL",t.id),f=await s.sessionManager.get(t.webrtcSessionId);if(!f)throw d.debug(`webRTC session ${t.webrtcSessionId} not found.`),new Error(`Session for call ${t.id} not found.`);const p=(0,n.getMediaState)(t);if([i.CALL_MEDIA_STATES.DUAL_HOLD,i.CALL_MEDIA_STATES.LOCAL_HOLD].includes(p)){if(d.debug("Modifying remote offer to prevent resetting media while in local hold."),r.sdp=(0,a.default)(r.sdp),!r.sdp)return void d.debug("SDP is either undefined or not a string.");o.mediaDiff=l.compareMedia(o.remoteDesc.sdp,r.sdp,!0)}let g;try{g=await c.handleOffer(r.sdp,t.webrtcSessionId,t.bandwidth)}catch(e){throw d.debug("Failed to receive offer SDP.",e),e}return{answer:g,session:f,opInfo:o}}async function p(e,t,r){const{CallRequests:n,logManager:a}=e,{answer:i,session:s,opInfo:c}=r,u=a.getLogger("CALL",t.id);try{return await n.updateSessionResponse({wrtcsSessionId:t.wrtcsSessionId,answer:i.answerSDP,isAnonymous:t.isAnonymous,account:t.account,customParameters:t.customParameters,customBodies:t.customBodies}),u.info("Finished responding to remote update. Changing state based on the remote operation."),{remoteTracks:await(0,o.default)(l.OPERATIONS.ADD_MEDIA,c.mediaDiff,s)}}catch(e){throw u.info("Failed to respond to remote offer with an answer."),e}}},17077:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,WebRTC:r}=e;return async function(e,i){const s=t.getLogger("CALLSTACK"),c=await r.sessionManager.get(e),{tracks:l}=i;if(!c){const t=`WebRTC session ${e} not found.`;throw s.debug(t),new a.default({message:t})}const u=await r.track.getTracks(l),d=u.reduce(((e,t,r)=>(0,n.default)(t)?e.concat(r):e),[]).map((e=>l[e]));if(!(0,o.default)(d)){const e=`The following tracks could not be found for rollback: ${d.join(", ")}`;s.debug(e)}let f;await c.removeTracks(l),await Promise.all(u.map((e=>e.stop())));try{f=await c.rollbackLocalDescription()}catch(e){throw s.debug("Failed to rollback local description offer SDP:",e),e}return{offer:f}}};var n=i(r(54502)),o=i(r(84499)),a=i(r(75412));function i(e){return e&&e.__esModule?e:{default:e}}},49676:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,CallstackSDP:r,CallReporter:l,WebRTC:u}=e;return async function(d,f){const{CallstackWebrtc:p}=e,{sessionId:g,bandwidth:E,dscpControls:_}=f,y=(0,n.getCallByWebrtcSessionId)(t.getState(),g),v=y.id,S=l.getReport(v),O=y.currentOperations.find((e=>e.isLocal&&[o.OPERATIONS.ADD_MEDIA,o.OPERATIONS.ADD_BASIC_MEDIA].includes(e.type))),h=S.getEvent(O.eventId);let T=[];if(d.medias)for(const e of d.medias)T.push({type:e.type,media:await u.media.get(e.media.id)});const I=await p.createLocal(d,v);T=T.concat(I);const C=await u.sessionManager.get(g),m=await(0,s.organizeTracks)(T),A=(0,i.getTrackDscpMapping)(m,_);await C.addTracks(m.all,A);const b=(0,n.getOptions)(t.getState());let R,N,P,w;try{w=h.addEvent(a.REPORT_EVENTS.CREATE_OFFER),R=await C.createOffer(),w.endEvent()}catch(e){const t=new c.default({message:e.message,code:c.callCodes.GENERIC_ERROR});throw w.endEvent(t),t}try{R.sdp=r.runPipeline(b.sdpHandlers,R.sdp,{callId:v,type:R.type,step:"set",endpoint:"local",bandwidth:E}),P=h.addEvent(a.REPORT_EVENTS.PROCESS_MEDIA_LOCAL),P.addData("operation",a.REPORTER_OPERATION_EVENTS_MAP.ADD_MEDIA),R=await C.setLocalDescription(R),P.endEvent(),N=r.runPipeline(b.sdpHandlers,R.sdp,{callId:v,type:R.type,step:"send",endpoint:"local",bandwidth:E})}catch(e){const t=new c.default({message:e.message,code:c.callCodes.GENERIC_ERROR});throw P.endEvent(t),t}let M=[];for(const e of T){const t=await e.media.getState();M=[...M,t]}return{medias:M,sdp:N}}},r(62234),r(69375);var n=r(40481),o=r(59090),a=r(84581),i=r(69752),s=r(56294),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}},47575:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{localChanges:(e,t)=>({destination:t}),signalling:(t,r)=>{let{destination:n}=r;return o(e,t,n)}}},t.signalling=o;var n=r(40481);async function o(e,t,r){const{context:o,CallRequests:a,logManager:i}=e,s=i.getLogger("CALL",t);s.info("Performing direct transfer on call.");const c={wrtcsSessionId:(0,n.getCallById)(o.getState(),t).wrtcsSessionId,address:r,id:t};try{await a.directTransferSession(c)}catch(e){throw s.info("Failed to direct transfer call."),e}s.info("Finished local portion of direct transfer. Waiting on remote response.")}},6521:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,n.default)(e.container);e.factory("Callstack.operations.directTransfer",(()=>{const r=e.container.Callstack.models.Negotiation;return{local:function(n,l){return r.instance({type:c.OPERATIONS.DIRECT_TRANSFER,isLocal:!0,stages:{validate:o.default,localOffer:t.localChanges,signalling:t.signalling,remoteSuccess:(0,a.default)(e.container),remoteFailure:(0,i.default)(e.container)},createFlow:s.default},{callId:n,deferred:l})}}}))};var n=l(r(47575)),o=l(r(26387)),a=l(r(75976)),i=l(r(50933)),s=l(r(41534)),c=r(59090);function l(e){return e&&e.__esModule?e:{default:e}}},50933:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r}=e;return function(e,i){const s=i.reasonText||o.COMPLEX_OPERATION_MESSAGES.DIRECT_TRANSFER_FAILURE,c=i.statusCode||o.STATUS_CODES.DIRECT_TRANSFER_FAILURE,l=r.getLogger("CALL",e.id);l.info("Received call operation failed notice; handling.",{wrtcsSessionId:e.wrtcsSessionId}),l.debug(`Processing as a local direct transfer failure (${c}).`),l.info("Finished handling call operation failed notice.");const u=new a.default({message:`Direct transfer operation failed: ${s} (${c})`,code:a.callCodes.GENERIC_ERROR});return t.dispatch(n.callActions.directTransferFinish(e.id,{error:u,transition:{reasonText:s,statusCode:c}})),u}};var n=r(35),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},75976:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,CallRequests:r,CallstackWebrtc:s,emitEvent:c,logManager:l}=e;return async function(e,u){const d=l.getLogger("CALL",e.id);d.info("Received session status completed notice; handling.",{wrtcsSessionId:e.wrtcsSessionId});const{reasonText:f,statusCode:p}=u;if(f){let e;e=p||0===p?p:a.STATUS_CODES.DIRECT_TRANSFER_SUCCESS,d.debug(`Session completed notice caused by ${f} (${e}).`)}d.info(`Ending webRTC session with id: ${e.webrtcSessionId}, locally ...`),await s.closeCall(e.webrtcSessionId),t.dispatch(n.callActions.directTransferFinish(e.id,{transition:{reasonText:a.COMPLEX_OPERATION_MESSAGES.DIRECT_TRANSFER_SUCCESS,statusCode:a.STATUS_CODES.DIRECT_TRANSFER_SUCCESS}}));try{d.debug("Ending call session on server-side."),await r.endSession({callId:e.id,wrtcsSessionId:e.wrtcsSessionId,isAnonymous:e.isAnonymous,account:e.account})}catch(e){d.debug(`Error received when attempting to end the session: ${e}.`)}finally{d.info(`Finished ending call. Changing call state to ${a.CALL_STATES.ENDED}.`),t.dispatch(n.callActions.endCallFinish(e.id,(0,i.generateEndParams)(e.state,!0,u))),c(o.CALL_TRACKS_REMOVED,{callId:e.id,trackIds:[...e.localTracks,...e.remoteTracks]}),c(o.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold}})}}};var n=r(35),o=r(51918),a=r(77126),i=r(69752)},26387:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const i=(0,n.getCallById)(e,t);return i?i.state!==o.CALL_STATES.ON_HOLD?new a.default({code:a.callCodes.INVALID_STATE,message:`Call is in an invalid state: state=${i.state}. It should be: state=${o.CALL_STATES.ON_HOLD}.`}):void 0:new a.default({code:a.callCodes.INVALID_PARAM,message:"Cannot direct transfer call: Invalid call ID."})};var n=r(40481),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},9638:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.genericRemote",(()=>{const t=(0,o.default)(e.container);return{remote:{remoteOffer:t.localChanges,signalling:t.signalling}}})),e.factory("Callstack.operations.genericRemote",(()=>{const t=e.container.Callstack.models.Negotiation;return{remote:function(r){return t.instance({type:a.OPERATIONS.GENERIC_REMOTE,isLocal:!1,stages:e.container.Callstack.stages.genericRemote.remote},{callId:r})}}}))};var n,o=(n=r(26909))&&n.__esModule?n:{default:n},a=r(59090)},26909:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t}=e;return{localChanges:(t,r,n)=>d(e,t,r,n),signalling:async(r,n,o)=>{try{const{remoteTracks:a}=await f(e,r,o);t.dispatch(l.callActions.updateCall(r.id,{remote:!0,remoteParticipant:{displayNumber:n.remoteNumber,displayName:n.remoteName},remoteTracks:a}))}catch(e){throw t.dispatch(l.callActions.updateCall(r.id,{remote:!0,error:e})),e}}}},t.localChanges=d,t.signalling=f,r(97107),r(62234);var n=r(48151),o=u(r(29819)),a=u(r(11876)),i=r(70949),s=r(73520),c=r(77126),l=r(35);function u(e){return e&&e.__esModule?e:{default:e}}async function d(e,t,r,n){const{WebRTC:l,CallstackWebrtc:u,CallstackSDP:d,logManager:f}=e,p=f.getLogger("CALL",t.id),g=await l.sessionManager.get(t.webrtcSessionId);if(!g)throw p.debug(`webRTC session ${t.webrtcSessionId} not found.`),new Error(`Session for call ${t.id} not found.`);const E=(0,s.getMediaState)(t);if((0,a.default)(r.sdp)&&[c.CALL_MEDIA_STATES.DUAL_HOLD,c.CALL_MEDIA_STATES.LOCAL_HOLD].includes(E)){if(p.debug("Modifying remote offer to prevent resetting media while in local hold."),r.sdp=(0,o.default)(r.sdp),!r.sdp)return void p.debug("SDP is either undefined or not a string.");n.mediaDiff=d.compareMedia(n.remoteDesc.sdp,r.sdp,!0)}const _=await(0,i.isSameSdpSessionId)(l,t.webrtcSessionId,r.sdp);if(!_){p.debug(`Received offer SDP is from a different session. Recreating Peer for call ${t.id}.`);const e=await l.sessionManager.get(t.webrtcSessionId);await e.recreatePeer()}let y;r.sdp.includes("setup:active")&&(p.debug(`Received offer SDP with active role for call ${t.id}. Changing.`),r.sdp=r.sdp.replace(/setup:active/g,"setup:actpass"));try{y=await u.handleOffer(r.sdp,t.webrtcSessionId,t.bandwidth)}catch(e){throw p.debug("Failed to receive offer SDP.",e),e}return{answer:y,sameSession:_,session:g}}async function f(e,t,r){const{CallRequests:o,logManager:a}=e,{answer:i,sameSession:s,session:c}=r,l=a.getLogger("CALL",t.id);try{await o.updateSessionResponse({wrtcsSessionId:t.wrtcsSessionId,answer:i.answerSDP,isAnonymous:t.isAnonymous,account:t.account,customParameters:t.customParameters,customBodies:t.customBodies});let e=[];return s||(e=await(0,n.getAllRemoteTracks)(c)),{remoteTracks:e}}catch(e){throw l.info("Failed to respond to remote offer with an answer."),e}}},58998:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,n.default)(e.container),r=(0,s.default)(e.container);e.factory("Callstack.stages.hold",(()=>({local:{validate:o.default,localOffer:t.localChanges,signalling:t.signalling,remoteAnswer:(0,i.default)(e.container),rollback:(0,a.default)(e.container)},remote:{remoteOffer:r.localChanges,signalling:r.signalling}}))),e.factory("Callstack.operations.hold",(()=>{const t=e.container.Callstack,r=t.models.Negotiation;function n(e){return(n,o)=>{const a=t.stages.hold[e?"local":"remote"];return r.instance({type:c.OPERATIONS.HOLD,isLocal:e,stages:a},{callId:n,deferred:o})}}return{local:n(!0),remote:n(!1)}})),e.factory("Callstack.utils.rollbackHold",(()=>(0,a.default)(e.container)))};var n=l(r(38877)),o=l(r(35590)),a=l(r(8506)),i=l(r(99808)),s=l(r(18893)),c=r(59090);function l(e){return e&&e.__esModule?e:{default:e}}},38877:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{localChanges:t=>i(e,t),signalling:(t,r)=>s(e,t,r)}},t.localChanges=i,t.signalling=s;var n=r(35),o=r(40481),a=r(37654);async function i(e,t){const{context:r,CallstackWebrtc:n,logManager:a}=e,i=a.getLogger("CALL",t);i.info("Holding call.");const s=(0,o.getCallById)(r.getState(),t);let c;try{c=await n.generateOffer(s.webrtcSessionId,{audio:"inactive",video:"inactive"},s.bandwidth)}catch(e){throw i.debug("Failed to generate SDP offer"),e}return{offer:c}}async function s(e,t,r){const{context:i,CallRequests:s,Callstack:c,CallstackWebrtc:l,logManager:u}=e,{offer:d}=r,f=(0,o.getCallById)(i.getState(),t),p=u.getLogger("CALL",f.id);try{await s.updateSession({wrtcsSessionId:f.wrtcsSessionId,id:f.id,offer:d.sdp,isAnonymous:f.isAnonymous,account:f.account,customParameters:f.customParameters,customBodies:f.customBodies})}catch(e){let t;p.info("Failed to hold call.");try{await c.utils.rollbackHold(f.webrtcSessionId)}catch(e){p.debug("Automatic hold rollback failed:",e),t=e}const r=(0,a.getBrowserDetails)().browser;if(t||"chrome"===r){if("safari"===r||"chrome"===r)throw p.info("Ending call due to unrecoverable state after call hold failure."),await l.closeCall(f.webrtcSessionId),i.dispatch(n.callActions.endCallFinish(f.id,{isLocal:!0,transition:{reasonText:"Call has ended due to call hold failure."}})),e;p.info("Unable to reset state after hold operation failure, future operations may not work as intended.")}throw e}p.info("Finished local portion of holding call. Waiting on remote response.")}},99808:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,emitEvent:s,CallstackWebrtc:c,CallReporter:l}=e;return async function(e,u){const d=r.getLogger("CALL",e.id),f=l.getReport(e.id),p=e.currentOperations.find((e=>e.isLocal&&e.type===a.OPERATIONS.HOLD)),g=f.getEvent(p.eventId).addEvent(i.REPORT_EVENTS.PROCESS_MEDIA_REMOTE);g.addData("operation",i.REPORTER_OPERATION_EVENTS_MAP.HOLD);try{const t={sessionId:e.webrtcSessionId,answerSdp:u.sdp};await c.receivedAnswer(t,e)}catch(r){throw t.dispatch(n.callActions.endCallFinish(e.id,{error:r})),s(o.CALL_TRACKS_REMOVED,{callId:e.id,trackIds:[...e.localTracks,...e.remoteTracks]}),g.setError(r),g.endEvent(),r}d.info(`Finished processing remote response to local ${p.type}. Changing state based on operation.`),t.dispatch(n.callActions.holdCallFinish(e.id,{...p.operationData,localTracks:e.localTracks,remoteTracks:e.remoteTracks})),s(o.CALL_TRACKS_REMOVED,{callId:e.id,trackIds:[...e.localTracks,...e.remoteTracks]}),s(o.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold}}),g.endEvent()}};var n=r(35),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),a=r(59090),i=r(84581);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},35590:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=(0,n.getCallById)(e,t);return r?!1!==r.localHold?new o.default({code:o.callCodes.INVALID_STATE,message:"Call is in an invalid state: localHold=true. It should be: localHold=false."}):void 0:new o.default({code:o.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."})};var n=r(40481),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(75412));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},18893:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r}=e;return{localChanges:(t,r,o)=>async function(e,t,r,o){const{WebRTC:a,CallstackWebrtc:i,logManager:s}=e,c=s.getLogger("CALL",t.id),l=await a.sessionManager.get(t.webrtcSessionId);if(!l)throw c.debug(`webRTC session ${t.webrtcSessionId} not found.`),new Error(`Session for call ${t.id} not found.`);const u=await(0,n.isSameSdpSessionId)(a,t.webrtcSessionId,r.sdp);let d;u||(c.debug(`Received offer SDP is from a different session. Recreating Peer for call ${t.id}.`),await l.recreatePeer());try{d=await i.handleOffer(r.sdp,t.webrtcSessionId,t.bandwidth)}catch(e){throw c.debug("Failed to receive offer SDP.",e),e}return{answer:d,sameSession:u,session:l,opInfo:o}}(e,t,r,o),signalling:async(n,c,l)=>{try{const{localTracks:u,remoteTracks:d}=await async function(e,t,r){const{CallRequests:n,logManager:a}=e,{answer:i,sameSession:c,session:l,opInfo:u}=r,d=a.getLogger("CALL",t.id);try{await n.updateSessionResponse({wrtcsSessionId:t.wrtcsSessionId,answer:i.answerSDP,isAnonymous:t.isAnonymous,account:t.account,customParameters:t.customParameters,customBodies:t.customBodies}),d.info("Finished responding to remote update. Changing state based on the remote operation.");let e=[];return e=c?await(0,o.default)(s.OPERATIONS.HOLD,u.mediaDiff,l):await(0,o.getAllRemoteTracks)(l),{remoteTracks:e,localTracks:t.localTracks}}catch(e){throw d.info("Failed to respond to remote offer with an answer."),e}}(e,n,l);t.dispatch(a.callActions.remoteHoldFinish(n.id,{remote:!0,remoteParticipant:{displayNumber:c.remoteNumber,displayName:c.remoteName},localTracks:u,remoteTracks:d})),r(i.CALL_STATE_CHANGE,{callId:n.id,previous:{state:n.state,localHold:n.localHold,remoteHold:n.remoteHold}}),r(i.CALL_TRACKS_REMOVED,{callId:n.id,trackIds:[...u,...d]})}catch(e){throw t.dispatch(a.callActions.remoteHoldFinish(n.id,{remote:!0,error:e})),r(i.CALL_STATE_CHANGE,{callId:n.id,previous:{state:n.state,localHold:n.localHold,remoteHold:n.remoteHold},error:e}),e}}}},r(97107);var n=r(70949),o=l(r(48151)),a=r(35),i=l(r(51918)),s=r(59090);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},8506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,WebRTC:r,CallstackWebrtc:n,emitEvent:l,context:u}=e;return async function(e){const d=t.getLogger("CALLSTACK"),f=await r.sessionManager.get(e);if(!f){const t=`WebRTC session ${e} not found.`;throw new s.default({message:t})}try{await f.setTransceiversDirection({audio:"sendrecv",video:"sendrecv"})}catch(e){}let p,g;try{p=await f.rollbackLocalDescription()}catch(e){d.debug("Failed to rollback local description offer SDP:",e),g=e}const E=(0,c.getBrowserDetails)().browser;if((g||"chrome"===E)&&await async function(e,r){const s=(0,o.getCallByWebrtcSessionId)(u.getState(),e),c=t.getLogger("CALL",s.id);if("safari"===r||"chrome"===r){c.info("Ending call due to unrecoverable state after call hold failure."),await n.closeCall(s.webrtcSessionId);const e="Call has ended due to call hold failure.";u.dispatch(a.callActions.endCallFinish(s.id,{isLocal:!0,transition:{reasonText:e}})),l(i.CALL_TRACKS_REMOVED,{callId:s.id,trackIds:[...s.localTracks,...s.remoteTracks]})}}(e,E),g)throw g;return{offer:p}}};var n,o=r(40481),a=r(35),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),s=(n=r(75412))&&n.__esModule?n:{default:n},c=r(37654);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}},1441:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,n.default)(e.container);e.factory("Callstack.stages.iceRestart",(()=>({local:{validate:o.default,localOffer:t.localChanges,signalling:t.signalling,remoteAnswer:(0,a.default)(e.container)}}))),e.factory("Callstack.operations.iceRestart",(()=>{const t=e.container.Callstack.models.Negotiation;return{local:function(r,n){return t.instance({type:i.OPERATIONS.MEDIA_RESTART,isLocal:!0,stages:e.container.Callstack.stages.iceRestart.local},{callId:r,deferred:n})}}}))};var n=s(r(48687)),o=s(r(81275)),a=s(r(72597)),i=r(59090);function s(e){return e&&e.__esModule?e:{default:e}}},48687:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{localChanges:t=>u(e,t),signalling:(t,r)=>d(e,t,r)}},t.localChanges=u,t.signalling=d;var n=r(40481),o=r(69752),a=r(94482),i=r(9101),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412)),c=r(1011);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}async function u(e,t){const{context:r,WebRTC:l,CallstackWebrtc:u,logManager:d}=e,f=(0,n.getCallById)(r.getState(),t),{webrtcSessionId:p,wrtcsSessionId:g,bandwidth:E,isAnonymous:_,account:y,localHold:v,customParameters:S,customBodies:O}=f,h=await l.sessionManager.get(p);if("passive"===await h.getDtlsRole()){const{mediaConnectionRetryDelay:e}=(0,n.getOptions)(r.getState());await(0,c.delay)(e)}const T=d.getLogger("CALL",t);try{await h.restartIce()}catch(e){T.debug("Peer restartIce function not available. Restarting ICE with createOffer instead.")}const{connected:I}=(0,a.getConnectionState)(r.getState());if(!I&&(T.debug("Websocket not connected; waiting for reconnect before performing media restart."),!await(0,i.waitForReconnect)(e)))throw T.info("Subscription lost; stopping media restart attempt."),new s.default({code:s.subscriptionCodes.WS_CONNECTION_ERROR,message:"No subscription for operation."});T.info("Performing call renegotiation to reconnect media connection.");const C={audio:v?"inactive":"sendrecv",video:v?"inactive":"sendrecv"};if(!v){const e=(0,o.getLocalTracks)(r,t);C.audio=e.some((e=>"audio"===e.kind))?"sendrecv":"recvonly",C.video=e.some((e=>"video"===e.kind))?"sendrecv":"recvonly"}const m={wrtcsSessionId:g,id:t,isAnonymous:_,account:y,customParameters:S,customBodies:O},A={iceRestart:!0};let b;try{b=await u.generateOffer(p,C,E,A),m.offer=b.sdp}catch(e){throw T.debug("Failed to generate offer."),new s.default({code:s.callCodes.INVALID_OFFER,message:"Failed to generate SDP offer"})}return{offer:b}}async function d(e,t,r){const{context:o,CallRequests:a,logManager:i}=e,{offer:s}=r,c=(0,n.getCallById)(o.getState(),t),l=i.getLogger("CALL",c.id);try{await a.updateSession({wrtcsSessionId:c.wrtcsSessionId,id:c.id,offer:s.sdp,isAnonymous:c.isAnonymous,account:c.account,customParameters:c.customParameters,customBodies:c.customBodies}),l.info("Finished local portion of media restart. Waiting on remote response.")}catch(e){throw l.info("Failed to renegotiate call."),e}}},72597:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,emitEvent:c,CallstackWebrtc:l,CallReporter:u}=e;return async function(e,d){const f=r.getLogger("CALL",e.id);f.info("Processing remote response from regular, local update request.");const p=u.getReport(e.id),g=e.currentOperations.find((e=>e.isLocal&&e.type===i.OPERATIONS.MEDIA_RESTART)),E=p.getEvent(g.eventId).addEvent(s.REPORT_EVENTS.PROCESS_MEDIA_REMOTE);E.addData("operation",s.REPORTER_OPERATION_EVENTS_MAP.MEDIA_RESTART);const _=(0,n.getMediaState)(e);f.debug(`Current call info; State: ${e.state}, MediaState: ${_}.`);try{const t={sessionId:e.webrtcSessionId,answerSdp:d.sdp};await l.receivedAnswer(t,e)}catch(r){throw t.dispatch(o.callActions.endCallFinish(e.id,{error:r})),c(a.CALL_TRACKS_REMOVED,{callId:e.id,trackIds:[...e.localTracks,...e.remoteTracks]}),c(a.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold},error:r}),E.setError(r),E.endEvent(),r}f.info(`Finished processing remote response to local ${g.type}. Changing state based on operation.`),t.dispatch(o.callActions.restartMediaFinish(e.id)),c(a.MEDIA_RESTART,{callId:e.id}),E.endEvent()}};var n=r(73520),o=r(35),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),i=r(59090),s=r(84581);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}},81275:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=(0,n.getCallById)(e,t);return r?r.state===o.CALL_STATES.ENDED?new a.default({code:a.callCodes.INVALID_STATE,message:`Invalid call state: ${r.state}. It should be on-going.`}):void 0:new a.default({code:a.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."})};var n=r(40481),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},67337:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,n.default)(e.container);e.factory("Callstack.stages.make",(()=>({local:{validate:s.default,localOffer:t.localChanges,signalling:t.signalling,remoteAnswer:(0,o.default)(e.container),callStatusUpdateRinging:(0,a.default)(e.container),receiveEarlyMedia:(0,i.default)(e.container)},remote:{remoteOffer:(0,c.default)(e.container)}}))),e.factory("Callstack.operations.make",(()=>{const t=e.container.Callstack,r=t.models.Negotiation,n=t.models.Update;return{local:function(e,n){return r.instance({type:g.OPERATIONS.MAKE,isLocal:!0,stages:t.stages.make.local,createFlow:function(){return{...(0,u.default)(...arguments),receiveUpdate:(0,d.createPending)(...arguments).start}}},{callId:e,deferred:n})},remote:function(e){return n.instance({type:g.OPERATIONS.MAKE,isLocal:!1,stages:t.stages.make.remote,createFlow:l.default},{callId:e})}}})),e.factory("Callstack.utils.setupIncomingCall",(()=>(0,f.default)(e.container))),e.factory("Callstack.utils.setupOutgoingSession",(()=>(0,p.default)(e.container)))};var n=E(r(5775)),o=E(r(80621)),a=E(r(15838)),i=E(r(56137)),s=E(r(81571)),c=E(r(27030)),l=E(r(8922)),u=E(r(98307)),d=r(46883),f=E(r(94916)),p=E(r(62168)),g=r(59090);function E(e){return e&&e.__esModule?e:{default:e}}},5775:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{localChanges:function(t,r,n){return l(e,t,r,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{})},signalling:(t,r)=>u(e,t,r)}},t.localChanges=l,t.signalling=u;var n=r(35),o=r(51918),a=r(40481),i=r(69752),s=r(77126),c=r(69260);async function l(e,t,r,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{context:c,Callstack:l,logManager:u}=e,{setupOutgoingSession:d}=l.utils,f=u.getLogger("CALL",t);f.info("Initiating new outgoing call.");const p=(0,a.getTurnInfo)(c.getState()),g=(0,a.getOptions)(c.getState()),E=(0,i.checkBandwidthControls)(o.bandwidth);let _;try{const e={defaultPeerConfig:g.defaultPeerConfig,turnInfo:p,bandwidth:E,dscpControls:o.dscpControls,callId:t,trickleIceMode:g.trickleIceMode,removeBundling:g.removeBundling};_=await d(n,e)}catch(e){throw f.info(`Failed to initiate call. Changing to ${s.CALL_STATES.ENDED}.`),e}return{participants:r,callInfo:_,options:o,bandwidth:E}}async function u(e,t,r){const{context:a,CallRequests:i,CallstackWebrtc:l,emitEvent:u,logManager:d}=e,{participants:f,callInfo:p,options:g,bandwidth:E}=r,_=d.getLogger("CALL",t);let y;try{const e={id:t,to:f.to,offer:p.offerSdp,isAnonymous:g.isAnonymous,account:g.account,from:f.from},r={displayName:g.displayName?g.displayName:"",customParameters:g.customParameters,customBodies:g.customBodies};y=await i.createSession(e,r)}catch(e){throw _.info("Failed to initiate call. Ending call and cleaning up WebRTC portions."),await l.closeCall(p.sessionId),e}_.info(`Finished initiating call. Changing to ${s.CALL_STATES.INITIATED} and waiting on remote answer.`);const v=(0,c.getSessionById)(a.getState(),p.sessionId);a.dispatch(n.callActions.pendingMakeCall(t,{wrtcsSessionId:y,webrtcSessionId:p.sessionId,mediaIds:p.mediaIds,bandwidth:E,displayName:g.displayName,customParameters:g.customParameters,customBodies:g.customBodies,localTracks:v.localTracks,state:s.CALL_STATES.INITIATED})),u(o.CALL_TRACKS_ADDED,{callId:t,trackIds:v.localTracks})}},56137:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,logManager:c,WebRTC:l,CallstackSDP:u}=e;return async function(e,d){const{customParameters:f}=d,p=(0,o.getCallByWrtcsSessionId)(t.getState(),e),g=c.getLogger("CALL",(p||{}).id);if(g.info("Received early media notice; handling.",{wrtcsSessionId:e}),!p)return void g.info("Early media notice for unknown wrtcsSession. Ignoring.",{wrtcsSessionId:e});const E=await l.sessionManager.get(p.webrtcSessionId);if(!E)return void g.info("Early media notice for missing wrtcsSession. Ignoring.",{wrtcsSessionId:e});if(f){const e=f.map((e=>e.name));g.debug(`Received custom parameters as part of the Call: ${e}.`),t.dispatch(n.callActions.customParametersReceived(p.id,{customParameters:f})),r(i.CUSTOM_PARAMETERS,{callId:p.id,customParameters:f})}try{const e=(0,o.getOptions)(t.getState()),r=u.runPipeline(e.sdpHandlers,d.sdp,{callId:p.id,type:"pranswer",step:"set",endpoint:"remote"});await E.processAnswer({type:"pranswer",sdp:r})}catch(e){throw g.debug(`Failed to process pranswer for Call ${p.id}; ignoring.`),e}const _=await(0,a.getAllRemoteTracks)(E);g.info(`Finished handling early media notice. Changing to ${s.CALL_STATES.EARLY_MEDIA}.`),t.dispatch(n.callActions.sessionProgress(p.id,{remoteParticipant:{displayNumber:d.remoteNumber,displayName:d.remoteName},remoteTracks:_})),r(i.CALL_TRACKS_ADDED,{callId:p.id,trackIds:_}),r(i.CALL_STATE_CHANGE,{callId:p.id,previous:{state:p.state,localHold:p.localHold,remoteHold:p.remoteHold}})}};var n=r(35),o=r(40481),a=r(48151),i=r(51918),s=r(77126)},80621:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,emitEvent:l,CallstackWebrtc:u,CallReporter:d,WebRTC:f}=e;return async function(e,p){const g=r.getLogger("CALL",e.id),E=d.getReport(e.id),_=e.currentOperations.find((e=>e.isLocal&&[a.OPERATIONS.MAKE,a.OPERATIONS.MAKE_ANONYMOUS,a.OPERATIONS.JOIN].includes(e.type))),y=E.getEvent(_.eventId).addEvent(c.REPORT_EVENTS.PROCESS_MEDIA_REMOTE);y.addData("operation",a.OPERATIONS.MAKE);try{const t={sessionId:e.webrtcSessionId,answerSdp:p.sdp};await u.receivedAnswer(t,e)}catch(r){return t.dispatch(n.callActions.endCallFinish(e.id,{error:r})),l(o.CALL_TRACKS_REMOVED,{callId:e.id,trackIds:[...e.localTracks,...e.remoteTracks]}),l(o.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold},error:r}),y.setError(r),void y.endEvent()}g.info(`Finished processing remote response to local ${_.type}. Changing state based on operation.`);const v=await f.sessionManager.get(e.webrtcSessionId),S=await(0,s.getAllRemoteTracks)(v);t.dispatch(n.callActions.makeCallFinish(e.id,{state:i.CALL_STATES.CONNECTED,startTime:Date.now(),remoteParticipant:{displayNumber:p.remoteNumber,displayName:p.remoteName},remoteTracks:S})),l(o.CALL_TRACKS_ADDED,{callId:e.id,trackIds:S}),l(o.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold}}),y.endEvent()}},r(62234);var n=r(35),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),a=r(59090),i=r(77126),s=r(48151),c=r(84581);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}},81571:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i,s){const c=(0,n.getCallById)(e,t);let l=(0,o.validateDestination)(c.to);if(!l)try{(0,a.validateMediaConstraints)(i)}catch(e){l=e}if(!l)try{(0,a.validateDetachedMedia)(i.medias)}catch(e){l=e}return l};var n=r(40481),o=r(25939),a=r(9066)},27030:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async function(t,r,n){await l(e,t,r)}},t.localChanges=l;var n=r(35),o=r(40481),a=r(51918),i=r(59090),s=r(77126),c=r(84581);async function l(e,t,r,l){const{context:u,CallRequests:d,Callstack:f,emitEvent:p,CallReporter:g,logManager:E}=e,{setupIncomingCall:_}=f.utils,{sdp:y,callId:v}=r,S=(0,o.getOptions)(u.getState()),O=g.getReport(v).findLastOngoingEvent(c.REPORT_EVENTS.RECEIVE_CALL),h=E.getLogger("CALL",v);if(y){O.addData("isSlowStart",!1);const e=(0,o.getTurnInfo)(u.getState());try{await _({offer:{sdp:y,type:"offer"},trickleIceMode:S.trickleIceMode,defaultPeerConfig:S.defaultPeerConfig,turnInfo:e,callId:v,removeBundling:S.removeBundling,serverTurnCredentials:S.serverTurnCredentials})}catch(e){throw h.info(`Failed to initiate incoming call. Changing to ${s.CALL_STATES.ENDED}.`),u.dispatch(n.callActions.endCallFinish(v,{isLocal:!0,error:{error:e}})),p(a.CALL_OPERATION,{callId:v,isLocal:!0,operation:i.OPERATIONS.END,transition:i.OP_TRANSITIONS.FINISH,error:{error:e}}),p(a.CALL_STATE_CHANGE,{callId:v,previous:{state:s.CALL_STATES.INITIATING,localHold:!1,remoteHold:!1},error:{error:e}}),e}}else h.debug("Incoming call is a slow-start call."),O.addData("isSlowStart",!0);let T=s.CALL_STATES.INITIATED;if("auto"===S.ringingFeedbackMode){h.info("Sending ringing feedback automatically for incoming call.");const e={wrtcsSessionId:t,id:v};try{await d.updateCallRinging(e),h.debug("Successfully sent ringing feedback."),T=s.CALL_STATES.RINGING}catch(e){h.info(`Failed to send ringing feedback - ${e.code}: ${e.message} `)}}h.info(`Finished initiating incoming call. Changing to ${T} and waiting on local answer.`),u.dispatch(n.callActions.updateCall(v,{state:T})),p(a.CALL_STATE_CHANGE,{callId:v,previous:{state:s.CALL_STATES.INITIATING,localHold:!1,remoteHold:!1}})}},94916:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,WebRTC:s,CallstackSDP:c,CallReporter:l}=e;return async function(e){const{defaultPeerConfig:u,turnInfo:d,trickleIceMode:f,callId:p,removeBundling:g}=e,E=e.offer,_=r.getLogger("CALL",p);let y;_.info("Setting up remote WebRTC portions of call.");try{let e=u.iceServers;d&&(e=e.map((e=>({...e,username:d.username,credential:d.password})))),y=await s.sessionManager.create({peer:{rtcConfig:{...u,iceServers:e},trickleIceMode:f,removeBundling:g}})}catch(e){throw _.debug("Failed to create WebRTC Session for incoming Call.",e.message),new i.default({message:e.message,code:i.callCodes.GENERIC_ERROR})}t.dispatch(n.callActions.sessionCreated(p,{webrtcSessionId:y.id}));const v=l.getReport(p).findLastOngoingEvent(a.REPORT_EVENTS.RECEIVE_CALL).addEvent(a.REPORT_EVENTS.PROCESS_MEDIA_REMOTE);v.addData("operation",a.REPORTER_OPERATION_EVENTS_MAP.MAKE_REMOTE),v.addData("isSlowStart",!1);const S=(0,o.getOptions)(t.getState());try{E.sdp=c.runPipeline(S.sdpHandlers,E.sdp,{callId:p,type:E.type,step:"set",endpoint:"remote"}),await y.processOffer({type:"offer",sdp:E.sdp}),v.endEvent(),_.info("Finished setting up remote WebRTC portions of call.")}catch(e){throw v.setError(e),v.endEvent(),e}return y.id}};var n=r(35),o=r(40481),a=r(84581),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},62168:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,CallReporter:u,CallstackSDP:d,WebRTC:f}=e;return async function(p,g){const E=r.getLogger("CALL",g.callId);E.info("Setting up local WebRTC portions of call.");const _=(0,o.getCallById)(t.getState(),g.callId),y=u.getReport(_.id),v=_.currentOperations.find((e=>e.isLocal&&e.status===a.OP_STATUS.ONGOING)),S=y.getEvent(v.eventId);let O,h=[];if(p.medias)for(const e of p.medias)h.push({type:e.type,media:await f.media.get(e.media.id)});if(p.audio||p.video||p.screen)try{const t=await e.CallstackWebrtc.createLocal(p,g.callId);h=h.concat(t)}catch(e){throw E.debug("Failed to get media requested for the call."),e}try{let e=g.defaultPeerConfig.iceServers;g.turnInfo&&(e=e.map((e=>({...e,username:g.turnInfo.username,credential:g.turnInfo.password})))),O=await f.sessionManager.create({peer:{rtcConfig:{...g.defaultPeerConfig,iceServers:e},trickleIceMode:g.trickleIceMode,removeBundling:g.removeBundling}}),E.debug("Created WebRTC Session for Call.",{webrtcSessionId:O.id})}catch(e){throw E.debug("Failed to create WebRTC Session for Call.",e.message),new c.default({message:e.message,code:c.callCodes.GENERIC_ERROR})}t.dispatch(n.callActions.sessionCreated(g.callId,{webrtcSessionId:O.id}));const T=await(0,i.organizeTracks)(h),I=(0,s.getTrackDscpMapping)(T,g.dscpControls);try{await O.addTracks(T.all,I)}catch(e){throw e}const C=(0,o.getOptions)(t.getState());let m,A,b,R;try{R=S.addEvent(l.REPORT_EVENTS.CREATE_OFFER),A=await O.createOffer(),R.endEvent()}catch(e){E.debug("Failed to create local SDP offer.",e.message);const t=new c.default({message:e.message,code:c.callCodes.GENERIC_ERROR});throw R.endEvent(t),t}try{A.sdp=d.runPipeline(C.sdpHandlers,A.sdp,{callId:g.callId,type:A.type,step:"set",endpoint:"local",bandwidth:g.bandwidth}),b=S.addEvent(l.REPORT_EVENTS.PROCESS_MEDIA_LOCAL),b.addData("operation",v.type),A=await O.setLocalDescription(A),b.endEvent(),m=d.runPipeline(C.sdpHandlers,A.sdp,{callId:g.callId,type:A.type,step:"send",endpoint:"local",bandwidth:g.bandwidth})}catch(e){E.debug("Failed to set local SDP.",e.message);const t=new c.default({message:e.message,code:c.callCodes.GENERIC_ERROR});throw b.endEvent(t),t}return E.info("Finished setting up local WebRTC portions of call."),{offerSdp:m,sessionId:O.id,mediaIds:h.map((e=>e.media.id))}}},r(69375);var n=r(35),o=r(40481),a=r(59090),i=r(56294),s=r(69752),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412)),l=r(84581);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}},32466:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,n.default)(e.container);e.factory("Callstack.stages.startMOH",(()=>({remote:{remoteOffer:t.localChanges,signalling:t.signalling}}))),e.factory("Callstack.stages.stopMOH",(()=>{const t=(0,o.default)(e.container);return{remote:{remoteOffer:t.localChanges,signalling:t.signalling}}})),e.factory("Callstack.operations.startMOH",(()=>{const t=e.container.Callstack.models.Negotiation;return{remote:function(r){return t.instance({type:a.OPERATIONS.START_MOH,isLocal:!1,stages:e.container.Callstack.stages.startMOH.remote},{callId:r})}}})),e.factory("Callstack.operations.stopMOH",(()=>{const t=e.container.Callstack.models.Negotiation;return{remote:function(r){return t.instance({type:a.OPERATIONS.STOP_MOH,isLocal:!1,stages:e.container.Callstack.stages.stopMOH.remote},{callId:r})}}}))};var n=i(r(12637)),o=i(r(34597)),a=r(59090);function i(e){return e&&e.__esModule?e:{default:e}}},12637:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r}=e;return{localChanges:(t,r,n)=>g(e,t,r,n),signalling:async(n,o,a)=>{try{const{remoteTracks:i}=await E(e,n,a);t.dispatch(l.callActions.remoteStartMohFinish(n.id,{remote:!0,remoteParticipant:{displayNumber:o.remoteNumber,displayName:o.remoteName},remoteTracks:i})),r(u.CALL_TRACKS_ADDED,{callId:n.id,trackIds:i})}catch(e){throw t.dispatch(l.callActions.remoteStartMohFinish(n.id,{remote:!0,error:e})),e}}}},t.localChanges=g,t.signalling=E,r(97107),r(62234);var n=r(73520),o=p(r(48151)),a=p(r(11876)),i=p(r(29819)),s=r(70949),c=r(77126),l=r(35),u=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),d=r(59090);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function p(e){return e&&e.__esModule?e:{default:e}}async function g(e,t,r,o){const{CallstackWebrtc:l,CallstackSDP:u,WebRTC:d,logManager:f}=e,p=f.getLogger("CALL",t.id),g=await d.sessionManager.get(t.webrtcSessionId);if(!g)throw p.debug(`webRTC session ${t.webrtcSessionId} not found.`),new Error(`Session for call ${t.id} not found.`);const E=(0,n.getMediaState)(t);if((0,a.default)(r.sdp)&&[c.CALL_MEDIA_STATES.DUAL_HOLD,c.CALL_MEDIA_STATES.LOCAL_HOLD].includes(E)){if(p.debug("Modifying remote offer to prevent resetting media while in local hold."),r.sdp=(0,i.default)(r.sdp),!r.sdp)return void p.debug("SDP is either undefined or not a string.");o.mediaDiff=u.compareMedia(o.remoteDesc.sdp,r.sdp,!0)}if(!await(0,s.isSameSdpSessionId)(d,t.webrtcSessionId,r.sdp)){p.debug(`Received offer SDP is from a different session. Recreating Peer for call ${t.id}.`);const e=await d.sessionManager.get(t.webrtcSessionId);await e.recreatePeer()}let _;try{_=await l.handleOffer(r.sdp,t.webrtcSessionId,t.bandwidth)}catch(e){throw p.debug("Failed to receive offer SDP.",e),e}return{answer:_,opInfo:o,session:g}}async function E(e,t,r){const{CallRequests:n,logManager:a}=e,{answer:i,opInfo:s,session:c}=r,l=a.getLogger("CALL",t.id);try{return await n.updateSessionResponse({wrtcsSessionId:t.wrtcsSessionId,answer:i.answerSDP,isAnonymous:t.isAnonymous,account:t.account,customParameters:t.customParameters,customBodies:t.customBodies}),l.info("Finished responding to remote update. Changing state based on the remote operation."),{remoteTracks:await(0,o.default)(d.OPERATIONS.START_MOH,s.mediaDiff,c)}}catch(e){throw l.info("Failed to respond to remote offer with an answer."),e}}},34597:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r}=e;return{localChanges:(t,r,n)=>g(e,t,r,n),signalling:async(n,o,a)=>{try{const{remoteTracks:i}=await E(e,n,a);t.dispatch(l.callActions.remoteStopMohFinish(n.id,{remote:!0,remoteParticipant:{displayNumber:o.remoteNumber,displayName:o.remoteName},remoteTracks:i})),r(u.CALL_TRACKS_REMOVED,{callId:n.id,trackIds:i})}catch(e){throw t.dispatch(l.callActions.remoteStopMohFinish(n.id,{remote:!0,error:e})),e}}}},t.localChanges=g,t.signalling=E,r(97107),r(62234);var n=r(73520),o=p(r(48151)),a=p(r(11876)),i=p(r(29819)),s=r(70949),c=r(77126),l=r(35),u=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),d=r(59090);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function p(e){return e&&e.__esModule?e:{default:e}}async function g(e,t,r,o){const{CallstackWebrtc:l,CallstackSDP:u,WebRTC:d,logManager:f}=e,p=f.getLogger("CALL",t.id),g=await d.sessionManager.get(t.webrtcSessionId);if(!g)throw p.debug(`webRTC session ${t.webrtcSessionId} not found.`),new Error(`Session for call ${t.id} not found.`);const E=(0,n.getMediaState)(t);if((0,a.default)(r.sdp)&&[c.CALL_MEDIA_STATES.DUAL_HOLD,c.CALL_MEDIA_STATES.LOCAL_HOLD].includes(E)){if(p.debug("Modifying remote offer to prevent resetting media while in local hold."),r.sdp=(0,i.default)(r.sdp),!r.sdp)return void p.debug("SDP is either undefined or not a string.");o.mediaDiff=u.compareMedia(o.remoteDesc.sdp,r.sdp,!0)}if(!await(0,s.isSameSdpSessionId)(d,t.webrtcSessionId,r.sdp)){p.debug(`Received offer SDP is from a different session. Recreating Peer for call ${t.id}.`);const e=await d.sessionManager.get(t.webrtcSessionId);await e.recreatePeer()}let _;try{_=await l.handleOffer(r.sdp,t.webrtcSessionId,t.bandwidth)}catch(e){throw p.debug("Failed to receive offer SDP.",e),e}return{answer:_,session:g,opInfo:o}}async function E(e,t,r){const{CallRequests:n,logManager:a}=e,{answer:i,opInfo:s,session:c}=r,l=a.getLogger("CALL",t.id);try{return await n.updateSessionResponse({wrtcsSessionId:t.wrtcsSessionId,answer:i.answerSDP,isAnonymous:t.isAnonymous,account:t.account,customParameters:t.customParameters,customBodies:t.customBodies}),l.info("Finished responding to remote update. Changing state based on the remote operation."),{remoteTracks:await(0,o.default)(d.OPERATIONS.STOP_MOH,s.mediaDiff,c)}}catch(e){throw l.info("Failed to respond to remote offer with an answer."),e}}},33841:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.removeMedia",(()=>{const t=(0,n.default)(e.container),r=(0,c.default)(e.container);return{local:{validate:o.default,localOffer:t.localChanges,signalling:t.signalling,remoteAnswer:(0,l.default)(e.container),rollback:(0,i.default)(e.container)},remote:{remoteOffer:r.localChanges,signalling:r.signalling}}})),e.factory("Callstack.stages.removeBasicMedia",(()=>{const t=(0,n.default)(e.container);return{local:{validate:s.default,localOffer:t.localChanges,signalling:t.signalling,remoteAnswer:(0,l.default)(e.container),rollback:(0,i.default)(e.container)}}})),e.factory("Callstack.operations.removeMedia",(()=>{const t=e.container.Callstack,r=t.models.Negotiation;function n(e){return(n,o)=>{const a=t.stages.removeMedia[e?"local":"remote"];return r.instance({type:u.OPERATIONS.REMOVE_MEDIA,isLocal:e,stages:a},{callId:n,deferred:o})}}return{local:n(!0),remote:n(!1)}})),e.factory("Callstack.operations.removeBasicMedia",(()=>{const t=e.container.Callstack.models.Negotiation;return{local:function(r,n){return t.instance({type:u.OPERATIONS.REMOVE_BASIC_MEDIA,isLocal:!0,stages:e.container.Callstack.stages.removeBasicMedia.local},{callId:r,deferred:n})}}})),e.factory("Callstack.utils.webrtcRemoveMedia",(()=>(0,a.default)(e.container))),e.factory("Callstack.utils.rollbackRemoveMedia",(()=>(0,i.default)(e.container)))};var n=d(r(73817)),o=d(r(87851)),a=d(r(45370)),i=d(r(50361)),s=d(r(21981)),c=d(r(8588)),l=d(r(83557)),u=r(59090);function d(e){return e&&e.__esModule?e:{default:e}}},83557:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,emitEvent:s,CallstackWebrtc:c,CallReporter:l}=e;return async function(e,u){const d=r.getLogger("CALL",e.id),f=l.getReport(e.id),p=e.currentOperations.find((e=>e.isLocal&&[a.OPERATIONS.REMOVE_MEDIA,a.OPERATIONS.REMOVE_BASIC_MEDIA].includes(e.type))),g=f.getEvent(p.eventId).addEvent(i.REPORT_EVENTS.PROCESS_MEDIA_REMOTE);g.addData("operation",i.REPORTER_OPERATION_EVENTS_MAP.REMOVE_MEDIA);try{const t={sessionId:e.webrtcSessionId,answerSdp:u.sdp};await c.receivedAnswer(t,e)}catch(r){throw t.dispatch(n.callActions.endCallFinish(e.id,{error:r})),s(o.CALL_TRACKS_REMOVED,{callId:e.id,trackIds:[...e.localTracks,...e.remoteTracks]}),s(o.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold},error:r}),g.setError(r),g.endEvent(),r}d.info(`Finished processing remote response to local ${p.type}. Changing state based on operation.`);const E=p.operationData.tracks;s(o.CALL_REMOVED_MEDIA,{callId:e.id,local:!0,tracks:E}),t.dispatch(n.callActions.removeMediaFinish(e.id,{bandwidth:p.operationData.bandwidth,localTracks:E})),s(o.CALL_TRACKS_REMOVED,{callId:e.id,trackIds:E}),g.endEvent()}},r(62234);var n=r(35),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),a=r(59090),i=r(84581);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},73817:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{localChanges:function(t,r){return s(e,t,r,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})},signalling:(t,r)=>c(e,t,r)}},t.localChanges=s,t.signalling=c;var n=r(51918),o=r(35),a=r(40481),i=r(37654);async function s(e,t,r,n){const{context:o,Callstack:i,logManager:s}=e,c=s.getLogger("CALL",t);c.info("Removing media from call.");const{bandwidth:l}=n,u=(0,a.getCallById)(o.getState(),t),{webrtcSessionId:d,bandwidth:f}=u,p={audio:l&&l.audio?l.audio:f.audio,video:l&&l.video?l.video:f.video};let g;try{g=await i.utils.webrtcRemoveMedia({sessionId:d,tracks:r,bandwidth:p})}catch(e){throw c.info("Failed to remove media from call."),e}return{operationData:{local:!0,tracks:r,bandwidth:p},sdp:g}}async function c(e,t,r){const{context:s,CallRequests:c,Callstack:l,CallstackWebrtc:u,emitEvent:d,logManager:f}=e,{sdp:p}=r,g=(0,a.getCallById)(s.getState(),t),E=f.getLogger("CALL",g.id);try{await c.updateSession({wrtcsSessionId:g.wrtcsSessionId,id:g.id,offer:p,isAnonymous:g.isAnonymous,account:g.account,customParameters:g.customParameters,customBodies:g.customBodies})}catch(e){E.info("Failed to remove media from call.");try{await l.utils.rollbackRemoveMedia(g.webrtcSessionId)}catch(t){if(E.debug("Automatic remove media rollback failed:",t),"safari"===(0,i.getBrowserDetails)().browser)throw E.info("Ending call due to unrecoverable state after call remove media failure."),await u.closeCall(g.webrtcSessionId),s.dispatch(o.callActions.endCallFinish(g.id,{isLocal:!0,transition:{reasonText:"Call has ended due to call remove media failure."}})),d(n.CALL_STATE_CHANGE,{callId:g.id,previous:{state:g.state,localHold:g.localHold,remoteHold:g.remoteHold},error:e}),e;E.info("Unable to reset state after remove media operation failure, future operations may not work as intended.")}throw e}E.info("Finished local portion of removing media. Waiting on remote response.")}},87851:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const c=(0,i.getCallById)(e,t);return c?c.state!==a.CALL_STATES.CONNECTED?new s.default({code:s.callCodes.INVALID_STATE,message:`Invalid call state: ${c.state}. It should be: ${a.CALL_STATES.CONNECTED}.`}):!(0,o.default)(r)||(0,n.default)(r)?new s.default({code:s.callCodes.INVALID_PARAM,message:'Invalid parameter"; no track IDs specified to remove.'}):void 0:new s.default({code:s.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."})};var n=l(r(84499)),o=l(r(90283)),a=r(77126),i=r(40481),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}function l(e){return e&&e.__esModule?e:{default:e}}},21981:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const i=(0,a.getCallById)(e,t);return i?i.state!==o.CALL_STATES.CONNECTED?new n.default({code:n.callCodes.INVALID_STATE,message:`Invalid call state: ${i.state}. It should be: ${o.CALL_STATES.CONNECTED}.`}):1!==r.length?new n.default({code:n.callCodes.INVALID_PARAM,message:"Must have only one track for basic scenario!"}):void 0:new n.default({code:n.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."})};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412)),o=r(77126),a=r(40481);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},8588:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r}=e;return{localChanges:(t,r,n)=>p(e,t,r,n),signalling:async(n,o,a)=>{try{const{remoteTracks:i}=await g(e,n,a);t.dispatch(c.callActions.remoteRemoveMediaFinish(n.id,{remote:!0,remoteParticipant:{displayNumber:o.remoteNumber,displayName:o.remoteName},localTracks:void 0,remoteTracks:i})),r(l.CALL_TRACKS_REMOVED,{callId:n.id,trackIds:i})}catch(e){throw t.dispatch(c.callActions.remoteRemoveMediaFinish(n.id,{remote:!0,error:e})),e}}}},t.localChanges=p,t.signalling=g,r(97107),r(62234);var n=r(73520),o=f(r(48151)),a=f(r(11876)),i=f(r(29819)),s=r(77126),c=r(35),l=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),u=r(59090);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}function f(e){return e&&e.__esModule?e:{default:e}}async function p(e,t,r,o){const{WebRTC:c,CallstackWebrtc:l,CallstackSDP:u,logManager:d}=e,f=d.getLogger("CALL",t.id),p=await c.sessionManager.get(t.webrtcSessionId);if(!p)throw f.debug(`webRTC session ${t.webrtcSessionId} not found.`),new Error(`Session for call ${t.id} not found.`);const g=(0,n.getMediaState)(t);if((0,a.default)(r.sdp)&&[s.CALL_MEDIA_STATES.DUAL_HOLD,s.CALL_MEDIA_STATES.LOCAL_HOLD].includes(g)){if(f.debug("Modifying remote offer to prevent resetting media while in local hold."),r.sdp=(0,i.default)(r.sdp),!r.sdp)return void f.debug("SDP is either undefined or not a string.");o.mediaDiff=u.compareMedia(o.remoteDesc.sdp,r.sdp,!0)}let E;try{E=await l.handleOffer(r.sdp,t.webrtcSessionId,t.bandwidth)}catch(e){throw f.debug("Failed to receive offer SDP.",e),e}return{answer:E,opInfo:o,session:p}}async function g(e,t,r){const{CallRequests:n,logManager:a}=e,{answer:i,opInfo:s,session:c}=r,l=a.getLogger("CALL",t.id);try{return await n.updateSessionResponse({wrtcsSessionId:t.wrtcsSessionId,answer:i.answerSDP,isAnonymous:t.isAnonymous,account:t.account,customParameters:t.customParameters,customBodies:t.customBodies}),l.info("Finished responding to remote update. Changing state based on the remote operation."),{remoteTracks:await(0,o.default)(u.OPERATIONS.REMOVE_MEDIA,s.mediaDiff,c)}}catch(e){throw l.info("Failed to respond to remote offer with an answer."),e}}},50361:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,WebRTC:r}=e;return async function(e){const n=t.getLogger("CALLSTACK"),a=await r.sessionManager.get(e);if(!a){const t=`WebRTC session ${e} not found.`;throw n.debug(t),new o.default({message:t})}let i;try{i=await a.rollbackLocalDescription()}catch(e){throw n.debug("Failed to rollback local description offer SDP:",e),e}return{offer:i}}};var n,o=(n=r(75412))&&n.__esModule?n:{default:n}},45370:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,CallstackSDP:r,CallReporter:l,WebRTC:u}=e;return async function(e){const{sessionId:d,bandwidth:f,tracks:p}=e,g=await u.track.getTracks(p),E=g.reduce(((e,t,r)=>(0,n.default)(t)?e.concat(r):e),[]).map((e=>p[e]));if(!(0,o.default)(E)){const e=`The following invalid track ids were provided: ${E.join(", ")}`;throw new c.default({code:c.callCodes.INVALID_PARAM,message:e})}const _=await u.sessionManager.get(d),y=(0,a.getCallByWebrtcSessionId)(t.getState(),d),v=y.id,S=l.getReport(v),O=y.currentOperations.find((e=>e.isLocal&&[i.OPERATIONS.REMOVE_MEDIA,i.OPERATIONS.REMOVE_BASIC_MEDIA].includes(e.type))),h=S.getEvent(O.eventId);await _.removeTracks(p);try{await Promise.all(g.map((async e=>{if(!await e.isDetached())return e.stop()})))}catch(e){}const T=(0,a.getOptions)(t.getState());let I,C,m,A;try{A=h.addEvent(s.REPORT_EVENTS.CREATE_OFFER),I=await _.createOffer(),A.endEvent()}catch(e){const t=new c.default({message:e.message,code:c.callCodes.GENERIC_ERROR});throw A.endEvent(t),t}try{I.sdp=r.runPipeline(T.sdpHandlers,I.sdp,{callId:v,type:I.type,step:"set",endpoint:"local",bandwidth:f}),m=h.addEvent(s.REPORT_EVENTS.PROCESS_MEDIA_LOCAL),m.addData("operation",s.REPORTER_OPERATION_EVENTS_MAP.REMOVE_MEDIA),I=await _.setLocalDescription(I),m.endEvent(),C=r.runPipeline(T.sdpHandlers,I.sdp,{callId:v,type:I.type,step:"send",endpoint:"local",bandwidth:f})}catch(e){const t=new c.default({message:e.message,code:c.callCodes.GENERIC_ERROR});throw m.endEvent(t),t}return C}},r(62234);var n=u(r(54502)),o=u(r(84499)),a=r(40481),i=r(59090),s=r(84581),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e){return e&&e.__esModule?e:{default:e}}},87351:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async function(t,r){await _(e,t,r)}},t.localChanges=_,r(97107),r(62234);var n=r(73520),o=E(r(11876)),a=E(r(48151)),i=r(77126),s=r(59090),c=g(r(50527)),l=g(r(21836)),u=g(r(51918)),d=r(84581),f=r(69260);function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function E(e){return e&&e.__esModule?e:{default:e}}async function _(e,t,r){const{context:p,WebRTC:g,Callstack:E,CallstackSDP:_,CallstackWebrtc:y,emitEvent:v,logManager:S,CallReporter:O}=e,h=await async function(e,t){const r=S.getLogger("CALL",e.id);let{remoteOp:o,mediaDiff:a,remoteDesc:i}=await E.utils.getRemoteOperationInfo(e,t);const c=(0,n.getMediaState)(e);return r.info(`Handling state change as remote ${o} in ${c} scenario.`),o===s.OPERATIONS.UNHOLD&&!0===e.localHold&&["sendrecv","sendonly","recvonly"].some((e=>t.includes(e)))&&(r.debug("Modifying remote SDP to prevent media in local hold scenario."),t=t.replace(/sendrecv|sendonly|recvonly/gi,"inactive"),a=_.compareMedia(i.sdp,t,!0)),{remoteOp:o,mediaDiff:a,remoteDesc:i,sdp:t}}(t,r.sdp),T=await async function(e,t){const r=S.getLogger("CALL",e.id);r.info("Processing remote response from slow-start remote update request.");const n=await g.sessionManager.get(e.webrtcSessionId);if(!n)throw r.debug(`webRTC session ${e.webrtcSessionId} not found.`),new Error(`Session for call ${e.id} not found.`);const a=O.getReport(e.id),c=e.currentOperations.find((e=>!e.isLocal&&e.type===s.OPERATIONS.SLOW_START)),l=a.getEvent(c.eventId),u=l.addEvent(d.REPORT_EVENTS.PROCESS_MEDIA_REMOTE);u.addData("operation",l.type);try{await y.receivedAnswer({sessionId:e.webrtcSessionId,answerSdp:t},e),u.endEvent()}catch(e){throw r.debug("Failed to receive answer SDP",e),u.endEvent(e),e}const f=(0,o.default)(t)?i.CALL_STATES.CONNECTED:i.CALL_STATES.ON_HOLD;return r.info(`Finished processing remote slow-start response. Changing to ${f}.`),n}(t,h.sdp);await async function(e,t,r,n){const{remoteOp:d,mediaDiff:g}=r,E=await(0,a.default)(d,g,n);let _=[];!e.localHold&&[s.OPERATIONS.HOLD,s.OPERATIONS.UNHOLD].includes(d)&&(_=(0,f.getSessionById)(p.getState(),e.webrtcSessionId).localTracks);const y=(0,o.default)(t.sdp)?i.CALL_STATES.CONNECTED:i.CALL_STATES.ON_HOLD,S=function(e){const t={[s.OPERATIONS.HOLD]:c.remoteHoldFinish,[s.OPERATIONS.UNHOLD]:c.remoteUnholdFinish,[s.OPERATIONS.ADD_MEDIA]:c.remoteAddMediaFinish,[s.OPERATIONS.REMOVE_MEDIA]:c.remoteRemoveMediaFinish,[s.OPERATIONS.START_MOH]:c.remoteStartMohFinish,[s.OPERATIONS.STOP_MOH]:c.remoteStopMohFinish,[s.OPERATIONS.SLOW_START]:c.remoteSlowStart};return function(){const r=(t[e]||c.updateCall)(...arguments);return r.type===l.UPDATE_CALL&&(r.meta={isRemote:!0}),r}}(d);p.dispatch(S(e.id,{state:y,remoteParticipant:{displayNumber:t.remoteNumber,displayName:t.remoteName},remoteTracks:E,localTracks:_})),s.OPERATIONS.HOLD===d?(v(u.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold}}),v(u.CALL_TRACKS_REMOVED,{callId:e.id,trackIds:[..._,...E]})):s.OPERATIONS.UNHOLD===d?(v(u.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold}}),v(u.CALL_TRACKS_ADDED,{callId:e.id,trackIds:[..._,...E]})):[s.OPERATIONS.ADD_MEDIA,s.OPERATIONS.START_MOH].includes(d)?v(u.CALL_TRACKS_ADDED,{callId:e.id,trackIds:E}):[s.OPERATIONS.REMOVE_MEDIA,s.OPERATIONS.STOP_MOH].includes(d)&&v(u.CALL_TRACKS_REMOVED,{callId:e.id,trackIds:E})}(t,r,h,T)}},58422:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.slowStart",(()=>{const t=(0,n.default)(e.container);return{remote:{localOffer:t.localChanges,signalling:t.signalling,remoteAnswer:(0,o.default)(e.container)}}})),e.factory("Callstack.operations.slowStart",(()=>{const t=e.container.Callstack.models.Negotiation;return{remote:function(r){return t.instance({type:i.OPERATIONS.SLOW_START,isLocal:!1,stages:e.container.Callstack.stages.slowStart.remote,createFlow:(e,t,r)=>{const n=(0,a.default)(e,t,r);return{...n,start:function(e,t){for(var r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];return n.start(e,o)}}}},{callId:r,deferred:{resolve:()=>{},reject:()=>{}}})}}}))};var n=s(r(77406)),o=s(r(87351)),a=s(r(98307)),i=r(59090);function s(e){return e&&e.__esModule?e:{default:e}}},77406:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{localChanges:(t,r)=>s(e,t,r),signalling:(t,r)=>c(e,t,r)}},t.localChanges=s,t.signalling=c;var n=r(73520),o=r(40481),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(50527));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}async function s(e,t,r){const{context:a,WebRTC:i,CallstackWebrtc:s,logManager:c}=e,l=c.getLogger("CALL",t.id);l.info("Processing slow-start update request from remote endpoint.");const u=(0,n.getMediaState)(t);l.debug(`Current call info; State: ${t.state}, MediaState: ${u}.`);const{mediaBrokerOnly:d}=(0,o.getOptions)(a.getState());if(d)l.debug("Not recreating PeerConnection as mediaBrokerOnly is set to true in configuration.");else{l.debug(`Recreating Peer for Session ${t.webrtcSessionId}.`);const e=await i.sessionManager.get(t.webrtcSessionId);await e.recreatePeer()}const f={audio:t.localHold?"inactive":"sendrecv",video:t.localHold?"inactive":"sendrecv"};let p;try{p=await s.generateOffer(t.webrtcSessionId,f)}catch(e){throw l.info("Failed to respond to slow-start remote update.",e),e}return{slowOffer:p,...r}}async function c(e,t,r){const{context:n,CallRequests:o,logManager:i}=e,{slowOffer:s,remoteNumber:c,remoteName:l}=r,u=i.getLogger("CALL",t.id);try{await o.updateSessionResponse({wrtcsSessionId:t.wrtcsSessionId,answer:s.sdp,isAnonymous:t.isAnonymous,account:t.account,customParameters:t.customParameters,customBodies:t.customBodies}),n.dispatch(a.remoteSlowStart(t.id,{remoteParticipant:{displayNumber:c,displayName:l}})),u.info("Finished responding to slow-start remote update. Waiting on remote response.")}catch(e){throw n.dispatch(a.remoteSlowStart(t.id,{remote:!0,error:e})),u.info("Failed to respond to slow-start remote update.",e),e}}},82489:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,n.default)(e.container),r=(0,i.default)(e.container);e.factory("Callstack.stages.unhold",(()=>({local:{validate:o.default,localOffer:t.localChanges,signalling:t.signalling,remoteAnswer:(0,s.default)(e.container),rollback:(0,a.default)(e.container)},remote:{remoteOffer:r.localChanges,signalling:r.signalling}}))),e.factory("Callstack.operations.unhold",(()=>{const t=e.container.Callstack,r=t.models.Negotiation;function n(e){return(n,o)=>{const a=t.stages.unhold[e?"local":"remote"];return r.instance({type:c.OPERATIONS.UNHOLD,isLocal:e,stages:a},{callId:n,deferred:o})}}return{local:n(!0),remote:n(!1)}})),e.factory("Callstack.utils.rollbackUnhold",(()=>(0,a.default)(e.container)))};var n=l(r(5075)),o=l(r(65939)),a=l(r(5683)),i=l(r(70100)),s=l(r(15549)),c=r(59090);function l(e){return e&&e.__esModule?e:{default:e}}},15549:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,emitEvent:n,CallstackWebrtc:f,CallReporter:p,WebRTC:g}=e;return async function(e,E){const _=r.getLogger("CALL",e.id),y=p.getReport(e.id),v=e.currentOperations.find((e=>e.isLocal&&e.type===i.OPERATIONS.UNHOLD)),S=y.getEvent(v.eventId).addEvent(c.REPORT_EVENTS.PROCESS_MEDIA_REMOTE);S.addData("operation",i.OPERATIONS.UNHOLD);try{const t={sessionId:e.webrtcSessionId,answerSdp:E.sdp};await f.receivedAnswer(t,e)}catch(r){throw t.dispatch(o.callActions.endCallFinish(e.id,{error:r})),S.setError(r),S.endEvent(),r}const O=d.default.parse(E.sdp);O.media.every((e=>"inactive"===e.direction||"sendonly"===e.direction))?t.dispatch(o.callActions.updateCall(e.id,{remoteHold:!0})):e.remoteHold&&O.media.some((e=>"sendrecv"===e.direction))&&t.dispatch(o.callActions.updateCall(e.id,{remoteHold:!1})),_.info(`Finished processing remote response to local ${v.type}. Changing state based on operation.`);const h=await g.sessionManager.get(e.webrtcSessionId),T=await(0,s.getAllRemoteTracks)(h);let I=[];(e=(0,l.getCallById)(t.getState(),e.id)).remoteHold||(I=(0,u.getSessionById)(t.getState(),e.webrtcSessionId).localTracks),t.dispatch(o.callActions.unholdCallFinish(e.id,{...v.operationData,localTracks:I,remoteTracks:T})),[...I,...T].length>0&&n(a.CALL_TRACKS_ADDED,{callId:e.id,trackIds:[...I,...T]}),n(a.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold}}),S.endEvent()}};var n,o=r(35),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),i=r(59090),s=r(48151),c=r(84581),l=r(40481),u=r(69260),d=(n=r(54722))&&n.__esModule?n:{default:n};function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}},5075:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{localChanges:t=>s(e,t),signalling:(t,r)=>c(e,t,r)}},t.localChanges=s,t.signalling=c;var n=r(35),o=r(40481),a=r(37654),i=r(69260);async function s(e,t){const{context:r,CallstackWebrtc:n,logManager:a}=e,s=a.getLogger("CALL",t);s.info("Unholding call.");const c=(0,o.getCallById)(r.getState(),t),{webrtcSessionId:l}=c,u=(0,i.getSessionById)(r.getState(),l).localTracks.map((e=>(0,i.getTrackById)(r.getState(),e))),d={audio:u.some((e=>"audio"===e.kind))?"sendrecv":"recvonly",video:u.some((e=>"video"===e.kind))?"sendrecv":"recvonly"};let f;try{f=await n.generateOffer(l,d,c.bandwidth)}catch(e){throw s.debug("Invalid SDP offer or SDP offer not received."),e}return{offer:f}}async function c(e,t,r){const{context:i,CallRequests:s,Callstack:c,CallstackWebrtc:l,logManager:u}=e,{offer:d}=r,f=(0,o.getCallById)(i.getState(),t),p=u.getLogger("CALL",f.id),g={wrtcsSessionId:f.wrtcsSessionId,id:f.id,offer:d.sdp,isAnonymous:f.isAnonymous,account:f.account,customParameters:f.customParameters,customBodies:f.customBodies};try{await s.updateSession(g)}catch(e){let t;p.info("Failed to unhold call.");try{await c.utils.rollbackUnhold(f.webrtcSessionId)}catch(e){p.debug("Automatic unhold rollback failed:",e),t=e}const r=(0,a.getBrowserDetails)().browser;if(t){if("safari"===r)throw p.info("Ending call due to unrecoverable state after call unhold failure."),await l.closeCall(f.webrtcSessionId),i.dispatch(n.callActions.endCallFinish(f.id,{isLocal:!0,transition:{reasonText:"Call has ended due to call unhold failure."}})),e;p.info("Unable to reset state after unhold operation failure, future operations may not work as intended.")}throw e}p.info("Finished local portion of unholding call. Waiting on remote response.")}},65939:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=(0,n.getCallById)(e,t);return r?!0!==r.localHold?new o.default({code:o.callCodes.INVALID_STATE,message:"Call is in an invalid state: localHold=false. It should be: localHold=true."}):void 0:new o.default({code:o.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."})};var n=r(40481),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(75412));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},70100:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r}=e;return{localChanges:(t,r,n)=>y(e,t,r,n),signalling:async(n,o,a)=>{try{const{remoteTracks:i,localTracks:s}=await v(e,n,a);if(t.dispatch(l.callActions.remoteUnholdFinish(n.id,{remote:!0,remoteParticipant:{displayNumber:o.remoteNumber,displayName:o.remoteName},localTracks:s,remoteTracks:i})),r(u.CALL_STATE_CHANGE,{callId:n.id,previous:{state:n.state,localHold:n.localHold,remoteHold:n.remoteHold}}),r(u.CALL_TRACKS_ADDED,{callId:n.id,trackIds:[...s,...i]}),!1===n.localHold&&!0===n.remoteHold&&n.remoteTracks.length>0){const e=(0,d.getCallById)(t.getState(),n.id),o=n.remoteTracks.filter((t=>!e.remoteTracks.includes(t)));r(u.CALL_TRACKS_REMOVED,{callId:n.id,trackIds:o})}}catch(e){throw t.dispatch(l.callActions.remoteUnholdFinish(n.id,{remote:!0,error:e})),r(u.CALL_STATE_CHANGE,{callId:n.id,previous:{state:n.state,localHold:n.localHold,remoteHold:n.remoteHold},error:e}),e}}}},t.localChanges=y,t.signalling=v,r(97107),r(62234);var n=r(70949),o=r(73520),a=_(r(48151)),i=g(r(11876)),s=g(r(29819)),c=r(77126),l=r(35),u=_(r(51918)),d=r(40481),f=r(59090),p=r(69260);function g(e){return e&&e.__esModule?e:{default:e}}function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(E=function(e){return e?r:t})(e)}function _(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=E(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}async function y(e,t,r,a){const{context:l,WebRTC:u,CallstackWebrtc:f,CallstackSDP:p,logManager:g}=e,E=g.getLogger("CALL",t.id),_=await u.sessionManager.get(t.webrtcSessionId);if(!_)throw E.debug(`webRTC session ${t.webrtcSessionId} not found.`),new Error(`Session for call ${t.id} not found.`);const y=(0,o.getMediaState)(t);if((0,i.default)(r.sdp)&&[c.CALL_MEDIA_STATES.DUAL_HOLD,c.CALL_MEDIA_STATES.LOCAL_HOLD].includes(y)){if(E.debug("Modifying remote offer to prevent resetting media while in local hold."),r.sdp=(0,s.default)(r.sdp),!r.sdp)return void E.debug("SDP is either undefined or not a string.");a.mediaDiff=p.compareMedia(a.remoteDesc.sdp,r.sdp,!0)}const{mediaBrokerOnly:v}=(0,d.getOptions)(l.getState()),S=await(0,n.isSameSdpSessionId)(u,t.webrtcSessionId,r.sdp);let O;S&&t.hasMOH&&!v?(E.debug(`Received offer SDP is both an unhold and stop MoH on the same session. Recreating Peer for call ${t.id}.`),await _.recreatePeer()):E.debug("Not recreating PeerConnection as mediaBrokerOnly is set to true in configuration."),r.sdp.includes("setup:active")&&(E.debug(`Received offer SDP with active role for call ${t.id}. Changing.`),r.sdp=r.sdp.replace(/setup:active/g,"setup:actpass"));try{O=await f.handleOffer(r.sdp,t.webrtcSessionId,t.bandwidth)}catch(e){throw E.debug("Failed to receive offer SDP.",e),e}return{answer:O,sameSession:S,session:_,opInfo:a}}async function v(e,t,r){const{context:n,CallRequests:o,logManager:i}=e,{answer:s,sameSession:c,session:l,opInfo:u}=r,d=i.getLogger("CALL",t.id);try{await o.updateSessionResponse({wrtcsSessionId:t.wrtcsSessionId,answer:s.answerSDP,isAnonymous:t.isAnonymous,account:t.account,customParameters:t.customParameters,customBodies:t.customBodies}),d.info("Finished responding to remote update. Changing state based on the remote operation.");let e=[];e=c?await(0,a.default)(f.OPERATIONS.UNHOLD,u.mediaDiff,l):await(0,a.getAllRemoteTracks)(l);let r=[];return t.localHold||(r=(0,p.getSessionById)(n.getState(),t.webrtcSessionId).localTracks),{remoteTracks:e,localTracks:r}}catch(e){throw d.info("Failed to respond to remote offer with an answer."),e}}},5683:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,WebRTC:r}=e;return async function(e){const n=t.getLogger("CALLSTACK"),a=await r.sessionManager.get(e);if(!a){const t=`WebRTC session ${e} not found.`;throw new o.default({message:t})}try{await a.setTransceiversDirection({audio:"inactive",video:"inactive"})}catch(e){}let i;try{i=await a.rollbackLocalDescription()}catch(e){throw n.debug("Failed to rollback local description offer SDP:",e),e}return{offer:i}}};var n,o=(n=r(75412))&&n.__esModule?n:{default:n}},35680:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,CallstackSDP:s,WebRTC:c}=e;return async function(l,u){const{CallReporter:d}=e,{sessionId:f,bandwidth:p,callId:g,dscpControls:E}=u,_=r.getLogger("CALL",g);_.info("Setting up local WebRTC portions of call.");const y=(0,n.getCallById)(t.getState(),g),v=d.getReport(g),S=y.currentOperations.find((e=>e.isLocal&&e.type===o.OPERATIONS.ANSWER)),O=v.getEvent(S.eventId),h=O.addEvent(a.REPORT_EVENTS.GET_USER_MEDIA);let T,I,C,m,A,b;h.addData("mediaConstraints",l);try{const e=await c.sessionManager.getWithMedia(f,l,E);T=e.session,I=e.medias,h.endEvent()}catch(e){_.debug("Failed to get and add new media to call.");const t=new i.default({message:e.message,code:i.callCodes.USER_MEDIA_ERROR});throw h.endEvent(t),t}try{b=O.addEvent(a.REPORT_EVENTS.CREATE_ANSWER),C=await T.createAnswer(),b.endEvent()}catch(e){const t=new i.default({message:e.message,code:i.callCodes.GENERIC_ERROR});throw b.endEvent(t),t}try{m=(0,n.getOptions)(t.getState()),C.sdp=s.runPipeline(m.sdpHandlers,C.sdp,{callId:g,type:C.type,step:"set",endpoint:"local",bandwidth:p}),A=O.addEvent(a.REPORT_EVENTS.PROCESS_MEDIA_LOCAL),A.addData("operation",a.REPORTER_OPERATION_EVENTS_MAP.ANSWER),C=await T.setLocalDescription(C),A.endEvent()}catch(e){const t=new i.default({message:e.message,code:i.callCodes.GENERIC_ERROR});throw A.endEvent(t),t}const R=s.runPipeline(m.sdpHandlers,C.sdp,{callId:g,type:C.type,step:"send",endpoint:"local",bandwidth:p});return _.info("Finished setting up local WebRTC portions of call."),{error:!1,answerSDP:R,mediaIds:I.map((e=>e.id)),session:T}}};var n=r(40481),o=r(59090),a=r(84581),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},30373:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.answer",(()=>{const t=(0,n.default)(e.container);return{local:{validate:o.default,localOffer:t.localChanges,signalling:t.signalling}}})),e.factory("Callstack.stages.answerSlow",(()=>{const t=(0,a.default)(e.container);return{local:{validate:i.default,localOffer:t.localChanges,signalling:t.signalling,remoteAnswer:(0,s.default)(e.container)}}})),e.factory("Callstack.operations.answer",(()=>{const t=e.container.Callstack,r=t.models.Update;return{local:function(e){return r.instance({type:l.OPERATIONS.ANSWER,isLocal:!0,stages:t.stages.answer.local},{callId:e})}}})),e.factory("Callstack.operations.answerSlow",(()=>{const t=e.container.Callstack,r=t.models.Negotiation;return{local:function(e,n){return r.instance({type:l.OPERATIONS.ANSWER,isLocal:!0,stages:t.stages.answerSlow.local},{callId:e,deferred:n})}}})),e.factory("Callstack.utils.answerWebrtcSession",(()=>(0,c.default)(e.container)))};var n=u(r(51471)),o=u(r(40839)),a=u(r(48444)),i=u(r(87481)),s=u(r(5146)),c=u(r(35680)),l=r(59090);function u(e){return e&&e.__esModule?e:{default:e}}},51471:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{localChanges:(t,r,n)=>async function(e,t,r,n){const{context:o,Callstack:i,logManager:s}=e,{answerWebrtcSession:l}=i.utils,u=s.getLogger("CALL",t);u.info("Answering incoming call.");const d=(0,a.getCallById)(o.getState(),t),f=(0,c.checkBandwidthControls)(n.bandwidth),p={sessionId:d.webrtcSessionId,bandwidth:f,dscpControls:n.dscpControls,callId:d.id};let g;try{g=await l(r,p)}catch(e){throw u.info("Failed to answer incoming call."),e}return{webrtcInfo:g,bandwidth:f}}(e,t,r,n),signalling:(t,r,c,f)=>async function(e,t,r,c,f){const{context:p,Callstack:g,CallRequests:E,CallReporter:_,emitEvent:y,logManager:v}=e,{webrtcInfo:S,bandwidth:O}=f,h=(0,a.getCallById)(p.getState(),t),T=v.getLogger("CALL",h.id),I={id:h.id,answer:S.answerSDP,wrtcsSessionId:h.wrtcsSessionId,customParameters:c.customParameters,customBodies:c.customBodies};try{await E.answerSession(I),T.info(`Finished answering call. Changing to ${s.CALL_STATES.CONNECTED}.`);const e=((0,d.getSessionById)(p.getState(),h.webrtcSessionId)||{}).localTracks,t=await(0,l.getIncomingRemoteTracks)(S.session);p.dispatch(n.callActions.answerCallFinish(h.id,{state:s.CALL_STATES.CONNECTED,startTime:Date.now(),mediaIds:S.mediaIds,webrtcSessionId:S.sessionId,mediaConstraints:r,bandwidth:O,customParameters:c.customParameters,customBodies:c.customBodies,localTracks:e,remoteTracks:t},{isSlowStart:!1})),y(o.CALL_TRACKS_ADDED,{callId:h.id,trackIds:[...e,...t]}),y(o.CALL_STATE_CHANGE,{callId:h.id,previous:{state:h.state,localHold:h.localHold,remoteHold:h.remoteHold}})}catch(e){if(T.info("Failed to answer call."),55===e.code){const e=_.getReport(h.id),t=h.currentOperations.find((e=>e.isLocal&&e.type===i.OPERATIONS.ANSWER)),r=e.getEvent(t.eventId).addEvent(u.REPORT_EVENTS.RESYNC);await g.operations.resyncCallState.stages.signalling(h.id),r.endEvent()}throw e}}(e,t,r,c,f)}};var n=r(35),o=r(51918),a=r(40481),i=r(59090),s=r(77126),c=r(69752),l=r(48151),u=r(84581),d=r(69260)},40839:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,s){const c=(0,n.getCallById)(e,t);if(!c)return new i.default({message:`Failed to answer call. Call ${t} not found.`,code:i.callCodes.INVALID_PARAM});if(![o.CALL_STATES.INITIATED,o.CALL_STATES.RINGING].includes(c.state))return new i.default({message:`Failed to answer call. Call must be in ${o.CALL_STATES.INITIATED} or ${o.CALL_STATES.RINGING} state.`,code:i.callCodes.INVALID_STATE});if(c.direction!==o.CALL_DIRECTION.INCOMING)return new i.default({message:"Failed to answer call. Call must be incoming.",code:i.callCodes.INVALID_STATE});if(c.isSlowStart)return new i.default({message:"Failed to answer call. Call is slow-start.",code:i.callCodes.INVALID_STATE});for(const[e,t]of Object.entries(r))if(t&&"medias"!==e){const t="screen"===e?"video":e;if(!(t in c.mediaOffered)||!c.mediaOffered[t])return new i.default({message:`Failed to answer call by offering '${e}': Incoming call did not offer this media.`,code:i.callCodes.INVALID_PARAM})}try{(0,a.validateMediaConstraints)(r)}catch(e){return e}if(r.medias)try{(0,a.validateDetachedMedia)(r.medias)}catch(e){return e}},r(62234);var n=r(40481),o=r(77126),a=r(9066),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},5146:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,emitEvent:u,CallstackWebrtc:d,CallReporter:f,WebRTC:p}=e;return async function(e,g){const E=r.getLogger("CALL",e.id),_=f.getReport(e.id),y=e.currentOperations.find((e=>e.isLocal&&e.type===a.OPERATIONS.ANSWER)),v=_.getEvent(y.eventId).addEvent(c.REPORT_EVENTS.PROCESS_MEDIA_REMOTE);v.addData("operation",c.REPORTER_OPERATION_EVENTS_MAP.ANSWER),v.addData("isSlowStart",e.isSlowStart);try{const t={sessionId:e.webrtcSessionId,answerSdp:g.sdp};await d.receivedAnswer(t,e)}catch(r){throw t.dispatch(n.callActions.endCallFinish(e.id,{error:r})),v.setError(r),v.endEvent(),r}E.info(`Finished processing remote response to local ${y.type}. Changing state based on operation.`);const S=await p.sessionManager.get(e.webrtcSessionId),O=await(0,s.getAllRemoteTracks)(S),h=(0,l.getSessionById)(t.getState(),e.webrtcSessionId).localTracks;t.dispatch(n.callActions.callAccepted(e.id,{state:i.CALL_STATES.CONNECTED,startTime:Date.now(),remoteParticipant:{displayNumber:g.remoteNumber,displayName:g.remoteName},remoteTracks:O,localTracks:h})),u(o.CALL_TRACKS_ADDED,{callId:e.id,trackIds:[...O,...h]}),u(o.CALL_STATE_CHANGE,{callId:e.id,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold}}),v.endEvent()}};var n=r(35),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),a=r(59090),i=r(77126),s=r(48151),c=r(84581),l=r(69260);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}},48444:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{localChanges:(t,r,n)=>l(e,t,r,n),signalling:(t,r)=>u(e,t,r)}},t.localChanges=l,t.signalling=u;var n=r(35),o=r(40481),a=r(59090),i=r(77126),s=r(69752),c=r(84581);async function l(e,t,r,n){const{context:a,Callstack:i,logManager:c}=e,{setupOutgoingSession:l}=i.utils,u=c.getLogger("CALL",t);u.info("Answering incoming call.");const d=(0,s.checkBandwidthControls)(n.bandwidth);u.debug("Answering call with slow start negotiation.");const f=(0,o.getTurnInfo)(a.getState()),p=(0,o.getOptions)(a.getState());let g;try{g=await l(r,{callId:t,defaultPeerConfig:p.defaultPeerConfig,turnInfo:f,bandwidth:d,dscpControls:n.dscpControls,trickleIceMode:p.trickleIceMode,removeBundling:p.removeBundling,serverTurnCredentials:p.serverTurnCredentials})}catch(e){throw u.info("Failed to answer incoming call."),e}return{webrtcInfo:g,media:r,bandwidth:d,options:n}}async function u(e,t,r){const{context:s,Callstack:l,CallRequests:u,CallReporter:d,logManager:f}=e,{webrtcInfo:p,media:g,bandwidth:E,options:_}=r,y=(0,o.getCallById)(s.getState(),t),v=f.getLogger("CALL",y.id);try{await u.answerSession({id:y.id,answer:p.offerSdp,wrtcsSessionId:y.wrtcsSessionId,customParameters:_.customParameters,customBodies:_.customBodies}),v.info(`Finished answering slow-start call. Changing to ${i.CALL_STATES.RINGING} and waiting for remote slow-start answer.`),s.dispatch(n.callActions.answerCallFinish(y.id,{state:i.CALL_STATES.RINGING,startTime:Date.now(),mediaIds:p.mediaIds,webrtcSessionId:p.sessionId,mediaConstraints:g,bandwidth:E,customParameters:_.customParameters,customBodies:_.customBodies,localTracks:[],remoteTracks:[]},{isSlowStart:y.isSlowStart}))}catch(e){if(v.info("Failed to answer call."),55===e.code){const e=d.getReport(y.id),t=y.currentOperations.find((e=>e.isLocal&&e.type===a.OPERATIONS.ANSWER)),r=e.getEvent(t.eventId).addEvent(c.REPORT_EVENTS.RESYNC);await l.operations.resyncCallState.stages.signalling(y.id),r.endEvent()}throw e}}},87481:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,s){const c=(0,n.getCallById)(e,t);if(!c)return new i.default({message:`Failed to answer call. Call ${t} not found.`,code:i.callCodes.INVALID_PARAM});if(![o.CALL_STATES.INITIATED,o.CALL_STATES.RINGING].includes(c.state))return new i.default({message:`Failed to answer call. Call must be in ${o.CALL_STATES.INITIATED} or ${o.CALL_STATES.RINGING} state.`,code:i.callCodes.INVALID_STATE});if(c.direction!==o.CALL_DIRECTION.INCOMING)return new i.default({message:"Failed to answer call. Call must be incoming.",code:i.callCodes.INVALID_STATE});if(!c.isSlowStart)return new i.default({message:"Failed to answer call. Call is not slow-start.",code:i.callCodes.INVALID_STATE});try{(0,a.validateMediaConstraints)(r)}catch(e){return e}if(r.medias)try{(0,a.validateDetachedMedia)(r.medias)}catch(e){return e}},r(62234);var n=r(40481),o=r(77126),a=r(9066),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},89974:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.callCancelled",(()=>({remote:{remoteOffer:(0,o.default)(e.container)}}))),e.factory("Callstack.operations.callCancelled",(()=>{const t=e.container.Callstack.models.Update;return r=>t.instance({type:a.OPERATIONS.CALL_CANCEL,isLocal:!1,stages:e.container.Callstack.stages.callCancelled.remote},{callId:r})}))};var n,o=(n=r(350))&&n.__esModule?n:{default:n},a=r(59090)},350:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,CallstackWebrtc:s,logManager:c}=e;return async function(e){const l=(0,i.getCallByWrtcsSessionId)(t.getState(),e),u=c.getLogger("CALL",(l||{}).id);u.info("Received call cancelled notice; handling.",{wrtcsSessionId:e}),l?[o.CALL_STATES.ENDED,o.CALL_STATES.CANCELLED].includes(l.state)?u.info(`Call cancelled notice for already ${l.state} call. Ignoring.`,{wrtcsSessionId:e}):(await s.closeCall(l.webrtcSessionId),u.info(`Finished handling call cancelled notice. Changing to ${o.CALL_STATES.CANCELLED}.`),t.dispatch(a.callActions.callCancelled(l.id)),r(n.CALL_STATE_CHANGE,{callId:l.id,previous:{state:l.state,localHold:l.localHold,remoteHold:l.remoteHold}})):u.info("Call cancelled notice for unknown wrtcsSession. Ignoring.",{wrtcsSessionId:e})}},r(62234);var n=r(51918),o=r(77126),a=r(35),i=r(40481)},68336:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.end",(()=>{const t=(0,n.default)(e.container);return{local:{validate:o.default,localOffer:t.localChanges,signalling:t.signalling},remote:{remoteOffer:(0,a.default)(e.container)}}})),e.factory("Callstack.operations.end",(()=>{const t=e.container.Callstack.models.Update;function r(r){return n=>{const o=e.container.Callstack.stages.end[r?"local":"remote"],a=r?void 0:i.createEnded;return t.instance({type:s.OPERATIONS.END,isLocal:r,stages:o,createFlow:a},{callId:n})}}return{local:r(!0),remote:r(!1)}}))};var n=c(r(61869)),o=c(r(67592)),a=c(r(53254)),i=r(46883),s=r(59090);function c(e){return e&&e.__esModule?e:{default:e}}},61869:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{localChanges:t=>s(e,t),signalling:t=>c(e,t)}},t.localChanges=s,t.signalling=c;var n=r(40481),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),a=r(77126);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}async function s(e,t){const{context:r,CallstackWebrtc:o,logManager:a}=e,i=a.getLogger("CALL",t);i.info("Ending call.");const s=(0,n.getCallById)(r.getState(),t);o.closeCall(s.webrtcSessionId).catch((e=>{i.warn(`Could not successfully complete closing webrtc call: ${e}`)}))}async function c(e,t){const{context:r,CallRequests:i,logManager:s,emitEvent:c}=e,l=(0,n.getCallById)(r.getState(),t),u=s.getLogger("CALL",l.id),{wrtcsSessionId:d,isAnonymous:f,account:p}=l;try{await i.endSession({callId:t,wrtcsSessionId:d,isAnonymous:f,account:p})}catch(e){}finally{u.info(`Finished ending call. Changing to ${a.CALL_STATES.ENDED}.`),c(o.CALL_TRACKS_REMOVED,{callId:t,trackIds:[...l.localTracks,...l.remoteTracks]})}}},67592:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!(0,n.getCallById)(e,t))return new o.default({code:o.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."})};var n=r(40481),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(75412));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},53254:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,CallstackWebrtc:l,logManager:u}=e;return async function(e){let{reasonText:d,statusCode:f,remoteName:p,remoteNumber:g}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const E=(0,o.getCallByWrtcsSessionId)(t.getState(),e),_=u.getLogger("CALL",(E||{}).id);if(_.info("Received call status ended notice; handling.",{wrtcsSessionId:e}),!E)return void _.info("Call ended notice for unknown wrtcsSession. Ignoring.",{wrtcsSessionId:e});if(E.state===i.CALL_STATES.ENDED)return void _.info("Call ended notice for already Ended call. Ignoring.",{wrtcsSessionId:e});const y=E;_.debug(`Call ended notice caused by ${d} (Status Code: ${f}).`);try{await l.closeCall(E.webrtcSessionId)}catch(e){_.warn(`Could not succesfully complete closing local webrtc call: ${e.message}`)}_.info(`Finished handling call ended notice. Changing to ${i.CALL_STATES.ENDED}.`),t.dispatch(n.callActions.endCallFinish(E.id,(0,c.generateEndParams)(E.state,!1,{reasonText:d,statusCode:f,remoteName:p,remoteNumber:g}))),r(s.CALL_OPERATION,{callId:E.id,operation:a.OPERATIONS.END,transition:a.OP_TRANSITIONS.FINISH,isLocal:!1,previous:{}}),r(s.CALL_TRACKS_REMOVED,{callId:E.id,trackIds:[...y.localTracks,...y.remoteTracks]}),r(s.CALL_STATE_CHANGE,{callId:E.id,transition:{reasonText:d,statusCode:f},previous:{state:y.state,localHold:y.localHold,remoteHold:y.remoteHold}})}};var n=r(35),o=r(40481),a=r(59090),i=r(77126),s=r(51918),c=r(69752)},59221:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async function(t,r){await a(e,t,r)}},t.signalling=a;var n=r(40481),o=r(77126);async function a(e,t,r){const{CallRequests:a,CallstackWebrtc:i,context:s,logManager:c}=e,l=c.getLogger("CALL",t);l.info("Forwarding incoming call.");const u=(0,n.getCallById)(s.getState(),t),d={wrtcsSessionId:u.wrtcsSessionId,address:r};try{await a.forwardSession(d),await i.closeCall(u.webrtcSessionId),l.info(`Finished forwarding call. Changing to ${o.CALL_STATES.ENDED}.`)}catch(e){throw l.info("Failed to forward call."),e}}},99568:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.forward",(()=>({local:{validate:o.default,localOffer:()=>{},signalling:(0,n.default)(e.container)}}))),e.factory("Callstack.operations.forward",(()=>{const t=e.container.Callstack.models.Update;return{local:function(r){return t.instance({type:a.OPERATIONS.FORWARD_CALL,isLocal:!0,stages:e.container.Callstack.stages.forward.local},{callId:r})}}}))};var n=i(r(59221)),o=i(r(47336)),a=r(59090);function i(e){return e&&e.__esModule?e:{default:e}}},47336:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const i=(0,n.getCallById)(e,t);return i?[o.CALL_STATES.INITIATED,o.CALL_STATES.RINGING].includes(i.state)?i.direction!==o.CALL_DIRECTION.INCOMING?new a.default({message:"Failed to forward call. Call must be incoming.",code:a.callCodes.INVALID_STATE}):void 0:new a.default({message:`Failed to forward call. Call must be in ${o.CALL_STATES.INITIATED} or ${o.CALL_STATES.RINGING} state.`,code:a.callCodes.INVALID_STATE}):new a.default({message:`Failed to forward call. Call ${t} not found.`,code:a.callCodes.INVALID_PARAM})},r(62234);var n=r(40481),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},18129:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,WebRTC:n}=e;return async function(e,c){const l=r.getLogger("CALL",e);l.info("Getting call statistics.");const u=(0,o.getCallById)(t.getState(),e),d=new Map,f=await n.sessionManager.get(u.webrtcSessionId),p=await f.getStats(c);l.info("Finished getting call statistics.");const g="ribbon-sdk-info_"+s.default,E=(0,i.getVersion)(),_="@rbbn/"+(u.isAnonymous?"webrtc-anonymous-js-sdk":"webrtc-js-sdk"),y=(0,a.getBrowserDetails)(),v={id:g,type:"ribbon_sdk_info",sdk:_,version:E,callId:e};y&&(v.platform=y.browser+"/"+y.version);const S=p.keys(),O=p.get(S.next().value);return O&&(v.timestamp=O.timestamp),d.set(g,v),p.forEach((e=>{d.set(e.id,e)})),d}};var n,o=r(40481),a=r(37654),i=r(13126),s=(n=r(20855))&&n.__esModule?n:{default:n}},97236:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.getStats",(()=>({local:{validate:o.default,localOffer:(0,n.default)(e.container)}}))),e.factory("Callstack.operations.getStats",(()=>{const t=e.container.Callstack.models.Update;return{local:function(r){return t.instance({type:a.OPERATIONS.GET_STATS,isLocal:!0,stages:e.container.Callstack.stages.getStats.local},{callId:r})}}}))};var n=i(r(18129)),o=i(r(85524)),a=r(59090);function i(e){return e&&e.__esModule?e:{default:e}}},85524:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const i=(0,n.getCallById)(e,t);return i?i.state===o.CALL_STATES.ENDED?new a.default({code:a.callCodes.INVALID_STATE,message:"Failed to get call stats; call must not be ended."}):r&&!i.localTracks.includes(r)?new a.default({code:a.callCodes.INVALID_PARAM,message:"Provided trackId is not a local track on the call."}):void 0:new a.default({code:a.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."})},r(62234);var n=r(40481),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},74019:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,CallstackWebrtc:r,logManager:a}=e;return async function(e){const i=a.getLogger("CALL",e);i.info("Ignoring incoming call.");const s=(0,o.getCallById)(t.getState(),e);r.closeCall(s.webrtcSessionId),i.info(`Finished ignoring call. Changing to ${n.CALL_STATES.ENDED}.`)}};var n=r(77126),o=r(40481)},67801:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.ignore",(()=>({local:{validate:o.default,localOffer:(0,n.default)(e.container)}}))),e.factory("Callstack.operations.ignore",(()=>{const t=e.container.Callstack.models.Update;return{local:function(r){return t.instance({type:a.OPERATIONS.IGNORE,isLocal:!0,stages:e.container.Callstack.stages.ignore.local},{callId:r})}}}))};var n=i(r(74019)),o=i(r(19283)),a=r(59090);function i(e){return e&&e.__esModule?e:{default:e}}},19283:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=(0,o.getCallById)(e,t);return r?[n.CALL_STATES.INITIATED,n.CALL_STATES.RINGING].includes(r.state)?r.direction!==n.CALL_DIRECTION.INCOMING?new a.default({message:"Failed to ignore call. Call must be incoming.",code:a.callCodes.INVALID_STATE}):void 0:new a.default({message:`Failed to ignore call. Call must be in ${n.CALL_STATES.INITIATED} or ${n.CALL_STATES.RINGING} state.`,code:a.callCodes.INVALID_STATE}):new a.default({message:`Failed to ignore call. Call ${t} not found.`,code:a.callCodes.INVALID_PARAM})},r(62234);var n=r(77126),o=r(40481),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},75071:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.playAudioFile",(()=>({local:{validate:o.default,localOffer:(0,n.default)(e.container)}}))),e.factory("Callstack.operations.playAudioFile",(()=>{const t=e.container.Callstack.models.Update;return{local:function(r){return t.instance({type:a.OPERATIONS.PLAY_AUDIO,isLocal:!0,stages:e.container.Callstack.stages.playAudioFile.local},{callId:r})}}}))};var n=i(r(98415)),o=i(r(85917)),a=r(59090);function i(e){return e&&e.__esModule?e:{default:e}}},98415:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async function(t,r,n){await d(e,t,r,n)}},t.localChanges=d;var n=r(35),o=r(40481),a=u(r(51918)),i=r(59090),s=u(r(75412)),c=r(81997);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}async function d(e,t,r,l){const{context:u,WebRTC:d,emitEvent:f,Notifications:p,logManager:g}=e,E=g.getLogger("CALL",t);E.info("Replacing call audio with file media.");const _=(0,o.getCallById)(u.getState(),t),y=await d.sessionManager.get(_.webrtcSessionId);if(!y)throw new s.default({code:s.callCodes.INVALID_STATE,message:"Call's WebRTC session not found."});let v;try{v=await y.insertAudio(r),E.info("Audio file has started to play.");const e=_.currentOperations.find((e=>e.isLocal&&e.type===i.OPERATIONS.PLAY_AUDIO));u.dispatch(n.callActions.operationUpdate(t,i.OP_TRANSITIONS.PLAY_AUDIO,!0,{transition:i.OP_TRANSITIONS.UPDATE,eventId:e.eventId})),f(a.CALL_OPERATION,{callId:t,isLocal:!0,operation:i.OPERATIONS.PLAY_AUDIO,transition:i.OP_TRANSITIONS.UPDATE,previous:{operations:i.OPERATIONS.PLAY_AUDIO,status:i.OP_STATUS.ONGOING}})}catch(e){let t;switch(E.info("Failed to start playing audio file."),e.message){case"Failed to play audio file.":t=s.callCodes.INVALID_PARAM;break;case"No valid local audio track found to insert audio file on.":t=s.callCodes.NOT_SUPPORTED;break;default:t=s.callCodes.UNKNOWN_ERROR}throw new s.default({code:t,message:e.message})}l({duration:v});const S=1e3*v+3e3;let O;try{O=await p.takeAction((e=>e.type===c.SESSION_AUDIO_ENDED&&e.payload.id===y.id),S)}catch(e){throw E.info("No response from audio file after expected duration; timing-out."),new s.default({code:s.callCodes.STATE_DESYNC,message:"Play audio file operation timed-out."})}if(O.error)throw E.info("Audio file encountered an error while playing."),new s.default({code:s.callCodes.UNKNOWN_ERROR,message:"Encountered error while playing audio file."});E.info("Audio file has finished playing.")}},85917:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){const s=(0,n.getCallById)(e,t);return s?s.state!==o.CALL_STATES.CONNECTED?new a.default({code:a.callCodes.INVALID_STATE,message:`Invalid call state: ${s.state}. It should be: ${o.CALL_STATES.CONNECTED}.`}):void 0:new a.default({code:a.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."})};var n=r(40481),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},29072:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.reject",(()=>({local:{validate:o.default,localOffer:()=>{},signalling:(0,n.default)(e.container)}}))),e.factory("Callstack.operations.reject",(()=>{const t=e.container.Callstack.models.Update;return{local:function(r){return t.instance({type:a.OPERATIONS.REJECT,isLocal:!0,stages:e.container.Callstack.stages.reject.local},{callId:r})}}}))};var n=i(r(97769)),o=i(r(54728)),a=r(59090);function i(e){return e&&e.__esModule?e:{default:e}}},97769:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async function(t){await a(e,t)}},t.signalling=a;var n=r(40481),o=r(77126);async function a(e,t){const{context:r,CallRequests:a,CallstackWebrtc:i,logManager:s}=e,c=s.getLogger("CALL",t);c.info("Rejecting incoming call.");const l=(0,n.getCallById)(r.getState(),t),u={id:t,wrtcsSessionId:l.wrtcsSessionId};try{await a.rejectSession(u)}catch(e){throw c.info("Failed to reject call."),e}await i.closeCall(l.webrtcSessionId),c.info(`Finished rejecting call. Changing to ${o.CALL_STATES.ENDED}.`)}},54728:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=(0,n.getCallById)(e,t);return r?[o.CALL_STATES.INITIATED,o.CALL_STATES.RINGING].includes(r.state)?r.direction!==o.CALL_DIRECTION.INCOMING?new a.default({message:"Failed to reject call. Call must be incoming.",code:a.callCodes.INVALID_STATE}):void 0:new a.default({message:`Failed to reject call. Call must be in ${o.CALL_STATES.INITIATED} or ${o.CALL_STATES.RINGING} state.`,code:a.callCodes.INVALID_STATE}):new a.default({message:`Failed to reject call. Call ${t} not found.`,code:a.callCodes.INVALID_PARAM})},r(62234);var n=r(40481),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},18284:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.replaceTrack",(()=>({local:{validate:o.default,localOffer:(0,n.default)(e.container)}}))),e.factory("Callstack.operations.replaceTrack",(()=>{const t=e.container.Callstack.models.Update;return{local:function(r){return t.instance({type:i.OPERATIONS.REPLACE_TRACK,isLocal:!0,stages:e.container.Callstack.stages.replaceTrack.local},{callId:r})}}})),e.factory("Callstack.utils.webRtcReplaceTrack",(()=>(0,a.default)(e.container)))};var n=s(r(34545)),o=s(r(92140)),a=s(r(7276)),i=r(59090);function s(e){return e&&e.__esModule?e:{default:e}}},34545:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async function(t,r,n){return o(e,t,r,n)}},t.localChanges=o;var n=r(40481);async function o(e,t,r,o){const{context:a,Callstack:i,logManager:s}=e,c=s.getLogger("CALL",t);c.info("Replacing track on call.");const l=(0,n.getCallById)(a.getState(),t);let u;try{u=await i.utils.webRtcReplaceTrack({sessionId:l.webrtcSessionId,trackId:r,mediaConstraints:o})}catch(e){throw c.info("Failed to replace track on call."),e}const{newTrackId:d,oldTrackState:f}=u;return{newTrackId:d,oldTrackState:f}}},92140:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,s){const c=(0,n.getCallById)(e,t);if(!c)return new i.default({code:i.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."});if([o.CALL_STATES.CANCELLED,o.CALL_STATES.ENDED,o.CALL_STATES.INITIATING].includes(c.state))return new i.default({code:i.callCodes.INVALID_STATE,message:`Call is in an invalid state: ${c.state}.`});try{(0,a.validateMediaConstraints)(s)}catch(e){return e}if(s&&s.medias){if(s.medias.length>1)return new i.default({code:i.callCodes.INVALID_PARAM,message:"Only one detached media can be passed to replace an existing track."});try{(0,a.validateDetachedMedia)(s.medias)}catch(e){return e}}},r(62234);var n=r(40481),o=r(77126),a=r(9066),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},7276:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,WebRTC:a}=e;return async function(i){const{CallstackWebrtc:s}=e,{sessionId:c,trackId:l,mediaConstraints:u}=i,d=r.getLogger("CALLSTACK");let f,p,g=0;if(Object.entries(u).forEach((e=>{let[t,r]=e;r&&(g++,f="medias"===t?u.medias[0].type:t)})),1!==g)throw new o.default({code:o.callCodes.INVALID_PARAM,message:`Require exactly one new track type to be specified. Found ${g} track types.`});try{p=await a.sessionManager.get(c)}catch(e){throw d.debug(e.message),e}const E=p.allLocalTracks.find((e=>e.id===l));if(!E)throw new o.default({code:o.callCodes.INVALID_PARAM,message:`Old track ${l} not found.`});const _=await E.getState(),y=_.kind;if(!("audio"===y&&"audio"===f||"video"===y&&["video","screen"].includes(f)))throw new o.default({code:o.callCodes.INVALID_PARAM,message:`Media constraints incompatible for old track kind: ${y}.`});let v=[];if(u.medias)for(const e of u.medias)v.push({type:e.type,media:await a.media.get(e.media.id)});else try{const e=(0,n.getCallByWebrtcSessionId)(t.getState(),c);v=await s.createLocal(u,e.id)}catch(e){throw d.debug("Failed to create local media."),e}let S,O=[];for(const e of v){const t=await e.media.getTracks();O=[...O,...t]}for(const e of O)if((await e.getState()).kind===y){S=e;break}if(!S)throw new o.default({code:o.callCodes.USER_MEDIA_ERROR,message:`${y} track not found`});const h=await p.replaceTrack(S,{trackId:l});if(h)throw d.debug("Failed to replace track."),await S.stop(),new o.default({code:o.callCodes.GENERIC_ERROR,message:h.message});return await E.stop(),{newTrackId:S.id,oldTrackState:_}}},r(62234),r(69375);var n=r(40481),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(75412));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},85514:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.resyncCallState",(()=>({local:{validate:o.default,localOffer:()=>{},signalling:(0,n.default)(e.container)}}))),e.factory("Callstack.operations.resyncCallState",(()=>{const t=e.container.Callstack.models.Update;return{local:function(r){return t.instance({type:a.OPERATIONS.RESYNC,isLocal:!0,stages:e.container.Callstack.stages.resyncCallState.local},{callId:r})},stages:{signalling:(0,n.default)(e.container)}}}))};var n=i(r(96049)),o=i(r(11102)),a=r(59090);function i(e){return e&&e.__esModule?e:{default:e}}},96049:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async function(t,r){await c(e,t,r)}},t.signalling=c;var n=r(35),o=r(40481),a=r(77126),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}async function c(e,t,r){const{context:s,CallRequests:c,CallstackWebrtc:l,logManager:u,emitEvent:d}=e,f=u.getLogger("CALL",t),p=(0,o.getCallById)(s.getState(),t);try{if("ANSWERED"===(r||await c.getSession({wrtcsSessionId:p.wrtcsSessionId,id:t})).state&&p.state!==a.CALL_STATES.CONNECTED&&p.state!==a.CALL_STATES.ON_HOLD){f.info("Call re-sync found that call was answered elsewhere. Cancelling call."),await l.closeCall(p.webrtcSessionId);const e=(0,o.getCallById)(s.getState(),t);e.state!==a.CALL_STATES.ENDED&&e.state!==a.CALL_STATES.CANCELLED&&(s.dispatch(n.callActions.callCancelled(p.id)),d(i.CALL_STATE_CHANGE,{callId:t,previous:{state:e.state,localHold:e.localHold,remoteHold:e.remoteHold}}))}else f.info("Call re-sync found that there are no changes necessary for the call"),s.dispatch(n.callActions.resyncFinish(p.id))}catch(e){if(47===e.code){f.info("Call re-sync found that the call has ended. Ending Call."),await l.closeCall(p.webrtcSessionId);const r=(0,o.getCallById)(s.getState(),t);r.state!==a.CALL_STATES.ENDED&&r.state!==a.CALL_STATES.CANCELLED&&(s.dispatch(n.callActions.endCallFinish(p.id,{isLocal:!0})),d(i.CALL_TRACKS_REMOVED,{callId:t,trackIds:[...p.localTracks,...p.remoteTracks]}),d(i.CALL_STATE_CHANGE,{callId:t,previous:{state:p.state,localHold:p.localHold,remoteHold:p.remoteHold},error:e}))}else f.info(`Call re-sync failure (${e.code}).`,e)}}},11102:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!(0,n.getCallById)(e,t))return new o.default({code:o.callCodes.INVALID_PARAM,message:"Call not found; invalid call ID."})};var n=r(40481),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(75412));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},21506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.sendCustomParameters",(()=>({local:{validate:o.default,localOffer:()=>{},signalling:(0,n.default)(e.container)}}))),e.factory("Callstack.operations.sendCustomParameters",(()=>{const t=e.container.Callstack.models.Update;return{local:function(r){return t.instance({type:a.OPERATIONS.SEND_CUSTOM_PARAMETERS,isLocal:!0,stages:e.container.Callstack.stages.sendCustomParameters.local},{callId:r})}}}))};var n=i(r(63361)),o=i(r(82966)),a=r(59090);function i(e){return e&&e.__esModule?e:{default:e}}},63361:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async function(t){await o(e,t)}},t.signalling=o;var n=r(40481);async function o(e,t){const{context:r,CallRequests:o,logManager:a}=e,i=a.getLogger("CALL",t);i.info("Sending custom parameters for call.");const s=(0,n.getCallById)(r.getState(),t),{wrtcsSessionId:c,isAnonymous:l,account:u,customParameters:d}=s,f={wrtcsSessionId:c,isAnonymous:l,account:u,customParameters:d,id:t};try{await o.updateCustomParameters(f),i.info("Finished sending custom parameters.")}catch(e){throw i.info("Failed to send custom parameters."),e}}},82966:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=(0,n.getCallById)(e,t);if(!r)return new a.default({code:a.callCodes.INVALID_PARAM,message:`Invalid Call ID. No call found with Call ID: ${t}`});if(r.state!==o.CALL_STATES.CONNECTED&&r.state!==o.CALL_STATES.ON_HOLD)return new a.default({code:a.callCodes.INVALID_STATE,message:`Call in invalid state for sending custom parameters. Call state: ${r.state}`});{const{customParameters:e}=r;if(!e)return new a.default({code:a.callCodes.INVALID_STATE,message:`No custom parameters set on call: ${t}.`})}};var n=r(40481),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},25654:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.stages.sendDtmf",(()=>({local:{validate:o.default,localOffer:(0,n.default)(e.container)}}))),e.factory("Callstack.operations.sendDtmf",(()=>{const t=e.container.Callstack.models.Update;return{local:function(r){return t.instance({type:a.OPERATIONS.SEND_DTMF,isLocal:!0,stages:e.container.Callstack.stages.sendDtmf.local},{callId:r})}}}))};var n=i(r(51025)),o=i(r(72802)),a=r(59090);function i(e){return e&&e.__esModule?e:{default:e}}},8882:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.playInBand=async function(e,t){let{tone:r,duration:o,intertoneGap:a}=t;o=Number(o)>0?Number(o):100,a=Number(a)>-1?Number(a):70;const i=e.localTracks.find((e=>"audio"===e.getState().kind)),s=i.getStream(),c=new AudioContext,l=c.createMediaStreamSource(s),u=c.createMediaStreamDestination();l.connect(u);const d=u.stream.getAudioTracks()[0];return await e.peer.replaceTrack(d,{trackId:i.id}),await(0,n.addTones)(c,u,r,{duration:o,gap:a}),await e.peer.replaceTrack(i.track,{trackId:d.id}),c.close(),!0},t.playOutBand=async function(e,t){return await e.sendDTMF(t)};var n=r(44991)},51025:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async function(t,r){let{duration:n,intertoneGap:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};await l(e,t,r,{duration:n,intertoneGap:o})}},t.localChanges=l;var n,o=r(8882),a=(n=r(58532))&&n.__esModule?n:{default:n},i=r(40481),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}async function l(e,t,r,n){let{duration:c,intertoneGap:l}=n;const{context:u,logManager:d,WebRTC:f}=e,p=d.getLogger("CALL",t),g=(0,i.getCallById)(u.getState(),t),E=await f.sessionManager.get(g.webrtcSessionId),_=await E.getRemoteDescription(),y=(0,a.default)(_.sdp);try{y?(p.debug(`Sending DTMF tones out-of-band for call ${g.id}.`),await(0,o.playOutBand)(E,{tone:r,duration:c,intertoneGap:l})):(p.debug(`Sending DTMF tones in-band for call ${g.id}.`),await(0,o.playInBand)(E,{tone:r,duration:c,intertoneGap:l})),p.info(`Successfully sent DTMF tones for call ${g.id}.`)}catch(e){throw p.debug(`Failed to send DTMF tones for call ${g.id}.`),new s.default({code:s.callCodes.GENERIC_ERROR,message:`Unable to send DTMF tones for call ${g.id}.`})}}},44991:(e,t,r)=>{"use strict";function n(e){if("string"!=typeof e||e.length>1||!/[\d*#]+/.test(e))throw new Error("Invalid input for DTMF tone.");switch(e){case"1":return["697","1209"];case"2":return["697","1336"];case"3":return["697","1477"];case"4":return["770","1209"];case"5":return["770","1336"];case"6":return["770","1477"];case"7":return["852","1209"];case"8":return["852","1336"];case"9":return["852","1477"];case"0":return["941","1336"];case"*":return["941","1209"];case"#":return["941","1477"]}}function o(e){const t=e.match(/[\d*#]+/);if(!t||t[0]!==e)throw new Error("Invalid characters in tone.");return e.split("")}Object.defineProperty(t,"__esModule",{value:!0}),t.addTones=async function(e,t,r,a){const i=[e.createOscillator(),e.createOscillator()];i[0].type="sine",i[1].type="sine";const s=e.createGain();function c(e,t,r){i[0].frequency.setValueAtTime(e[0],t),i[0].frequency.setValueAtTime(0,t+r),i[1].frequency.setValueAtTime(e[1],t),i[1].frequency.setValueAtTime(0,t+r)}i[0].connect(s),i[1].connect(s),s.gain.value=.1,s.connect(t),s.connect(e.destination);const l=o(r).map(n),u=a.duration/1e3,d=a.gap/1e3;let f=e.currentTime;for(let e=0;e<l.length;e++)c(l[e],f,u),f=f+u+d;i[0].start(),i[1].start();const p=l.length*(a.duration+a.gap);await new Promise((e=>{setTimeout(e,p)})),s.disconnect(),i[0].stop(),i[0].disconnect(),i[1].stop(),i[1].disconnect()},t.convertTone=n,t.splitTones=o,r(97107)},72802:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let{duration:i,intertoneGap:s}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const c=(0,n.getCallById)(e,t);return c?[o.CALL_STATES.CONNECTED,o.CALL_STATES.RINGING,o.CALL_STATES.EARLY_MEDIA].includes(c.state)?r&&/^[\d*#]+/.test(r)?void 0:new a.default({code:a.callCodes.INVALID_PARAM,message:"No DTMF tone specified."}):new a.default({code:a.callCodes.INVALID_STATE,message:`Call is in an invalid state (${c.state}).`}):new a.default({code:a.callCodes.INVALID_PARAM,message:"Call state not found; invalid call ID."})},r(62234);var n=r(40481),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},14990:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.operations.sendRingingFeedback",(()=>{const t=e.container.Callstack.models.Update;return{local:function(r){return t.instance({type:a.OPERATIONS.SEND_RINGING_FEEDBACK,isLocal:!0,stages:{validate:o.default,localOffer:()=>{},signalling:(0,n.default)(e.container)}},{callId:r})}}}))};var n=i(r(26021)),o=i(r(82430)),a=r(59090);function i(e){return e&&e.__esModule?e:{default:e}}},26021:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async function(t){await a(e,t)}},t.signalling=a;var n=r(40481),o=r(77126);async function a(e,t){const{context:r,CallRequests:a,logManager:i}=e,s=i.getLogger("CALL",t);s.info("Sending ringing feedback for incoming call.");const c=(0,n.getCallById)(r.getState(),t),l={wrtcsSessionId:c.wrtcsSessionId,id:c.id};try{await a.updateCallRinging(l)}catch(e){throw s.info(`Failed to send ringing feedback: ${e.code}: ${e.message}`),e}s.info(`Ringing feedback sent. Changing call to ${o.CALL_STATES.RINGING} state.`)}},82430:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=(0,n.getCallById)(e,t),i=(0,n.getOptions)(e);return r?"manual"!==i.ringingFeedbackMode?new a.default({message:"Failed to send ringing feedback. Configuration must be set to 'manual' mode.",code:a.callCodes.NOT_SUPPORTED}):r.state!==o.CALL_STATES.INITIATED?new a.default({message:`Failed to send ringing feedback. Call must be in ${o.CALL_STATES.INITIATED} state.`,code:a.callCodes.INVALID_STATE}):r.direction!==o.CALL_DIRECTION.INCOMING?new a.default({message:"Failed to send ringing feedback. Call must be incoming.",code:a.callCodes.INVALID_STATE}):void 0:new a.default({message:`Failed to send ringing feedback. Call ${t} not found.`,code:a.callCodes.INVALID_PARAM})};var n=r(40481),o=r(77126),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},15838:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,logManager:s}=e;return function(e){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=(0,a.getCallByWrtcsSessionId)(t.getState(),e),u=s.getLogger("CALL",(l||{}).id);if(u.info("Received call status ringing notice; handling.",{wrtcsSessionId:e}),l)if(l.state===i.CALL_STATES.INITIATED){if(c.customParameters){const e=c.customParameters.map((e=>e.name));u.debug(`Received custom parameters as part of the Call: ${e}.`),t.dispatch(n.callActions.customParametersReceived(l.id,{customParameters:c.customParameters})),r(o.CUSTOM_PARAMETERS,{callId:l.id,customParameters:c.customParameters})}u.info(`Finished handling call ringing notice. Changing to ${i.CALL_STATES.RINGING}.`),t.dispatch(n.callActions.callRinging(l.id,{remoteParticipant:{displayNumber:c.remoteNumber,displayName:c.remoteName}})),r(o.CALL_STATE_CHANGE,{callId:l.id,previous:{state:l.state,localHold:l.localHold,remoteHold:l.remoteHold}})}else u.info(`Call ringing notice for Call in an invalid state: ${l.state}. Ignoring.`);else u.info("Call ringing notice for unknown wrtcsSession. Ignoring.",{wrtcsSessionId:e})}};var n=r(35),o=r(51918),a=r(40481),i=r(77126)},84581:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REPORT_METRICS=t.REPORT_EVENTS=t.REPORTER_REQUESTS=t.REPORTER_OPERATION_EVENTS_MAP=t.ICE_COLLECTION_OPERATIONS=void 0;var n=r(59090);const o=t.REPORT_EVENTS={MAKE:"MAKE",SEND_RINGING_FEEDBACK:"SEND_RINGING_FEEDBACK",ANSWER:"ANSWER",GET_USER_MEDIA:"GET_USER_MEDIA",PROCESS_MEDIA_LOCAL:"PROCESS_MEDIA_LOCAL",PROCESS_MEDIA_REMOTE:"PROCESS_MEDIA_REMOTE",ICE_COLLECTION:"ICE_COLLECTION",RELAY_CANDIDATE_COLLECTED:"RELAY_CANDIDATE_COLLECTED",IGNORE:"IGNORE",REJECT:"REJECT",FORWARD_CALL:"FORWARD_CALL",END_LOCAL:"END_LOCAL",END_REMOTE:"END_REMOTE",ADD_BASIC_MEDIA:"ADD_BASIC_MEDIA_LOCAL",ADD_MEDIA:"ADD_MEDIA_LOCAL",ADD_MEDIA_REMOTE:"ADD_MEDIA_REMOTE",ADD_TRACKS:"ADD_TRACKS",REMOVE_BASIC_MEDIA:"REMOVE_BASIC_MEDIA_LOCAL",REMOVE_MEDIA:"REMOVE_MEDIA_LOCAL",REMOVE_MEDIA_REMOTE:"REMOVE_MEDIA_REMOTE",MEDIA_RESTART:"MEDIA_RESTART",REPLACE_TRACK:"REPLACE_TRACK",HOLD_LOCAL:"HOLD_LOCAL",HOLD_REMOTE:"HOLD_REMOTE",UNHOLD_LOCAL:"UNHOLD_LOCAL",UNHOLD_REMOTE:"UNHOLD_REMOTE",PLAY_AUDIO:"PLAY_AUDIO",START_MOH:"START_MOH",STOP_MOH:"START_MOH",SEND_CUSTOM_PARAMETERS:"SEND_CUSTOM_PARAMETERS",GET_STATS:"GET_STATS",SEND_DTMF:"SEND_DTMF",RESYNC:"RESYNC",DIRECT_TRANSFER:"DIRECT_TRANSFER",CONSULTATIVE_TRANSFER:"CONSULTATIVE_TRANSFER",JOIN:"JOIN",GET_AVAILABLE_CODECS:"GET_AVAILABLE_CODECS",SLOW_START:"SLOW_START",RECEIVE_CALL:"RECEIVE_CALL",REMOTE_RINGING:"REMOTE_RINGING",REST_REQUEST:"REST_REQUEST",AUDIT_CALL:"AUDIT_CALL",CREATE_OFFER:"CREATE_OFFER",CREATE_ANSWER:"CREATE_ANSWER"};t.REPORTER_REQUESTS={CREATE_SESSION:"CREATE_SESSION",ANSWER_SESSION:"ANSWER_SESSION",REJECT_SESSION:"REJECT_SESSION",FORWARD_SESSION:"FORWARD_SESSION",UPDATE_SESSION:"UPDATE_SESSION",GET_SESSION:"GET_SESSION",CALL_RINGING_UPDATE_SESSION:"CALL_RINGING_UPDATE_SESSION",UPDATE_CUSTOM_PARAMETERS_ON_SESSION:"UPDATE_CUSTOM_PARAMETERS_ON_SESSION",END_SESSION:"END_SESSION"},t.REPORT_METRICS={CALL_DURATION:"CALL_DURATION",MAKE_CALL_PRE_LOCAL_SETUP:"MAKE_CALL_PRE_LOCAL_SETUP",MAKE_CALL_LOCAL_SETUP:"MAKE_CALL_LOCAL_SETUP",MAKE_CALL_REMOTE_SETUP:"MAKE_CALL_REMOTE_SETUP",TIME_TO_MAKE:"TIME_TO_MAKE",ANSWER_CALL_PRE_LOCAL_SETUP:"ANSWER_CALL_PRE_LOCAL_SETUP",ANSWER_CALL_LOCAL_SETUP:"ANSWER_CALL_LOCAL_SETUP",TIME_TO_ANSWER:"TIME_TO_ANSWER",TIME_FROM_RECEIVE_TO_ANSWER:"TIME_FROM_RECEIVE_TO_ANSWER",TIME_TO_CALL_SETUP_DURATION:"TIME_TO_CALL_SETUP_DURATION",TIME_TO_RINGING:"TIME_TO_RINGING",TIME_TO_IGNORE:"TIME_TO_IGNORE",TIME_TO_REJECT:"TIME_TO_REJECT",TIME_TO_ADD_MEDIA:"TIME_TO_ADD_MEDIA",TIME_TO_ADD_MEDIA_REMOTE:"TIME_TO_ADD_MEDIA_REMOTE",TIME_TO_REMOVE_MEDIA:"TIME_TO_REMOVE_MEDIA",TIME_TO_REMOVE_MEDIA_REMOTE:"TIME_TO_REMOVE_MEDIA_REMOTE",TIME_TO_RESTART_MEDIA:"TIME_TO_RESTART_MEDIA",TIME_TO_HOLD_LOCAL:"TIME_TO_HOLD_LOCAL",TIME_TO_HOLD_REMOTE:"TIME_TO_HOLD_REMOTE",TIME_TO_UNHOLD_LOCAL:"TIME_TO_UNHOLD_LOCAL",TIME_TO_UNHOLD_REMOTE:"TIME_TO_UNHOLD_REMOTE",TIME_TO_COLLECT_ICE_CANDIDATES:"TIME_TO_COLLECT_ICE_CANDIDATES",TIME_TO_RELAY_CANDIDATES:"TIME_TO_RELAY_CANDIDATES",TIME_TO_SEND_CUSTOM_PARAMETERS:"TIME_TO_SEND_CUSTOM_PARAMETERS",TIME_TO_FORWARD:"TIME_TO_FORWARD",TIME_TO_DIRECT_TRANSFER:"TIME_TO_DIRECT_TRANSFER",TIME_TO_CONSULTATIVE_TRANSFER:"TIME_TO_CONSULTATIVE_TRANSFER",TIME_TO_JOIN:"TIME_TO_JOIN"},t.REPORTER_OPERATION_EVENTS_MAP={MAKE:"MAKE",MAKE_REMOTE:o.RECEIVE_CALL,MAKE_ANONYMOUS:"MAKE",ANSWER:"ANSWER",REJECT:"REJECT",IGNORE:"IGNORE",SEND_RINGING_FEEDBACK:"SEND_RINGING_FEEDBACK",FORWARD_CALL:"FORWARD_CALL",HOLD:"HOLD_LOCAL",UNHOLD:"UNHOLD_LOCAL",HOLD_REMOTE:"HOLD_REMOTE",UNHOLD_REMOTE:"UNHOLD_REMOTE",SEND_CUSTOM_PARAMETERS:"SEND_CUSTOM_PARAMETERS",ADD_MEDIA:"ADD_MEDIA_LOCAL",ADD_MEDIA_REMOTE:"ADD_MEDIA_REMOTE",ADD_BASIC_MEDIA:"ADD_BASIC_MEDIA_LOCAL",ADD_BASIC_MEDIA_REMOTE:"ADD_BASIC_MEDIA_REMOTE",REMOVE_MEDIA:"REMOVE_MEDIA_LOCAL",REMOVE_MEDIA_REMOTE:"REMOVE_MEDIA_REMOTE",REMOVE_BASIC_MEDIA:"REMOVE_BASIC_MEDIA_LOCAL",REMOVE_BASIC_MEDIA_REMOTE:"REMOVE_BASIC_MEDIA_REMOTE",GET_STATS:"GET_STATS",SEND_DTMF:"SEND_DTMF",CONSULTATIVE_TRANSFER:"CONSULTATIVE_TRANSFER",DIRECT_TRANSFER:"DIRECT_TRANSFER",JOIN:"JOIN",REPLACE_TRACK:"REPLACE_TRACK",MEDIA_RESTART:"MEDIA_RESTART",RESYNC:"RESYNC",PLAY_AUDIO:"PLAY_AUDIO",GET_AVAILABLE_CODECS:"GET_AVAILABLE_CODECS",END:"END_LOCAL",END_REMOTE:"END_REMOTE",START_MOH_REMOTE:"START_MOH",STOP_MOH_REMOTE:"STOP_MOH",SLOW_START_REMOTE:"SLOW_START",UNKNOWN_REMOTE:"UNKNOWN",GENERIC_REMOTE:"UNKNOWN",NO_CHANGE_REMOTE:"UNKNOWN",callStatusUpdateEnded:o.END_REMOTE,receiveEarlyMedia:"EARLY_MEDIA",callStatusUpdateRinging:o.REMOTE_RINGING,[n.OPERATIONS.CALL_CANCEL]:n.OPERATIONS.CALL_CANCEL},t.ICE_COLLECTION_OPERATIONS={MAKE:"MAKE",ANSWER:"ANSWER",JOIN:"JOIN",HOLD:"HOLD_LOCAL",UNHOLD:"UNHOLD_LOCAL",UNHOLD_REMOTE:"UNHOLD_REMOTE",ADD_MEDIA:"ADD_MEDIA_LOCAL",ADD_BASIC_MEDIA:"ADD_BASIC_MEDIA_LOCAL",ADD_MEDIA_REMOTE:"ADD_MEDIA_REMOTE",REMOVE_MEDIA:"REMOVE_MEDIA_LOCAL",REMOVE_BASIC_MEDIA:"REMOVE_BASIC_MEDIA_LOCAL",MEDIA_RESTART:"MEDIA_RESTART",START_MOH:"START_MOH",STOP_MOH:"STOP_MOH",SLOW_START:"SLOW_START",UNKNOWN:"UNKNOWN"}},58384:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=function(e){const t=(0,o.default)();return{createReport:function(){const r=e.getLogger(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]),o=t.createReport(...arguments),a=o.addMetric;return o.addMetric=(e,t)=>{if("number"==typeof t)r.debug(`Metric collected: ${e} is ${t} ms`);else if(t.duration&&t.operation)r.debug(`Metric collected: ${e} is ${t.duration} ms, during operation: ${t.operation}`);else if(t.candidates&&t.operation)for(const n of t.candidates)n.duration&&r.debug(`Metric collected: ${e} is ${n.duration} ms, during operation: ${t.operation}`);a(e,t)},n.default.registerAllMetricHandlers(o),o},getReport:t.getReport,deleteReport:t.deleteReport}}(e.container.logManager);e.value("CallReporter",t)};var n=a(r(93339)),o=a(r(14132));function a(e){return e&&e.__esModule?e:{default:e}}},93339:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(62234),r(69375);var n=r(84581);function o(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(o,a){let i;for(let e=o.timeline.length-1;e>=0;e--){const r=o.timeline[e];if(t.includes(r.type)){i=r;break}for(let e=0;e<=r.timeline.length-1;e++){const n=r.timeline[e];if(t.includes(n.type)){i=n;break}}if(i)break}return!(!i||a.type===n.REPORT_EVENTS.PROCESS_MEDIA_REMOTE&&"MAKE_CALL_REMOTE_SETUP"===e&&"MAKE"!==a.getData("operation")||(e===n.REPORT_METRICS.TIME_TO_COLLECT_ICE_CANDIDATES?o.addMetric(e,{operation:i.getData("operation"),duration:a.end-i.start}):(o.addMetric(e,a.end-i.start),r&&o.unregisterMetricHandler(e)),0))}}function a(e,t){return function(r,n){const o=r.timeline.find((e=>t.includes(e.type)));return!!o&&(r.addMetric(e,n.start-o.start),r.unregisterMetricHandler(e),!0)}}function i(e,t){return function(r,n){const o=r.timeline.find((e=>t.includes(e.type)));return!(!o||o===n||(r.addMetric(e,n.end-o.start),r.unregisterMetricHandler(e),0))}}function s(){const e=[];return(t,r)=>{if(r.type===n.REPORT_EVENTS.RELAY_CANDIDATE_COLLECTED){const t={...r.getData(),duration:r.start};e.push(t)}else r.type===n.REPORT_EVENTS.PROCESS_MEDIA_LOCAL&&(e.map((t=>(t.duration=t.duration-r.start,e))),e.length&&t.addMetric(n.REPORT_METRICS.TIME_TO_RELAY_CANDIDATES,{operation:r.getData("operation"),candidates:[...e]}),e.length=0)}}t.default={handlers:{durationHandler:o,joinedCallDurationHandler:i,relayCandidatesHandler:s},registerAllMetricHandlers:function(e){e.registerMetricHandler(n.REPORT_METRICS.CALL_DURATION,[n.REPORT_EVENTS.END_LOCAL,n.REPORT_EVENTS.END_REMOTE,n.REPORT_EVENTS.JOIN,n.REPORT_EVENTS.DIRECT_TRANSFER,n.REPORT_EVENTS.CONSULTATIVE_TRANSFER],i(n.REPORT_METRICS.CALL_DURATION,[n.REPORT_EVENTS.MAKE,n.REPORT_EVENTS.RECEIVE_CALL,n.REPORT_EVENTS.JOIN])),e.registerMetricHandler(n.REPORT_METRICS.MAKE_CALL_LOCAL_SETUP,[n.REPORT_EVENTS.PROCESS_MEDIA_LOCAL],o(n.REPORT_METRICS.MAKE_CALL_LOCAL_SETUP,[n.REPORT_EVENTS.MAKE])),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_COLLECT_ICE_CANDIDATES,[n.REPORT_EVENTS.ICE_COLLECTION],o(n.REPORT_METRICS.TIME_TO_COLLECT_ICE_CANDIDATES,[n.REPORT_EVENTS.PROCESS_MEDIA_LOCAL],!1)),e.registerMetricHandler(n.REPORT_METRICS.MAKE_CALL_REMOTE_SETUP,[n.REPORT_EVENTS.PROCESS_MEDIA_REMOTE],o(n.REPORT_METRICS.MAKE_CALL_REMOTE_SETUP,[n.REPORT_EVENTS.REST_REQUEST])),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_RINGING,[n.REPORT_EVENTS.REMOTE_RINGING],o(n.REPORT_METRICS.TIME_TO_RINGING,[n.REPORT_EVENTS.MAKE])),e.registerMetricHandler(n.REPORT_METRICS.TIME_FROM_RECEIVE_TO_ANSWER,n.REPORT_EVENTS.ANSWER,o(n.REPORT_METRICS.TIME_FROM_RECEIVE_TO_ANSWER,[n.REPORT_EVENTS.RECEIVE_CALL])),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_CALL_SETUP_DURATION,n.REPORT_EVENTS.PROCESS_MEDIA_LOCAL,o(n.REPORT_METRICS.TIME_TO_CALL_SETUP_DURATION,[n.REPORT_EVENTS.RECEIVE_CALL])),e.registerMetricHandler(n.REPORT_METRICS.ANSWER_CALL_LOCAL_SETUP,n.REPORT_EVENTS.PROCESS_MEDIA_LOCAL,o(n.REPORT_METRICS.ANSWER_CALL_LOCAL_SETUP,[n.REPORT_EVENTS.ANSWER])),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_RELAY_CANDIDATES,[n.REPORT_EVENTS.PROCESS_MEDIA_LOCAL,n.REPORT_EVENTS.RELAY_CANDIDATE_COLLECTED],s()),e.registerMetricHandler(n.REPORT_METRICS.ANSWER_CALL_PRE_LOCAL_SETUP,n.REPORT_EVENTS.PROCESS_MEDIA_LOCAL,a(n.REPORT_METRICS.ANSWER_CALL_PRE_LOCAL_SETUP,[n.REPORT_EVENTS.ANSWER])),e.registerMetricHandler(n.REPORT_METRICS.MAKE_CALL_PRE_LOCAL_SETUP,n.REPORT_EVENTS.PROCESS_MEDIA_LOCAL,a(n.REPORT_METRICS.MAKE_CALL_PRE_LOCAL_SETUP,[n.REPORT_EVENTS.MAKE])),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_REJECT,[n.REPORT_EVENTS.REJECT],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_REJECT,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_IGNORE,[n.REPORT_EVENTS.IGNORE],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_IGNORE,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_ADD_MEDIA,[n.REPORT_EVENTS.ADD_MEDIA,n.REPORT_EVENTS.ADD_BASIC_MEDIA],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_ADD_MEDIA,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_ADD_MEDIA_REMOTE,[n.REPORT_EVENTS.ADD_MEDIA_REMOTE],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_ADD_MEDIA_REMOTE,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_HOLD_LOCAL,[n.REPORT_EVENTS.HOLD_LOCAL],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_HOLD_LOCAL,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_HOLD_REMOTE,[n.REPORT_EVENTS.HOLD_REMOTE],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_HOLD_REMOTE,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_UNHOLD_LOCAL,[n.REPORT_EVENTS.UNHOLD_LOCAL],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_UNHOLD_LOCAL,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_UNHOLD_REMOTE,[n.REPORT_EVENTS.UNHOLD_REMOTE],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_UNHOLD_REMOTE,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_REMOVE_MEDIA,[n.REPORT_EVENTS.REMOVE_MEDIA,n.REPORT_EVENTS.REMOVE_BASIC_MEDIA],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_REMOVE_MEDIA,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_REMOVE_MEDIA_REMOTE,[n.REPORT_EVENTS.REMOVE_MEDIA_REMOTE],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_REMOVE_MEDIA_REMOTE,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_RESTART_MEDIA,n.REPORT_EVENTS.MEDIA_RESTART,((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_RESTART_MEDIA,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_SEND_CUSTOM_PARAMETERS,n.REPORT_EVENTS.SEND_CUSTOM_PARAMETERS,((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_SEND_CUSTOM_PARAMETERS,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_FORWARD,[n.REPORT_EVENTS.FORWARD_CALL],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_FORWARD,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_DIRECT_TRANSFER,[n.REPORT_EVENTS.DIRECT_TRANSFER],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_DIRECT_TRANSFER,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_CONSULTATIVE_TRANSFER,[n.REPORT_EVENTS.CONSULTATIVE_TRANSFER],((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_CONSULTATIVE_TRANSFER,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_JOIN,n.REPORT_EVENTS.JOIN,i(n.REPORT_METRICS.TIME_TO_JOIN,[n.REPORT_EVENTS.JOIN])),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_MAKE,n.REPORT_EVENTS.MAKE,((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_MAKE,r.end-r.start)})),e.registerMetricHandler(n.REPORT_METRICS.TIME_TO_ANSWER,n.REPORT_EVENTS.ANSWER,((t,r)=>{e.addMetric(n.REPORT_METRICS.TIME_TO_ANSWER,r.end-r.start)}))}}},94236:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return function(r,n,o){const a=r.media[0].setup;return t.debug(`Changing SDP DTLS role from ${a} to ${e}.`),r.media.map((t=>(t.setup=e,t))),r}}},46484:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.modifySdpBandwidth=function(e,t,r){function n(e){return[{type:"AS",limit:e},{type:"TIAS",limit:1e3*e}]}return t.bandwidth&&(t.bandwidth.call&&(e.bandwidth=n(t.bandwidth.call)),t.bandwidth.audio&&e.media.filter((e=>"audio"===e.type)).forEach((e=>{e.bandwidth=n(t.bandwidth.audio)})),t.bandwidth.video&&e.media.filter((e=>"video"===e.type)).forEach((e=>{e.bandwidth=n(t.bandwidth.video)}))),e}},88851:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sanitizeSdesFromSdp=function(e,t,r){for(const t of e.media)t.crypto&&t.fingerprint&&delete t.crypto;return e}},52410:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("CallstackSDP.compareMedia",(()=>(0,n.default)(e.container))),e.factory("CallstackSDP.runPipeline",(()=>(0,o.default)(e.container)))};var n=a(r(87520)),o=a(r(38773));function a(e){return e&&e.__esModule?e:{default:e}}},87520:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t}=e;return function(e,r){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=s.default.parse(e),u=s.default.parse(r),d=(0,n.default)(t,l),f=(0,n.default)(t,u);let p;p=c?(0,o.matchMediasNaive)(d,f):(0,o.matchMedias)(d,f);const g=p.prevUnmatched,E=p.currUnmatched,_=[],y=[];return p.matched.forEach((e=>{let{previous:t,current:r}=e;const n=(0,a.default)(t,r);n.sending===i.MEDIA_TRANSITIONS.SAME&&n.receiving===i.MEDIA_TRANSITIONS.SAME?y.push(t):_.push({media:r,changes:n})})),{added:E,removed:g,changed:_,unchanged:y}}},r(69375);var n=c(r(64858)),o=r(87361),a=c(r(13504)),i=r(69540),s=c(r(54722));function c(e){return e&&e.__esModule?e:{default:e}}},13504:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r={sending:void 0,receiving:void 0};return e.willSend!==t.willSend?t.willSend?r.sending=n.MEDIA_TRANSITIONS.START:r.sending=n.MEDIA_TRANSITIONS.STOP:r.sending=n.MEDIA_TRANSITIONS.SAME,e.willReceive!==t.willReceive?t.willReceive?r.receiving=n.MEDIA_TRANSITIONS.START:r.receiving=n.MEDIA_TRANSITIONS.STOP:r.receiving=n.MEDIA_TRANSITIONS.SAME,r};var n=r(69540)},69540:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MEDIA_TRANSITIONS=void 0,t.MEDIA_TRANSITIONS={START:"START",STOP:"STOP",SAME:"SAME"}},87361:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.matchMedias=function(e,t){const r=[...e],n=[...t],o=[];let a=[];const i=[],s=function(e,t){return t.findIndex((t=>(void 0===e.sectionId||void 0===t.sectionId)&&e.mediaId===t.mediaId&&e.trackId===t.trackId))};return r.filter((e=>["number","string"].includes(typeof e.sectionId))).forEach((e=>{const t=function(e,t){return t.findIndex((t=>t.sectionId===e.sectionId))}(e,n);if(t>=0){const[r]=n.splice(t,1);i.push({previous:e,current:r})}else{const t=s(e,n);if(t>=0){const[r]=n.splice(t,1);i.push({previous:e,current:r})}else o.push(e)}})),r.filter((e=>void 0===e.sectionId)).forEach((e=>{const t=s(e,n);if(t>=0){const[r]=n.splice(t,1);i.push({previous:e,current:r})}else o.push(e)})),a=n,{prevUnmatched:o,currUnmatched:a,matched:i}},t.matchMediasNaive=function(e,t){const r=[...e],n=[...t],o=[],a=[],i=[],s=r.length<=n.length?n.length:r.length;for(let e=0;e<s;e++)void 0===r[e]?a.push(n[e]):void 0===n[e]?o.push(r[e]):i.push({previous:r[e],current:n[e]});return{prevUnmatched:o,currUnmatched:a,matched:i}},r(62234),r(69375)},77839:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return a(e)||s(e)?o.OPERATIONS.HOLD:i(e)||c(e)?o.OPERATIONS.UNHOLD:d(e)?o.OPERATIONS.START_MOH:l(e)?o.OPERATIONS.ADD_MEDIA:f(e)?o.OPERATIONS.STOP_MOH:u(e)?o.OPERATIONS.REMOVE_MEDIA:p(e)?"NO_CHANGE":"UNKNOWN"},t.hadMediaFlowing=g,t.hasMediaFlowing=E,t.was3xHold=s,t.was3xUnhold=c,t.wasAddMedia=l,t.wasHold=a,t.wasNoChange=p,t.wasRemoveMedia=u,t.wasStartMoh=d,t.wasStopMoh=f,t.wasUnhold=i;var n=r(69540),o=r(59090);function a(e){const{added:t,removed:r,changed:o,unchanged:a}=e,i=g(e)&&!E(e),s=!t.some((e=>e.willSend||e.willReceive)),c=0===r.length,l=o.length>0,u=o.every((e=>{let{media:t,changes:r}=e;const o=r.sending===n.MEDIA_TRANSITIONS.STOP||r.sending===n.MEDIA_TRANSITIONS.SAME&&!t.willSend,a=r.receiving===n.MEDIA_TRANSITIONS.STOP||r.receiving===n.MEDIA_TRANSITIONS.SAME&&!t.willReceive;return o&&a})),d=a.every((e=>!e.willSend&&!e.willReceive));return i&&s&&c&&l&&u&&d}function i(e){const{added:t,removed:r,changed:o,unchanged:a}=e,i=!g(e)&&E(e),s=0===t.length&&0===r.length,c=a.every((e=>!e.willSend&&!e.willReceive)),l=o.length>0,u=o.every((e=>{let{media:t,changes:r}=e;const o=r.sending===n.MEDIA_TRANSITIONS.START||r.sending===n.MEDIA_TRANSITIONS.SAME&&!t.willSend,a=r.receiving===n.MEDIA_TRANSITIONS.START||r.receiving===n.MEDIA_TRANSITIONS.SAME&&!t.willReceive;return o&&a}));return i&&s&&c&&l&&u}function s(e){const{added:t,removed:r,changed:o,unchanged:a}=e,i=g(e),s=o.every((e=>{let{media:t,changes:r}=e;return"audio"===t.type?r.receiving===n.MEDIA_TRANSITIONS.STOP&&r.sending===n.MEDIA_TRANSITIONS.SAME:r.receiving===n.MEDIA_TRANSITIONS.STOP||r.receiving===n.MEDIA_TRANSITIONS.SAME&&!1===t.willReceive})),c=!t.some((e=>e.willSend||e.willReceive)),l=0===r.length,u=a.every((e=>!e.willSend&&!e.willReceive||"video"===e.type&&e.willSend&&!e.willReceive));return i&&s&&c&&l&&u}function c(e){const{added:t,removed:r,changed:o,unchanged:a}=e,i=E(e),s=o.every((e=>{let{media:t,changes:r}=e;return r.sending===n.MEDIA_TRANSITIONS.SAME&&r.receiving===n.MEDIA_TRANSITIONS.START||"video"===t.type&&r.sending===n.MEDIA_TRANSITIONS.START&&r.receiving===n.MEDIA_TRANSITIONS.START})),c=0===t.length&&0===r.length,l=a.every((e=>!e.willSend&&!e.willReceive));return i&&s&&c&&l}function l(e){const{added:t,removed:r,changed:o}=e,a=0===r.length,i=t.length>0||o.length>0,s=t.every((e=>e.willSend)),c=o.every((e=>{let{media:t,changes:r}=e;return r.sending===n.MEDIA_TRANSITIONS.START&&(r.receiving===n.MEDIA_TRANSITIONS.SAME||r.receiving===n.MEDIA_TRANSITIONS.START)}));return a&&i&&s&&c}function u(e){const{added:t,removed:r,changed:o}=e,a=0===t.length,i=0===r.length,s=o.length>0,c=o.every((e=>{let{media:t,changes:r}=e;return r.sending===n.MEDIA_TRANSITIONS.STOP&&r.receiving!==n.MEDIA_TRANSITIONS.STOP}));return a&&i&&s&&c}function d(e){const{added:t,removed:r,changed:o,unchanged:a}=e;if(!l(e))return!1;const i=1===o.length&&"audio"===o[0].media.type&&o[0].changes.sending===n.MEDIA_TRANSITIONS.START&&o[0].changes.receiving===n.MEDIA_TRANSITIONS.SAME&&!o[0].media.willReceive,s=0===t.length&&0===r.length,c=a.every((e=>!e.willSend&&!e.willReceive));return s&&c&&i}function f(e){const{added:t,removed:r,changed:o,unchanged:a}=e;if(!u(e))return!1;const i=1===o.length&&"audio"===o[0].media.type&&o[0].changes.sending===n.MEDIA_TRANSITIONS.STOP&&o[0].changes.receiving===n.MEDIA_TRANSITIONS.SAME&&!o[0].media.willReceive,s=0===t.length&&0===r.length,c=a.every((e=>!e.willSend&&!e.willReceive));return s&&c&&i}function p(e){const{added:t,removed:r,changed:n,unchanged:o}=e,a=0===t.length&&0===r.length&&0===n.length,i=o.length>0;return a&&i}function g(e){const{removed:t,changed:r,unchanged:o}=e,a=o.some((e=>e.willSend&&e.willReceive)),i=r.some((e=>{let{media:t,changes:r}=e;const o=r.sending===n.MEDIA_TRANSITIONS.STOP||r.sending===n.MEDIA_TRANSITIONS.SAME&&t.willSend,a=r.receiving===n.MEDIA_TRANSITIONS.STOP||r.receiving===n.MEDIA_TRANSITIONS.SAME&&t.willReceive;return o&&a})),s=t.some((e=>e.willSend&&e.willReceive));return a||i||s}function E(e){const{added:t,changed:r,unchanged:n}=e,o=n.some((e=>e.willSend&&e.willReceive)),a=r.some((e=>{let{media:t,changes:r}=e;return t.willSend&&t.willReceive})),i=t.some((e=>e.willSend&&e.willReceive));return o||a||i}},48151:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e,t,r){if(t.removed.length>0)return await a(r);let i;switch(e){case o.OPERATIONS.ADD_MEDIA:case o.OPERATIONS.START_MOH:i=function(e){let t=[];e.changed.forEach((e=>{const{media:r,changes:n}=e;if("START"===n.sending&&("SAME"===n.receiving||"START"===n.receiving)){const e=void 0===r.sectionId?r.sectionIndex:r.sectionId;t.push(e)}}));const r=e.added.filter((e=>e.willSend)).map((e=>void 0===e.sectionId?e.sectionIndex:e.sectionId));return t=t.concat(r),t}(t);break;case o.OPERATIONS.REMOVE_MEDIA:case o.OPERATIONS.STOP_MOH:i=function(e){const t=[];return e.changed.forEach((e=>{const{media:r,changes:n}=e;if("STOP"===n.sending&&"STOP"!==n.receiving){const e=void 0===r.sectionId?r.sectionIndex:r.sectionId;t.push(e)}})),t}(t);break;case o.OPERATIONS.HOLD:i=(0,n.was3xHold)(t)?function(e){const t=[];return e.changed.forEach((e=>{const{media:r,changes:n}=e;if("audio"===r.type){if("STOP"===n.receiving&&"SAME"===n.sending){const e=void 0===r.sectionId?r.sectionIndex:r.sectionId;t.push(e)}}else if("STOP"===n.receiving||"SAME"===n.receiving&&!1===r.willReceive){const e=void 0===r.sectionId?r.sectionIndex:r.sectionId;t.push(e)}})),e.unchanged.forEach((e=>{if("video"===e.type&&e.willSend&&!e.willReceive){const r=void 0===e.sectionId?e.sectionIndex:e.sectionId;t.push(r)}})),t}(t):function(e){const t=[];return e.changed.forEach((e=>{const{media:r,changes:n}=e;if("STOP"===n.sending){const e=void 0===r.sectionId?r.sectionIndex:r.sectionId;t.push(e)}})),t}(t);break;case o.OPERATIONS.UNHOLD:i=(0,n.was3xUnhold)(t)?function(e){const t=[];return e.changed.forEach((e=>{let{media:r,changes:n}=e;if("SAME"===n.sending&&"START"===n.receiving||"video"===r.type&&"START"===n.sending&&"START"===n.receiving){const e=void 0===r.sectionId?r.sectionIndex:r.sectionId;t.push(e)}})),t}(t):function(e){const t=[];return e.changed.forEach((e=>{const{media:r,changes:n}=e;if("START"===n.sending){const e=void 0===r.sectionId?r.sectionIndex:r.sectionId;t.push(e)}})),t}(t);break;default:i=[]}return await r.getRemoteTrackIdsFromTransceivers(i)},t.getAllRemoteTracks=a,t.getIncomingRemoteTracks=async function(e){return await e.getIncomingRemoteTrackIds()},r(69375);var n=r(77839),o=r(59090);async function a(e){return await e.getActiveRemoteTrackIds()}},64858:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=e.getLogger("SDP"),n=[];return t.media.forEach(((e,o)=>{const a=e.mid,i=o;e.ssrcGroups&&e.ssrcGroups.length>1&&r.debug(`Media section contains multiple ssrc groups. Summary for ${a} will be wrong.`);const s=e.direction||t.direction;let c,l,u,d;s?(c=s.includes("send"),l=s.includes("recv")):(c=!0,l=!0),c?e.msid?[u,d]=e.msid.split(" "):e.ssrcs&&(u=e.ssrcs.find((e=>"mslabel"===e.attribute)).value,d=e.ssrcs.find((e=>"label"===e.attribute)).value):(u=void 0,d=void 0);const f={sectionId:a,sectionIndex:i,type:e.type,willSend:c,willReceive:l,mediaId:u,trackId:d};n.push(f)})),n},r(62234),r(69375)},38773:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t}=e,r=t.getLogger("SDP");return function(e,t,i){const s=r.getLevel();return(s===a.logLevels.DEBUG||s===a.logLevels.TRACE?o.default:n.default)(e,t,i,r)}};var n=i(r(41743)),o=i(r(88351)),a=r(44413);function i(e){return e&&e.__esModule?e:{default:e}}},41743:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,c){const l=s.default.parse(t),u=Object.freeze(l);let d=(0,a.default)(u);return(0,o.default)(e)&&e.forEach((e=>{const t=(0,i.formattedFunctionName)(e);if((0,n.default)(e))try{d=e(d,r,u)}catch(e){c.info(`Currently running pipeline to ${r.step} ${r.endpoint} ${r.type} for callId: ${r.callId}`),c.error(`Error running SDP handler: ${t}`,e)}else c.error("SDP handler not a function; skipping.")})),s.default.write(d)};var n=c(r(30524)),o=c(r(90283)),a=c(r(89321)),i=r(88784),s=c(r(54722));function c(e){return e&&e.__esModule?e:{default:e}}},88351:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,l){const u=s.default.parse(t);if(!(0,o.default)(e))return s.default.write(u);const d=Object.freeze(u);let f,p,g=(0,a.default)(d);const E=[];e.forEach((e=>{const t=(0,i.formattedFunctionName)(e);if((0,n.default)(e)){l.debug(`Running SDP handler ${t}.`);try{p=(0,a.default)(g),g=e(g,r,d),f=(0,c.default)(p,g),E.push({name:t,diff:f.text})}catch(e){l.info(`Currently running pipeline to ${r.step} ${r.endpoint} ${r.type} for callId: ${r.callId}`),l.error(`Error running SDP handler: ${t}`,e)}}else l.error("SDP handler not a function; skipping."),E.push({name:t,diff:"No diff, not a function."})})),f=(0,c.default)(d,g);const _=(0,i.sdpToYaml)(r)(d)(g)(E)(f);return l.debug(`SDP Handler changes: ${_}`),s.default.write(g)},r(69375);var n=l(r(30524)),o=l(r(90283)),a=l(r(89321)),i=r(88784),s=l(r(54722)),c=l(r(94574));function l(e){return e&&e.__esModule?e:{default:e}}},88784:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sdpToYaml=t.formattedFunctionName=void 0;var n=l(r(68015)),o=l(r(59419)),a=l(r(5968)),i=l(r(80880)),s=l(r(93054)),c=l(r(54722));function l(e){return e&&e.__esModule?e:{default:e}}t.sdpToYaml=e=>t=>r=>n=>o=>`\n---\nsdp-pipeline-run:\n  info:\n    callId: ${e.callId}\n    type: ${e.type}\n    step: ${e.step}\n    endpoint: ${e.endpoint}\n    bandwidth: ${u(e.bandwidth)}\n  sdp: |\n    ${d(g)(t)}\n  handlers:\n    ${f(n)}\n  final:\n    diff: |\n      ${p(E)(o.text)}\n    sdp: |\n      ${o.changed?d(E)(r):"No changes to the SDP"}\n...\n`,t.formattedFunctionName=e=>e.name||e.toString().slice(0,120).replace(/\n/g,"");const u=e=>e&&JSON.stringify(e,null," ").replace(/\n/g," ").replace(/ {2}/g," "),d=e=>t=>c.default.write(t).replace(/\n/g,`\n${e}`).trimEnd(),f=(0,s.default)([n.default,(0,o.default)(" \n"),(0,i.default)(""),(0,a.default)((e=>{let{name:t,diff:r}=e;return`${g}- name: ${t.replace(/\n/g,"")}\n      diff: |\n        ${p(_)(r)}\n`}))]),p=e=>t=>t?t.replace(/\n/g,`\n${e}`):"No changes found",g="    ",E="      ",_="        "},11876:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=o.default.parse(e),r=t.media.filter((e=>"video"===e.type)).every((e=>e&&"inactive"===e.direction)),n=t.media.filter((e=>"audio"===e.type)).every((e=>e&&["inactive","sendonly"].includes(e.direction)));return!r||!n},r(62234);var n,o=(n=r(54722))&&n.__esModule?n:{default:n}},58532:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return o.default.parse(e).media.filter((e=>"audio"===e.type)).some((e=>e.rtp.some((e=>"telephone-event"===e.codec))))};var n,o=(n=r(54722))&&n.__esModule?n:{default:n}},29819:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e&&"string"==typeof e)return e.replace(/sendrecv|sendonly|recvonly/gi,"inactive")}},69752:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkBandwidthControls=function(e){const t={...e};return e&&e.audio&&"number"==typeof e.audio||(t.audio=null),e&&e.video&&"number"==typeof e.video||(t.video=null),t},t.generateEndParams=function(e,t,r){const n={isLocal:t,remoteParticipant:{displayNumber:r.remoteNumber,displayName:r.remoteName},transition:{prevState:e}};return r.statusCode&&(n.transition.statusCode=r.statusCode),r.reasonText&&(n.transition.reasonText=r.reasonText),n},t.getCallAction=function(e){return e===c.OPERATIONS.SLOW_START?{callAction:i.callActions.remoteSlowStart,eventFns:[]}:{callAction:i.callActions.updateCall,eventFns:[]}},t.getLocalOpTrackEvents=function(e,t,r,n,i){switch(t){case c.OPERATIONS.HOLD:case c.OPERATIONS.REMOVE_MEDIA:case c.OPERATIONS.REMOVE_BASIC_MEDIA:{const t=[];return r.payload.localTracks&&t.push(...r.payload.localTracks),r.payload.remoteTracks&&t.push(...r.payload.remoteTracks),t.length?{type:s.CALL_TRACKS_REMOVED,args:{callId:e,trackIds:t}}:void 0}case c.OPERATIONS.UNHOLD:case c.OPERATIONS.ADD_MEDIA:case c.OPERATIONS.ADD_BASIC_MEDIA:{const t=function(e,t,r){const n=(0,a.getCallById)(t,e.payload.id),{remoteTracks:i}=n,{localTracks:s=[],remoteTracks:c=[]}=e.payload,l=[...s,...(0,o.default)(i,c)];if(l&&0!==l.length)return l}(r,n);return t?{type:s.CALL_TRACKS_ADDED,args:{callId:e,trackIds:t}}:void 0}case c.OPERATIONS.MEDIA_RESTART:return{type:s.MEDIA_RESTART,args:{callId:e}}}},t.getLocalTracks=function(e,t,r){const n=(0,a.getCallById)(e.getState(),t),o=(n?n.localTracks:[]).map((t=>(0,l.getTrackById)(e.getState(),t)));return r?o.filter((e=>e.kind===r)):o},t.getTrackDscpMapping=function(e,t){const{audio:r,video:n,screen:o}=e,a={};if(t){if(t.screenNetworkPriority)for(const e of o)a[e.id]=t.screenNetworkPriority;if(t.audioNetworkPriority)for(const e of r)a[e.id]=t.audioNetworkPriority;if(t.videoNetworkPriority)for(const e of n)a[e.id]=t.videoNetworkPriority}return a},r(69375);var n,o=(n=r(6022))&&n.__esModule?n:{default:n},a=r(40481),i=r(35),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),c=r(59090),l=r(69260);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}},63858:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("Callstack.utils.getRemoteOperationInfo",(()=>(0,o.default)(e.container)))};var n,o=(n=r(17918))&&n.__esModule?n:{default:n}},56294:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.organizeTracks=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t={audio:[],video:[],screen:[],all:[]};return await Promise.all(e.map((async e=>{if(["audio","video","screen"].includes(e.type)){const r=await e.media.getTracks();t[e.type]=t[e.type].concat(r),t.all=t.all.concat(r)}}))),t},r(62234)},17918:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{CallstackSDP:t,logManager:r,WebRTC:c}=e;return async function(e,l){const u=r.getLogger("CALL",e.id),d=await c.sessionManager.get(e.webrtcSessionId),f=(0,a.getMediaState)(e);u.debug(`Current call info; State: ${e.state}, MediaState: ${f}.`);const p=await d.getLatestRemoteDesc();let g=t.compareMedia(p.sdp,l),E=(0,n.default)(g);u.debug(`Interpreted update request as a ${E} operation.`);const _=(0,o.default)(l);return"UNKNOWN"===E?f===i.CALL_MEDIA_STATES.REMOTE_HOLD&&_?E=s.OPERATIONS.UNHOLD:(g=t.compareMedia(p.sdp,l,!0),E=(0,n.default)(g),u.debug(`Re-interpreted update request as a ${E} operation.`)):"NO_CHANGE"===E&&(_||f!==i.CALL_MEDIA_STATES.LOCAL_HOLD||(E=s.OPERATIONS.HOLD,u.debug(`Interpreting NO_CHANGE operation as ${E} due to ${f} state.`))),{remoteOp:E,mediaDiff:g,remoteDesc:p}}};var n=c(r(77839)),o=c(r(11876)),a=r(73520),i=r(77126),s=r(59090);function c(e){return e&&e.__esModule?e:{default:e}}},25939:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateDestination=function(e){return e?"string"!=typeof e?new n.default({message:"Incorrect destination type.",code:n.callCodes.INVALID_PARAM}):void 0:new n.default({message:"No destination provided.",code:n.callCodes.INVALID_PARAM})};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(75412));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},70949:(e,t)=>{"use strict";function r(e,t){const r=n(e),o=n(t);if(r&&o)return r===o}function n(e){const t=e.match(/o=.*/gm);if(t&&t[0])return t[0].split(" ")[1]}Object.defineProperty(t,"__esModule",{value:!0}),t.getSdpSessionId=n,t.hasSameSessionId=r,t.isSameSdpSessionId=async function(e,t,n){const o=await e.sessionManager.get(t),a=await o.getRemoteDescription();if(a&&a.sdp)return r(a.sdp,n)}},10680:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,WebRTC:r}=e;return async function(e){const n=t.getLogger("CALLSTACK"),o=await r.sessionManager.get(e);o?(await Promise.all(o.localTracks.map((async e=>{await e.isDetached()||await e.stop()}))),await o.end()):n.debug(`webRTC session ${e} not found.`)}}},15156:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("CallstackWebrtc.closeCall",(()=>(0,n.default)(e.container))),e.factory("CallstackWebrtc.createLocal",(()=>(0,o.default)(e.container))),e.factory("CallstackWebrtc.generateOffer",(()=>(0,a.default)(e.container))),e.factory("CallstackWebrtc.handleOffer",(()=>(0,i.default)(e.container))),e.factory("CallstackWebrtc.receivedAnswer",(()=>(0,s.default)(e.container)))};var n=c(r(10680)),o=c(r(57188)),a=c(r(14613)),i=c(r(92742)),s=c(r(35497));function c(e){return e&&e.__esModule?e:{default:e}}},57188:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,CallReporter:r,WebRTCMediaOperations:i}=e;return async function(e,s){const c=(0,n.getCallById)(t.getState(),s),l=r.getReport(s),u=c.currentOperations.find((e=>e.isLocal&&e.status===o.OP_STATUS.ONGOING&&(e.isBlocking||[o.OPERATIONS.REPLACE_TRACK,o.OPERATIONS.JOIN].includes(e.type)))),d=l.getEvent(u.eventId).addEvent(a.REPORT_EVENTS.GET_USER_MEDIA);d.addData("mediaConstraints",e);let f=[];try{f=await i.createLocal(e)}catch(e){throw d.setError(e),d.endEvent(),e}return d.endEvent(),f}},r(62234);var n=r(40481),o=r(59090),a=r(84581)},14613:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,CallstackSDP:s,WebRTC:c,CallReporter:l}=e;return async function(e,u,d){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const p=r.getLogger("CALLSTACK"),g=await c.sessionManager.get(e);if(!g){const t=`WebRTC session ${e} not found.`;throw p.debug(t),new a.default({message:t,code:a.callCodes.GENERIC_ERROR})}const E=(0,n.getCallByWebrtcSessionId)(t.getState(),e),_=l.getReport(E.id),y=E.currentOperations.find((e=>e.isLocal&&e.isBlocking&&e.status===o.OP_STATUS.ONGOING||!e.isLocal&&e.type===o.OPERATIONS.SLOW_START)),v=_.getEvent(y.eventId);let S,O,h,T;try{h=v.addEvent(i.REPORT_EVENTS.CREATE_OFFER),S=await g.createOffer({mediaDirections:u,...f}),h.endEvent()}catch(e){const t=new a.default({message:e.message,code:a.callCodes.GENERIC_ERROR});throw h.endEvent(t),t}try{O=(0,n.getOptions)(t.getState()),S.sdp=s.runPipeline(O.sdpHandlers,S.sdp,{callId:E.id,type:S.type,step:"set",endpoint:"local",bandwidth:d},p),T=v.addEvent(i.REPORT_EVENTS.PROCESS_MEDIA_LOCAL),T.addData("operation",v.type),S=await g.setLocalDescription(S),T.endEvent()}catch(e){const t=new a.default({message:e.message,code:a.callCodes.GENERIC_ERROR});throw T.endEvent(t),t}const I=s.runPipeline(O.sdpHandlers,S.sdp,{callId:E.id,type:S.type,step:"send",endpoint:"local",bandwidth:d},p);return{type:S.type,sdp:I}}};var n=r(40481),o=r(59090),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412)),i=r(84581);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},92742:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,CallstackSDP:i,WebRTC:s,CallReporter:c}=e;return async function(e,l,u){const d=r.getLogger("CALLSTACK"),f=await s.sessionManager.get(l);if(!f)return void d.debug(`webRTC session ${l} not found.`);const{id:p}=(0,n.getCallByWebrtcSessionId)(t.getState(),l),g=(0,n.getOptions)(t.getState());e=i.runPipeline(g.sdpHandlers,e,{callId:p,type:"offer",step:"set",endpoint:"remote"},d);const E=(0,n.getCallById)(t.getState(),p),_=c.getReport(E.id),y=E.currentOperations.find((e=>!e.isLocal)),v=_.getEvent(y.eventId),S=v.addEvent(o.REPORT_EVENTS.PROCESS_MEDIA_REMOTE);let O,h,T;try{const t=await f.processOffer({type:"offer",sdp:e});if(t)return S.endEvent(t),{error:t};S.endEvent()}catch(e){const t=new a.default({message:e.message,code:a.callCodes.GENERIC_ERROR});throw S.endEvent(t),t}try{T=v.addEvent(o.REPORT_EVENTS.CREATE_ANSWER),O=await f.createAnswer(),T.endEvent()}catch(e){const t=new a.default({message:e.message,code:a.callCodes.GENERIC_ERROR});throw T.endEvent(t),t}try{O.sdp=i.runPipeline(g.sdpHandlers,O.sdp,{callId:p,type:O.type,step:"set",endpoint:"local",bandwidth:u},d),h=v.addEvent(o.REPORT_EVENTS.PROCESS_MEDIA_LOCAL),h.addData("operation",v.type),O=await f.setLocalDescription(O),h.endEvent()}catch(e){const t=new a.default({message:e.message,code:a.callCodes.GENERIC_ERROR});throw h.endEvent(t),t}return{answerSDP:i.runPipeline(g.sdpHandlers,O.sdp,{callId:p,type:O.type,step:"send",endpoint:"local",bandwidth:u},d)}}};var n=r(40481),o=r(84581),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},35497:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,CallstackSDP:n,WebRTC:s}=e;return async function(e,c){const l=r.getLogger("CALL",c.id);l.debug(`Processing SDP answer for session ${e.sessionId}.`);const u=await s.sessionManager.get(e.sessionId);if(!u)throw l.debug(`webRTC session ${e.sessionId} not found.`),new i.default({code:i.callCodes.INVALID_PARAM,message:`WebRTC session for Call ${c.id} does not exist.`});let d=(0,o.getOptions)(t.getState()).sdpHandlers,f=e.answerSdp;if(f.includes("a=setup:actpass")){const e=c.isCaller?"passive":"active";l.debug(`Received answer SDP has role of actpass. Changing to ${e}.`),d=[...d,(0,a.default)(e,l)]}try{f=n.runPipeline(d,f,{callId:c.id,type:"answer",step:"set",endpoint:"remote"}),await u.processAnswer({type:"answer",sdp:f})}catch(e){let t;throw l.debug(`Failed to process answer: ${e.message}`),t=e.message.includes("The order of m-lines")?{code:i.callCodes.SESSION_MISMATCH,message:"Failed to receive answer due to media negotiation mismatch."}:{code:i.callCodes.GENERIC_ERROR,message:`Failed to receive answer: ${e.message}`},new i.default(t)}}},r(62234);var n,o=r(40481),a=(n=r(94236))&&n.__esModule?n:{default:n},i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},16556:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.getVersion)()[0]<4||(e.ringingFeedbackMode&&!["auto","manual"].includes(e.ringingFeedbackMode)&&(l.warn("Call configuration `ringingFeedbackMode` invalid. Switching to `auto`."),e.ringingFeedbackMode="auto"),e.iceCollectionDelay&&(e.iceCollectionIdealTimeout||(e.iceCollectionIdealTimeout=e.iceCollectionDelay),delete e.iceCollectionDelay),e.maxIceTimeout&&!e.iceCollectionMaxTimeout&&(e.iceCollectionMaxTimeout||(e.iceCollectionMaxTimeout=e.maxIceTimeout),delete e.maxIceTimeout),e.skipIceCollection&&(e.trickleIceMode&&["NONE","HALF"].includes(e.trickleIceMode)&&(l.warn("Conflicting `skipIceCollection` and `trickleIceMode` options specified. Proceeding with `skipIceCollection: true` only."),delete e.trickleIceMode),e.trickleIceMode="FULL")),e},t.fixIceServerUrls=function(e){let t;try{t=new URL(e)}catch(t){return l.warn(`Invalid URL specified for ice server: ${e}`),e}const r=t.protocol,n=t.search;if(!n)return e;let o;o=r&&r.toLowerCase().startsWith("turn")?e=>"transport"!==e:()=>!0;const a=new URLSearchParams(n);Array.from(a.keys()).filter(o).forEach((e=>a.delete(e)));const i=a.toString();return t.search=i,t.search.length!==n.length&&l.warn(`Invalid STUN/TURN server URL provided: ${e}`),t.toString()},t.mergeDefaults=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e=(0,a.default)(u,e),e.iceCollectionCheckFunction||(e.iceCollectionCheckFunction=s.iceCollectionCheckFunction),f(e),e},r(62234),r(61412),r(91883),r(70286);var n,o=r(69932),a=(n=r(7485))&&n.__esModule?n:{default:n},i=r(13126),s=r(24679),c=r(52932);const l=o.logManager.getLogger("CALL"),u={defaultPeerConfig:{sdpSemantics:"unified-plan",iceServers:[]},iceCollectionIdealTimeout:1e3,iceCollectionMaxTimeout:3e3,serverTurnCredentials:!0,sdpHandlers:[],removeBundling:!1,earlyMedia:!1,resyncOnConnect:!1,mediaBrokerOnly:!1,trickleIceMode:"NONE",skipIceCollection:!1,normalizeDestination:!0,ringingFeedbackMode:"auto",callAuditTimer:25e3,mediaConnectionRetryDelay:3e3},d=c.validation.schema({defaultPeerConfig:c.validation.schema({sdpSemantics:(0,c.enums)(["unified-plan"]),iceServers:c.validation.array(),iceCandidatePoolSize:c.validation.optional(c.validation.positive()),iceTransportPolicy:c.validation.optional((0,c.enums)(["all","public","relay"])),bundlePolicy:c.validation.optional((0,c.enums)(["balanced","max-compat","max-bundle"])),certificates:c.validation.optional(c.validation.array().every.schema({expires:c.validation.string()})),peerIdentity:c.validation.optional(c.validation.string()),rtcpMuxPolicy:c.validation.optional((0,c.enums)(["negotiate","require"]))}),iceCollectionIdealTimeout:c.validation.positive(),iceCollectionMaxTimeout:c.validation.positive(),iceCollectionCheckFunction:c.validation.optional(c.validation.function()),serverTurnCredentials:c.validation.boolean(),sdpHandlers:c.validation.array(),removeBundling:c.validation.boolean(),earlyMedia:c.validation.boolean(),resyncOnConnect:c.validation.boolean(),mediaBrokerOnly:c.validation.boolean(),trickleIceMode:c.validation.string(),skipIceCollection:c.validation.boolean(),normalizeDestination:c.validation.boolean(),ringingFeedbackMode:(0,c.enums)(["auto","manual"]),callAuditTimer:c.validation.positive(),mediaConnectionRetryDelay:c.validation.positive()}),f=(0,c.parse)("call",d)},77126:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WEBRTC_DEVICE_KINDS=t.STATUS_CODES=t.OPERATIONS=t.ICE_COLLECTION_RESULT_TYPES=t.COMPLEX_OPERATION_MESSAGES=t.COMPLEX_OPERATIONS=t.CALL_STATES=t.CALL_MEDIA_STATES=t.CALL_MEDIA_CONNECTION_STATES=t.CALL_DIRECTION=void 0,t.CALL_STATES={INITIATING:"Initiating",INITIATED:"Initiated",EARLY_MEDIA:"Early Media",RINGING:"Ringing",CANCELLED:"Cancelled",CONNECTED:"Connected",ON_HOLD:"On Hold",ENDED:"Ended"},t.CALL_MEDIA_STATES={CONNECTED:"Connected",LOCAL_HOLD:"Local Hold",REMOTE_HOLD:"Remote Hold",DUAL_HOLD:"Dual Hold"},t.CALL_MEDIA_CONNECTION_STATES={NEW:"new",CHECKING:"checking",CONNECTED:"connected",COMPLETED:"completed",FAILED:"failed",DISCONNECTED:"disconnected",CLOSED:"closed"},t.OPERATIONS={CHANGE_MEDIA:"Change Media",HOLD_MEDIA:"Hold Media",UNHOLD_MEDIA:"Unhold Media",MUSIC_ON_HOLD:"Music on hold"},t.COMPLEX_OPERATIONS={DIRECT_TRANSFER:"Direct Transfer",CONSULTATIVE_TRANSFER:"Consultative Transfer",JOIN:"Join"},t.COMPLEX_OPERATION_MESSAGES={DIRECT_TRANSFER_SUCCESS:"Direct Transfer Successful",CONSULTATIVE_TRANSFER_SUCCESS:"Transfer Successful",JOIN_SUCCESS:"Join Successful",DIRECT_TRANSFER_FAILURE:"Direct Transfer Failed",CONSULTATIVE_TRANSFER_FAILURE:"Transfer Failed",JOIN_FAILURE:"Join Failed"},t.STATUS_CODES={DIRECT_TRANSFER_SUCCESS:9905,CONSULTATIVE_TRANSFER_SUCCESS:9905,JOIN_SUCCESS:9906,DIRECT_TRANSFER_FAILURE:-1,CONSULTATIVE_TRANSFER_FAILURE:-1,JOIN_FAILURE:-2},t.CALL_DIRECTION={INCOMING:"incoming",OUTGOING:"outgoing"},t.WEBRTC_DEVICE_KINDS={audioinput:"microphone",videoinput:"camera",audiooutput:"speaker"},t.ICE_COLLECTION_RESULT_TYPES={START_CALL:"StartCall",WAIT:"Wait",ERROR:"Error"}},21836:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_CALL=t.TURN_CHANGED=t.TRACK_REMOVED=t.TRACK_ADDED=t.SET_CUSTOM_PARAMETERS=t.SESSION_PROGRESS=t.SESSION_CREATED=t.SEND_RINGING_FEEDBACK_FINISH=t.SEND_RINGING_FEEDBACK=t.SEND_DTMF_FINISH=t.SEND_DTMF=t.SEND_CUSTOM_PARAMETERS_FINISH=t.SEND_CUSTOM_PARAMETERS=t.RESYNC_FINISH=t.RESYNC=t.REPLACE_TRACK_FINISH=t.REPLACE_TRACK=t.REMOVE_MEDIA_FINISH=t.REMOVE_MEDIA=t.REMOVE_BASIC_MEDIA=t.REMOTE_STOP_MOH_FINISH=t.REMOTE_START_MOH_FINISH=t.REMOTE_SLOW_START=t.REMOTE_REMOVE_MEDIA_FINISH=t.REMOTE_ADD_MEDIA_FINISH=t.REJECT_CALL_FINISH=t.REJECT_CALL=t.PLAY_AUDIO_FINISH=t.PLAY_AUDIO=t.PENDING_PLAY_AUDIO=t.PENDING_OPERATION=t.PENDING_MAKE_CALL=t.PENDING_JOIN=t.PENDING_CONSULTATIVE_TRANSFER=t.OPERATION_UPDATE=t.MUSIC_ON_HOLD=t.MEDIA_RESTART_FINISH=t.MEDIA_RESTART=t.MAKE_CALL_FINISH=t.MAKE_CALL=t.MAKE_ANONYMOUS_CALL_FINISH=t.MAKE_ANONYMOUS_CALL=t.JOIN_START=t.JOIN_FINISH=t.JOIN=t.IGNORE_CALL_FINISH=t.IGNORE_CALL=t.GET_STATS_FINISH=t.GET_STATS=t.GET_AVAILABLE_CODECS=t.FORWARD_CALL_FINISH=t.FORWARD_CALL=t.END_CALL_FINISH=t.END_CALL=t.DIRECT_TRANSFER_FINISH=t.DIRECT_TRANSFER=t.CUSTOM_PARAMETERS_RECEIVED=t.CONSULTATIVE_TRANSFER_FINISH=t.CONSULTATIVE_TRANSFER=t.CALL_UNHOLD_FINISH=t.CALL_UNHOLD=t.CALL_RINGING=t.CALL_REMOTE_UNHOLD_FINISH=t.CALL_REMOTE_HOLD_FINISH=t.CALL_INCOMING=t.CALL_HOLD_FINISH=t.CALL_HOLD=t.CALL_CANCELLED=t.CALL_ACCEPTED=t.AVAILABLE_CODECS_RETRIEVED=t.ANSWER_CALL_FINISH=t.ANSWER_CALL=t.ADD_MEDIA_FINISH=t.ADD_MEDIA=t.ADD_BASIC_MEDIA=void 0;const r="@@KANDY/CALL/",n=(t.MAKE_CALL=r+"MAKE",t.PENDING_MAKE_CALL=r+"PENDING_MAKE",t.SESSION_CREATED=r+"SESSION_CREATED",t.MAKE_CALL_FINISH=r+"MAKE_FINISH",t.MAKE_ANONYMOUS_CALL=r+"MAKE_ANONYMOUS_CALL",t.MAKE_ANONYMOUS_CALL_FINISH=r+"MAKE_ANONYMOUS_CALL_FINISH",t.CALL_INCOMING=r+"INCOMING",t.SEND_RINGING_FEEDBACK=r+"SEND_RINGING_FEEDBACK",t.SEND_RINGING_FEEDBACK_FINISH=r+"SEND_RINGING_FEEDBACK_FINISH",t.CALL_RINGING=r+"RINGING",t.SESSION_PROGRESS=r+"SESSION_PROGRESS",t.CALL_CANCELLED=r+"CANCELLED",t.ANSWER_CALL=r+"ANSWER",t.ANSWER_CALL_FINISH=r+"ANSWER_FINISH",t.REJECT_CALL=r+"REJECT",t.REJECT_CALL_FINISH=r+"REJECT_FINISH",t.IGNORE_CALL=r+"IGNORE",t.IGNORE_CALL_FINISH=r+"IGNORE_FINISH",t.CALL_ACCEPTED=r+"ACCEPTED",t.END_CALL=r+"END",t.END_CALL_FINISH=r+"END_FINISH",t.FORWARD_CALL=r+"FORWARD_CALL",t.FORWARD_CALL_FINISH=r+"FORWARD_CALL_FINISH",t.PENDING_OPERATION=r+"PENDING_OPERATION",t.UPDATE_CALL=r+"UPDATE_CALL",t.CALL_HOLD=r+"HOLD",t.CALL_HOLD_FINISH=r+"HOLD_FINISH",t.CALL_UNHOLD=r+"UNHOLD",t.CALL_UNHOLD_FINISH=r+"UNHOLD_FINISH",t.SET_CUSTOM_PARAMETERS=r+"SET_CUSTOM_PARAMETERS",t.SEND_CUSTOM_PARAMETERS=r+"SEND_CUSTOM_PARAMETERS",t.SEND_CUSTOM_PARAMETERS_FINISH=r+"SEND_CUSTOM_PARAMETERS_FINISH",t.ADD_MEDIA=r+"ADD_MEDIA",t.ADD_MEDIA_FINISH=r+"ADD_MEDIA_FINISH",t.ADD_BASIC_MEDIA=r+"ADD_BASIC_MEDIA",t.REMOVE_MEDIA=r+"REMOVE_MEDIA",t.REMOVE_MEDIA_FINISH=r+"REMOVE_MEDIA_FINISH",t.REMOVE_BASIC_MEDIA=r+"REMOVE_BASIC_MEDIA",t.MUSIC_ON_HOLD=r+"MUSIC_ON_HOLD",t.SEND_DTMF=r+"SEND_DTMF",t.SEND_DTMF_FINISH=r+"SEND_DTMF_FINISH",t.GET_STATS=r+"GET_STATS",t.GET_STATS_FINISH=r+"GET_STATS_FINISH",t.CONSULTATIVE_TRANSFER=r+"CONSULTATIVE_TRANSFER",t.PENDING_CONSULTATIVE_TRANSFER=r+"PENDING_CONSULTATIVE_TRANSFER",t.CONSULTATIVE_TRANSFER_FINISH=r+"CONSULTATIVE_TRANSFER_FINISH",t.DIRECT_TRANSFER=r+"DIRECT_TRANSFER",t.DIRECT_TRANSFER_FINISH=r+"DIRECT_TRANSFER_FINISH",t.JOIN=r+"JOIN",t.JOIN_START=r+"JOIN_START",t.PENDING_JOIN=r+"PENDING_JOIN",t.JOIN_FINISH=r+"JOIN_FINISH",t.REPLACE_TRACK=r+"REPLACE_TRACK",t.REPLACE_TRACK_FINISH=r+"REPLACE_TRACK_FINISH",t.MEDIA_RESTART=r+"MEDIA_RESTART",t.MEDIA_RESTART_FINISH=r+"MEDIA_RESTART_FINISH",t.RESYNC=r+"RESYNC",t.RESYNC_FINISH=r+"RESYNC_FINISH",t.PLAY_AUDIO=r+"PLAY_AUDIO",t.PENDING_PLAY_AUDIO=r+"PENDING_PLAY_AUDIO",t.PLAY_AUDIO_FINISH=r+"PLAY_AUDIO_FINISH",t.CUSTOM_PARAMETERS_RECEIVED=r+"CUSTOM_PARAMETERS_RECEIVED",t.GET_AVAILABLE_CODECS=r+"GET_AVAILABLE_CODECS",t.AVAILABLE_CODECS_RETRIEVED=r+"AVAILABLE_CODECS_RETRIEVED",t.OPERATION_UPDATE=r+"OPERATION_UPDATE",t.CALL_REMOTE_HOLD_FINISH=r+"REMOTE_HOLD_FINISH",t.CALL_REMOTE_UNHOLD_FINISH=r+"REMOTE_UNHOLD_FINISH",t.REMOTE_ADD_MEDIA_FINISH=r+"REMOTE_ADD_MEDIA_FINISH",t.REMOTE_REMOVE_MEDIA_FINISH=r+"REMOTE_REMOVE_MEDIA_FINISH",t.REMOTE_START_MOH_FINISH=r+"REMOTE_START_MOH_FINISH",t.REMOTE_STOP_MOH_FINISH=r+"REMOTE_STOP_MOH_FINISH",t.REMOTE_SLOW_START=r+"REMOTE_SLOW_START",r+"TURN/"),o=(t.TURN_CHANGED=n+"CHANGED",r+"TRACK/");t.TRACK_ADDED=o+"ADDED",t.TRACK_REMOVED=o+"REMOVED"},50527:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addBasicMedia=function(e,t){return c(a.ADD_BASIC_MEDIA,e,t)},t.addMedia=function(e,t){return c(a.ADD_MEDIA,e,t)},t.addMediaFinish=function(e,t){return c(a.ADD_MEDIA_FINISH,e,t)},t.answerCall=function(e,t){return c(a.ANSWER_CALL,e,t)},t.answerCallFinish=function(e,t,r){return c(a.ANSWER_CALL_FINISH,e,t,r)},t.availableCodecsRetrieved=function(e){const t={type:a.AVAILABLE_CODECS_RETRIEVED,payload:{...e}};return e.error&&(t.error=!0),t},t.callAccepted=function(e,t){return c(a.CALL_ACCEPTED,e,t)},t.callActionHelper=c,t.callCancelled=function(e,t){return c(a.CALL_CANCELLED,e,t)},t.callIncoming=function(e,t){return c(a.CALL_INCOMING,e,t)},t.callRinging=function(e,t){return c(a.CALL_RINGING,e,t)},t.consultativeTransfer=function(e,t){return c(a.CONSULTATIVE_TRANSFER,e,t)},t.consultativeTransferFinish=function(e,t){return c(a.CONSULTATIVE_TRANSFER_FINISH,e,t)},t.customParametersReceived=function(e,t){return c(a.CUSTOM_PARAMETERS_RECEIVED,e,t)},t.directTransfer=function(e,t){return c(a.DIRECT_TRANSFER,e,t)},t.directTransferFinish=function(e,t){return c(a.DIRECT_TRANSFER_FINISH,e,t)},t.endCall=function(e,t){return c(a.END_CALL,e,t)},t.endCallFinish=function(e,t){return c(a.END_CALL_FINISH,e,t)},t.forwardCall=function(e,t){return c(a.FORWARD_CALL,e,t)},t.forwardCallFinish=function(e,t){return c(a.FORWARD_CALL_FINISH,e,t)},t.getAvailableCodecs=function(e,t){return{type:a.GET_AVAILABLE_CODECS,payload:{...e},meta:{deferred:t}}},t.getStats=function(e,t,r){return{type:a.GET_STATS,payload:{...t,id:e},meta:{deferred:r}}},t.getStatsFinish=function(e,t){return c(a.GET_STATS_FINISH,e,t)},t.holdCall=function(e,t){return c(a.CALL_HOLD,e,t)},t.holdCallFinish=function(e,t){return c(a.CALL_HOLD_FINISH,e,t)},t.ignoreCall=function(e,t){return c(a.IGNORE_CALL,e,t)},t.ignoreCallFinish=function(e,t){return c(a.IGNORE_CALL_FINISH,e,t)},t.join=function(e,t){return c(a.JOIN,e,t)},t.joinFinish=function(e,t){return c(a.JOIN_FINISH,e,t)},t.joinStart=function(e,t){return c(a.JOIN_START,e,t)},t.makeAnonymousCall=function(e,t){return{type:a.MAKE_ANONYMOUS_CALL,payload:{id:e,callee:t.callee,credentials:t.credentials,mediaConstraints:t.mediaConstraints,callOptions:t.callOptions}}},t.makeAnonymousCallFinish=function(e,t){return c(a.MAKE_ANONYMOUS_CALL_FINISH,e,t)},t.makeCall=function(e,t){return c(a.MAKE_CALL,e,t)},t.makeCallFinish=function(e,t){return c(a.MAKE_CALL_FINISH,e,t)},t.operationUpdate=function(e,t,r,n){let{transition:o,operationData:i,eventId:s,isBlocking:c,operationId:l}=n;return{type:a.OPERATION_UPDATE,payload:{id:e,operation:t,operationId:l,transition:o,operationData:i,eventId:s,isLocal:r,isBlocking:c}}},t.pendingConsultativeTransfer=function(e,t){return c(a.PENDING_CONSULTATIVE_TRANSFER,e,t)},t.pendingJoin=function(e,t){return c(a.PENDING_JOIN,e,t)},t.pendingMakeCall=function(e,t){return c(a.PENDING_MAKE_CALL,e,t)},t.pendingOperation=function(e,t){return c(a.PENDING_OPERATION,e,t)},t.playAudio=function(e,t){return{type:a.PLAY_AUDIO,payload:{id:e,filePath:t}}},t.playAudioFinish=function(e,t){return{type:a.PLAY_AUDIO_FINISH,payload:{id:e,error:t},error:void 0!==t}},t.playAudioPending=function(e){return{type:a.PENDING_PLAY_AUDIO,payload:{id:e}}},t.rejectCall=function(e,t){return c(a.REJECT_CALL,e,t)},t.rejectCallFinish=function(e,t){return c(a.REJECT_CALL_FINISH,e,t)},t.remoteAddMediaFinish=function(e,t){return c(a.REMOTE_ADD_MEDIA_FINISH,e,t)},t.remoteHoldFinish=function(e,t){return c(a.CALL_REMOTE_HOLD_FINISH,e,t)},t.remoteRemoveMediaFinish=function(e,t){return c(a.REMOTE_REMOVE_MEDIA_FINISH,e,t)},t.remoteSlowStart=function(e,t){return c(a.REMOTE_SLOW_START,e,t)},t.remoteStartMohFinish=function(e,t){return c(a.REMOTE_START_MOH_FINISH,e,t)},t.remoteStopMohFinish=function(e,t){return c(a.REMOTE_STOP_MOH_FINISH,e,t)},t.remoteUnholdFinish=function(e,t){return c(a.CALL_REMOTE_UNHOLD_FINISH,e,t)},t.removeBasicMedia=function(e,t){return c(a.REMOVE_BASIC_MEDIA,e,t)},t.removeMedia=function(e,t){return c(a.REMOVE_MEDIA,e,t)},t.removeMediaFinish=function(e,t){return c(a.REMOVE_MEDIA_FINISH,e,t)},t.replaceTrack=function(e,t){return c(a.REPLACE_TRACK,e,t)},t.replaceTrackFinish=function(e,t){return c(a.REPLACE_TRACK_FINISH,e,t)},t.restartMedia=function(e,t){return c(a.MEDIA_RESTART,e,t)},t.restartMediaFinish=function(e,t){return c(a.MEDIA_RESTART_FINISH,e,t)},t.resync=function(e,t){return c(a.RESYNC,e,t)},t.resyncFinish=function(e,t){return c(a.RESYNC_FINISH,e,t)},t.sendCustomParameters=function(e,t){return c(a.SEND_CUSTOM_PARAMETERS,e,t)},t.sendCustomParametersFinish=function(e,t){return c(a.SEND_CUSTOM_PARAMETERS_FINISH,e,t)},t.sendDTMF=function(e,t){return c(a.SEND_DTMF,e,t)},t.sendDTMFFinish=function(e,t){return c(a.SEND_DTMF_FINISH,e,t)},t.sendRingingFeedback=function(e){return c(a.SEND_RINGING_FEEDBACK,e)},t.sendRingingFeedbackFinish=function(e,t){return c(a.SEND_RINGING_FEEDBACK_FINISH,e,t)},t.sessionCreated=function(e,t){return c(a.SESSION_CREATED,e,t)},t.sessionProgress=function(e,t){return c(a.SESSION_PROGRESS,e,t)},t.setCustomParameters=function(e,t){return{type:a.SET_CUSTOM_PARAMETERS,payload:{id:e,customParameters:(0,n.default)(t)?t.customParameters:t,customBodies:(0,n.default)(t)?t.customBodies:void 0}}},t.unholdCall=function(e,t){return c(a.CALL_UNHOLD,e,t)},t.unholdCallFinish=function(e,t){return c(a.CALL_UNHOLD_FINISH,e,t)},t.updateCall=function(e,t){return c(a.UPDATE_CALL,e,t)};var n=s(r(36705)),o=s(r(84499)),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(21836));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a={type:e,payload:{...r,id:t}};return(0,o.default)(n)||(a.meta=n),r.error&&(a.error=!0),a}},35:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.turnActions=t.callActions=void 0;var n=i(r(50527)),o=i(r(7604));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}t.callActions=n,t.turnActions=o},7604:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.turnChanged=function(e){let{credentials:t}=e;return{type:n.TURN_CHANGED,payload:{credentials:t}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(21836));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},10776:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{CallManager:t,context:r,logManager:l,API_LOG_TAG:u,emitEvent:d}=e,f=l.getLogger("CALL");return{directTransfer:async function(e,c){f.debug(u+"call.directTransfer: ",e,c),(0,o.getOptions)(r.getState()).normalizeDestination&&(c=(0,s.normalizeSipUri)(c,(0,i.getDomain)(r.getState())),f.info("Address normalized to: ",c)),r.dispatch(n.callActions.directTransfer(e,{destination:c}));try{await t.directTransfer(e,c)}catch(t){r.dispatch(n.callActions.directTransferFinish(e,{error:t}));const i=(0,o.getCallById)(r.getState(),e);d(a.CALL_STATE_CHANGE,{callId:e,previous:{state:i?i.state:void 0,localHold:i?i.localHold:void 0,remoteHold:i?i.remoteHold:void 0},error:t})}},consultativeTransfer:async function(e,i){let s;f.debug(u+"call.consultativeTransfer: ",e,i),r.dispatch(n.callActions.consultativeTransfer(e,{otherCallId:i}));try{const r=[{id:e,role:"primary"},{id:i,role:"secondary"}];await t.consultativeTransfer(r)}catch(t){s=t,r.dispatch(n.callActions.consultativeTransferFinish(e,{otherCallId:i,error:s}));const c=(0,o.getCallById)(r.getState(),e);d(a.CALL_STATE_CHANGE,{callId:e,previous:{state:c?c.state:void 0,localHold:c?c.localHold:void 0,remoteHold:c?c.remoteHold:void 0},error:s})}},join:async function(e,s){f.debug(u+"call.join: ",e,s);const l=(0,c.v4)(),p=(0,i.getUserInfo)(r.getState()).username;let g;r.dispatch(n.callActions.join(e,{otherCallId:s,newCallId:l,from:p}));try{const r=[{id:e,role:"primary"},{id:s,role:"secondary"},{id:l,role:"joined"}];await t.join(r,p)}catch(t){g=t,r.dispatch(n.callActions.joinFinish(e,{usedCallIds:[e,s],error:g}));const i=(0,o.getCallById)(r.getState(),e);d(a.CALL_STATE_CHANGE,{callId:e,previous:{state:i?i.state:void 0,localHold:i?i.localHold:void 0,remoteHold:i?i.remoteHold:void 0},error:g})}}}};var n=r(35),o=r(40481),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),i=r(87075),s=r(89968),c=r(84596);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}},14649:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{states:o.CALL_STATES,mediaConnectionStates:o.CALL_MEDIA_CONNECTION_STATES,reportEvents:n.REPORT_EVENTS,metrics:n.REPORT_METRICS}};var n=r(84581),o=r(77126)},68343:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{CallManager:t,context:r,logManager:d,API_LOG_TAG:f,emitEvent:p}=e,g=d.getLogger("CALL");return{make:function(e,d){let E=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};g.debug(f+"call.make: ",e,d,E);const _=(0,u.v4)(),y={to:e,from:(0,s.getUserInfo)(r.getState()).username},v=(0,c.formatMediaConstraints)(d);return(0,o.getOptions)(r.getState()).normalizeDestination&&y.to&&"string"==typeof y.to&&(y.to=(0,l.normalizeSipUri)(y.to,(0,s.getDomain)(r.getState())),g.info(`Address normalized to: ${y.to}`)),r.dispatch(n.callActions.makeCall(_,{participantAddress:y.to,from:y.from,mediaConstraints:v,...E})),setTimeout((async()=>{p(a.CALL_STARTED,{callId:_});try{await t.make(_,y,v,E),p(a.CALL_STATE_CHANGE,{callId:_,previous:{state:i.CALL_STATES.INITIATING,localHold:!1,remoteHold:!1}})}catch(e){r.dispatch(n.callActions.makeCallFinish(_,{state:i.CALL_STATES.ENDED,error:e})),p(a.CALL_STATE_CHANGE,{callId:_,previous:{state:i.CALL_STATES.INITIATING,localHold:!1,remoteHold:!1},error:e})}}),0),_},answer:async function(e,i){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};g.debug(f+"call.answer: ",e,i,s);try{const a=(0,c.formatMediaConstraints)(i);r.dispatch(n.callActions.answerCall(e,{mediaConstraints:a,...s}));const l=(0,o.getCallById)(r.getState(),e);l&&l.isSlowStart?await t.answerSlow(e,a,s):await t.answer(e,a,s)}catch(t){r.dispatch(n.callActions.answerCallFinish(e,{error:t}));const i=(0,o.getCallById)(r.getState(),e);p(a.CALL_STATE_CHANGE,{callId:e,previous:{state:i?i.state:void 0,localHold:i?i.localHold:void 0,remoteHold:i?i.remoteHold:void 0},error:t})}},reject:async function(e){let i;g.debug(f+"call.reject: ",e),r.dispatch(n.callActions.rejectCall(e));try{await t.reject(e)}catch(e){i=e}r.dispatch(n.callActions.rejectCallFinish(e,{error:i}));const s=(0,o.getCallById)(r.getState(),e);p(a.CALL_STATE_CHANGE,{callId:e,previous:{state:s?s.state:void 0,localHold:s?s.localHold:void 0,remoteHold:s?s.remoteHold:void 0},error:i})},ignore:async function(e){let i;g.debug(f+"call.ignore: ",e),r.dispatch(n.callActions.ignoreCall(e));try{await t.ignore(e)}catch(e){i=e}r.dispatch(n.callActions.ignoreCallFinish(e,{error:i}));const s=(0,o.getCallById)(r.getState(),e);p(a.CALL_STATE_CHANGE,{callId:e,previous:{state:s?s.state:void 0,localHold:s?s.localHold:void 0,remoteHold:s?s.remoteHold:void 0},error:i})},forward:async function(e,i){let c;g.debug(f+"call.forward: ",i),(0,o.getOptions)(r.getState()).normalizeDestination&&(i=(0,l.normalizeSipUri)(i,(0,s.getDomain)(r.getState())),g.info("Address normalized to: ",i)),r.dispatch(n.callActions.forwardCall(e,{destination:i}));try{await t.forward(e,i)}catch(e){c=e}r.dispatch(n.callActions.forwardCallFinish(e,{error:c}));const u=(0,o.getCallById)(r.getState(),e);p(a.CALL_STATE_CHANGE,{callId:e,previous:{state:u?u.state:void 0,localHold:u?u.localHold:void 0,remoteHold:u?u.remoteHold:void 0},error:c})},end:async function(e){let i;g.debug(f+"call.end: ",e),r.dispatch(n.callActions.endCall(e));try{await t.end(e)}catch(e){i=e,g.info(`call.end error: ${i.message}`)}finally{const t=(0,o.getCallById)(r.getState(),e);r.dispatch(n.callActions.endCallFinish(e,{isLocal:!0,error:i})),p(a.CALL_STATE_CHANGE,{callId:e,previous:{state:t?t.state:void 0,localHold:t?t.localHold:void 0,remoteHold:t?t.remoteHold:void 0},error:i})}}}};var n=r(35),o=r(40481),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),i=r(77126),s=r(87075),c=r(9066),l=r(89968),u=r(84596);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}},6836:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{call:{...(0,n.default)(e),...(0,o.default)(e),...(0,a.default)(e),...(0,i.default)(e),...(0,s.default)(e)}}};var n=c(r(68343)),o=c(r(66342)),a=c(r(10776)),i=c(r(3478)),s=c(r(14649));function c(e){return e&&e.__esModule?e:{default:e}}},66342:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{CallManager:t,context:r,logManager:n,API_LOG_TAG:u,emitEvent:d}=e,f=n.getLogger("CALL");return{hold:async function(e){f.debug(u+"call.hold: ",e),r.dispatch(a.callActions.holdCall(e));const n=(0,s.getCallById)(r.getState(),e);let o;try{await t.hold(e)}catch(t){o=t,r.dispatch(a.callActions.holdCallFinish(e,{local:!0,error:o})),d(i.CALL_STATE_CHANGE,{callId:e,previous:{state:n?n.state:void 0,localHold:n?n.localHold:void 0,remoteHold:n?n.remoteHold:void 0},error:o})}},unhold:async function(e){f.debug(u+"call.unhold: ",e),r.dispatch(a.callActions.unholdCall(e));const n=(0,s.getCallById)(r.getState(),e);let o;try{await t.unhold(e)}catch(t){o=t,r.dispatch(a.callActions.unholdCallFinish(e,{local:!0,error:o})),d(i.CALL_STATE_CHANGE,{callId:e,previous:{state:n?n.state:void 0,localHold:n?n.localHold:void 0,remoteHold:n?n.remoteHold:void 0},error:o})}},addMedia:async function(e){let n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};f.debug(u+"call.addMedia: ",e,o,s);try{const n=(0,c.formatMediaConstraints)(o);r.dispatch(a.callActions.addMedia(e,{mediaConstraints:n,...s})),await t.addMedia(e,n,s)}catch(t){n=t,r.dispatch(a.callActions.addMediaFinish(e,{local:!0,error:n})),d(i.CALL_ADDED_MEDIA,{callId:e,local:!0,error:n})}},removeMedia:async function(e,n){let o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};f.debug(u+"call.removeMedia: ",e,n),r.dispatch(a.callActions.removeMedia(e,{tracks:n,...s}));try{await t.removeMedia(e,n,s)}catch(t){o=t,r.dispatch(a.callActions.removeMediaFinish(e,{local:!0,error:o})),d(i.CALL_REMOVED_MEDIA,{callId:e,local:!0,error:o})}},startVideo:async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};f.debug(u+"call.startVideo: ",e,s);const c={audio:!1,video:!!(0,o.default)(n)||n,screen:!1},l=a.callActions.addBasicMedia(e,{mediaConstraints:c,kind:"video",...s});let p;r.dispatch(l);try{await t.addBasicMedia(e,c,s)}catch(t){p=t,r.dispatch(a.callActions.addMediaFinish(e,{local:!0,error:p})),d(i.CALL_ADDED_MEDIA,{callId:e,local:!0,error:p})}},stopVideo:async function(e){f.debug(u+"call.stopVideo: ",e),r.dispatch(a.callActions.removeBasicMedia(e,{kind:"video"}));const n=(0,l.getLocalTracks)(r,e,"video").map((e=>e.trackId));let o;try{await t.removeBasicMedia(e,n)}catch(t){o=t,r.dispatch(a.callActions.removeMediaFinish(e,{local:!0,error:o})),d(i.CALL_REMOVED_MEDIA,{callId:e,local:!0,error:o})}},replaceTrack:async function(e,n,o){let s;f.debug(u+"call.replaceTrack: ",e,n,o);let l={};try{const i=(0,c.formatMediaConstraints)(o);r.dispatch(a.callActions.replaceTrack(e,{trackId:n,mediaConstraints:i})),l=await t.replaceTrack(e,n,i)}catch(e){s=e}r.dispatch(a.callActions.replaceTrackFinish(e,{...l,error:s})),d(i.CALL_TRACK_REPLACED,{callId:e,newTrackId:s?void 0:l.newTrackId,oldTrack:s?void 0:l.oldTrackState,error:s})},restartMedia:async function(e){f.debug(`${u}call.restartMedia, callId: ${e}`),r.dispatch(a.callActions.restartMedia(e));try{await t.iceRestart(e)}catch(t){r.dispatch(a.callActions.restartMediaFinish(e,{local:!0,error:t})),d(i.MEDIA_RESTART,{callId:e,error:t})}},resync:async function(e){let n;f.debug(`${u}call.resync, callId: ${e}`),r.dispatch(a.callActions.resync(e));try{await t.resyncCallState(e)}catch(e){n=e}r.dispatch(a.callActions.resyncFinish(e,{error:n}))},playAudioFile:function(e,n){let o;f.debug(`${u}call.playAudioFile`,n);const i=new Promise(((i,s)=>{r.dispatch(a.callActions.playAudio(e,n)),t.playAudioFile(e,n,(function(e){o&&"function"==typeof o&&o(e)})).then((()=>{r.dispatch(a.callActions.playAudioFinish(e)),i()})).catch((t=>{r.dispatch(a.callActions.playAudioFinish(e,t)),s(t)}))}));return i.onPlaying=e=>(o=e,i),i}}};var n,o=(n=r(84499))&&n.__esModule?n:{default:n},a=r(35),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),s=r(40481),c=r(9066),l=r(69752);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}},3478:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,CallManager:r,Callstack:s,CallReporter:c,emitEvent:l,logManager:u,API_LOG_TAG:d}=e,f=u.getLogger("CALL");return{getAll:function(){return f.debug(d+"call.getAll"),(0,n.getCalls)(t.getState())},getById:function(e){return f.debug(d+"call.getById: ",e),(0,n.getCallById)(t.getState(),e)},sendRingingFeedback:async function(e){f.debug(d+"call.sendRingingFeedback: ",e),t.dispatch(o.callActions.sendRingingFeedback(e));const i=(0,n.getCallById)(t.getState(),e);let s;try{await r.sendRingingFeedback(e)}catch(e){s=e}t.dispatch(o.callActions.sendRingingFeedbackFinish(e,{error:s})),l(a.CALL_STATE_CHANGE,{callId:e,previous:{state:i?i.state:void 0,localHold:i?i.localHold:void 0,remoteHold:i?i.remoteHold:void 0},error:s})},setCustomParameters:async function(e,r){f.debug(d+"call.setCustomParameters: ",e,r),t.dispatch(o.callActions.setCustomParameters(e,r))},sendCustomParameters:async function(e){let n;f.debug(d+"call.sendCustomParameters: ",e),t.dispatch(o.callActions.sendCustomParameters(e));try{await r.sendCustomParameters(e)}catch(e){n=e}t.dispatch(o.callActions.sendCustomParametersFinish(e,{error:n}))},sendDTMF:async function(e,n){let a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:70;f.debug(d+"call.sendDTMF: ",e,n,i,s),"number"==typeof n&&(n+=""),t.dispatch(o.callActions.sendDTMF(e,{tone:n,duration:i,intertoneGap:s}));try{await r.sendDtmf(e,n,{duration:i,intertoneGap:s})}catch(e){a=e}t.dispatch(o.callActions.sendDTMFFinish(e,{error:a}))},getStats:async function(e,n){let i,s;f.debug(d+"call.getStats: ",e,n),t.dispatch(o.callActions.getStats(e,{trackId:n}));try{i=await r.getStats(e,n)}catch(e){throw s=e,s}finally{t.dispatch(o.callActions.getStatsFinish(e,{error:s,result:i,trackId:n})),l(a.STATS_RECEIVED,{callId:e,result:i,trackId:n,error:s})}return i},getReport:function(e){f.debug(d+"call.getReport: ",e);const t=c.getReport(e);return t?t.getSerializable():t},getAvailableCodecs:async function(e){let r;f.debug(`${d}call.getAvailableCodecs, kind: ${e}`),t.dispatch(o.callActions.getAvailableCodecs({kind:e},{promise:{}}));try{r=await s.operations.getAvailableCodecs(e),t.dispatch(o.callActions.availableCodecsRetrieved({kind:e,codecs:r})),l(a.AVAILABLE_CODECS,{kind:e,codecs:r})}catch(e){return f.debug("Failed to retrieve codecs: ",e.message),await Promise.reject(new Error(e.message))}return await Promise.resolve(r)},setSdpHandlers:function(e){f.debug(`${d}call.setSdpHandlers, sdpHandlers:`,e),t.dispatch((0,i.setSdpHandlers)(e))}}},r(97107);var n=r(40481),o=r(35),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51918)),i=r(87310);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},59090:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OP_TRANSITIONS=t.OP_STATUS=t.OPERATIONS=t.NO_FINISH_OPS=t.ENDPOINTS=void 0;const r=t.OPERATIONS={MAKE:"MAKE",MAKE_ANONYMOUS:"MAKE_ANONYMOUS",ANSWER:"ANSWER",SLOW_ANSWER:"SLOW_ANSWER",REJECT:"REJECT",IGNORE:"IGNORE",END:"END",SEND_RINGING_FEEDBACK:"SEND_RINGING_FEEDBACK",FORWARD_CALL:"FORWARD_CALL",HOLD:"HOLD",UNHOLD:"UNHOLD",SEND_CUSTOM_PARAMETERS:"SEND_CUSTOM_PARAMETERS",ADD_MEDIA:"ADD_MEDIA",ADD_BASIC_MEDIA:"ADD_BASIC_MEDIA",REMOVE_MEDIA:"REMOVE_MEDIA",REMOVE_BASIC_MEDIA:"REMOVE_BASIC_MEDIA",GET_STATS:"GET_STATS",SEND_DTMF:"SEND_DTMF",CONSULTATIVE_TRANSFER:"CONSULTATIVE_TRANSFER",DIRECT_TRANSFER:"DIRECT_TRANSFER",JOIN:"JOIN",REPLACE_TRACK:"REPLACE_TRACK",MEDIA_RESTART:"MEDIA_RESTART",RESYNC:"RESYNC",PLAY_AUDIO:"PLAY_AUDIO",GET_AVAILABLE_CODECS:"GET_AVAILABLE_CODECS",START_MOH:"START_MOH",STOP_MOH:"STOP_MOH",SLOW_START:"SLOW_START",GENERIC_REMOTE:"GENERIC_REMOTE",CALL_CANCEL:"CALL_CANCEL"};t.ENDPOINTS={LOCAL:"LOCAL",REMOTE:"REMOTE"},t.OP_STATUS={NOT_STARTED:"NOT_STARTED",ONGOING:"ONGOING",PENDING:"PENDING",RESOLVING:"RESOLVING",FINISHED:"FINISHED"},t.OP_TRANSITIONS={START:"START",UPDATE:"UPDATE",RESUME:"RESUME",FINISH:"FINISH"},t.NO_FINISH_OPS=[r.ADD_BASIC_MEDIA,r.REMOVE_BASIC_MEDIA,r.GET_AVAILABLE_CODECS,r.MAKE_ANONYMOUS]},51918:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STATS_RECEIVED=t.MEDIA_RESTART=t.MEDIA_CONNECTION_CHANGE=t.CUSTOM_PARAMETERS=t.CALL_TRACK_REPLACED=t.CALL_TRACKS_REMOVED=t.CALL_TRACKS_ADDED=t.CALL_STATE_CHANGE=t.CALL_STARTED=t.CALL_REMOVED_MEDIA=t.CALL_OPERATION=t.CALL_JOIN=t.CALL_INCOMING=t.CALL_ADDED_MEDIA=t.AVAILABLE_CODECS=void 0,t.CALL_OPERATION="call:operation",t.CALL_STARTED="call:start",t.CALL_JOIN="call:join",t.CALL_INCOMING="call:receive",t.CALL_STATE_CHANGE="call:stateChange",t.CALL_ADDED_MEDIA="call:newMedia",t.CALL_REMOVED_MEDIA="call:removedMedia",t.CALL_TRACKS_ADDED="call:tracksAdded",t.CALL_TRACKS_REMOVED="call:tracksRemoved",t.STATS_RECEIVED="call:statsReceived",t.CALL_TRACK_REPLACED="call:trackReplaced",t.CUSTOM_PARAMETERS="call:customParameters",t.AVAILABLE_CODECS="call:availableCodecs",t.MEDIA_CONNECTION_CHANGE="call:mediaConnectionChange",t.MEDIA_RESTART="call:mediaRestart"},9647:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(6836)),o=a(r(88401));function a(e){return e&&e.__esModule?e:{default:e}}t.default={name:"call",createAPI:n.default,reducer:o.default}},41905:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(62234);var n=p(r(43813)),o=p(r(35968)),a=f(r(21836)),i=f(r(81997)),s=r(77126),c=r(59090),l=p(r(48475)),u=r(45775);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function p(e){return e&&e.__esModule?e:{default:e}}const g=(e,t)=>e,E=(e,t)=>{const r=Date.now();return{...e,state:s.CALL_STATES.ENDED,startTime:e.startTime||r,endTime:r,remoteParticipant:{...e.remoteParticipant,...t.payload.remoteParticipant},mediaConnectionState:"closed",isPending:void 0,localTracks:[],remoteTracks:[]}},_={},y={};_[a.MAKE_CALL]={next(e,t){const r={id:t.payload.id,remoteParticipant:{displayNumber:t.payload.participantAddress,displayName:t.payload.participantName},to:t.payload.participantAddress,from:t.payload.from,mediaConstraints:t.payload.mediaConstraints,dscpControls:t.payload.dscpControls,state:s.CALL_STATES.INITIATING,direction:s.CALL_DIRECTION.OUTGOING,localHold:!1,remoteHold:!1,isCaller:!0,isAnonymous:t.payload.isAnonymous,account:t.payload.account,localTracks:[],remoteTracks:[],currentOperations:[]};return(0,o.default)(e,r)}},_[a.CALL_INCOMING]={next:(e,t)=>(0,o.default)(e,{...t.payload,direction:"incoming",isCaller:!1,state:s.CALL_STATES.INITIATING,localHold:!1,remoteHold:!1,localTracks:[],remoteTracks:[],currentOperations:[]})},y[a.SEND_RINGING_FEEDBACK_FINISH]={next:(e,t)=>({...e,state:s.CALL_STATES.RINGING})},y[a.CALL_RINGING]={next:(e,t)=>t.payload.remoteParticipant?{...e,state:s.CALL_STATES.RINGING,remoteParticipant:t.payload.remoteParticipant}:{...e,state:s.CALL_STATES.RINGING}},y[a.SESSION_PROGRESS]={next:(e,t)=>({...e,state:s.CALL_STATES.EARLY_MEDIA,remoteParticipant:t.payload.remoteParticipant,remoteTracks:t.payload.remoteTracks})},y[a.PENDING_OPERATION]=g,y[a.REMOTE_SLOW_START]=g;const v=(e,t)=>({...e,isHandling:!0});y[a.ANSWER_CALL]=v,y[a.REJECT_CALL]=v,y[a.FORWARD_CALL]=v,y[a.CALL_CANCELLED]={next:(e,t)=>({...e,state:s.CALL_STATES.CANCELLED})},y[a.IGNORE_CALL_FINISH]={next:(e,t)=>{const r=Date.now();return{...e,startTime:r,endTime:r,state:s.CALL_STATES.ENDED}},throw:(e,t)=>e},y[a.REJECT_CALL_FINISH]={next:(e,t)=>{const r=Date.now(),n={...e,startTime:r,endTime:r,state:s.CALL_STATES.ENDED};return delete n.isHandling,n},throw:(e,t)=>e},y[a.SESSION_CREATED]={next:(e,t)=>({...e,webrtcSessionId:t.payload.webrtcSessionId})},y[a.PENDING_MAKE_CALL]={next:(e,t)=>({...e,state:s.CALL_STATES.INITIATED,wrtcsSessionId:t.payload.wrtcsSessionId,webrtcSessionId:t.payload.webrtcSessionId,bandwidth:t.payload.bandwidth,displayName:t.payload.displayName,customParameters:t.payload.customParameters,customBodies:t.payload.customBodies,localTracks:t.payload.localTracks})},y[a.MAKE_CALL_FINISH]={next:(e,t)=>({...e,...t.payload}),throw:(e,t)=>({...e,...t.payload})},y[a.MAKE_ANONYMOUS_CALL_FINISH]={next:(e,t)=>e,throw:E},y[a.ANSWER_CALL_FINISH]={next(e,t){const r=t.payload.webrtcSessionId||e.webrtcSessionId,n={...e,state:t.payload.state,mediaConstraints:t.payload.mediaConstraints,dscpControls:t.payload.dscpControls,webrtcSessionId:r,localHold:!1,remoteHold:!1,bandwidth:t.payload.bandwidth,customParameters:t.payload.customParameters,customBodies:t.payload.customBodies,localTracks:t.payload.localTracks,remoteTracks:t.payload.remoteTracks};return t.meta&&!t.meta.isSlowStart&&(n.startTime=t.payload.startTime),n.state===s.CALL_STATES.CONNECTED&&delete n.isHandling,n},throw(e,t){const r={...e,...t.payload};return delete r.isHandling,r}},y[a.CALL_ACCEPTED]={next(e,t){const r={...e,...t.payload};return r.isHandling&&r.state===s.CALL_STATES.CONNECTED&&delete r.isHandling,r},throw(e,t){const r=t.payload.state||e.state;return{...e,state:r}}},y[a.END_CALL_FINISH]=E,y[a.UPDATE_CALL]={next(e,t){const{transition:r,localTracks:n,remoteTracks:o,...a}=t.payload,i={...e,...a};if(o&&o.length>0&&(i.remoteTracks=o),t.meta&&!0===t.meta.isRemote){const e=i.currentOperations.find((e=>!e.isLocal&&e.type===c.OPERATIONS.SLOW_START&&e.status===c.OP_STATUS.ONGOING));e&&(i.currentOperations=i.currentOperations.filter((t=>t.id!==e.id)))}return i}},y[a.CALL_HOLD_FINISH]={next(e,t){const r=t.payload.remoteTracks,n=e.remoteTracks.filter((e=>!r.includes(e))),{localTracks:o}=t.payload,a=e.localTracks.filter((e=>!o.includes(e)));return{...e,localHold:!0,state:s.CALL_STATES.ON_HOLD,localTracks:a,remoteTracks:n}}},y[a.CALL_UNHOLD_FINISH]={next(e,t){const r=t.payload.remoteTracks,o=(0,n.default)(e.remoteTracks,r),{localTracks:a}=t.payload,i=(0,n.default)(e.localTracks,a),c=e.remoteHold?s.CALL_STATES.ON_HOLD:s.CALL_STATES.CONNECTED;return{...e,localHold:!1,state:c,localTracks:i,remoteTracks:o}}},y[a.SET_CUSTOM_PARAMETERS]={next:(e,t)=>({...e,customParameters:t.payload.customParameters,customBodies:t.payload.customBodies})},y[a.SEND_CUSTOM_PARAMETERS_FINISH]={next:(e,t)=>({...e,...t.payload})},y[a.CALL_REMOTE_HOLD_FINISH]={next(e,t){const r=t.payload.remoteTracks,n=e.remoteTracks.filter((e=>!r.includes(e))),o=t.payload.localTracks,a=e.localTracks.filter((e=>!o.includes(e)));return{...e,remoteHold:!0,state:s.CALL_STATES.ON_HOLD,remoteParticipant:{...e.remoteParticipant,...t.payload.remoteParticipant},localTracks:a,remoteTracks:n}}},y[a.CALL_REMOTE_UNHOLD_FINISH]={next(e,t){const r=t.payload.remoteTracks,o=t.payload.localTracks,a=(0,n.default)(e.localTracks,o),i=e.localHold?s.CALL_STATES.ON_HOLD:s.CALL_STATES.CONNECTED,c={...e,remoteHold:!1,state:i,remoteParticipant:{...e.remoteParticipant,...t.payload.remoteParticipant},localTracks:a,remoteTracks:r};return!0===c.hasMOH&&(c.hasMOH=!1),c}},y[a.REMOTE_ADD_MEDIA_FINISH]={next(e,t){const r=t.payload.remoteTracks,o=(0,n.default)(e.remoteTracks,r);return{...e,remoteTracks:o}}},y[a.REMOTE_REMOVE_MEDIA_FINISH]={next(e,t){const r=t.payload.remoteTracks,n=e.remoteTracks.filter((e=>!r.includes(e)));return{...e,remoteTracks:n}}},y[a.REMOTE_START_MOH_FINISH]={next(e,t){const r=t.payload.remoteTracks,o=(0,n.default)(e.remoteTracks,r);return{...e,hasMOH:!0,remoteTracks:o}}},y[a.REMOTE_STOP_MOH_FINISH]={next(e,t){const r=t.payload.remoteTracks,n=e.remoteTracks.filter((e=>!r.includes(e)));return{...e,hasMOH:!1,remoteTracks:n}}},y[a.FORWARD_CALL_FINISH]={next(e,t){const r={...e,state:s.CALL_STATES.ENDED};return delete r.isHandling,r}},y[a.DIRECT_TRANSFER_FINISH]={next:E},_[a.CONSULTATIVE_TRANSFER_FINISH]={next:(e,t)=>e.map((e=>e.id===t.payload.id||e.id===t.payload.otherCallId?E(e,t):e)),throw:(e,t)=>e},_[a.JOIN_START]={next(e,t){const r={id:t.payload.id,remoteParticipant:{displayNumber:t.payload.participantAddress,displayName:t.payload.participantName},to:t.payload.participantAddress,from:t.payload.from,mediaConstraints:t.payload.mediaConstraints,state:s.CALL_STATES.INITIATING,direction:s.CALL_DIRECTION.OUTGOING,localHold:!1,remoteHold:!1,isCaller:!0,isJoinedCall:!0,customParameters:t.payload.customParameters,bandwidth:t.payload.bandwidth,dscpControls:t.payload.dscpControls,localTracks:[],remoteTracks:[],currentOperations:[{isLocal:!0,id:t.payload.operationId,type:c.OPERATIONS.JOIN,status:c.OP_STATUS.ONGOING,eventId:t.payload.eventId}]};return(0,o.default)(e,r)}},_[a.PENDING_JOIN]={next:(e,t)=>e.map((e=>e.id===t.payload.id?{...e,wrtcsSessionId:t.payload.wrtcsSessionId,webrtcSessionId:t.payload.webrtcSessionId,localTracks:t.payload.localTracks,state:t.payload.state}:e))},_[a.JOIN_FINISH]={next:(e,t)=>e.map((e=>e.id===t.payload.id||t.payload.usedCallIds&&t.payload.usedCallIds.includes(e.id)?E(e,t):e)),throw:(e,t)=>e.map((e=>e.id===t.payload.id&&t.payload.usedCallIds&&!t.payload.usedCallIds.includes(e.id)?E(e,t):e))},y[a.ADD_MEDIA_FINISH]={next(e,t){const r=t.payload.localTracks;return{...e,bandwidth:t.payload.bandwidth,localTracks:e.localTracks.concat(r)}}},y[a.REMOVE_MEDIA_FINISH]={next(e,t){const r=t.payload.localTracks,n=e.localTracks.filter((e=>!r.includes(e)));return{...e,bandwidth:t.payload.bandwidth,localTracks:n}}},y[a.REPLACE_TRACK_FINISH]={next(e,t){const r=t.payload.oldTrackState.id,n=t.payload.newTrackId,o=e.localTracks.filter((e=>e!==r)).concat(n);return{...e,localTracks:o}}},y[i.SESSION_ICE_CONNECTION_STATE_CHANGE]={next:(e,t)=>({...e,mediaConnectionState:t.payload.iceConnectionState})};const S=(0,u.handleActions)(y,{}),O=(0,u.combineActions)(a.PENDING_OPERATION,a.PENDING_MAKE_CALL,a.MAKE_CALL_FINISH,a.MAKE_ANONYMOUS_CALL_FINISH,a.ANSWER_CALL,a.ANSWER_CALL_FINISH,a.REJECT_CALL,a.REJECT_CALL_FINISH,a.CALL_ACCEPTED,a.SEND_RINGING_FEEDBACK_FINISH,a.CALL_RINGING,a.SESSION_PROGRESS,a.CALL_CANCELLED,a.IGNORE_CALL_FINISH,a.END_CALL_FINISH,a.CALL_HOLD_FINISH,a.CALL_UNHOLD_FINISH,a.SET_CUSTOM_PARAMETERS,a.SEND_CUSTOM_PARAMETERS_FINISH,a.CALL_REMOTE_HOLD_FINISH,a.CALL_REMOTE_UNHOLD_FINISH,a.REMOTE_ADD_MEDIA_FINISH,a.REMOTE_REMOVE_MEDIA_FINISH,a.ADD_MEDIA_FINISH,a.REMOVE_MEDIA_FINISH,a.UPDATE_CALL,a.FORWARD_CALL,a.FORWARD_CALL_FINISH,a.DIRECT_TRANSFER_FINISH,a.REPLACE_TRACK_FINISH,a.MEDIA_RESTART,a.MEDIA_RESTART_FINISH,a.REMOTE_SLOW_START,a.REMOTE_START_MOH_FINISH,a.REMOTE_STOP_MOH_FINISH,a.SESSION_CREATED,a.OPERATION_UPDATE),h=(0,u.combineActions)(i.SESSION_ICE_CONNECTION_STATE_CHANGE);_[O]=(e,t)=>e.map((function(e){if(e.id===t.payload.id){let r=S(e,t);return r=(0,l.default)(r,t),r}return e})),_[h]=(e,t)=>e.map((function(e){return e.webrtcSessionId===t.payload.id?S(e,t):e}));const T=(0,u.handleActions)(_,[]);t.default=T},88401:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return{calls:(0,n.default)(e.calls,t),turn:(0,o.default)(e.turn,t)}};var n=a(r(41905)),o=a(r(92834));function a(e){return e&&e.__esModule?e:{default:e}}},48475:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=l(r(7977)),o=l(r(82549)),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(21836)),i=r(59090),s=r(45775);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}function l(e){return e&&e.__esModule?e:{default:e}}const u={};u[a.OPERATION_UPDATE]={next(e,t){e.currentOperations=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const{transition:r,operationId:n}=t.payload;if(r===i.OP_TRANSITIONS.START){const r={type:t.payload.operation,id:n,status:i.OP_STATUS.ONGOING,eventId:t.payload.eventId,isLocal:t.payload.isLocal,isBlocking:t.payload.isBlocking};return e.concat(r)}return r===i.OP_TRANSITIONS.UPDATE?e.map((e=>e.id===n?{...e,status:i.OP_STATUS.PENDING,operationData:t.payload.operationData}:e)):r===i.OP_TRANSITIONS.RESUME?e.map((e=>e.id===n?{...e,status:i.OP_STATUS.RESOLVING}:e)):r===i.OP_TRANSITIONS.FINISH?e.filter((e=>e.id!==n)):e}(e.currentOperations,t);const r=t.payload.isLocal?"localOp":"remoteOp";if(t.payload.transition===i.OP_TRANSITIONS.START)return e[r]?e:{...e,[r]:{operation:t.payload.operation,status:i.OP_STATUS.ONGOING,eventId:t.payload.eventId}};if(t.payload.transition===i.OP_TRANSITIONS.UPDATE)return{...e,[r]:{...e[r],status:i.OP_STATUS.PENDING,operationData:t.payload.operationData}};if(t.payload.transition===i.OP_TRANSITIONS.FINISH){const a=!t.payload.isLocal,s={...e,[r]:void 0},c=e[r]&&e[r].operation;return(0,n.default)(c)?e:c===t.payload.operation||a&&c===i.OPERATIONS.SLOW_START||(0,o.default)(c)(i.NO_FINISH_OPS)||t.payload.operation===i.OPERATIONS.END?s:e}return e}},u[a.UPDATE_CALL]={next:(e,t)=>e};const d=(0,s.handleActions)(u,{});t.default=d},92834:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(21836)),o=r(45775);function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}const i={};i[n.TURN_CHANGED]={next:(e,t)=>({...e,...t.payload.credentials})};const s=(0,o.handleActions)(i,{});t.default=s},40481:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getActiveCalls=function(e){const t=[n.CALL_STATES.ENDED,n.CALL_STATES.CANCELLED];return o(e).filter((e=>!t.includes(e.state)))},t.getCallById=function(e,t){return o(e).find((e=>e.id===t))},t.getCallByWebrtcSessionId=function(e,t){return o(e).find((e=>e.webrtcSessionId===t))},t.getCallByWrtcsSessionId=function(e,t){return o(e).find((e=>e.wrtcsSessionId===t))},t.getCalls=o,t.getOptions=function(e){return e.config.call},t.getTurnInfo=function(e){return e.call.turn},r(62234);var n=r(77126);function o(e){return e.call.calls}},9066:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatMediaConstraints=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{audio:e.audio&&!(0,o.default)(e.audioOptions)?e.audioOptions:e.audio,video:e.video&&!(0,o.default)(e.videoOptions)?e.videoOptions:e.video,screen:e.screen&&!(0,o.default)(e.screenOptions)?e.screenOptions:e.screen,medias:e.medias}},t.isValidateNativeConstraints=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object.keys(e).some((e=>["audioOptions","videoOptions","screenOptions"].includes(e))))throw new Error("Cannot validate SDK media constraints format. Format constraints before validating.");return Object.keys(e).some((t=>["audio","video","screen"].includes(t)&&Boolean(e[t])))},t.validateDetachedMedia=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const t of e){if(!t.media.detached)throw new a.default({message:`Media: ${t.media.id} is not detached.`,code:a.callCodes.GENERIC_ERROR});if(!t.media.local)throw new a.default({message:`Media: ${t.media.id} is not local. Only local media may be used when adding detached media to a call.`,code:a.callCodes.GENERIC_ERROR})}},t.validateMediaConstraints=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{medias:t}=e;if(!t)return;if(!Array.isArray(t))throw new a.default({message:"Incorrect type for mediaConstraints.medias. Must be an array of media objects.",code:a.callCodes.GENERIC_ERROR});if(!t.every((e=>{let{type:t,media:r}=e;return Boolean(t)&&Boolean(r)})))throw new a.default({message:"Incorrect media objects.",code:a.callCodes.GENERIC_ERROR});const r=[];e.audio&&r.push("audio"),e.video&&r.push("video"),e.screen&&r.push("screen");const n=[];t.forEach((e=>{n.push(e.type)}));const o=r.filter((e=>n.includes(e)));if(o.length>0)throw new a.default({message:`Both detached media tracks and media options provided for ${o}`,code:a.callCodes.GENERIC_ERROR})},r(97107),r(62234),r(69375);var n,o=(n=r(84499))&&n.__esModule?n:{default:n},a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},73640:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,TimerTracker:r}=e;t.getLogger("CALL").info("Cleaning up call plugin"),r.clearAllByType("call"),r.clearAllByType("callNegotiation")}},41768:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,l.default)(e);for(const t in c)c[t](e);return e.factory("CallRequests",a.default),e.defer((function(e){const{context:r,logManager:o}=e,a=o.getLogger("CALL"),{mediaDevices:s,peerConnection:c}=(0,d.getWebRTCSupportCapabilities)();s&&c||a.warn("Calls are not supported on this platform due to lack of WebRTC support. Call APIs will not be available."),t=(0,i.default)(t),t=(0,i.mergeDefaults)(t);const l=(0,d.getBrowserDetails)();"unified-plan"!==t.defaultPeerConfig.sdpSemantics&&(a.warn("Only `unified-plan` is supported as sdpSemantics. Switching to `unified-plan`."),t.defaultPeerConfig.sdpSemantics="unified-plan"),"firefox"===l.browser&&!0===t.earlyMedia&&(a.warn("Firefox does not support pranswer for Early Media. Disabling early media configuration."),t.earlyMedia=!1),"chrome"===l.browser&&l.version>=110&&t.defaultPeerConfig.iceServers&&t.defaultPeerConfig.iceServers.forEach((e=>{Array.isArray(e.urls)?e.urls=e.urls.map(i.fixIceServerUrls):e.urls&&(e.urls=(0,i.fixIceServerUrls)(e.urls))})),r.dispatch((0,u.update)(t,n.default.name)),void 0!==t.removeH264Codecs&&a.warn("The `call.removeH264Codecs` configuration has been removed. Please see the documentation for the `sdpHandlers` configuration for how to implement similar behaviour."),r.dispatch((0,u.setSdpHandlers)(t.sdpHandlers))})),{api:n.default.createAPI,name:n.default.name,reducer:n.default.reducer,middleware:o.default,capabilities:["call","link_call","link_user_id","link_pstn"],cleanup:s.default}};var n=g(r(9647)),o=g(r(12661)),a=g(r(5703)),i=p(r(16556)),s=g(r(73640)),c=p(r(88131)),l=g(r(41600)),u=r(87310),d=r(37654);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function p(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function g(e){return e&&e.__esModule?e:{default:e}}},54049:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{CallManager:t,logManager:r}=e.container;return async function(n){if(!i(n))return;const s=n.payload.notificationMessage,{sessionData:c}=s.sessionParams,l=(0,a.getCallByWrtcsSessionId)(e.getState(),c),u=r.getLogger("CALL",l?l.id:void 0);l?l&&l.state!==o.CALL_STATES.RINGING&&l.state!==o.CALL_STATES.EARLY_MEDIA&&l.state!==o.CALL_STATES.INITIATED?u.info(`Received call cancel notification when state is ${l.state}. Ignoring.`):l&&l.isHandling?u.info("Received call cancel notification while handling is in-progress. Ignoring."):await t.callCancelled(c):u.info(`Received ${s.eventType} notification for unknown call; ignoring.`)}},t.shouldHandlePattern=i;var n=r(70506),o=r(77126),a=r(40481);function i(e){return e.type===n.NOTIFICATION_RECEIVED&&"callCancel"===e.payload.notificationMessage.eventType}},43427:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{CallManager:t,logManager:r}=e.container;return async function(a){if(!s(a))return;const c=a.payload.notificationMessage,{sessionData:l,reasonText:u,statusCode:d}=c.sessionParams,f=(0,n.getCallByWrtcsSessionId)(e.getState(),l);if(!f)return void r.getLogger("CALL").info(`Received ${c.eventType} notification for unknown call; ignoring.`);const p=(0,i.getDomain)(e.getState()),g=(0,o.getRemoteParticipant)(f,c,p),E={eventType:c.eventType,reasonText:u,statusCode:d,...g};await t.callStatusUpdateEnded(l,E)}},t.shouldHandlePattern=s;var n=r(40481),o=r(82481),a=r(70506),i=r(87075);function s(e){return e.type===a.NOTIFICATION_RECEIVED&&"callEnd"===e.payload.notificationMessage.eventType}},87096:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{CallManager:t,logManager:r}=e.container;return async function(a){if(!s(a))return;const c=a.payload.notificationMessage,{sessionData:l,reasonText:u,statusCode:d}=c.sessionParams,f=(0,n.getCallByWrtcsSessionId)(e.getState(),l);if(!f)return void r.getLogger("CALL").info(`Received ${c.eventType} notification for unknown call; ignoring.`);const p=(0,i.getDomain)(e.getState()),g=(0,o.getRemoteParticipant)(f,c,p),E={eventType:c.eventType,reasonText:u,statusCode:d,...g};await t.callStatusUpdateFailed(l,E)}},t.shouldHandlePattern=s;var n=r(40481),o=r(82481),a=r(70506),i=r(87075);function s(e){return e.type===a.NOTIFICATION_RECEIVED&&"sessionFail"===e.payload.notificationMessage.eventType}},21769:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{CallManager:t,logManager:r}=e.container;return async function(a){if(!s(a))return;const c=a.payload.notificationMessage,{sessionData:l}=c.sessionParams,u=(0,n.getCallByWrtcsSessionId)(e.getState(),l);if(!u)return void r.getLogger("CALL").info(`Received ${c.eventType} notification for unknown call; ignoring.`);const d=(0,i.getDomain)(e.getState()),f=(0,o.getRemoteParticipant)(u,c,d),p={eventType:c.eventType,...f,customParameters:c.customParameters};t.callStatusUpdateRinging(l,p)}},t.shouldHandlePattern=s;var n=r(40481),o=r(82481),a=r(70506),i=r(87075);function s(e){return e.type===a.NOTIFICATION_RECEIVED&&"ringing"===e.payload.notificationMessage.eventType}},57082:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.container.CallManager;return async function(e){if(!o(e))return;const r=e.payload.notificationMessage,n=r.callNotificationParams||{},a=r.sessionParams.sessionData,i={eventType:r.eventType,sdp:r.sessionParams.sdp,remoteName:n.callerName,remoteNumber:n.callerDisplayNumber,calleeNumber:n.calleeDisplayNumber,customParameters:r.customParameters};await t.establishOffer(a,i,e.meta.channel)}},t.shouldHandlePattern=o;var n=r(70506);function o(e){return e.type===n.NOTIFICATION_RECEIVED&&"call"===e.payload.notificationMessage.eventType}},12661:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=E.map((t=>t(e)));return e=>r=>(t.forEach((e=>e(r))),e(r))};var n=g(r(54049)),o=g(r(43427)),a=g(r(87096)),i=g(r(21769)),s=g(r(17347)),c=g(r(57082)),l=g(r(15966)),u=g(r(66890)),d=g(r(8889)),f=g(r(79130)),p=g(r(54493));function g(e){return e&&e.__esModule?e:{default:e}}const E=[n.default,o.default,a.default,i.default,s.default,c.default,l.default,u.default,d.default,f.default,...p.default]},15966:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.container.CallManager,r=e.container.logManager.getLogger("CALL");return async function(n){if(!s(n))return;const c=n.payload.notificationMessage,{sessionData:l}=c.sessionParams,u=(0,o.getCallByWrtcsSessionId)(e.getState(),l);if(!u)return void r.info(`Received ${c.eventType} notification for unknown call; ignoring.`);const d=(0,i.getDomain)(e.getState()),f=(0,a.getRemoteParticipant)(u,c,d),p={eventType:c.eventType,wrtcsSessionId:c.sessionParams.sessionData,sdp:c.sessionParams.sdp,retryAfter:c.sessionParams.retryAfter,message:c.sessionParams.reasonText,code:c.statusCode,...f,customParameters:c.customParameters};await t.negotiationAnswer(l,p)}},t.shouldHandlePattern=s;var n=r(70506),o=r(40481),a=r(82481),i=r(87075);function s(e){return e.type===n.NOTIFICATION_RECEIVED&&"respondCallUpdate"===e.payload.notificationMessage.eventType}},66890:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{CallManager:t,logManager:r}=e.container,n=r.getLogger("CALL");return async function(r){if(!s(r))return;const c=r.payload.notificationMessage,{sessionData:l}=c.sessionParams,u=(0,o.getCallByWrtcsSessionId)(e.getState(),l);if(!u)return void n.info(`Received ${c.eventType} notification for unknown call; ignoring.`);if(![a.CALL_STATES.CONNECTED,a.CALL_STATES.ON_HOLD].includes(u.state))return void n.debug(`Call not in correct state to perform a midcall operation: ${u.state}.`);const d=(0,i.getRemoteParticipant)(u,c),f={eventType:c.eventType,wrtcsSessionId:c.sessionParams.sessionData,sdp:c.sessionParams.sdp,...d,customParameters:c.customParameters};try{await t.negotiationOffer(l,f)}catch(e){n.warn(`Cannot handle remote operation. Error: ${e.message}`)}}},t.shouldHandlePattern=s,r(62234);var n=r(70506),o=r(40481),a=r(77126),i=r(82481);function s(e){return e.type===n.NOTIFICATION_RECEIVED&&Boolean("startCallUpdate"===e.payload.notificationMessage.eventType)}},8889:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{CallManager:t,logManager:r}=e.container;return async function(o){if(!a(o))return;const i=o.payload.notificationMessage,{sessionData:s}=i.sessionParams;if(!(0,n.getCallByWrtcsSessionId)(e.getState(),s))return void r.getLogger("CALL").info(`Received ${i.eventType} notification for unknown call; ignoring.`);const c=i.callNotificationParams||{},l={eventType:i.eventType,sdp:i.sessionParams.sdp,remoteName:c.remoteName,remoteNumber:c.remoteDisplayNumber,customParameters:i.customParameters};await t.receiveEarlyMedia(s,l)}},t.shouldHandlePattern=a;var n=r(40481),o=r(70506);function a(e){return e.type===o.NOTIFICATION_RECEIVED&&"sessionProgress"===e.payload.notificationMessage.eventType}},17347:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{CallManager:t,logManager:r}=e.container;return async function(a){if(!s(a))return;const c=a.payload.notificationMessage,{sessionData:l,reasonText:u,statusCode:d}=c.sessionParams,f=(0,n.getCallByWrtcsSessionId)(e.getState(),l);if(!f)return void r.getLogger("CALL").info(`Received ${c.eventType} notification for unknown call; ignoring.`);const p=(0,i.getDomain)(e.getState()),g=(0,o.getRemoteParticipant)(f,c,p),E={eventType:c.eventType,reasonText:u,statusCode:d,...g};await t.sessionStatusUpdateEnded(l,E)}},t.shouldHandlePattern=s;var n=r(40481),o=r(82481),a=r(70506),i=r(87075);function s(e){return e.type===a.NOTIFICATION_RECEIVED&&"sessionComplete"===e.payload.notificationMessage.eventType}},79130:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.container.CallOperations;return function(e){o(e)&&t.setTurnCredentials(e)}},t.shouldHandlePattern=o;var n=r(34721);function o(e){return!(e.error||e.type!==n.SUBSCRIBE_FINISHED||!e.payload.subscriptions||!e.payload.subscriptions.length||!e.payload.subscriptions[0].turnCredentials)}},88131:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"setTurnCredentials",{enumerable:!0,get:function(){return o.default}});var n,o=(n=r(56731))&&n.__esModule?n:{default:n}},56731:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("CallOperations.setTurnCredentials",(()=>(0,o.default)(e.container)))};var n,o=(n=r(49116))&&n.__esModule?n:{default:n}},49116:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r}=e,a=r.getLogger("CALL");return function(e){const{serverTurnCredentials:r,defaultPeerConfig:i}=(0,o.getOptions)(t.getState());if(0===i.iceServers.length)return void a.debug("No ICE servers provided during setup; not using TURN/STUN for calls.");if(!r)return void a.debug("Using application provided TURN credentials.");const s=e.payload.subscriptions[0].turnCredentials;t.dispatch(n.turnActions.turnChanged({credentials:s}))}};var n=r(35),o=r(40481)},10839:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,sendRequest:r,CallReporter:c}=e;return{directTransferSession:async function(e){const l=(0,i.getRequestInfo)(t.getState()),u={method:"PUT"};u.body=JSON.stringify({callControlRequest:{type:"transfer",address:e.address}});const d=c.getReport(e.id),f=(0,n.getCallById)(t.getState(),e.id).currentOperations.find((e=>e.isLocal&&e.type===o.OPERATIONS.DIRECT_TRANSFER)),p=d.getEvent(f.eventId).addEvent(a.REPORT_EVENTS.REST_REQUEST),g=await s.linkCallRequest(r,l,{...u,...e});if(g.error)throw p.setError(g.error),p.endEvent(),g.error;p.endEvent()},consultativeTransferSessions:async function(e){const l=(0,i.getRequestInfo)(t.getState()),u={method:"PUT"};u.body=JSON.stringify({callControlRequest:{type:"transfer",sessionData:e.otherWrtcsSessionId,address:e.destination}});const d=c.getReport(e.id),f=(0,n.getCallById)(t.getState(),e.id).currentOperations.find((e=>e.isLocal&&e.type===o.OPERATIONS.CONSULTATIVE_TRANSFER)),p=d.getEvent(f.eventId).addEvent(a.REPORT_EVENTS.REST_REQUEST),g=await s.linkCallRequest(r,l,{...u,...e});if(g.error)throw p.setError(g.error),p.endEvent(),g.error;p.endEvent()},joinSessions:async function(e){const l=(0,i.getRequestInfo)(t.getState()),u={method:"POST"};u.body=JSON.stringify({callControlRequest:{type:"join",firstSessionData:e.wrtcsSessionId,secondSessionData:e.otherWrtcsSessionId,sdp:e.sdp,customParameters:e.customParameters}});const d=c.getReport(e.id),f=(0,n.getCallById)(t.getState(),e.id).currentOperations.find((e=>e.isLocal&&e.type===o.OPERATIONS.JOIN)),p=d.getEvent(f.eventId).addEvent(a.REPORT_EVENTS.REST_REQUEST),g=await s.linkCallRequest(r,l,u);if(g.error)throw p.setError(g.error),p.endEvent(),g.error;return p.endEvent(),g.callControlResponse.sessionData}}};var n=r(40481),o=r(59090),a=r(84581),i=r(87075),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(47378));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}},73504:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,sendRequest:d,CallReporter:f}=e;return{createSession:async function(e,p){const g=r.getLogger("CALL",e.id);g.info("Creating call session on server-side.");const E=(0,i.getRequestInfo)(t.getState()),_=(0,n.getOptions)(t.getState()),y=f.getReport(e.id),v=(0,n.getCallById)(t.getState(),e.id).currentOperations.find((e=>e.isLocal&&(e.type===o.OPERATIONS.MAKE||e.type===o.OPERATIONS.MAKE_ANONYMOUS))),S=y.getEvent(v.eventId);let O;e.isAnonymous?O=e.from:(O=(0,c.normalizeSipUri)(E.username,(0,i.getDomain)(t.getState())),g.debug("Caller address normalized to: "+O)),p.displayName&&(O=`${p.displayName}<${O}>`);const h={type:"callStart",to:e.to,from:O,sdp:e.offer};_.earlyMedia&&(h.supported=["earlymedia"]),p.customParameters&&(h.customParameters=p.customParameters),p.customBodies&&(h.customBodies=p.customBodies);const T={...e,method:"POST"};let I;if(e.isAnonymous){I="callMeResponse";const e=(0,s.getWebsocketId)(t.getState(),"callMe");if(!e)throw new u.default({code:u.callCodes.GENERIC_ERROR,message:"Cannot start call without call service subscription."});T.body=JSON.stringify({callMeRequest:{...h,notifyChannelId:e}})}else I="callControlResponse",T.body=JSON.stringify({callControlRequest:h});const C=S.addEvent(a.REPORT_EVENTS.REST_REQUEST);C.addData("requestType",a.REPORTER_REQUESTS.CREATE_SESSION);const m=await l.linkCallRequest(d,E,T);if(m.error)throw g.debug("Failed to create Call session server-side.",m.error),C.setError(m.error),C.endEvent(),m.error;{const e=m[I].sessionData;return g.debug("Call session created server-side.",{wrtcsSessionId:e}),C.addData("wrtcsSessionId",e),C.endEvent(),e}},answerSession:async function(e){const s=r.getLogger("CALL",e.id);s.info("Answering call session on server-side.");const c=f.getReport(e.id),u=(0,n.getCallById)(t.getState(),e.id).currentOperations.find((e=>e.isLocal&&e.type===o.OPERATIONS.ANSWER)),p=c.getEvent(u.eventId),g=(0,i.getRequestInfo)(t.getState()),E={method:"PUT"};E.body=JSON.stringify({callControlRequest:{type:"callAnswer",sdp:e.answer,customParameters:e.customParameters,customBodies:e.customBodies}});const _=p.addEvent(a.REPORT_EVENTS.REST_REQUEST);_.addData("requestType",a.REPORTER_REQUESTS.ANSWER_SESSION);const y=await l.linkCallRequest(d,g,{...E,...e});if(y.error)throw s.debug("Failed to answer Call session server-side.",y.error),_.setError(y.error),_.endEvent(),y.error;s.debug("Call session answered server-side.",{wrtcsSessionId:e.wrtcsSessionId}),_.endEvent()},rejectSession:async function(e){const s=r.getLogger("CALL",e.id);s.info("Rejecting call session on server-side.");const c=f.getReport(e.id),u=(0,n.getCallById)(t.getState(),e.id).currentOperations.find((e=>e.isLocal&&e.type===o.OPERATIONS.REJECT)),p=c.getEvent(u.eventId),g=(0,i.getRequestInfo)(t.getState()),E={method:"POST",endUrl:"calldisposition"};E.body=JSON.stringify({callDispositionRequest:{action:"reject",sessionData:e.wrtcsSessionId}});const _=p.addEvent(a.REPORT_EVENTS.REST_REQUEST);_.addData("requestType",a.REPORTER_REQUESTS.REJECT_SESSION);const y=await l.linkCallRequest(d,g,E);if(y.error)throw s.debug("Failed to reject Call session server-side.",{wrtcsSessionId:e.wrtcsSessionId},y.error),_.setError(y.error),_.endEvent(),y.error;s.debug("Call session rejected server-side.",{wrtcsSessionId:e.wrtcsSessionId}),_.endEvent()},forwardSession:async function(e){const s=(0,n.getCallByWrtcsSessionId)(t.getState(),e.wrtcsSessionId);r.getLogger("CALL",s.id).info("Forwarding call session on server-side.");const c=f.getReport(s.id),u=s.currentOperations.find((e=>e.isLocal&&e.type===o.OPERATIONS.FORWARD_CALL)),p=c.getEvent(u.eventId),g=(0,i.getRequestInfo)(t.getState()),E={method:"POST",endUrl:"calldisposition"};E.body=JSON.stringify({callDispositionRequest:{action:"forward",sessionData:e.wrtcsSessionId,address:e.address}});const _=p.addEvent(a.REPORT_EVENTS.REST_REQUEST);_.addData("requestType",a.REPORTER_REQUESTS.FORWARD_SESSION);const y=await l.linkCallRequest(d,g,E);if(y.error)throw _.setError(y.error),_.endEvent(),y.error;_.endEvent()},endSession:async function(e){const s=r.getLogger("CALL",e.callId);s.info("Ending call session on server-side.");const c=f.getReport(e.callId),u=(0,n.getCallById)(t.getState(),e.callId).currentOperations.find((e=>e.isLocal&&[o.OPERATIONS.END,o.OPERATIONS.JOIN,o.OPERATIONS.DIRECT_TRANSFER,o.OPERATIONS.CONSULTATIVE_TRANSFER].includes(e.type))),p=c.getEvent(u.eventId),g=(0,i.getRequestInfo)(t.getState()),E=p.addEvent(a.REPORT_EVENTS.REST_REQUEST);E.addData("requestType",a.REPORTER_REQUESTS.END_SESSION);const _=await l.linkCallRequest(d,g,{method:"DELETE",responseType:"none",...e});if(_.error)throw s.info("Failed to end Call session server-side.",_.error),E.setError(_.error),E.endEvent(),_.error;s.info("Call session ended server-side.",{wrtcsSessionId:e.wrtcsSessionId}),E.endEvent()}}},r(62234);var n=r(40481),o=r(59090),a=r(84581),i=r(87075),s=r(56512),c=r(89968),l=f(r(47378)),u=f(r(75412));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},5703:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{...(0,n.default)(e),...(0,o.default)(e),...(0,a.default)(e),...(0,i.default)(e)}};var n=s(r(10839)),o=s(r(73504)),a=s(r(70475)),i=s(r(19742));function s(e){return e&&e.__esModule?e:{default:e}}},70475:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,sendRequest:r,logManager:n,CallReporter:u}=e;return{getSession:async function(e){const n=(0,s.getRequestInfo)(t.getState()),l=u.getReport(e.id);let d;const f=(0,o.getCallById)(t.getState(),e.id).currentOperations.find((e=>e.isLocal&&e.status===a.OP_STATUS.PENDING));f?(d=l.getEvent(f.eventId).addEvent(i.REPORT_EVENTS.REST_REQUEST),d.addData("requestType",i.REPORTER_REQUESTS.GET_SESSION)):(d=l.findLastOngoingEvent(i.REPORT_EVENTS.RECEIVE_CALL).addEvent(i.REPORT_EVENTS.REST_REQUEST),d.addData("requestType",i.REPORTER_REQUESTS.GET_SESSION));const p=await c.linkCallRequest(r,n,{method:"GET",...e});if(p.error)throw d.setError(p.error),d.endEvent(),p.error;return d.addData("state",p.callControlResponse.state),d.endEvent(),{error:!1,state:p.callControlResponse.state}},updateCallRinging:async function(e){const o=n.getLogger("CALL",e.id);o.info("Updating call session as ringing on server-side.");const a=(0,s.getRequestInfo)(t.getState()),l={method:"PUT"};l.body=JSON.stringify({callControlRequest:{type:"ringing"}});const d=u.getReport(e.id).findLastOngoingEvent([i.REPORT_EVENTS.RECEIVE_CALL,i.REPORT_EVENTS.SEND_RINGING_FEEDBACK]).addEvent(i.REPORT_EVENTS.REST_REQUEST);d.addData("requestType",i.REPORTER_REQUESTS.CALL_RINGING_UPDATE_SESSION);const f=await c.linkCallRequest(r,a,{...l,...e});if(f.error)throw d.setError(f.error),d.endEvent(),o.debug("Failed to update call session as ringing server-side.",f.error),{error:f.error};return o.debug("Call session updated as ringing server-side.",{wrtcsSessionId:e.wrtcsSessionId}),d.addData("wrtcsSessionId",e.wrtcsSessionId),d.endEvent(),{error:!1}},updateCustomParameters:async function(e){const n=(0,s.getRequestInfo)(t.getState()),l={method:"PUT"},d=e.isAnonymous?"callMeRequest":"callControlRequest";l.body=JSON.stringify({[d]:{type:"sendCustomHeaders",customParameters:e.customParameters}});const f=u.getReport(e.id),p=(0,o.getCallById)(t.getState(),e.id).currentOperations.find((e=>e.isLocal&&e.type===a.OPERATIONS.SEND_CUSTOM_PARAMETERS)),g=f.getEvent(p.eventId).addEvent(i.REPORT_EVENTS.REST_REQUEST);g.addData("requestType",i.REPORTER_REQUESTS.UPDATE_CUSTOM_PARAMETERS_ON_SESSION);const E=await c.linkCallRequest(r,n,{...l,...e});if(E.error)throw g.setError(E.error),g.endEvent(),{error:E.error};return g.endEvent(),{error:!1}},auditCall:async function(e){const n=(0,s.getRequestInfo)(t.getState()),o={method:"PUT"},a=e.isAnonymous?"callMeRequest":"callControlRequest";o.body=JSON.stringify({[a]:{type:"audit"}});const d=u.getReport(e.id).addEvent(i.REPORT_EVENTS.AUDIT_CALL),f=await c.linkCallRequest(r,n,{...o,...e});if(f.error)throw d.setError(f.error),d.endEvent(),new l.default({code:f.error.code,message:f.error.message});return d.endEvent(),{status:"Connected",error:!1}}}};var n,o=r(40481),a=r(59090),i=r(84581),s=r(87075),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(47378)),l=(n=r(75412))&&n.__esModule?n:{default:n};function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}},19742:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,sendRequest:r,CallReporter:c}=e;return{updateSession:async function(e){const l=(0,n.getRequestInfo)(t.getState()),u={method:"PUT"},d=e.isAnonymous?"callMeRequest":"callControlRequest";u.body=JSON.stringify({[d]:{type:"startCallUpdate",sdp:e.offer,customParameters:e.customParameters,customBodies:e.customBodies}});const f=(0,o.getCallById)(t.getState(),e.id),p=c.getReport(f.id),g=f.currentOperations.find((e=>e.isLocal&&e.status===a.OP_STATUS.PENDING)),E=p.getEvent(g.eventId).addEvent(i.REPORT_EVENTS.REST_REQUEST);E.addData("requestType",i.REPORTER_REQUESTS.UPDATE_SESSION);const _=await s.linkCallRequest(r,l,{...u,...e});if(_.error)throw E.endEvent(_.error),_.error;E.endEvent()},updateSessionResponse:async function(e){const a=(0,n.getRequestInfo)(t.getState()),l={method:"PUT"},u=e.isAnonymous&&e.account?"callMeRequest":"callControlRequest",d={[u]:{type:"respondCallUpdate"}};e.statusCode?d[u].statusCode=`${e.statusCode}`:(d[u].sdp=e.answer,d[u].customParameters=e.customParameters,d[u].customBodies=e.customBodies),l.body=JSON.stringify(d);const f=(0,o.getCallByWrtcsSessionId)(t.getState(),e.wrtcsSessionId),p=c.getReport(f.id),g=f.currentOperations.find((e=>!e.isLocal)),E=p.getEvent(g.eventId).addEvent(i.REPORT_EVENTS.REST_REQUEST);E.addData("requestType",i.REPORTER_REQUESTS.UPDATE_SESSION);const _=await s.linkCallRequest(r,a,{...l,...e});if(_.error)throw E.endEvent(_.error),_.error;E.endEvent()}}};var n=r(87075),o=r(40481),a=r(59090),i=r(84581),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(47378));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}},47378:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateCallUrl=i,t.handleLinkCallRequestError=a,t.linkCallRequest=async function(e,t,r){r.url=i(t,r);const n=await e(r);return n.error?{error:a(n)}:n.body};var n,o=(n=r(75412))&&n.__esModule?n:{default:n};function a(e){let t,r;if(e)if(e.body)if("callControlResponse"in e.body){const{callControlResponse:n}=e.body;t=function(e){switch(e){case 5:return"Request failed: Invalid or missing request body";case 26:return"Request failed: Internal Server Error";case 27:return"Request failed: Authorization failure";case 35:return"Request failed: Service is not authorized due to Call Control resources on the server being not enabled";case 37:return"Request failed: Detected invalid parameter value. Check Request content";case 42:return"Request failed: Resource does not exist";case 61:return"Request failed: Authentication failure due to credentials not provided or incorrect";case 62:return"Request failed: Authentication failure due to account being disabled";case 63:return"Request failed: Authentication failure due to account being locked";case 1004:return"Request failed: Bad request";default:return"Request failed: Unknown error"}}(n.statusCode),r=n.statusCode}else t=e.body.message,r=e.result.code;else e.result?(t=`Request failed: ${e.result.message}`,r=e.result.code):t="Request failed: Unknown error.";else t="Request failed: Unknown error.";return new o.default({message:t,code:r})}function i(e,t){const{baseURL:r,version:n,username:o}=e,{isAnonymous:a,account:i,wrtcsSessionId:s,endUrl:c}=t;let l=`${r}/rest/version/${n}/${a?"anonymous":"user"}/${a?i:o}`;return l+=c?`/${c}`:"/"+(a?"callMe":"callControl"),s&&(l+=`/callSessions/${s}`),l}},82481:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRemoteParticipant=function(e,t,r){if(!t.callNotificationParams||!e)return{};let n={};const o=t.callNotificationParams.callerDisplayNumber&&t.callNotificationParams.callerDisplayNumber.startsWith("conference@");return n="incoming"===e.direction||o?{remoteName:t.callNotificationParams.callerName,remoteNumber:t.callNotificationParams.callerDisplayNumber}:{remoteName:t.callNotificationParams.remoteName,remoteNumber:t.callNotificationParams.remoteDisplayNumber},n.remoteNumber&&!n.remoteNumber.includes("@")&&(n.remoteNumber+=r),{remoteName:n.remoteName||e.remoteParticipant.displayName,remoteNumber:n.remoteNumber||e.remoteParticipant.displayNumber}},r(62234)},40449:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCodecRemover=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e=e.map((e=>"string"==typeof e?{name:e}:e)),function(t,r,n){const o=e.map((e=>e.name));return t.media.forEach((t=>{const r=[];let n=[];n=t.rtp.filter((e=>o.includes(e.codec))),n.forEach((n=>{e.filter((e=>e.name===n.codec)).forEach((e=>{!e.fmtpParams||e.fmtpParams&&0===e.fmtpParams.length?r.push(n.payload):t.fmtp.forEach((t=>{t.payload===n.payload&&e.fmtpParams.every((e=>t.config.includes(e)))&&r.push(n.payload)}))}))})),t.fmtp.forEach((e=>{if(e.config.includes("apt=")){var t=parseInt(e.config.replace("apt=",""));r.includes(t)&&r.push(e.payload)}}));let a=!1;if("number"==typeof t.payloads&&(t.payloads=t.payloads.toString(),a=!0),t.payloads){const e=t.payloads.split(" ").length;r.length>=e&&r.splice(e-1,r.length-e+1),t.payloads=t.payloads.split(" ").filter((e=>!r.includes(parseInt(e)))).join(" ")}t.payloads&&a&&(t.payloads=parseInt(t.payloads)),t.rtp=t.rtp.filter((e=>!r.includes(e.payload))),t.fmtp=t.fmtp.filter((e=>!r.includes(e.payload))),t.rtcpFb&&(t.rtcpFb=t.rtcpFb.filter((e=>!r.includes(e.payload))))})),t}},r(62234),r(69375)},24679:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.iceCollectionCheckFunction=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;const{iceCollectionDuration:r,iceCandidates:n,iceGatheringState:i,rtcPeerConnectionConfig:s,rtcLocalSessionDescription:c}=e,{iceCollectionIdealTimeout:l,iceCollectionMaxTimeout:u}=t;if("complete"===i)return 0===n.length?{type:o.ICE_COLLECTION_RESULT_TYPES.ERROR,error:"No ICE candidates available for call to proceed."}:{type:o.ICE_COLLECTION_RESULT_TYPES.START_CALL};if(r<l){let e=0;(s.rtcConfig.iceServers||[]).forEach((t=>{Array.isArray(t.urls)?e+=t.urls.filter((e=>e.startsWith("turn"))).length:"string"==typeof t.urls&&t.urls.startsWith("turn")&&(e+=1)}));const t=n.filter((e=>"rtp"===e.component&&"relay"===e.type));return a.default.parse(c.sdp).media.every((r=>t.filter((e=>parseInt(e.sdpMid)===r.mid||e.sdpMid===r.mid)).length>=e))&&e?{type:o.ICE_COLLECTION_RESULT_TYPES.START_CALL}:{type:o.ICE_COLLECTION_RESULT_TYPES.WAIT,wait:l-r}}if(r<u){const e=n.filter((e=>"rtp"===e.component&&"relay"===e.type));return a.default.parse(c.sdp).media.every((t=>e.filter((e=>parseInt(e.sdpMid)===t.mid||e.sdpMid===t.mid)).length>=1))?{type:o.ICE_COLLECTION_RESULT_TYPES.START_CALL}:{type:o.ICE_COLLECTION_RESULT_TYPES.WAIT,wait:u-r}}return 0===n.length?{type:o.ICE_COLLECTION_RESULT_TYPES.ERROR,error:"No ICE candidates available for call to proceed."}:{type:o.ICE_COLLECTION_RESULT_TYPES.START_CALL}};var n,o=r(77126),a=(n=r(54722))&&n.__esModule?n:{default:n}},89968:(e,t)=>{"use strict";function r(e){return e.replace(/[ \-.()+]/g,"")}Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeSipUri=function(e,t){const n=function(e,t){const r=function(e){const t=e.lastIndexOf("@");return 0!==t&&t!==e.length-1&&-1!==t?e.substr(t+1):""}(e);return r?{address:e.substr(0,e.length-r.length-1),domain:r}:{address:e,domain:t}}(e=e.trim(),t);t=n.domain;const o=function(e){const t=e.match(/^.*:/g);return t&&t[0]?t[0]:""}(e=n.address),a=function(e){const t=e.match(/^[#+*]+[\d|(][\d \-.()+]*$/g);return t&&t[0]?t[0].match(/[#+*]+/g)[0]:""}(e=e.substr(o.length));return e=e.substr(a.length),"sip:"+a+(function(e){const t=r(e).match(/^\d+$/g);return t&&1===t.length}(s=e)?r(s):s)+(""===(i=t)||void 0===i?"":0===i.indexOf("@")?i:"@"+i);var i,s}},73520:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMediaState=function(e){return o(e)?n.CALL_MEDIA_STATES.CONNECTED:a(e)?n.CALL_MEDIA_STATES.LOCAL_HOLD:i(e)?n.CALL_MEDIA_STATES.REMOTE_HOLD:s(e)?n.CALL_MEDIA_STATES.DUAL_HOLD:void 0},t.hasMedia=o,t.isDualHold=s,t.isLocalHold=a,t.isRemoteHold=i;var n=r(77126);function o(e){return e.state===n.CALL_STATES.CONNECTED&&!e.localHold&&!e.remoteHold}function a(e){return e.state===n.CALL_STATES.ON_HOLD&&e.localHold&&!e.remoteHold}function i(e){return e.state===n.CALL_STATES.ON_HOLD&&!e.localHold&&e.remoteHold}function s(e){return e.state===n.CALL_STATES.ON_HOLD&&e.localHold&&e.remoteHold}},81322:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SET_CACHE=t.FETCH_CALL_HISTORY_FINISH=t.FETCH_CALL_HISTORY=t.DELETE_CALL_HISTORY_FINISH=t.DELETE_CALL_HISTORY=t.ADD_CALL_HISTORY_ENTRY=void 0;const r="@@KANDY/";t.FETCH_CALL_HISTORY=r+"FETCH_CALL_HISTORY",t.FETCH_CALL_HISTORY_FINISH=r+"FETCH_CALL_HISTORY_FINISH",t.DELETE_CALL_HISTORY=r+"DELETE_CALL_HISTORY",t.DELETE_CALL_HISTORY_FINISH=r+"DELETE_CALL_HISTORY_FINISH",t.ADD_CALL_HISTORY_ENTRY=r+"ADD_CALL_HISTORY_ENTRY",t.SET_CACHE=r+"SET_CACHE"},31122:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addCallLogEntry=function(e){return{type:n.ADD_CALL_HISTORY_ENTRY,payload:e}},t.removeCallLogs=function(e){return{type:n.DELETE_CALL_HISTORY,payload:e}},t.removeCallLogsFinish=function(e){let{recordId:t,error:r}=e;return{type:n.DELETE_CALL_HISTORY_FINISH,error:!!r,payload:r||t}},t.retrieveCallLogs=function(e,t){return{type:n.FETCH_CALL_HISTORY,payload:{amount:e,offset:t}}},t.retrieveCallLogsFinish=function(e){let{logs:t,error:r}=e;return{type:n.FETCH_CALL_HISTORY_FINISH,error:!!r,payload:r||t}},t.setCache=function(e){return{type:n.SET_CACHE,payload:e}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(81322));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},64025:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,CallHistoryOperations:r,logManager:n,API_LOG_TAG:l,emitEvent:u}=e,d=n.getLogger("CALLHISTORY");return{call:{history:{get:()=>(d.debug(`${l}call.history.get`),(0,i.getCallHistory)(t.getState())),async fetch(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(d.debug(`${l}call.history.fetch, amount: ${e}, offset: ${n}`),t.dispatch(a.retrieveCallLogs(e,n)),!(0,o.default)(e)||e<0||!(0,o.default)(n)){d.info("Unable to retrieve log(s); invalid input.");const e=new c.default({code:c.callHistoryCodes.BAD_REQUEST,message:"Unable to retrieve log(s); invalid input."});return t.dispatch(a.retrieveCallLogsFinish({error:e})),void u(s.CALL_HISTORY_ERROR,{validationError:e})}try{await r.fetch(e,n)}catch(e){return d.info(`call.history.fetch error: ${e.message}`),void u(s.CALL_HISTORY_ERROR,{error:e})}u(s.CALL_HISTORY_CHANGE,{}),u(s.CALL_HISTORY_CACHE_CHANGE,{})},async remove(e){if(d.debug(`${l}call.history.remove, recordId: ${e}`),t.dispatch(a.removeCallLogs(e)),e){try{await r.removeCallLogs(e)}catch(e){return d.info(`call.history.remove error: ${e.message}`),void u(s.CALL_HISTORY_ERROR,{error:e})}u(s.CALL_HISTORY_CHANGE,{}),u(s.CALL_HISTORY_CACHE_CHANGE,{})}else{d.info("Could not remove call logs from history; invalid input.");const e=new c.default({code:c.callHistoryCodes.BAD_REQUEST,message:"Could not remove call logs; invalid input."});t.dispatch(a.removeCallLogsFinish({error:e}))}},async clear(){d.debug(`${l}call.history.clear`),t.dispatch(a.removeCallLogs("all"));try{await r.removeCallLogs("all")}catch(e){return d.info(`call.history.clear error: ${e.message}`),void u(s.CALL_HISTORY_ERROR,{error:e})}u(s.CALL_HISTORY_CHANGE,{}),u(s.CALL_HISTORY_CACHE_CHANGE,{})},getCache:()=>(d.debug(`${l}call.history.getCache`),JSON.stringify((0,i.getCachedHistory)(t.getState()))),setCache(e){let t;d.debug(`${l}call.history.setCache, data: ${e}`);try{if("string"!=typeof e)throw new Error("data is not a valid string");t=JSON.parse(e)}catch(e){throw d.info(`Invalid data provided: ${e}`),e}r.setCache(t),u(s.CALL_HISTORY_CHANGE,{}),u(s.CALL_HISTORY_CACHE_CHANGE,{})}}}}},r(97107);var n,o=(n=r(17174))&&n.__esModule?n:{default:n},a=u(r(31122)),i=r(33907),s=u(r(91708)),c=u(r(75412));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},91708:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CALL_HISTORY_ERROR=t.CALL_HISTORY_CHANGE=t.CALL_HISTORY_CACHE_CHANGE=void 0,t.CALL_HISTORY_CHANGE="callHistory:change",t.CALL_HISTORY_ERROR="callHistory:error",t.CALL_HISTORY_CACHE_CHANGE="callHistoryCache:change"},97969:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createAPI",{enumerable:!0,get:function(){return n.default}}),t.name=void 0,Object.defineProperty(t,"reducer",{enumerable:!0,get:function(){return o.default}});var n=a(r(64025)),o=a(r(52692));function a(e){return e&&e.__esModule?e:{default:e}}t.name="callHistory"},52692:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=u(r(35968)),o=u(r(3e4)),a=u(r(15353)),i=u(r(27748)),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(81322)),c=r(45775);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e){return e&&e.__esModule?e:{default:e}}const d={};d[s.FETCH_CALL_HISTORY_FINISH]={next(e,t){const r=e.filter((function(e){return 36===e.recordId.length&&"0"!==e.duration})),s=e.filter((function(e){return""!==e.resourceLocation})),c=r.filter((function(e){return!t.payload.some(p,e)})),l=(0,n.default)((0,o.default)("recordId",t.payload,s),c);return(0,i.default)((0,a.default)("startTime",l))}},d[s.DELETE_CALL_HISTORY_FINISH]={next:(e,t)=>"all"===t.payload?[]:e.filter((function(e){return e.recordId!==t.payload}))},d[s.ADD_CALL_HISTORY_ENTRY]={next:(e,t)=>(0,n.default)(t.payload,e)},d[s.SET_CACHE]={next:(e,t)=>t.payload};const f=(0,c.handleActions)(d,[]);t.default=f;const p=function(e){return!(Math.abs(e.startTime-this.startTime)>1e4||Math.abs(e.duration-this.duration)>5e3||e.direction!==this.direction)}},33907:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCachedHistory=function(e){return(0,o.default)(e.callHistory)},t.getCallHistory=function(e,t){if(!t)return(0,o.default)(e.callHistory);const r=t.amount,n=t.offset;return n+r>=e.callHistory.length?(0,o.default)(e.callHistory.slice(n)):(0,o.default)(e.callHistory.slice(n,n+r))};var n,o=(n=r(89321))&&n.__esModule?n:{default:n}},3727:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("CallHistoryRequests.fetchCallLogs",(t=>(0,n.default)(e.container))),e.factory("CallHistoryOperations.fetch",(t=>(0,o.default)(e.container)))};var n=a(r(32774)),o=a(r(86462));function a(e){return e&&e.__esModule?e:{default:e}}},86462:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,CallHistoryRequests:o}=e,a=r.getLogger("CALLHISTORY");return async function(e,r){const{dispatch:i}=t;a.info(`Attempting to retrieve ${e} call history log(s), with an offset of ${r}.`);try{const t=await o.fetchCallLogs({amount:e,offset:r});return a.info(`Successfully retrieved ${t.length} call history log(s).`),i(n.retrieveCallLogsFinish({logs:t})),t}catch(e){throw i(n.retrieveCallLogsFinish({error:e})),e}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(31122));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},32774:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,sendRequest:n}=e,s=r.getLogger("CALLHISTORY");return async function(e){const r=(0,a.getRequestInfo)(t.getState()),c=r.version,l={method:"GET",url:`${r.baseURL}/rest/version/${c}/user/${r.username}/logHistory`,queryParams:{startIndex:e.offset,count:e.amount},responseType:"json",body:void 0},u={4:i.callHistoryCodes.NOT_AUTHENTICATED,27:i.callHistoryCodes.FORBIDDEN,35:i.callHistoryCodes.FORBIDDEN};if(!r.username){const e="Failed to retrieve call logs; user not authenticated (credentials not set).";throw s.info(e),new i.default({code:i.callHistoryCodes.NOT_AUTHENTICATED,message:e})}const d=await n(l),{body:f,error:p,result:g}=d;if(!p){s.info(`Call log(s) fetched; Status code: ${f.logHistory.statusCode}`);let e=f.logHistory.logItems;return e=e.map((function(e){if("CallLog"===e.type)return e.params})),e=e.map((function(e){return"outgoing"!==e.direction||e.calleeDisplayNumber||e.calleeName||(e.calleeDisplayNumber=e.callerDisplayNumber,e.calleeName=e.callerName),"outgoing"===e.direction?e.remoteParticipant={displayName:e.calleeName,displayNumber:e.calleeDisplayNumber}:e.remoteParticipant={displayName:e.callerName,displayNumber:e.callerDisplayNumber},e})),e}let E="",_="";if((0,o.default)(f)){const{code:e,message:t}=g;_=`Failed to fetch call log(s); ${t}.`,E=403===e?i.callHistoryCodes.FORBIDDEN:i.callHistoryCodes.UNKNOWN_ERROR}else{const{statusCode:e}=f.logHistory;_=`Failed to fetch call log(s); Status code: ${e}`,E=u[e]||i.callHistoryCodes.UNKNOWN_ERROR}throw s.info(_),new i.default({code:E,message:_})}};var n,o=(n=r(84499))&&n.__esModule?n:{default:n},a=r(87075),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},7664:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"fetch",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"removeCallLogs",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"setCache",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"storeCallLog",{enumerable:!0,get:function(){return i.default}});var n=s(r(3727)),o=s(r(70229)),a=s(r(48963)),i=s(r(68580));function s(e){return e&&e.__esModule?e:{default:e}}},70229:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("CallHistoryRequests.removeCallLogs",(t=>(0,n.default)(e.container))),e.factory("CallHistoryOperations.removeCallLogs",(t=>(0,o.default)(e.container)))};var n=a(r(63344)),o=a(r(80328));function a(e){return e&&e.__esModule?e:{default:e}}},80328:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,CallHistoryRequests:o}=e,a=r.getLogger("CALLHISTORY");return async function(e){a.info("Attempting to remove call log(s):",e);try{await o.removeCallLogs(e),a.info("Successfully removed log(s) from call history."),t.dispatch(n.removeCallLogsFinish({recordId:e}))}catch(e){throw t.dispatch(n.removeCallLogsFinish({error:e})),e}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(31122));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},63344:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,sendRequest:n}=e,s=r.getLogger("CALLHISTORY");return async function(e){const r=(0,a.getRequestInfo)(t.getState()),c=r.version;let l=`${r.baseURL}/rest/version/${c}/user/${r.username}/`;l+="all"===e?"logHistory":`logRecord/${e}`;const u={method:"DELETE",url:l,responseType:"none"},d={4:i.callHistoryCodes.NOT_AUTHENTICATED,27:i.callHistoryCodes.FORBIDDEN,35:i.callHistoryCodes.FORBIDDEN,42:i.callHistoryCodes.NOT_FOUND};if(!r.username){const e="Failed to remove call log(s) from call history; user not authenticated (credentials not set).";throw s.info(e),new i.default({code:i.callHistoryCodes.NOT_AUTHENTICATED,message:e})}const f=await n(u),{body:p,error:g,result:E}=f;if(!g)return void s.info("Call log(s) removed successfully.");let _="",y="";if((0,o.default)(p)){const{code:e,message:t}=E;y=`Failed to remove log(s) from call history. ${t}`,_=403===e?i.callHistoryCodes.FORBIDDEN:i.callHistoryCodes.UNKNOWN_ERROR}else{const{statusCode:e}=p.logRecord;y=`Failed to remove log(s) from call history. Status Code ${e}`,_=d[e]||i.callHistoryCodes.UNKNOWN_ERROR}throw s.info(y),new i.default({code:_,message:y})}};var n,o=(n=r(84499))&&n.__esModule?n:{default:n},a=r(87075),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},48963:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("CallHistoryOperations.setCache",(t=>(0,o.default)(e.container)))};var n,o=(n=r(72738))&&n.__esModule?n:{default:n}},72738:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t}=e;return function(e){t.dispatch(n.setCache(e))}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(31122));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},68580:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("CallHistoryOperations.storeCallLog",(t=>(0,o.default)(e.container)))};var n,o=(n=r(73413))&&n.__esModule?n:{default:n}},73413:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,emitEvent:c}=e,l=r.getLogger("CALLHISTORY");return function(e,r){const u=(0,s.getCallById)(t.getState(),e);if(!u)return void l.debug(`Call (${e}) not in state to create local log.`);if(u.state!==i.CALL_STATES.ENDED)return;const d=(0,a.getUserInfo)(t.getState()),f={recordId:e,startTime:""+u.startTime,duration:""+(u.endTime-u.startTime),callerDisplayNumber:u.isCaller?d.username:u.remoteParticipant.displayNumber,calleeDisplayNumber:u.isCaller?u.remoteParticipant.displayNumber:d.username,calleeName:u.isCaller?u.remoteParticipant.displayName||u.remoteParticipant.displayNumber:d.username,callerName:u.isCaller?u.displayName?u.displayName:d.username:u.remoteParticipant.displayName||u.remoteParticipant.displayNumber,remoteParticipant:u.remoteParticipant,originalRemoteParticipant:null,resourceLocation:""};"incoming"===u.direction?r&&r.prevState===i.CALL_STATES.RINGING&&"9904"!==r.code?f.direction="missed":f.direction="incoming":f.direction="outgoing",l.debug(`Adding ${f.direction} call to the local call history:`,f),t.dispatch(n.addCallLogEntry(f)),c(o.CALL_HISTORY_CHANGE,{}),c(o.CALL_HISTORY_CACHE_CHANGE,{})}};var n=l(r(31122)),o=l(r(91708)),a=r(87075),i=r(77126),s=r(40481);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},31270:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(const t in i)i[t](e);return{api:o.createAPI,capabilities:["callHistory"],middleware:a.default,name:o.name,reducer:o.reducer}};var n,o=r(97969),a=(n=r(41516))&&n.__esModule?n:{default:n},i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(7664));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},41516:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.container.CallHistoryOperations;return e=>r=>{const o=e(r);switch(r.type){case n.END_CALL_FINISH:case n.REJECT_CALL_FINISH:r.payload.id&&t.storeCallLog(r.payload.id,r.payload.transition)}return o}};var n=r(21836)},18995:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLICK_TO_CALL_FINISH=t.CLICK_TO_CALL=void 0;const r="@@KANDY/";t.CLICK_TO_CALL=r+"CLICK_TO_CALL",t.CLICK_TO_CALL_FINISH=r+"CLICK_TO_CALL_FINISH"},59371:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clickToCall=function(e,t,r){return{type:n.CLICK_TO_CALL,payload:{callId:e,caller:t,callee:r}}},t.clickToCallFinish=function(e){let{callId:t,caller:r,callee:o,requestTime:a,error:i}=e;return i?{type:n.CLICK_TO_CALL_FINISH,error:!0,payload:{error:i}}:{type:n.CLICK_TO_CALL_FINISH,error:!1,payload:{callId:t,caller:r,callee:o,requestTime:a}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(18995));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},41100:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,ClickToCallOperations:i,logManager:s,API_LOG_TAG:c}=e,l=s.getLogger("CLICKTOCALL");return{clickToCall:{make:function(e,t){l.debug(c+"clickToCall.make: ",e,t);const o=(0,a.v4)();try{i.clickToCall(o,e,t)}catch(e){return r(n.CLICK_TO_CALL_ERROR,{callId:o,error:e}),o}return r(n.CLICK_TO_CALL_STARTED,{callId:o}),o},get:function(){return l.debug(c+"clickToCall.get"),(0,o.getAll)(t.getState())}}}};var n=r(40347),o=r(59534),a=r(84596)},40347:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLICK_TO_CALL_STARTED=t.CLICK_TO_CALL_ERROR=void 0,t.CLICK_TO_CALL_STARTED="clickToCall:start",t.CLICK_TO_CALL_ERROR="clickToCall:error"},53040:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"api",{enumerable:!0,get:function(){return n.default}}),t.name=void 0,Object.defineProperty(t,"reducer",{enumerable:!0,get:function(){return o.default}});var n=a(r(41100)),o=a(r(19083));function a(e){return e&&e.__esModule?e:{default:e}}t.name="clickToCall"},19083:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(45775);function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}const a={};a[function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(18995)).CLICK_TO_CALL_FINISH]={next:(e,t)=>t.error?e:e.concat({callId:t.payload.callId,caller:t.payload.caller,callee:t.payload.callee,requestTime:t.payload.requestTime})};const i=(0,n.handleActions)(a,[]);t.default=i},59534:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAll=function(e){return(0,o.default)(e.clickToCall)};var n,o=(n=r(89321))&&n.__esModule?n:{default:n}},72937:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.factory("ClickToCallOperations",a.default),e.factory("ClickToCallRequests",i.default),{api:o.default,capabilities:["clickToCall"],name:n.name,reducer:n.reducer}};var n=r(53040),o=s(r(41100)),a=s(r(96051)),i=s(r(67475));function s(e){return e&&e.__esModule?e:{default:e}}},96051:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,ClickToCallRequests:a}=e,i=r.getLogger("CLICKTOCALL");return{clickToCall:async function(e,r,s){const{dispatch:c}=t;if(c(n.clickToCall(e,r,s)),!r||!s){i.info("Missing call participant information");const t=new o.default({message:"callee and/or caller were not provided in CLICK_TO_CALL action payload",code:o.clickToCallCodes.MISSING_ARGS});throw c(n.clickToCallFinish({payload:{error:t,callId:e}})),t}try{const t=await a.clickToCall(e,r,s);return i.info("Successfully initiated a click to call."),c(n.clickToCallFinish({...t})),t}catch(t){throw c(n.clickToCallFinish({error:t,callId:e})),t}}}};var n=i(r(59371)),o=i(r(75412));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}},67475:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,sendRequest:a}=e,i=r.getLogger("CLICKTOCALL");return{clickToCall:async function(e,r,s){const c=(0,n.getConnectionInfo)(t.getState()),{server:l,username:u}=c,d=l.version,f={clickToCallRequest:{callingParty:r,calledParty:s}},p={url:`${l.protocol}://${l.server}:${l.port}/rest/version/${d}/user/${u}/clicktocall`,method:"POST",body:JSON.stringify(f)},g=Date.now(),E=await a(p),{error:_,result:y}=E;if(_){const{message:e}=y,t=`ClickToCall request failed. ${e}`;throw i.info(t),new o.default({code:o.clickToCallCodes.RESPONSE_ERROR,message:t})}return{callId:e,caller:r,callee:s,requestTime:g}}}};var n=r(87075),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(75412));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},20855:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const n=(0,r(84596).v4)();t.default=n},1011:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delay=function(e){return new Promise((t=>setTimeout(t,e)))},t.logCssSelector=function(e){return(0,n.default)(e)?e.id:e},t.normalizeServices=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>(0,o.default)(e)&&e.hasOwnProperty("service")?e:{service:e}))};var n=a(r(22202)),o=a(r(36705));function a(e){return e&&e.__esModule?e:{default:e}}},52932:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validationResults=t.validation=t.parse=t.errorMessages=t.enums=void 0;var n=p(r(97679)),o=p(r(5968)),a=p(r(80880)),i=p(r(84499)),s=p(r(90283)),c=p(r(8637)),l=p(r(35968)),u=p(r(25666)),d=r(69932),f=p(r(87014));function p(e){return e&&e.__esModule?e:{default:e}}f.default.extend({function:()=>e=>"function"==typeof e}),t.validation=(0,f.default)(),t.enums=e=>{const t=(0,o.default)((e=>(0,f.default)().exact(e)))(e);return(0,f.default)().passesAnyOf(...t)};const g=e=>t=>r=>(0,c.default)(_(e))(E(t)(r));t.errorMessages=g;const E=e=>t=>e.testAll(t);t.validationResults=E,t.parse=(e,t)=>r=>{const n=g(e)(t)(r);return(0,i.default)(n)||d.logManager.getLogger("VALIDATION").info(O(n)),r};const _=e=>t=>y([])(e)(t),y=e=>t=>r=>{let{cause:n,rule:o,target:i,value:u}=r;const d=(0,l.default)(e)(i||t);if((0,s.default)(n)){const e=y(d)(i);return(0,c.default)(e)(n)}return`${(0,a.default)(".")(d)} has value of '${u}', but it should be ${v(o)}`},v=e=>{let{name:t,args:r}=e;switch(t){case"schema":return"Schema";case"passesAnyOf":return`any of '${(0,a.default)("', '")((0,o.default)(S)(r))}'`;case"between":return`between ${r.join(", ")}`;default:return`${h(t)} ${t}`}},S=e=>e.chain[0].args,O=(0,n.default)(JSON.stringify)([u.default,null,4]),h=e=>/[aeiou]/i.test(e[0])?"an":"a"},13126:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getVersion=function(){return"7.7.0-beta.1729"}},93117:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{api:o.default,capabilities:["config"],name:n.default.name,reducer:n.default.reducer}};var n=a(r(53661)),o=a(r(68909));function a(e){return e&&e.__esModule?e:{default:e}}},18470:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SET_SDP_HANDLERS=t.CONFIG_UPDATE=void 0;const r="@@KANDY/";t.CONFIG_UPDATE=r+"CONFIG_UPDATE",t.SET_SDP_HANDLERS=r+"SET_SDP_HANDLERS"},87310:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setSdpHandlers=function(e){return e.push(o.sanitizeSdesFromSdp),e.push(a.modifySdpBandwidth),{type:n.SET_SDP_HANDLERS,payload:{sdpHandlers:e}}},t.update=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";var r;return r=t?{[t]:e}:e,{type:n.CONFIG_UPDATE,payload:r}},r(69375);var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(18470)),o=r(88851),a=r(46484);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},68909:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,API_LOG_TAG:s}=e,c=r.getLogger("CONFIG");return{getConfig:function(){return c.debug(s+"getConfig"),(0,a.getConfiguration)(t.getState())},updateConfig:function(e){c.debug(s+"updateConfig: ",e);const r=(0,n.default)(e);r.call&&(r.call=(0,i.default)(r.call)),t.dispatch(o.update(r))}}};var n=c(r(89321)),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(87310)),a=r(52063),i=c(r(16556));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function c(e){return e&&e.__esModule?e:{default:e}}},53661:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(43328))&&n.__esModule?n:{default:n};t.default={name:"config",reducer:o.default}},43328:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(18470)),a=r(45775),i=(n=r(7485))&&n.__esModule?n:{default:n};function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}const c={};c[o.CONFIG_UPDATE]={next:(e,t)=>(0,i.default)(e,t.payload)},c[o.SET_SDP_HANDLERS]={next:(e,t)=>({...e,call:{...e.call,sdpHandlers:t.payload.sdpHandlers}})};const l=(0,a.handleActions)(c,{});t.default=l},52063:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getConfiguration=function(e){return(0,o.default)(e.config)};var n,o=(n=r(89321))&&n.__esModule?n:{default:n}},40751:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanupWebSocket=function(e){e.close&&e.close(),e.onclose=null,e.onmessage=null,e.onopen=null,e.onerror=null},t.openWebsocket=function(e){const t=`${e.protocol}://${e.server}:${e.port}${e.url}`+(0,o.default)(e.params);a.debug(`Opening socket at: ${t}`);const r=new WebSocket(t);return new Promise(((e,t)=>{r.onopen=function(){r.onopen=null,r.onerror=null,e(r)},r.onerror=function(){r.onopen=null,r.onerror=null,t({error:!0,message:"Could not connect to websocket. Received error on open."})}}))};var n,o=(n=r(2633))&&n.__esModule?n:{default:n};const a=r(69932).logManager.getLogger("CONNECTIVITY")},9719:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WS_RECONNECT_FAILED=t.WS_ERROR=t.WS_DISCONNECT_FINISHED=t.WS_DISCONNECT=t.WS_CONNECT_FINISHED=t.WS_CLOSED=t.WS_ATTEMPT_CONNECT=t.LOST_CONNECTION=t.CHANGE_CONNECTIVITY_CHECKING=void 0;const r="@@KANDY/CONN/";t.WS_ATTEMPT_CONNECT=r+"WS_ATTEMPT_CONNECT",t.WS_CONNECT_FINISHED=r+"WS_CONNECT_FINISHED",t.WS_DISCONNECT=r+"WS_DISCONNECT",t.WS_DISCONNECT_FINISHED=r+"WS_DISCONNECT_FINISHED",t.WS_RECONNECT_FAILED=r+"WS_RECONNECT_FAILED",t.WS_CLOSED=r+"WS_CLOSED",t.WS_ERROR=r+"WS_ERROR",t.LOST_CONNECTION=r+"LOST_CONNECTION",t.CHANGE_CONNECTIVITY_CHECKING=r+"CHANGE_CONNECTIVITY_CHECKING"},47183:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wsReconnectFailed=t.wsError=t.wsDisconnectFinished=t.wsDisconnect=t.wsConnectFinished=t.wsClosed=t.wsAttemptConnect=t.lostConnection=t.changeConnectivityChecking=void 0,r(97107);var n,o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(9719)),a=(n=r(75412))&&n.__esModule?n:{default:n};function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function s(e){return function(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:e,error:t instanceof Error||t instanceof a.default,payload:t,meta:{isReconnect:r}}}}t.wsAttemptConnect=s(o.WS_ATTEMPT_CONNECT),t.wsDisconnect=s(o.WS_DISCONNECT),t.wsConnectFinished=s(o.WS_CONNECT_FINISHED),t.wsDisconnectFinished=s(o.WS_DISCONNECT_FINISHED),t.wsReconnectFailed=s(o.WS_RECONNECT_FAILED),t.wsClosed=s(o.WS_CLOSED),t.wsError=s(o.WS_ERROR),t.lostConnection=s(o.LOST_CONNECTION),t.changeConnectivityChecking=s(o.CHANGE_CONNECTIVITY_CHECKING)},64584:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,Connectivity:r,SubscriptionOperations:a,logManager:i,API_LOG_TAG:s}=e,c=i.getLogger("CONNECTIVITY");return{connection:{getSocketState:()=>(c.debug(s+"connection.getSocketState"),(0,o.getConnectionState)(t.getState())),enableConnectivityChecking(e){c.debug(s+"connection.enableConnectivityChecking: ",e),t.dispatch((0,n.changeConnectivityChecking)(e)),r.setPinging(e)},resetConnection(){c.debug(s+"connection.resetConnection");const e=(0,o.getConnectionState)(t.getState());if(!e.connected)return void c.debug(s+"connection.resetConnection: No active websocket connection. Ignoring request.");r.disconnect();const i=(0,o.getConnectivityConfig)(t.getState()).autoReconnect;c.info(`Websocket disconnected. (autoReconnect?: ${i})`),i?r.connect(e.wsInfo,!0).catch((()=>{t.dispatch((0,n.wsReconnectFailed)()),a.onConnectionLost()})):(t.dispatch((0,n.wsReconnectFailed)()),a.onConnectionLost())}}}};var n=r(47183),o=r(94482)},91463:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WS_CHANGE=void 0,t.WS_CHANGE="ws:change"},2852:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(79317)),o=i(r(64584)),a=i(r(49759));function i(e){return e&&e.__esModule?e:{default:e}}t.default={name:n.default,api:o.default,reducer:a.default}},79317:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="connectivity"},49759:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(14017))&&n.__esModule?n:{default:n},a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(9719)),i=r(45775);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}const c={};c[a.WS_ATTEMPT_CONNECT]={next:(e,t)=>({...e,connected:!1,pinging:!1})},c[a.WS_RECONNECT_FAILED]={next:(e,t)=>({...e,connected:!1,pinging:!1})},c[a.WS_CONNECT_FINISHED]={next:(e,t)=>({...e,connected:!0,pinging:t.payload.pinging,...(0,o.default)("checkConnectivity",t.payload.kandy)}),throw:(e,t)=>({connected:!1,pinging:!1})},c[a.LOST_CONNECTION]={next:(e,t)=>({...e,connected:!1,pinging:!1})},c[a.WS_DISCONNECT_FINISHED]={next:(e,t)=>({connected:!1,pinging:!1}),throw:(e,t)=>({connected:!1,pinging:!1})},c[a.WS_ERROR]={next:(e,t)=>({connected:!1,pinging:!1}),throw:(e,t)=>({connected:!1,pinging:!1})},c[a.CHANGE_CONNECTIVITY_CHECKING]={next:(e,t)=>({...e,checkConnectivity:t.payload})};const l=(0,i.handleActions)(c,{connected:!1,pinging:!1});t.default=l},94482:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCheckConnectivity=function(e){return e[o.default].checkConnectivity},t.getConnectionState=function(e){return(0,n.default)(e[o.default])},t.getConnectivityConfig=function(e){return e.config[o.default]};var n=a(r(89321)),o=a(r(79317));function a(e){return e&&e.__esModule?e:{default:e}}},9101:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.waitForReconnect=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e4;const{context:r,Notifications:s}=e,{connected:c}=(0,n.getConnectionState)(r.getState());if(c)return!0;const l=await Promise.race([s.takeAction(o.WS_CONNECT_FINISHED),s.takeAction(i.UNSUBSCRIBE_FINISHED),(0,a.delay)(t)]);return!(!l||!l.type||l.type!==o.WS_CONNECT_FINISHED)};var n=r(94482),o=r(9719),a=r(1011),i=r(34721)},91822:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,TimerTracker:r,Connectivity:o}=e,a=t.getLogger("CONNECTIVITY");a.info("Cleaning up connectivity plugin"),r.clearAllByType("connectivity");const i=(0,n.getConnectionState)(e.context.getState());i&&i.connected&&(a.debug("Closing websocket."),o.disconnect())};var n=r(94482)},77769:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultValues=t.checkOptions=t.applyDefaults=void 0;var n,o=(n=r(38142))&&n.__esModule?n:{default:n},a=r(78215),i=r(52932);const s=t.defaultValues={method:a.connCheckMethods.KEEP_ALIVE,pingInterval:3e4,reconnectLimit:5,reconnectDelay:5e3,reconnectTimeMultiplier:1,reconnectTimeLimit:64e4,autoReconnect:!0,checkConnectivity:!0,webSocketOAuthMode:"none"},c=i.validation.schema({method:(0,i.enums)([a.connCheckMethods.KEEP_ALIVE]),pingInterval:i.validation.positive(),reconnectLimit:i.validation.positive(),reconnectDelay:i.validation.positive(),reconnectTimeMultiplier:i.validation.positive(),reconnectTimeLimit:i.validation.positive(),autoReconnect:i.validation.boolean(),checkConnectivity:i.validation.boolean(),webSocketOAuthMode:(0,i.enums)(["none","query"])});t.checkOptions=(0,i.parse)("connectivity",c),t.applyDefaults=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.default)(s,e)}},8786:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t=(0,o.applyDefaults)(t),(0,o.checkOptions)(t),"string"==typeof t.method){const e=t.method;t.method={type:e,responsibleParty:u.connCheckResponsibility.CLIENT}}return e.value("Connectivity",{...(0,a.default)(e.container,(0,s.default)()),constants:{WS_STATUS:c.WS_STATUS}}),e.defer((e=>{e.context.dispatch((0,l.update)(t,n.default.name))})),{api:n.default.api,name:n.default.name,reducer:n.default.reducer,cleanup:i.default}};var n=d(r(2852)),o=r(77769),a=d(r(13418)),i=d(r(91822)),s=d(r(85222)),c=r(78039),l=r(87310),u=r(78215);function d(e){return e&&e.__esModule?e:{default:e}}},13418:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const{context:r,emitEvent:u,logManager:d,SubscriptionOperations:f,NotificationsOperations:p,TimerTracker:g}=e,E=d.getLogger("CONNECTIVITY");async function _(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E.info((s?"Re-":"")+"Connecting to websocket."),r.dispatch(n.wsAttemptConnect(e)),u(o.WS_CHANGE,{});const c=(0,a.getConnectivityConfig)(r.getState());let d=(0,a.getCheckConnectivity)(r.getState());void 0===d&&(d=c.checkConnectivity);try{const r=c.reconnectDelay>2e3?c.reconnectDelay:2e3;E.debug(`Attempting ${c.reconnectLimit} connections (delay: ${r}ms, mult.: ${c.reconnectTimeMultiplier}).`),await(0,i.startTebAttempts)({taskTimeout:r,attemptDelay:r,delayMultiplier:c.reconnectTimeMultiplier,maxDelay:c.reconnectTimeLimit,maxAttempts:c.reconnectLimit},t.connect,g,e),d&&(E.info(`Sending websocket pings every ${c.pingInterval}ms.`),t.setPinging({message:JSON.stringify({message_type:"ping"}),interval:c.pingInterval}))}catch(e){if(E.info(`Failed to ${s?"re-":""}connect websocket after ${c.reconnectLimit} attempts.`),s)throw e;{const t=new l.default({message:e.message,code:l.subscriptionCodes.WS_CONNECTION_ERROR});throw r.dispatch(n.wsConnectFinished(t)),u(o.WS_CHANGE,{}),t}}r.dispatch(n.wsConnectFinished({kandy:{...c,wsInfo:e},pinging:d})),u(o.WS_CHANGE,{})}async function y(){const{wsInfo:e,autoReconnect:t}=(0,a.getConnectionState)(r.getState());if(E.info(`Websocket disconnected. (autoReconnect?: ${t})`),r.dispatch(n.lostConnection()),u(o.WS_CHANGE,{}),t){const{bearerAccessToken:t}=(0,c.getConnectionInfo)(r.getState()),o=(0,a.getConnectivityConfig)(r.getState());t&&"query"===o.webSocketOAuthMode&&(e.params={access_token:t});try{await _(e,!0)}catch(e){r.dispatch(n.wsReconnectFailed()),f.onConnectionLost()}}else r.dispatch(n.wsReconnectFailed()),f.onConnectionLost()}return t.on("message",(e=>{E.debug("Received message on websocket.",e),function(e){p.processNotification(e,"WEBSOCKET")}(e)})),t.on("close",(e=>{E.debug(`Websocket closed (wasClean?: ${e.wasClean}; code ${e.code}).`),1e3===e.code?(E.info("Websocket closed normally."),r.dispatch(n.wsReconnectFailed()),f.onConnectionLost()):y()})),t.on("disconnected",(e=>{E.debug(`Websocket disconnected due to ping error: ${e.message}`),y()})),t.on("error",(()=>{E.debug("Websocket disconnected due to error."),y()})),{connect:_,disconnect:function(){E.info("Disconnecting websocket connection.");try{t.disconnect()}catch(e){}r.dispatch(n.wsDisconnectFinished()),u(o.WS_CHANGE,{})},setPinging:function(e){if(t.status===s.WS_STATUS.CONNECTED)if(t.isPinging&&!e)E.info("Stopping to send websocket pings."),t.setPinging(void 0);else if(!t.isPinging&&e){const e=(0,a.getConnectivityConfig)(r.getState()).pingInterval;E.info(`Starting to send websocket pings every ${e}ms.`),t.setPinging({message:JSON.stringify({message_type:"ping"}),interval:e})}}}};var n=d(r(47183)),o=d(r(91463)),a=r(94482),i=r(70867),s=r(78039),c=r(87075),l=d(r(75412));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},70867:(e,t,r)=>{"use strict";async function n(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2?arguments[2]:void 0;return Promise.race([e,new Promise(((e,o)=>{t=n.create("connectivity",(()=>{o(new Error(`Timed-out promise after ${r} milliseconds.`))}),r)}))]).finally((()=>n.clear(t)))}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const{delayLimit:r=8*e,multiplier:n=2,limit:o}=t;let a=1,i=e;for(;;){if(o&&o<=a)return i;yield i,i<r&&(i=e*Math.pow(n,a),i=i>r?r:i),a++}}()}Object.defineProperty(t,"__esModule",{value:!0}),t.makeTebSequence=o,t.startTebAttempts=function(e,t,r){let a,{taskTimeout:i=1e3,attemptDelay:s=1e3,delayMultiplier:c=1,maxDelay:l=5e3,maxAttempts:u=5}=e;for(var d=arguments.length,f=new Array(d>3?d-3:0),p=3;p<d;p++)f[p-3]=arguments[p];const g=o(s,{delayLimit:l,multiplier:c,limit:u});return new Promise(((e,t)=>{E({resolve:e,reject:t},r)}));async function E(e,r){const o=g.next(),s=o.done;s||(a=r.create("connectivity",E,o.value,{params:[e,r]}));try{const s=o.value<i?o.value:i,c=await n(t(...f),s,r);r.clear(a),e.resolve(c)}catch(t){s&&e.reject(t)}}},t.timedPromise=n,r(97107)},78039:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WS_STATUS=void 0,t.WS_STATUS={CONNECTED:"CONNECTED",CONNECTING:"CONNECTING",RECONNECTING:"RECONNECTING",NO_SOCKET:"NO_SOCKET"}},85222:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e,t=a.WS_STATUS.NO_SOCKET,r=!1;const n=(0,i.default)();let s;function c(){return t}function l(){const n=c();if(n===a.WS_STATUS.CONNECTED)s&&u(void 0),e&&((0,o.cleanupWebSocket)(e),e=void 0),t=a.WS_STATUS.NO_SOCKET;else{if(n!==a.WS_STATUS.CONNECTING)throw new Error("Websocket is not connected.");r=!0}}function u(t){if(c()!==a.WS_STATUS.CONNECTED)throw new Error("Websocket is not connected.");if(s){if(t)throw new Error("Websocket is already pinging.");r()}else{if(!t.message||!t.interval)throw new Error("All options must be provided to start pinging.");s=setInterval((function(){c()!==a.WS_STATUS.CONNECTED&&r();try{if(!e||1!==e.readyState)throw new Error("websocket was not in readyState");e.send(t.message)}catch(e){r(),l(),n.emit("disconnected",e)}}),t.interval)}function r(){clearInterval(s),s=void 0}}return{connect:function(i){return new Promise(((s,u)=>{c()===a.WS_STATUS.NO_SOCKET?(t=a.WS_STATUS.CONNECTING,(0,o.openWebsocket)(i).then((o=>{if(t=a.WS_STATUS.CONNECTED,e=o,r)throw r=!1,l(),new Error("Websocket connection interrupted by request.");o.onmessage=e=>{let t;try{t=JSON.parse(e.data)}catch(r){t=e.data}n.emit("message",t)},o.onclose=e=>{l(),n.emit("close",e)},o.onerror=e=>{l(),n.emit("error",e)},s()})).catch((e=>{t=a.WS_STATUS.NO_SOCKET,u(e)}))):u(new Error("Websocket already exists."))}))},disconnect:l,setPinging:u,on:n.on,off:n.off,get status(){return c()},get isPinging(){return Boolean(s)}}},r(97107);var n,o=r(40751),a=r(78039),i=(n=r(19353))&&n.__esModule?n:{default:n}},78215:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notificationTypes=t.connCheckResponsibility=t.connCheckMethods=void 0,t.notificationTypes={WEBSOCKET:"websocket",PUSH:"push"},t.connCheckResponsibility={CLIENT:"client",SERVER:"server"},t.connCheckMethods={KEEP_ALIVE:"keepAlive",PING_PONG:"pingPong"}},15701:()=>{},88058:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webrtcCodes=t.usersCodes=t.subscriptionCodes=t.sipEventCodes=t.proxyCodes=t.presenceCodes=t.mwiCodes=t.messagingCodes=t.groupsCodes=t.connectivityCodes=t.clickToCallCodes=t.callHistoryCodes=t.callCodes=t.bridgeCodes=t.authCodes=void 0,t.authCodes={INVALID_CREDENTIALS:"authentication:1",CONNECT_FAIL_WS_ERROR:"authentication:2",UNSUBSCRIBE_FAIL:"authentication:3",SUBSCRIBE_FAIL:"authentication:4",UPDATE_SUBSCRIPTION_FAIL:"authentication:6",INVALID_STATE:"authentication:7",MISSING_SERVICE:"authentication:12",SUBSCRIBE_UNAVAILABLE:"authentication:13"},t.callCodes={UNKNOWN_ERROR:"call:1",GENERIC_ERROR:"call:2",INIT_MEDIA_FAILED:"call:3",USER_MEDIA_ERROR:"call:4",NOT_SUPPORTED:"call:5",INVALID_STATE:"call:6",INVALID_PARAM:"call:7",STATE_DESYNC:"call:8",INVALID_OFFER:"call:9",NO_ICE_CANDIDATES:"call:10",SESSION_MISMATCH:"call:11",GLARE:"call:12"},t.callHistoryCodes={UNKNOWN_ERROR:"callHistory:1",BAD_REQUEST:"callHistory:2",NOT_FOUND:"callHistory:3",NOT_AUTHENTICATED:"callHistory:4",FORBIDDEN:"callHistory:5"},t.clickToCallCodes={MISSING_ARGS:"clickToCall:1",RESPONSE_ERROR:"clickToCall:2"},t.groupsCodes={UNKNOWN_ERROR:"groups:1",GENERIC_ERROR:"groups:2",MISSING_PARAMETERS:"groups:3"},t.messagingCodes={SEND_MESSAGE_FAIL:"messaging:5"},t.mwiCodes={FETCH_MWI_FAIL:"mwi:1"},t.sipEventCodes={UNKNOWN_ERROR:"sipEvents:1",NOT_PROVISIONED:"sipEvents:2",NOT_SUBSCRIBED:"sipEvents:3"},t.bridgeCodes={UNKNOWN_ERROR:"audioBridge:1",INVALID_INPUT:"audioBridge:2",ALREADY_EXISTS:"audioBridge:3",NOT_FOUND:"audioBridge:4",NOT_SUPPORTED:"audioBridge:5",MEDIA_NOT_FOUND:"audioBridge:6",INVALID_STATE:"audioBridge:7"},t.subscriptionCodes={WS_CONNECTION_ERROR:"subscription:1",NO_SERVICE_PROVIDED:"subscription:2",GENERIC_ERROR:"subscription:3",INVALID_STATE:"subscription:4"},t.connectivityCodes={WS_MESSAGE_ERROR:"connectivity:1"},t.presenceCodes={INVALID_STATUS:"presence:1",INVALID_ACTIVITY:"presence:2",INVALID_REQUEST:"presence:3",INVALID_PARAM:"presence:4"},t.usersCodes={UNKNOWN:"users:1",REFRESH_CONTACTS_FAIL:"users:2",DIRECTORY_REQUEST_FAIL:"users:3",INVALID_PARAM:"users:4"},t.webrtcCodes={INVALID_PARAM:"webrtc:1",INVALID_TRACK_ID:"webrtc:2",TRACK_IN_USE:"webrtc:3",TRACK_NOT_LOCAL:"webrtc:4"},t.proxyCodes={INVALID_PARAM:"proxy:1",SET_PROXY_CHANNEL_FAIL:"proxy:2",IN_ACTIVE_CALL:"proxy:3",VERSION_MISMATCH:"proxy:4",INVALID_STATE:"proxy:5",TIMEOUT:"proxy:6",UNKNOWN:"proxy:7"}},75412:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NO_CODE=void 0,Object.defineProperty(t,"authCodes",{enumerable:!0,get:function(){return n.authCodes}}),Object.defineProperty(t,"bridgeCodes",{enumerable:!0,get:function(){return n.bridgeCodes}}),Object.defineProperty(t,"callCodes",{enumerable:!0,get:function(){return n.callCodes}}),Object.defineProperty(t,"callHistoryCodes",{enumerable:!0,get:function(){return n.callHistoryCodes}}),Object.defineProperty(t,"clickToCallCodes",{enumerable:!0,get:function(){return n.clickToCallCodes}}),t.default=void 0,Object.defineProperty(t,"groupsCodes",{enumerable:!0,get:function(){return n.groupsCodes}}),Object.defineProperty(t,"messagingCodes",{enumerable:!0,get:function(){return n.messagingCodes}}),Object.defineProperty(t,"mwiCodes",{enumerable:!0,get:function(){return n.mwiCodes}}),Object.defineProperty(t,"presenceCodes",{enumerable:!0,get:function(){return n.presenceCodes}}),Object.defineProperty(t,"proxyCodes",{enumerable:!0,get:function(){return n.proxyCodes}}),Object.defineProperty(t,"sipEventCodes",{enumerable:!0,get:function(){return n.sipEventCodes}}),Object.defineProperty(t,"subscriptionCodes",{enumerable:!0,get:function(){return n.subscriptionCodes}}),Object.defineProperty(t,"usersCodes",{enumerable:!0,get:function(){return n.usersCodes}}),Object.defineProperty(t,"webrtcCodes",{enumerable:!0,get:function(){return n.webrtcCodes}});var n=r(88058);const o=t.NO_CODE="NO_CODE";t.default=class{constructor(e){let{message:t,code:r}=e;this.name="BasicError",this.code=r||o,this.message=t?`${t}`:"An error occurred."}}},5902:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,o.default)();e.factory("emitEvent",(()=>{const r=e.container.logManager.getLogger("EVENTS");return function(e,n){r.info(`Emitting event: ${e}`,n),t.emit(e,n)}}));const r={on:(e,r)=>{t.on(e,r)},off:(e,r)=>{t.off(e,r)},subscribe:e=>{t.subscribe(e)},unsubscribe:e=>{t.unsubscribe(e)}};return e.value("Events",r),{api:n.default.createAPI,name:n.default.name,reducer:n.default.reducer}};var n=a(r(29834)),o=a(r(19353));function a(e){return e&&e.__esModule?e:{default:e}}},12497:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EVENTS_UNSUBSCRIBE=t.EVENTS_SUBSCRIBE=t.EVENTS_ON=t.EVENTS_OFF=void 0;const r="@@KANDY/";t.EVENTS_ON=r+"EVENTS_ON",t.EVENTS_OFF=r+"EVENTS_OFF",t.EVENTS_SUBSCRIBE=r+"EVENTS_SUBSCRIBE",t.EVENTS_UNSUBSCRIBE=r+"EVENTS_UNSUBSCRIBE"},44745:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.off=function(e,t){return{type:n.EVENTS_OFF,payload:{eventType:e,listener:t}}},t.on=function(e,t){return{type:n.EVENTS_ON,payload:{eventType:e,listener:t}}},t.subscribe=function(e){return{type:n.EVENTS_SUBSCRIBE,payload:e}},t.unsubscribe=function(e){return{type:n.EVENTS_UNSUBSCRIBE,payload:e}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(12497));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},38010:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,context:r,Events:o,API_LOG_TAG:a}=e,i=t.getLogger("EVENTS");return{on:function(e,t){i.debug(a+"on: ",e),r.dispatch((0,n.on)(e,t)),o.on(e,t)},off:function(e,t){i.debug(a+"off: ",e),r.dispatch((0,n.off)(e,t)),o.off(e,t)},subscribe:function(e){i.debug(a+"subscribe"),r.dispatch((0,n.subscribe)(e)),o.subscribe(e)},unsubscribe:function(e){i.debug(a+"unsubscribe"),r.dispatch((0,n.unsubscribe)(e)),o.unsubscribe(e)}}};var n=r(44745)},29834:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(38010)),o=a(r(91373));function a(e){return e&&e.__esModule?e:{default:e}}t.default={createAPI:n.default,name:"events",reducer:o.default}},91373:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return(0,n.default)(t.type,i)?{...e,[t.payload.eventType]:l(e[t.payload.eventType],t)}:e};var n=c(r(82549)),o=c(r(20481)),a=c(r(49549)),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(12497));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function c(e){return e&&e.__esModule?e:{default:e}}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{aliases:[],count:0};switch((arguments.length>1?arguments[1]:void 0).type){case i.EVENTS_ON:return(0,a.default)("count",(0,o.default)(1),e);case i.EVENTS_OFF:return(0,a.default)("count",(0,o.default)(-1),e);default:return e}}},37984:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.factory=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=(0,l.getVersion)(),d=(0,o.default)(t);let{common:f,...g}=d;f=(0,c.default)(p,f),E(f);const _=new s.default;let y;_.defer((e=>{if(e.logManager&&e.logManager.getLogger){const t=e.logManager.getLogger("FACTORY");t&&t.info&&t.info(`SDK version: ${r}`)}}));const v=[],S=[],O=[],h={},T={container:_.container,capabilities:[],api:{},getState(){if(!y)throw Error("Store is not available during factory creation");if(I)throw Error("State is not available if the SDK has been destroyed");return y.getState()},dispatch(){if(!y)throw Error("Store is not available during factory creation");return y.dispatch(...arguments)},subscribe(e){if(!y)throw Error("Store is not available during factory creation");return y.subscribe(e)}};_.value("context",T),_.factory("TimerTracker",u.timerFactory);let I=!1;e.filter((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return("proxy"!==e.name||!f.disableProxy)&&"function"==typeof e.fn})).map((e=>e.fn(_,g[e.name]))).filter((e=>Boolean(e))).forEach((e=>{if(e.capabilities&&(T.capabilities=T.capabilities.concat(e.capabilities)),e.reducer&&(h[e.name]=e.reducer),e.middleware){const t="logs"===e.name?0:1;O.splice(O.length-t,0,(()=>e.middleware(T)))}"function"==typeof e.api&&S.push(e.api),"function"==typeof e.cleanup&&v.push(e.cleanup)}));const C=f.enableReduxDevTools?(0,i.composeWithDevTools)({name:f.reduxDevToolsName}):a.compose;return y=(0,a.createStore)((0,a.combineReducers)(h),C((0,a.applyMiddleware)((e=>e=>t=>I?null:e(t)),...O))),S.forEach((e=>{T.api=(0,n.default)(T.api,e(_.container))})),_.resolve(_.container),{...T.api,state:{get:function(){return y.getState()},subscribe:function(){return y.subscribe(...arguments)}},getCapabilities:()=>T.capabilities,getVersion:()=>r,destroy(){setTimeout((()=>{I||(v.forEach((e=>e(_.container))),y.replaceReducer((function(e,t){return{}})),I=!0)}),0)}}},r(97107),r(69375);var n=f(r(96042)),o=f(r(89321)),a=r(14848),i=r(88185),s=f(r(8997)),c=f(r(7485)),l=r(13126),u=r(17249),d=r(52932);function f(e){return e&&e.__esModule?e:{default:e}}const p={enableReduxDevTools:!1,reduxDevToolsName:"WebRTC SDK",disableProxy:!1},g=d.validation.schema({enableReduxDevTools:d.validation.boolean(),reduxDevToolsName:d.validation.string(),disableProxy:d.validation.boolean()}),E=(0,d.parse)("common",g)},97186:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(["group","groupCollapsed"].includes(e.method))return void console[e.method](...e.messages);if("groupEnd"===e.method)return void console.groupEnd();const{prefix:t,style:r,payload:n}=function(e){const{timestamp:t,level:r}=e,n=`${t} - ACTION - ${r}`;let o,[a,i]=e.messages,s="";return a.includes("state")?o=`${n} - ${a.toUpperCase()}`:a.includes("ADDED")||a.includes("DELETED")||a.includes("ARRAY")?(o=`${e.messages[0]}: ${e.messages[2]}`,s=e.messages[1],i=e.messages[3]):a.includes("CHANGED")?(o=`${e.messages[0]}: ${e.messages[2]}`,s=e.messages[1],i=`${e.messages[3]} ${e.messages[4]} ${e.messages[5]}`):a.includes("no diff")?(o=`${n} - NO DIFF`,i=""):o=`${n} - ${i.type} - ${a}`,{prefix:o,style:s,payload:i}}(e);console[e.method](t,r,n)},r(62234)},26672:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=o.logManager.getLogger("ACTION");t.setHandler(e.logActions.handler),t.setLevel(e.logActions.level);let r={};var n;a.logLevels[e.logLevel]===a.logLevels.INFO?(r.level=!1,r.diff=!1):r={...e.logActions},e.logActions.actionOnly&&(r.level={prevState:!1,action:"info",error:"info",nextState:!1}),e.logActions.excludeActions&&(r.predicate=(n=e.logActions.excludeActions,(e,t)=>!n.includes(t.type))),r.logger=t,r.titleFormatter=s.titleFormatter,r.colors=!1;const l=(0,i.default)(e.logActions);return(0,c.createLogger)({...r,...l})},r(62234);var n,o=r(69932),a=r(75188),i=(n=r(30106))&&n.__esModule?n:{default:n},s=r(28009),c=r(17783)},30106:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={},r=[];return e.exposePayloads?r.push(a):r.push(i),t.actionTransformer=function(e){return function(t){return e.forEach((function(e){t=e(t)})),t}}(r),t},r(69375);var n,o=(n=r(14017))&&n.__esModule?n:{default:n};function a(e){return e.meta&&e.meta.isSensitive?(0,o.default)("payload",e):e}function i(e){return e.meta&&e.meta.isSafe?e:(0,o.default)("payload",e)}},28009:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.titleFormatter=function(e,t,r){var n=["action"];return n.push(e.type),n.push("@ "+t),n.push("(in "+r.toFixed(2)+" ms)"),n.join(" ")},r(69375)},21360:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.partialDefaultLogActions=t.defaultOptions=void 0;var n,o=(n=r(97186))&&n.__esModule?n:{default:n};t.defaultOptions={logLevel:"debug",handler:void 0,logActions:!1},t.partialDefaultLogActions={handler:o.default,actionOnly:!1,collapsed:!1,diff:!1,level:"debug",exposePayloads:!0}},14849:()=>{},69932:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logManager=t.API_LOG_TAG=void 0;var n,o=(n=r(44413))&&n.__esModule?n:{default:n},a=r(21360);t.API_LOG_TAG="API invoked: ";const i=(0,o.default)(a.defaultOptions);t.logManager=i},42791:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SET_LEVEL=t.SET_HANDLER=t.LEVELS_CHANGE=t.HANDLERS_CHANGE=void 0;const r="@@KANDY/LOGS/";t.SET_LEVEL=r+"SET_LEVEL",t.LEVELS_CHANGE=r+"LEVELS_CHANGE",t.SET_HANDLER=r+"SET_HANDLER",t.HANDLERS_CHANGE=r+"HANDLERS_CHANGE"},45183:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handlersChanged=function(e){return{type:n.HANDLERS_CHANGE,payload:e}},t.levelsChanged=function(e){return{type:n.LEVELS_CHANGE,payload:e}},t.setHandler=function(e,t){return{type:n.SET_HANDLER,payload:{handler:e,type:t}}},t.setLevel=function(e,t){return{type:n.SET_LEVEL,payload:{level:e,type:t}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(42791));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},49528:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,LogsOperations:r,logManager:a,API_LOG_TAG:i}=e,s=a.getLogger("LOGS");return{logger:{levels:{SILENT:"silent",ERROR:"error",WARN:"warn",INFO:"info",DEBUG:"debug"},async setLevel(e,o){s.debug(i+"logger.setLevel: ",e,o),t.dispatch(n.setLevel(e,o));try{await r.setLogLevel(e,o)}catch(e){s.error(e.message)}},getLevel:e=>(s.debug(i+"logger.getLevel: ",e),(0,o.getLevel)(t.getState(),e)),async setHandler(e,o){s.debug(i+"logger.setHandler: ",e,o),t.dispatch(n.setHandler(e,o));try{await r.setLogHandler(e,o)}catch(e){s.error(e.message)}},getTypes:()=>(s.debug(i+"logger.getTypes"),(0,o.getTypes)(t.getState()))}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(45183)),o=r(98530);function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},50804:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createAPI",{enumerable:!0,get:function(){return n.default}}),t.name=void 0,Object.defineProperty(t,"reducer",{enumerable:!0,get:function(){return o.default}});var n=a(r(49528)),o=a(r(43375));function a(e){return e&&e.__esModule?e:{default:e}}t.name="logs"},43375:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(42791)),o=r(45775);function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}const i={};i[n.LEVELS_CHANGE]={next:(e,t)=>({...e,...t.payload})};const s=(0,o.handleActions)(i,{});t.default=s},98530:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLevel=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DEFAULT";return(0,o.default)(e).logs[t]},t.getTypes=function(e){const t=(0,o.default)(e);return Object.keys(t.logs)};var n,o=(n=r(89321))&&n.__esModule?n:{default:n}},28445:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHandlerMap=function(e){const t=e.getLoggers(),r=[...new Set(t.map((e=>e.type)))],o={};return o[n]=e.getHandler(),r.forEach((t=>{o[t]=e.getHandler(t)})),o},t.getLevelMap=function(e){const t=e.getLoggers(),r=[...new Set(t.map((e=>e.type)))],o={};return o[n]=e.getLevel(),r.forEach((t=>{o[t]=e.getLevel(t)})),o},r(69033),r(68903),r(21018),r(1415),r(4448),r(58871),r(56539);const n="DEFAULT"},28088:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r}=e,a="DEFAULT";return{setLogLevel:async function(e,i){i&&i!==a?(r.setLevel(i,e),r.getLoggers(i).forEach((t=>{t.setLevel(e)})),t.dispatch(n.levelsChanged({[i]:e}))):(r.setLevel(e),r.getLoggers().forEach((t=>{t.setLevel(e)})),t.dispatch(n.levelsChanged((0,o.getLevelMap)(r))))},setLogHandler:async function(e,i){i&&i!==a?(r.setHandler(i,e),r.getLoggers(i).forEach((t=>{t.setHandler(e)})),t.dispatch(n.handlersChanged({[i]:e}))):(r.setHandler(e),r.getLoggers().forEach((t=>{t.setHandler(e)})),t.dispatch(n.handlersChanged((0,o.getHandlerMap)(r))))}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(45183)),o=r(28445);function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},98953:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.value("logManager",f.logManager),e.constant("API_LOG_TAG",f.API_LOG_TAG),e.factory("LogsOperations",i.default);const r=f.logManager.getLogger("LOGS");t.handler&&"function"!=typeof t.handler&&(delete t.handler,r.warn("Invalid log handler configuration provided; using default instead.")),t.logLevel&&!Object.keys(d.logLevels).includes(t.logLevel.toUpperCase())&&(delete t.logLevel,r.warn("Invalid log level configuration provided; using default instead.")),t=(0,u.default)(s.defaultOptions,t),!1!==t.logActions&&(t.logActions instanceof Object?t.logActions=(0,u.default)(s.partialDefaultLogActions,t.logActions):t.logActions=s.partialDefaultLogActions),f.logManager.setLevel(t.logLevel),t.handler&&f.logManager.setHandler(t.handler),Object.values(f.logManager.getLoggers()).forEach((e=>{e.setLevel(t.logLevel),t.handler&&e.setHandler(t.handler)}));const p={api:n.createAPI,capabilities:["logs"],name:n.name,reducer:n.reducer};return t.logLevel=t.logLevel.toUpperCase(),d.logLevels[t.logLevel]<=d.logLevels.INFO&&!1!==t.logActions&&(p.middleware=(0,c.default)(t)),e.defer((function(e){const{context:r,WebRTC:i}=e;if(r.dispatch((0,l.update)(t,n.name)),r.dispatch(o.levelsChanged((0,a.getLevelMap)(f.logManager))),i){const e=i.logs;t.handler&&e.setHandler(t.handler),Object.values(e.getLoggers()).forEach((e=>{e.setLevel(t.logLevel),t.handler&&e.setHandler(t.handler)}))}})),p},r(62234);var n=r(50804),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=g(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(45183)),a=r(28445),i=p(r(28088)),s=r(21360),c=p(r(26672)),l=r(87310),u=p(r(7485)),d=r(44413),f=r(69932);function p(e){return e&&e.__esModule?e:{default:e}}function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(g=function(e){return e?r:t})(e)}r(14849)},87834:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_CONVERSATION=t.SEND_MESSAGE_READ_FINISH=t.SEND_MESSAGE_READ=t.SEND_MESSAGE_FINISH=t.SEND_MESSAGE=t.MESSAGE_RECEIVED=t.INCOMING_MESSAGE_READ=t.FILE_UPLOAD_FAIL=t.FETCH_MESSAGES_FINISHED=t.FETCH_MESSAGES=t.FETCH_CONVERSATIONS_FINISHED=t.FETCH_CONVERSATIONS=t.DELETE_MESSAGE_FINISH=t.DELETE_MESSAGE=t.DELETE_CONVERSATION_FINISH=t.DELETE_CONVERSATION=t.CREATE_CONVERSATION=t.CLEAR_MESSAGES_FINISH=t.CLEAR_MESSAGES=void 0;const r="@@KANDY/";t.CREATE_CONVERSATION=r+"CREATE_CONVERSATION",t.SEND_MESSAGE=r+"SEND_MESSAGE",t.SEND_MESSAGE_FINISH=r+"SEND_MESSAGE_FINISH",t.MESSAGE_RECEIVED=r+"MESSAGE_RECEIVED",t.INCOMING_MESSAGE_READ=r+"INCOMING_MESSAGE_READ",t.SEND_MESSAGE_READ=r+"SEND_MESSAGE_READ",t.SEND_MESSAGE_READ_FINISH=r+"SEND_MESSAGE_READ_FINISH",t.CLEAR_MESSAGES=r+"CLEAR_MESSAGES",t.CLEAR_MESSAGES_FINISH=r+"CLEAR_MESSAGES_FINISH",t.DELETE_CONVERSATION=r+"DELETE_CONVERSATION",t.DELETE_CONVERSATION_FINISH=r+"DELETE_CONVERSATION_FINISH",t.DELETE_MESSAGE=r+"DELETE_MESSAGES",t.DELETE_MESSAGE_FINISH=r+"DELETE_MESSAGES_FINISH",t.FETCH_CONVERSATIONS=r+"FETCH_CONVERSATIONS",t.FETCH_CONVERSATIONS_FINISHED=r+"FETCH_CONVERSATIONS_FINISHED",t.UPDATE_CONVERSATION=r+"UPDATE_CONVERSATION",t.FETCH_MESSAGES=r+"FETCH_MESSAGES",t.FETCH_MESSAGES_FINISHED=r+"FETCH_MESSAGES_FINISHED",t.FILE_UPLOAD_FAIL=r+"FILE_UPLOAD_FAIL"},40593:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createConversation=function(e,t){return{type:n.CREATE_CONVERSATION,payload:{destination:e,messages:[],isTypingList:[],...t}}},t.deleteConversation=function(e,t){return{type:n.DELETE_CONVERSATION,payload:{destination:e,type:t}}},t.deleteConversationFinish=function(e){let{destination:t,type:r,error:o}=e;return{type:n.DELETE_CONVERSATION_FINISH,payload:o||{destination:t,type:r},error:!!o}},t.fetchConversations=function(e){return{type:n.FETCH_CONVERSATIONS,payload:{...e}}},t.fetchConversationsFinished=function(e){let{conversations:t,error:r}=e;return{type:n.FETCH_CONVERSATIONS_FINISHED,payload:r||{conversations:t},error:Boolean(r)}},t.updateConversation=function(e){return{type:n.UPDATE_CONVERSATION,payload:e}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(87834));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},29889:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.messageActions=t.convoActions=void 0;var n=i(r(89129)),o=i(r(40593));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}t.messageActions=n,t.convoActions=o},89129:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearMessages=function(e,t){return{type:n.CLEAR_MESSAGES,payload:{destination:e,type:t}}},t.deleteMessage=function(e,t,r){return{type:n.DELETE_MESSAGE,payload:{destination:e,type:t,messageId:r}}},t.deleteMessageFinish=function(e){let{destination:t,type:r,messageId:o,error:a}=e;return{type:n.DELETE_MESSAGE_FINISH,payload:a||{destination:t,type:r,messageId:o},error:!!a}},t.fetchMessages=function(e,t,r){return{type:n.FETCH_MESSAGES,payload:{destination:e,amount:t,type:r}}},t.fetchMessagesFinished=function(e,t,r,o){return{type:n.FETCH_MESSAGES_FINISHED,payload:o||{destination:e,type:t,messages:r},error:!!o}},t.incomingMessageRead=void 0,t.messageReceived=function(e,t,r,o,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{type:"im",newConversation:!1};return{type:n.MESSAGE_RECEIVED,meta:i,payload:{destination:e,message:{timestamp:a,isPending:!1,read:!1,parts:t,sender:o,messageId:r}}}},t.sendMessageRead=t.sendMessageFinish=t.sendMessage=void 0,t.sendMessageReadFinish=function(e){let{messageId:t,participant:r,error:o}=e;return{type:n.SEND_MESSAGE_READ_FINISH,payload:o||{messageId:t,participant:r},error:Boolean(o)}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(87834));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function a(e,t,r){return{type:e,payload:{messageId:t,participant:r}}}t.sendMessage=(e,t,r,o,a)=>function(e,t,r,n,o,a){return{type:e,payload:{destination:t,id:a,message:{timestamp:n,isPending:!0,read:!1,parts:r,type:o}}}}(n.SEND_MESSAGE,e,t,r,o,a),t.sendMessageFinish=e=>{let{destination:t,sender:r,type:o,parts:a,timestamp:i,messageId:s,deliveryStatus:c,error:l}=e;return{type:n.SEND_MESSAGE_FINISH,payload:{destination:t,sender:r,type:o,parts:a,timestamp:i,messageId:s,deliveryStatus:c,error:l},error:Boolean(l)}},t.incomingMessageRead=(e,t)=>a(n.INCOMING_MESSAGE_READ,e,t),t.sendMessageRead=(e,t)=>a(n.SEND_MESSAGE_READ,e,t)},51465:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,API_LOG_TAG:r,context:a,MixinsMessaging:i}=e,s=t.getLogger("MESSAGING");return{conversation:{get:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"im"};s.debug(r+"conversation.get: ",e,t);const n=Array.isArray(e)?[...e]:[e];let c,l,u="Conversation";const d=(0,o.findConversation)(a.getState(),n,t.type);if(d){if(t.type===d.type)return u=d.description,c=d.messages,l=d.id,i.Conversation({destination:n,type:t.type,id:l,description:u,messages:c,lastMessage:d.lastMessage,isTypingList:d.isTypingList,lastReceived:d?d.lastReceived:void 0,lastPull:d?d.lastPull:void 0});s.info("Conversation found with matching destination, but conversation type does not match the type requested. Please specify the appropriate type, or call client.conversation.create() for a new type of conversation")}else s.info("Requested conversation not in state. Please use the create function if you would like a new conversation object.")},create:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"im"};s.debug(r+"conversation.create: ",e,t);const c=Array.isArray(e)?e:[e];return(0,o.findConversation)(a.getState(),c,t.type)||a.dispatch(n.convoActions.createConversation(c,t)),i.Conversation({destination:c,type:t.type})},getAll:function(){return s.debug(r+"conversation.getAll"),(0,o.getConversations)(a.getState()).map((e=>i.Conversation(e)))}}}};var n=r(29889),o=r(33603)},35180:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MESSAGES_ERROR=t.MESSAGES_CHANGE=t.CONVERSATIONS_NEW=t.CONVERSATIONS_CHANGE=void 0,t.CONVERSATIONS_NEW="conversations:new",t.CONVERSATIONS_CHANGE="conversations:change",t.MESSAGES_CHANGE="messages:change",t.MESSAGES_ERROR="messages:error"},78817:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createAPI",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"createMixins",{enumerable:!0,get:function(){return o.default}}),t.name=void 0,Object.defineProperty(t,"reducer",{enumerable:!0,get:function(){return a.default}});var n=i(r(51465)),o=i(r(8703)),a=i(r(54980));function i(e){return e&&e.__esModule?e:{default:e}}t.name="messaging"},8703:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,API_LOG_TAG:r,context:l,emitEvent:u,MessagingOperations:d}=e,f=t.getLogger("MESSAGING"),p=function(e){let t,{destination:n,part:o,messageContext:i,type:s="im"}=e;return"string"!=typeof o&&"text"!==o.type||(t={type:"text",text:o.text}),{destination:Array.isArray(n)?n:[n],messageContext:i,type:s,parts:[t],send:async function(){f.debug(`${r}conversation.Message.send`,this);const e=Date.now();l.dispatch(a.messageActions.sendMessage(this.destination,this.parts,e,this.type,this.messageContext.id));try{await d.sendMessage(this.destination[0],e,this.parts)}catch(e){f.debug(`${r}conversation.Message.send: Encountered an error: ${e}`),u(c.MESSAGES_CHANGE,{error:e})}}}};return{Conversation:function(e){let{destination:t,type:g="im",id:E,description:_="",messages:y=[],isTypingList:v=[],lastReceived:S,lastPull:O,lastMessage:h=""}=e;return{destination:t,type:g,description:_,messages:y,lastMessage:h,isTypingList:v,id:E,features:(0,i.getMessagingConfig)(l.getState()).features,lastReceived:S,lastPull:O,isPending:!1,createMessage:function(e){f.debug(`${r}conversation.Conversation.getMessages`);const t={features:this.features,id:this.id,type:this.type};return p({destination:this.destination,part:e,messageContext:t,type:this.type})},clearMessages:function(){f.debug(`${r}conversation.Conversation.clearMessages`),l.dispatch(a.messageActions.clearMessages(this.destination,this.type)),u(c.MESSAGES_CHANGE,{destination:this.destination,type:this.type})},getMessages:function(){return f.debug(`${r}conversation.Conversation.getMessages`),(0,i.findConversation)(l.getState(),this.destination,this.type).messages.map((e=>{e.forward=async t=>{const n=Date.now();l.dispatch(a.messageActions.sendMessage(t,e.parts,n,this.type,this.id));try{await d.sendMessage(t,n,e.parts)}catch(e){f.debug(`${r}conversation.Message.forward: Encountered an error: ${e}`),u(c.MESSAGES_CHANGE,{error:e})}};const t=(0,s.getUserInfo)(l.getState());return e.sender!==t.username&&(e.markRead=()=>{l.dispatch(a.messageActions.sendMessageRead(e.messageId,this.destination))}),e}))},getMessage:function(e){f.debug(`${r}conversation.Conversation.getMessage`);const t=(0,i.findConversation)(l.getState(),this.destination,this.type),n=(0,o.default)((t=>t.messageId===e))(t.messages);if(!n)return void f.debug(`Message (${e}) not found in conversation (${this.destination}).`);n.forward=async e=>{const t=Date.now();l.dispatch(a.messageActions.sendMessage(e,n.parts,t,this.type,this.id));try{await d.sendMessage(e,t,n.parts)}catch(e){f.debug(`${r}conversation.Message.forward: Encountered an error: ${e}`),u(c.MESSAGES_CHANGE,{error:e})}};const p=(0,s.getUserInfo)(l.getState());return n.sender!==p.username&&(n.markRead=()=>{l.dispatch(a.messageActions.sendMessageRead(n.messageId,this.destination))}),n},subscribe:function(e){if(f.debug(`${r}conversation.Conversation.subscribe`),e){const t=t=>{let{destination:r,messageId:o}=t;(0,n.default)(r,this.destination)&&e({destination:r,messageId:o})};return l.api.on("messages:change",t),()=>{l.api.off("messages:change",t)}}}}},Message:p}};var n=u(r(36582)),o=u(r(5215)),a=r(29889),i=r(33603),s=r(87075),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(35180));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e){return e&&e.__esModule?e:{default:e}}},54980:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=u(r(36582)),o=u(r(15353)),a=u(r(37273)),i=u(r(3e4)),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(87834)),c=r(45775);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e){return e&&e.__esModule?e:{default:e}}const d={};d[s.CREATE_CONVERSATION]={next:(e,t)=>({...e,conversations:[...e.conversations,{...t.payload}]})},d[s.FETCH_CONVERSATIONS_FINISHED]={next:(e,t)=>({...e,conversations:(0,a.default)(((e,t)=>(0,n.default)(e.destination,t.destination)&&e.type===t.type),t.payload.conversations,e.conversations)})},d[s.UPDATE_CONVERSATION]={next:(e,t)=>({...e,conversations:e.conversations.map((e=>(0,n.default)(e.destination,t.payload.destination)&&e.type===t.payload.type?{...e,...t.payload}:e))})},d[s.FETCH_MESSAGES]={next:(e,t)=>({...e,conversations:e.conversations.map((e=>(0,n.default)(e.destination,t.payload.destination)&&e.type===t.payload.type?{...e,isPending:!0}:e))})},d[s.FETCH_MESSAGES_FINISHED]={next:(e,t)=>({...e,conversations:e.conversations.map((e=>(0,n.default)(e.destination,t.payload.destination)&&e.type===t.payload.type?{...e,messages:(0,o.default)("timestamp",(0,i.default)("messageId",t.payload.messages,e.messages)),isTypingList:[],isPending:!1}:e))})},d[s.SEND_MESSAGE]={next:(e,t)=>({...e,conversations:e.conversations.map((e=>(0,n.default)(e.destination,t.payload.destination)&&e.type===t.payload.message.type?{...e,messages:[...e.messages,t.payload.message]}:e))})},d[s.INCOMING_MESSAGE_READ]={next:(e,t)=>({...e,conversations:e.conversations.map((e=>(0,n.default)(e.destination,t.payload.destination)&&e.type===t.payload.type?{...e,messages:e.messages.map((e=>e.messageId===t.payload.messageId?{...e,read:!0}:e))}:e))})},d[s.SEND_MESSAGE_READ_FINISH]={next:(e,t)=>({...e,conversations:e.conversations.map((e=>(0,n.default)(e.destination,t.payload.destination)&&e.type===t.payload.type?{...e,messages:e.messages.map((e=>e.messageId===t.payload.messageId?{...e,read:!0}:e))}:e))})},d[s.MESSAGE_RECEIVED]={next:(e,t)=>t.meta.newConversation?{...e,conversations:[...e.conversations,{destination:t.payload.destination,messages:[t.payload.message],type:t.meta.type,lastReceived:t.payload.message.timestamp}]}:{...e,conversations:e.conversations.map((e=>(0,n.default)(e.destination,t.payload.destination)&&e.type===t.meta.type?{...e,messages:[...e.messages,t.payload.message],lastReceived:t.payload.message.timestamp}:e))}},d[s.SEND_MESSAGE_FINISH]={next:(e,t)=>({...e,conversations:e.conversations.map((e=>(0,n.default)(e.destination,t.payload.destination)&&e.type===t.payload.type?{...e,messages:e.messages.map((e=>function(e,t){return e.timestamp===t.payload.timestamp?(e=t.payload.error?{...e,sender:t.payload.sender,isPending:!1,messageId:null,error:t.payload.error}:{...e,sender:t.payload.sender,isPending:!1,messageId:t.payload.messageId,parts:t.payload.parts},t.payload.deliveryStatus&&(e.deliveryStatus=t.payload.deliveryStatus)):e={...e},e}(e,t)))}:e))}),throw:(e,t)=>({...e,conversations:e.conversations.map((e=>(0,n.default)(e.destination,t.payload.destination)&&e.type===t.payload.type?{...e,messages:e.messages.filter((e=>e.timestamp!==t.payload.timestamp&&!e.isPending))}:e))})},d[s.CLEAR_MESSAGES]={next:(e,t)=>({...e,conversations:e.conversations.map((e=>(0,n.default)(e.destination,t.payload.destination)&&e.type===t.payload.type?{...e,messages:[]}:e))})},d[s.DELETE_MESSAGE_FINISH]={next:(e,t)=>({...e,conversations:e.conversations.map((e=>(0,n.default)(e.destination,t.payload.destination)&&e.type===t.payload.type?{...e,messages:e.messages.filter((e=>e.messageId!==t.payload.messageId))}:e))}),throw:(e,t)=>({...e,errors:e.errors.concat(t.payload)})},d[s.DELETE_CONVERSATION_FINISH]={next:(e,t)=>({...e,conversations:e.conversations.filter((e=>!((0,n.default)(e.destination,t.payload.destination)&&e.type===t.payload.type)))}),throw:(e,t)=>({...e,errors:e.errors.concat(t.payload)})};const f=(0,c.handleActions)(d,{conversations:[],errors:[]});t.default=f},33603:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findConversation=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"im";return(0,o.default)(e.messaging.conversations.find((e=>(0,n.default)(e.destination,t)&&e.type===r)))},t.findMember=function(e,t,r){const n=e.messaging.conversations.find((e=>e.destination===t));if(n)return(0,o.default)(n.members.find((e=>e.id===r)))},t.getConversations=function(e){return(0,o.default)(e.messaging.conversations)},t.getMessages=function(e,t){return(0,o.default)(e.messaging.conversations[t].messages)},t.getMessagingConfig=function(e){return(0,o.default)(e.config.messaging)};var n=a(r(36582)),o=a(r(89321));function a(e){return e&&e.__esModule?e:{default:e}}},55318:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={features:["base"]},{logManager:u}=e.container,d=u.getLogger("MESSAGING"),f=c.validation.schema({features:c.validation.array().every.string()}),p=(0,c.parse)("messaging",f);return t=(0,n.default)(r,t),p(t),(t.features.length>1||t.features[0]!==r.features[0])&&(d.warn("WebRTC Gateway's messaging is not compatible with add-on features. Reverting to base messaging."),t.features=r.features),d.info("Messaging features in use: "+t.features),e.factory("MixinsMessaging",o.createMixins),e.defer((function(e){const{context:r}=e;r.dispatch((0,l.update)(t,o.name))})),e.factory("MessagingOperations",a.default),e.factory("MessagingRequests",s.default),{api:o.createAPI,capabilities:["simpleMessagingOnly","onlyInternalMessaging"],middleware:i.default,name:o.name,reducer:o.reducer}};var n=u(r(38142)),o=r(78817),a=u(r(57830)),i=u(r(2748)),s=u(r(39266)),c=r(52932),l=r(87310);function u(e){return e&&e.__esModule?e:{default:e}}},2748:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.container.MessagingOperations;return e=>r=>(r.type===n.NOTIFICATION_RECEIVED&&r.payload.notificationMessage&&"IM"===r.payload.notificationMessage.eventType&&t.messageReceived(r),e(r))};var n=r(70506)},57830:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,logManager:l,MessagingRequests:u}=e,d=l.getLogger("MESSAGING");return{messageReceived:function(e){const{dispatch:i,getState:s}=t;if(![c.NOTIFICATION_RECEIVED].includes(e.type))return;if(!e.payload.notificationMessage||"IM"!==e.payload.notificationMessage.eventType)return;const l=e.payload.notificationMessage.imnotificationParams.msgText,u=e.payload.notificationMessage.imnotificationParams.primaryContact.split("sip:")[1],d=e.payload.notificationMessage.eventId,f="im";if((0,o.getConversations)(s()).find((e=>e.destination[0]===u))){i(n.messageActions.messageReceived([u],[{mimeType:"text/plain",type:"text",text:l}],d,u,Date.now(),{newConversation:!1,type:f}));const e={destination:[u],messageId:d,type:f};r(a.MESSAGES_CHANGE,e)}else{i(n.messageActions.messageReceived([u],[{mimeType:"text/plain",type:"text",text:l}],d,u,Date.now(),{newConversation:!0,type:"im"}));const e=[{destination:[u],type:f}];r(a.CONVERSATIONS_CHANGE,e)}},sendMessage:async function(e,o,c){const l=(0,s.getConnectionInfo)(t.getState()),f="im";let p;if(!l)throw d.debug("Sending mesage was aborted due to: no connection info available. Ensure user is authenticated."),p=new i.default({code:i.messagingCodes.SEND_MESSAGE_FAIL,message:"Failed to send message; no user connection info available."}),t.dispatch(n.messageActions.sendMessageFinish({sender:void 0,destination:[e],type:f,parts:c,timestamp:o,error:p})),r(a.MESSAGES_ERROR,{error:p}),p;const{username:g}=l;try{const i=await u.sendMessage(e,c,l);t.dispatch(n.messageActions.sendMessageFinish({sender:g,destination:[e],type:f,parts:c,timestamp:o,messageId:i.messageId})),r(a.MESSAGES_CHANGE,{destination:[e],type:f,messageId:i.messageId,sender:g})}catch(p){throw t.dispatch(n.messageActions.sendMessageFinish({sender:g,destination:[e],type:f,parts:c,timestamp:o,error:p})),r(a.MESSAGES_ERROR,{error:p}),p}}}},r(62234);var n=r(29889),o=r(33603),a=u(r(35180)),i=u(r(75412)),s=r(87075),c=r(70506);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},39266:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,sendRequest:r}=e,o=t.getLogger("MESSAGING");return{sendMessage:async function(e,t,a){const{server:i,username:s}=a,c=`${i.protocol}://${i.server}:${i.port}/rest/version/${i.version}/user/${s}/instantmessage`,l={imRequest:{charset:"UTF-8",toUrl:e,message:t[0].text,type:"A2"}},u={url:c,method:"POST",body:JSON.stringify(l)},d=await r(u),{error:f,result:p,body:g}=d;if(f){if(g){const{statusCode:e}=g.imResponse;throw o.debug(`Failed to send message with status code ${e}.`),new n.default({code:n.messagingCodes.SEND_MESSAGE_FAIL,message:`Failed to send message. Code: ${e}.`})}{const{message:e}=p;throw o.debug("Send message request failed",e),new n.default({code:n.messagingCodes.SEND_MESSAGE_FAIL,message:`Send message request failed: ${e}.`})}}if(g.imResponse&&g.imResponse.messageId)return{messageId:g.imResponse.messageId};throw new n.default({code:n.messagingCodes.SEND_MESSAGE_FAIL,message:"Failed to send message: Unexpected error"})}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(75412));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},41181:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MWI_UPDATE=void 0,t.MWI_UPDATE="@@KANDY/MWI_UPDATE"},53:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mwiUpdate=function(e){let{mwiData:t,error:r}=e;return r?{type:n.MWI_UPDATE,payload:r,error:!0}:{type:n.MWI_UPDATE,payload:{...t}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(41181));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},11918:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,MWIOperations:a,logManager:i,API_LOG_TAG:s}=e,c=i.getLogger("MWI");return{voicemail:{async fetch(){let e;c.debug(s+"voicemail.fetch");try{e=await a.fetchMwi()}catch(e){return void r(o.MWI_ERROR,{error:e})}r(o.MWI_CHANGE,e)},get:()=>(c.debug(s+"voicemail.get"),(0,n.getMwi)(t.getState()))}}};var n=r(2556),o=r(44717)},44717:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MWI_ERROR=t.MWI_CHANGE=void 0,t.MWI_CHANGE="voicemail:change",t.MWI_ERROR="voicemail:error"},5174:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"api",{enumerable:!0,get:function(){return n.default}}),t.name=void 0,Object.defineProperty(t,"reducer",{enumerable:!0,get:function(){return o.default}});var n=a(r(11918)),o=a(r(95449));function a(e){return e&&e.__esModule?e:{default:e}}t.name="mwi"},95449:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(41181)),o=r(45775);function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}const i={};i[n.MWI_UPDATE]={next:(e,t)=>({...t.payload})};const s=(0,o.handleActions)(i,{});t.default=s},2556:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMwi=function(e){return(0,o.default)(e.mwi)};var n,o=(n=r(89321))&&n.__esModule?n:{default:n}},2195:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.factory("MWIOperations",i.default),e.factory("MWIRequests",s.default),{api:o.default,capabilities:["voicemail"],middleware:a.default,name:n.name,reducer:n.reducer}};var n=r(5174),o=c(r(11918)),a=c(r(16983)),i=c(r(2225)),s=c(r(8753));function c(e){return e&&e.__esModule?e:{default:e}}},16983:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{mwiReceived:t}=e.container.MWIOperations;return e=>r=>{const{type:o,payload:a={}}=r;return o===n.NOTIFICATION_RECEIVED&&a.notificationMessage&&"mwi"===a.notificationMessage.eventType&&t(a.notificationMessage),e(r)}};var n=r(70506)},2225:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,logManager:i,MWIRequests:s}=e,{dispatch:c}=t,l=i.getLogger("MWI");return{fetchMwi:async function(){const e=await s.fetchVoicemails();return c(n.mwiUpdate({mwiData:e})),l.info("Successfully retrieved voicemail data from server"),e},mwiReceived:function(e){const t=(0,a.processMwi)({...e,data:e.mwiNotificationParam});c(n.mwiUpdate({mwiData:t})),r(o.MWI_CHANGE,t),l.info("Successfully processed mwi notification")}}};var n=s(r(53)),o=s(r(44717)),a=r(27470);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},8753:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,sendRequest:i}=e,s=r.getLogger("MWI");return{fetchVoicemails:async function(){const{baseURL:e,username:r,version:c}=(0,n.getRequestInfo)(t.getState()),{body:l,error:u,result:d={}}=await i({method:"GET",url:`${e}/rest/version/${c}/user/${r}/voicemail`,responseType:"json",body:void 0}),{mwiresponse:f}=l||{};if(u){let e;f&&({statusCode:e}=f);const t="number"==typeof e?`Failed to fetch voicemail(s). Status Code: ${e}`:`Voicemail fetch request failed. ${d.message}`;throw s.info(t),new o.default({code:o.mwiCodes.FETCH_MWI_FAIL,message:t})}return(0,a.processMwi)({data:f})}}};var n=r(87075),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412)),a=r(27470);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},27470:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.processMwi=function(e){let{time:t=Date.now(),data:r={}}=e;const{mwi:n,totalVoice:o="0",unheardVoice:a="0"}=r;return delete r.mwi,delete r.statusCode,{...r,newMessagesWaiting:"yes"===n,lastUpdated:t,totalVoice:o,unheardVoice:a}}},70506:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UNREGISTER_APPLE_PUSH_NOTIFICATION=t.UNREGISTER_ANDROID_PUSH_NOTIFICATION=t.REGISTER_APPLE_PUSH_NOTIFICATION=t.REGISTER_ANDROID_PUSH_NOTIFICATION=t.PROCESS_NOTIFICATION_FINISH=t.PROCESS_NOTIFICATION=t.NOTIFICATION_RECEIVED=t.ENABLE_NOTIFICATION_CHANNEL_FINISH=t.ENABLE_NOTIFICATION_CHANNEL=void 0;const r="@@KANDY/";t.PROCESS_NOTIFICATION=r+"PROCESS_NOTIFICATION",t.PROCESS_NOTIFICATION_FINISH=r+"PROCESS_NOTIFICATION_FINISH",t.NOTIFICATION_RECEIVED=r+"NOTIFICATION_RECEIVED",t.ENABLE_NOTIFICATION_CHANNEL=r+"ENABLE_NOTIFICATION_CHANNEL",t.ENABLE_NOTIFICATION_CHANNEL_FINISH=r+"ENABLE_NOTIFICATION_CHANNEL_FINISH",t.REGISTER_APPLE_PUSH_NOTIFICATION=r+"REGISTER_APPLE_PUSH_NOTIFICATION",t.REGISTER_ANDROID_PUSH_NOTIFICATION=r+"REGISTER_ANDROID_PUSH_NOTIFICATION",t.UNREGISTER_APPLE_PUSH_NOTIFICATION=r+"UNREGISTER_APPLE_PUSH_NOTIFICATION",t.UNREGISTER_ANDROID_PUSH_NOTIFICATION=r+"UNREGISTER_ANDROID_PUSH_NOTIFICATION"},50130:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enableNotificationChannel=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:n.ENABLE_NOTIFICATION_CHANNEL,payload:{...t},meta:{channel:e}}},t.enableNotificationChannelFinish=function(e){let{params:t,error:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var o={type:n.ENABLE_NOTIFICATION_CHANNEL_FINISH,meta:{channel:e}};return r?(o.error=!0,o.payload=new Error(r),o.payload.channelEnabled=t.channelEnabled):o.payload={...t},o},t.externalNotification=function(e){return a((arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PUSH").toUpperCase(),e)},t.notificationReceived=function(e,t){return{type:n.NOTIFICATION_RECEIVED,payload:e,error:e instanceof Error,meta:{channel:t}}},t.processNotificationFinish=function(e){return{type:n.PROCESS_NOTIFICATION_FINISH,payload:e,error:e instanceof Error,meta:{}}},t.registerAndroidPushNotification=function(e,t){return{type:n.REGISTER_ANDROID_PUSH_NOTIFICATION,payload:{...e,pushProvider:"google"},meta:{deferred:t}}},t.registerApplePushNotification=function(e,t){return{type:n.REGISTER_APPLE_PUSH_NOTIFICATION,payload:{...e,pushProvider:"apple"},meta:{deferred:t}}},t.unregisterAndroidPushNotification=function(e,t){return{type:n.UNREGISTER_ANDROID_PUSH_NOTIFICATION,payload:{registration:e},meta:{deferred:t}}},t.unregisterApplePushNotification=function(e,t){return{type:n.UNREGISTER_APPLE_PUSH_NOTIFICATION,payload:{registration:e},meta:{deferred:t}}},t.websocketNotification=function(e){return a("WEBSOCKET",e)},r(97107);var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(70506));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function a(e,t){return{type:n.PROCESS_NOTIFICATION,payload:t,meta:{channel:e}}}},41369:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,context:r,NotificationsOperations:a,emitEvent:i,API_LOG_TAG:s}=e,c=t.getLogger("NOTIFICATIONS");return{notification:{process:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PUSH";c.debug(s+"notification.process: ",e,t),r.dispatch(n.externalNotification(e,t)),a.processNotification(e,t)},registerApplePush:function(e){let{services:t,voipDeviceToken:o,standardDeviceToken:i,bundleId:l,clientCorrelator:u,realm:d,isProduction:f}=e;return c.debug(s+"notification.registerApplePush",arguments),r.dispatch(n.registerApplePushNotification({services:t,voipDeviceToken:o,standardDeviceToken:i,bundleId:l,clientCorrelator:u,realm:d,isProduction:f})),a.registerPushDeviceToken({services:t,voipDeviceToken:o,standardDeviceToken:i,bundleId:l,clientCorrelator:u,realm:d,isProduction:f,pushProvider:"apple"})},registerAndroidPush:function(e){let{services:t,deviceToken:o,bundleId:i,clientCorrelator:l,realm:u}=e;return c.debug(s+"notification.registerAndroidPush",arguments),r.dispatch(n.registerAndroidPushNotification({services:t,deviceToken:o,bundleId:i,clientCorrelator:l,realm:u})),a.registerPushDeviceToken({services:t,deviceToken:o,bundleId:i,clientCorrelator:l,realm:u,pushProvider:"google"})},unregisterApplePush:function(e){return c.debug(s+"notification.unregisterPush"),r.dispatch(n.unregisterApplePushNotification(e)),a.unregisterPushDeviceToken(e)},unregisterAndroidPush:function(e){return c.debug(s+"notification.unregisterPush"),r.dispatch(n.unregisterAndroidPushNotification(e)),a.unregisterPushDeviceToken(e)},enableWebsocket:async function(e){c.debug(s+"notification.enableWebsocket: ",e),r.dispatch(n.enableNotificationChannel("WEBSOCKET",{channelEnabled:e}));try{await a.enableWebsocketChannel(e,"WEBSOCKET"),i(o.NOTI_CHANGE,{channel:"WEBSOCKET"})}catch(e){i(o.NOTI_ERROR,{channel:"WEBSOCKET",error:e})}}}}};var n=i(r(50130)),o=i(r(99644));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}},99644:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOTI_RECEIVED=t.NOTI_ERROR=t.NOTI_CHANGE=void 0,t.NOTI_CHANGE="notifications:change",t.NOTI_ERROR="notifications:error",t.NOTI_RECEIVED="notification:received"},9617:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createAPI",{enumerable:!0,get:function(){return o.default}}),t.name=void 0,Object.defineProperty(t,"reducer",{enumerable:!0,get:function(){return n.default}});var n=a(r(5844)),o=a(r(41369));function a(e){return e&&e.__esModule?e:{default:e}}t.name="notifications"},5844:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(70506)),o=r(9719),a=r(45775);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}const s={};s[n.ENABLE_NOTIFICATION_CHANNEL_FINISH]={next(e,t){const r=t.meta.channel;let n;return n=t.payload.channelEnabled?{...e[r],...t.payload}:{...t.payload},{...e,[r]:n}}},s[o.WS_CONNECT_FINISHED]={next:e=>({...e,WEBSOCKET:{...e.WEBSOCKET,channelEnabled:!0}})},s[o.WS_DISCONNECT_FINISHED]={next:e=>({...e,WEBSOCKET:{...e.WEBSOCKET,channelEnabled:!1}})};const c=(0,a.handleActions)(s,{WEBSOCKET:{channelEnabled:!1},PUSH:{channelEnabled:!0}});t.default=c},82803:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNotificationConfig=function(e){return(0,o.default)(e.config.notifications)},t.getNotificationsInfo=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return t?e.notifications[t]:e.notifications};var n,o=(n=r(89321))&&n.__esModule?n:{default:n}},26662:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=l.validation.schema({idCacheLength:l.validation.positive(),incomingCallNotificationMode:(0,l.enums)(["any-channel","push-channel-only"]),pushRegistration:l.validation.optional(l.validation.schema({server:l.validation.string(),port:l.validation.string(),protocol:l.validation.string(),version:l.validation.string()}))}),u=(0,l.parse)("notifications",r),d=(0,n.default)({idCacheLength:100,incomingCallNotificationMode:"any-channel"},t);u(d),e.defer((function(e){const{context:t}=e;t.dispatch((0,c.update)(d,o.name))}));for(const t in i)i[t](e);return e.factory("NotificationRequests",s.default),{api:o.createAPI,capabilities:["push","registerPushNotifications","externalNotifications"],middleware:(0,a.default)(e),name:o.name,reducer:o.reducer}};var n=d(r(1036)),o=r(9617),a=d(r(76765)),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(325)),s=d(r(60530)),c=r(87310),l=r(52932);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function d(e){return e&&e.__esModule?e:{default:e}}},325:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"notification",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"pushRegistration",{enumerable:!0,get:function(){return o.default}});var n=a(r(33789)),o=a(r(50539));function a(e){return e&&e.__esModule?e:{default:e}}},73176:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t}=e;return async function(e,r){t.dispatch(n.enableNotificationChannelFinish(e,{params:{channelEnabled:r}}))}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(50130));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},33789:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("NotificationsOperations.enableWebsocketChannel",(()=>(0,o.default)(e.container))),e.factory("NotificationsOperations.processNotification",(()=>(0,n.default)(e.container)))};var n=a(r(27003)),o=a(r(73176));function a(e){return e&&e.__esModule?e:{default:e}}},27003:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,emitEvent:i}=e,s=r.getLogger("NOTIFICATIONS");var c=[];return async function(e,r){const l=(0,n.getNotificationConfig)(t.getState());s.info(`Received notification on channel ${r}. Handling...`);const u=(0,n.getNotificationsInfo)(t.getState(),r);if(!u.channelEnabled)return void s.debug(`Notification received on disabled channel: ${r}. Ignoring it ...`);const d=e.notificationMessage,f=d.eventId;if(s.debug(`The received notification is of type ${d.eventType}.`),"call"===e.notificationMessage.eventType&&"push-channel-only"===l.incomingCallNotificationMode&&"PUSH"!==u)s.warn("Dropped incoming call notification with id: "+f+" received through channel: "+u+" because current mode for handling notifications is set to: push-channel-only.");else if((0===l.idCacheLength?[]:c.slice(-1*l.idCacheLength)).includes(f)){s.info("Notification was a duplicate; ignoring.");const e=new Error(`Notification id ${f} is duplicate.`);t.dispatch(o.processNotificationFinish(e))}else{for(c.push(f);c.length>l.idCacheLength;)c.shift();t.dispatch(o.notificationReceived(e,r)),i(a.NOTI_RECEIVED,{payload:{...e}})}}},r(97107),r(62234),r(69375);var n=r(82803),o=s(r(50130)),a=s(r(99644));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},50539:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("NotificationsOperations.registerPushDeviceToken",(()=>(0,n.default)(e.container))),e.factory("NotificationsOperations.unregisterPushDeviceToken",(()=>(0,o.default)(e.container)))};var n=a(r(57195)),o=a(r(52910));function a(e){return e&&e.__esModule?e:{default:e}}},57195:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,NotificationRequests:n}=e,s=r.getLogger("NOTIFICATIONS");return async function(e){const r=(0,i.getConnectionInfo)(t.getState()),{pushRegistration:c}=(0,a.getNotificationConfig)(t.getState());return c&&(r.server=(0,o.default)(r.server,c)),s.info("Registering device token for PUSH notifications..."),await n.pushNotificationsRegistration(r,{...e})}};var n,o=(n=r(38142))&&n.__esModule?n:{default:n},a=r(82803),i=r(87075)},52910:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,NotificationRequests:n}=e,s=r.getLogger("NOTIFICATIONS");return async function(e){const r=(0,i.getConnectionInfo)(t.getState()),{pushRegistration:c}=(0,a.getNotificationConfig)(t.getState());return c&&(r.server=(0,o.default)(r.server,c)),s.info("Un-registering device token for PUSH notifications..."),await n.pushNotificationsDeRegistration(r,{registration:e})}};var n,o=(n=r(38142))&&n.__esModule?n:{default:n},a=r(82803),i=r(87075)},60530:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,sendRequest:r}=e,n=t.getLogger("NOTIFICATIONS");return{pushNotificationsRegistration:async function(e,t){let{services:a,pushProvider:i,bundleId:s,deviceToken:c,voipDeviceToken:l,standardDeviceToken:u,clientCorrelator:d,realm:f,isProduction:p}=t;const{server:g}=e;i=i.toLowerCase();const E=`${g.protocol}://${g.server}:${g.port}/rest/version/${g.version}/user/${e.username}/push/`+i+"/devices/",_="POST";let y={bundleID:s,service:a,clientCorrelator:d,realm:f,isProduction:p};"apple"===i?(y.voipDeviceToken=l,y.standardDeviceToken=u):y.deviceToken=c,y=JSON.stringify(y),n.debug(`Sending PUSH register request: ${_} ${E}`);const v=await r({url:E,method:_,body:y}),{body:S,error:O,result:h}=v;let T;const I=i+"DeviceRegistrationResponse";if(S&&S[I]&&(T=S[I]),O){if(n.info("Failed to register device token for PUSH notifications."),T){const e=T.statusCode;throw n.debug(`Device registration request for PUSH notifications failed with status code: ${e}`),new o.default({code:e,message:`Failed to register device token for PUSH notifications. Code: ${e}`})}{const{message:e}=h;throw n.debug(`Device registration request for PUSH notifications failed with message: ${e}.`),new o.default({code:h.code,message:`Failed to register device token for PUSH notifications. Error: ${h.message}`})}}if(T&&0!==T.statusCode)throw n.info(`Failed to register device token for PUSH notifications. Code: ${T.statuscode}`),new o.default({code:T.statusCode,message:`Failed to register device token for PUSH notifications. Error: ${T.statusCode}`});return n.info("Successfully registered device token for PUSH notifications."),{error:!1,...T}},pushNotificationsDeRegistration:async function(e,t){let{registration:a}=t;const{server:i}=e,s=`${i.protocol}://${i.server}:${i.port}${a}`,c="DELETE";n.debug(`Sending PUSH unregister request: ${c} ${s}`);const l=await r({url:s,method:c,responseType:"none"});if(l.error){if(n.info("Failed to unregister device token for PUSH notifications."),l.payload.body){const{statusCode:e}=l.payload.body;throw n.debug(`Failed to unregister device token for PUSH notifications. Status code: ${e}.`),new o.default({code:e,message:`Failed to unregister device token for PUSH notifications. Code: ${e}.`})}{const{message:e}=l.payload.result;throw n.debug(`Device token unregistration request failed for PUSH notifications: ${e}`),new o.default({code:l.payload.result.code,message:`Device token unregistration request failed for PUSH notifications: ${e}`})}}return n.info("Successfully unregistered device token for PUSH notifications."),{error:!1}}}};var n,o=(n=r(75412))&&n.__esModule?n:{default:n}},76765:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=[];return e.value("Notifications.takeAction",(function(e,r){if("string"==typeof e){const t=e;e=e=>e.type===t}return new Promise(((n,o)=>{let a;"number"==typeof r&&(a=setTimeout(o,r)),t.push({singleTake:!0,pattern:e,callback:n,timeoutId:a})}))})),e.value("Notifications.takeEveryAction",(function(e,r){if("string"==typeof e){const t=e;e=e=>e.type===t}if("function"!=typeof e||"function"!=typeof r)throw new Error("takeEveryAction parametesr must be functions.");t.push({singleTake:!1,pattern:e,callback:r})})),e=>e=>r=>{const n=e(r);let o=t.length;for(;o--;){const e=t[o];e.pattern(r)&&(e.singleTake&&(t.splice(o,1),e.timeoutId&&clearTimeout(e.timeoutId)),e.callback(r))}return n}},r(97107),r(69375)},60437:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_FINISH=t.UPDATE=t.UNSUBSCRIBE_FINISH=t.UNSUBSCRIBE=t.SUBSCRIBE_FINISH=t.SUBSCRIBE=t.RECEIVED=t.GET_PRESENCE_LIST=t.GET_FINISH=t.GET=t.DELETE_PRESENCE_LIST=t.CREATE_PRESENCE_LIST_FINISH=t.CREATE_PRESENCE_LIST=void 0;const r="@@KANDY/PRESENCE/";t.UPDATE=r+"UPDATE",t.UPDATE_FINISH=r+"UPDATE_FINISH",t.GET=r+"GET",t.GET_FINISH=r+"GET_FINISH",t.SUBSCRIBE=r+"SUBSCRIBE",t.SUBSCRIBE_FINISH=r+"SUBSCRIBE_FINISH",t.UNSUBSCRIBE=r+"UNSUBSCRIBE",t.UNSUBSCRIBE_FINISH=r+"UNSUBSCRIBE_FINISH",t.RECEIVED=r+"RECEIVED",t.CREATE_PRESENCE_LIST=r+"CREATE_PRESENCE_LIST",t.CREATE_PRESENCE_LIST_FINISH=r+"CREATE_PRESENCE_LIST_FINISH",t.DELETE_PRESENCE_LIST=r+"DELETE_PRESENCE_LIST",t.GET_PRESENCE_LIST=r+"GET_PRESENCE_LIST"},84157:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createListFinish=function(e){return{type:o.CREATE_PRESENCE_LIST_FINISH,error:e instanceof Error||e instanceof a.default,payload:e}},t.createPresenceList=function(e){return{type:o.CREATE_PRESENCE_LIST,payload:e}},t.deletePresenceList=function(e){return{type:o.DELETE_PRESENCE_LIST,payload:e}},t.getPresence=function(e){return{type:o.GET,payload:e}},t.getPresenceFinish=function(e){return{type:o.GET_FINISH,error:e instanceof Error||e instanceof a.default,payload:e}},t.getPresenceList=function(e){return{type:o.GET_PRESENCE_LIST,payload:e}},t.presenceReceived=function(e){return{type:o.RECEIVED,payload:e}},t.subscribePresence=function(e){return{type:o.SUBSCRIBE,payload:e}},t.subscribePresenceFinish=function(e){return Array.isArray(e.presentityUserId)||(e.presentityUserId=[e.presentityUserId]),{type:o.SUBSCRIBE_FINISH,error:e instanceof Error||e instanceof a.default,payload:e}},t.unsubscribePresence=function(e){return{type:o.UNSUBSCRIBE,payload:e}},t.unsubscribePresenceFinish=function(e){return e.presentityUserId&&!Array.isArray(e.presentityUserId)&&(e.presentityUserId=[e.presentityUserId]),{type:o.UNSUBSCRIBE_FINISH,error:e instanceof Error||e instanceof a.default,payload:e}},t.updatePresence=function(e,t,r){return{type:o.UPDATE,payload:{status:e,activity:t,note:r}}},t.updatePresenceFinish=function(e){return{type:o.UPDATE_FINISH,error:e instanceof Error||e instanceof a.default,payload:e}},r(97107);var n,o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(60437)),a=(n=r(75412))&&n.__esModule?n:{default:n};function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},52502:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{emitEvent:t,PresenceOperations:r,logManager:a,API_LOG_TAG:i,context:s}=e,c=a.getLogger("PRESENCE");return{presence:{async update(e,o,a){c.debug(i+"presence.update: ",e,o,a);try{await r.update(e,o,a),t(n.SELF_CHANGE,{})}catch(e){t(n.ERROR,{error:e})}},async fetch(e){c.debug(i+"presence.fetch: ",e);const o=Array.isArray(e)?e:[e];try{await r.fetch(o)}catch(e){t(n.ERROR,{error:e})}},async subscribe(e){c.debug(i+"presence.subscribe: ",e),e=Array.isArray(e)?e:[e];try{await r.subscribe(e)}catch(e){t(n.ERROR,{error:e})}},async unsubscribe(e){c.debug(i+"presence.unsubscribe: ",e),e=Array.isArray(e)?e:[e];try{await r.unsubscribe(e)}catch(e){t(n.ERROR,{error:e})}},get(e){c.debug(i+"presence.get: ",e);const t=Array.isArray(e)?e:[e],r=o.getPresence(s.getState(),t);return Array.isArray(t)?r:r.length?r[0]:void 0},getAll:()=>(c.debug(i+"presence.getAll: "),o.getAllPresence(s.getState())),getSelf:()=>(c.debug(i+"presence.getSelf: "),o.getSelfPresence(s.getState()))}}};var n=r(84341),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(22612));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},84341:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UNSUBSCRIBE=t.SUBSCRIBE=t.SELF_CHANGE=t.RECEIVED=t.ERROR=void 0,t.RECEIVED="presence:change",t.SELF_CHANGE="presence:selfChange",t.SUBSCRIBE="presence:subscribe",t.UNSUBSCRIBE="presence:unsubscribe",t.ERROR="presence:error"},54974:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"api",{enumerable:!0,get:function(){return n.default}}),t.name=void 0,Object.defineProperty(t,"reducer",{enumerable:!0,get:function(){return o.default}});var n=a(r(52502)),o=a(r(37601));function a(e){return e&&e.__esModule?e:{default:e}}t.name="presence"},37601:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(14017))&&n.__esModule?n:{default:n},a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(60437)),i=r(45775);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}const c={};c[a.UPDATE]={next:e=>({...e,self:{...e.self,loading:!0,error:!1}})},c[a.UPDATE_FINISH]={next(e,t){const r={...e,self:{loading:!1,error:!1,status:t.payload.status,activity:t.payload.activity}};return t.payload.note&&(r.self.note=t.payload.note),r},throw:(e,t)=>({...e,self:{...e.self,loading:!1,error:t.payload}})},c[a.GET]={next(e,t){let{payload:r}=t;const n={...e.users};for(const e of r)n[e]={userId:e,loading:!0};return{...e,users:n}}},c[a.GET_FINISH]={next(e,t){let{payload:r}=t;const n={};for(const e of r)e.userId&&(e.loading=!1,n[e.userId]=e);return{...e,users:{...e.users,...n}}},throw:(e,t)=>({...e})},c[a.RECEIVED]={next(e,t){let{payload:r}=t;return{...e,users:{...e.users,[r.userId]:{userId:r.userId,status:r.status,activity:r.activity,note:r.note,loading:!1}}}}},c[a.SUBSCRIBE]={next(e,t){let{payload:r}=t;Array.isArray(r)||(r=[r]);const n=Object.assign({},e.users);return r.forEach((e=>{n[e]={userId:e,loading:!1,isPending:!0}})),{...e,users:n}}},c[a.SUBSCRIBE_FINISH]={next(e,t){let{payload:r}=t;const n=Object.assign({},e.users);return r.presentityUserId.forEach((e=>{n[e]={userId:e,loading:!1,isPending:!1}})),{...e,users:n}},throw(e,t){let{payload:r}=t;const n=Object.assign({},e.users);return r.presentityUserId.forEach((e=>{delete n[e]})),{...e,users:n}}},c[a.UNSUBSCRIBE]={next(e,t){let{payload:r}=t;Array.isArray(r)||(r=[r]);const n=Object.assign({},e.users);return r.forEach((e=>{n[e]={userId:e,loading:!1,isPending:!0}})),{...e,users:n}}},c[a.UNSUBSCRIBE_FINISH]={next(e,t){let{payload:r}=t;return{...e,users:(0,o.default)(r.presentityUserId,e.users)}},throw(e,t){let{payload:r}=t;const n=Object.assign({},e.users);return r.presentityUserId&&r.presentityUserId.length>0&&r.presentityUserId.forEach((e=>{n[e]={userId:e,loading:!1,isPending:!1}})),{...e,users:n}}};const l=(0,i.handleActions)(c,{self:{},users:{}});t.default=l},22612:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAllPresence=function(e){return Object.values(e.presence.users)},t.getPresence=function(e,t){return t?Object.values(e.presence.users).filter((e=>-1!==t.indexOf(e.userId))):e.presence.users},t.getSelfPresence=function(e){return e.presence.self}},86606:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STATUS=t.ACTIVITY=void 0,t.STATUS={OPEN:"open",CLOSED:"closed"},t.ACTIVITY={ACTIVE:"active",IDLE:"idle",AWAY:"away",LUNCH:"lunch",OTHER:"other",BUSY:"busy",VACATION:"vacation",ON_THE_PHONE:"on-the-phone",UNKNOWN:"unknown"}},24011:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.factory("PresenceOperations",i.default),e.factory("PresenceRequests",s.default),{api:function(e){const t=(0,o.default)(e);return t.presence.statuses=c.STATUS,t.presence.activities=c.ACTIVITY,t},capabilities:["presence"],middleware:a.default,name:n.name,reducer:n.reducer}};var n=r(54974),o=l(r(52502)),a=l(r(44511)),i=l(r(93449)),s=l(r(73129)),c=r(86606);function l(e){return e&&e.__esModule?e:{default:e}}},44511:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.container.PresenceOperations;return e=>r=>(r.type===n.NOTIFICATION_RECEIVED&&r.payload.notificationMessage&&"presenceWatcher"===r.payload.notificationMessage.eventType&&t.presenceReceived(r),e(r))};var n=r(70506)},93449:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,logManager:l,PresenceRequests:u}=e,d=l.getLogger("PRESENCE");return{presenceReceived:function(e){const{dispatch:s,getState:c}=t;if(![i.NOTIFICATION_RECEIVED].includes(e.type))return;if(!e.payload.notificationMessage||"presenceWatcher"!==e.payload.notificationMessage.eventType)return;const l=e.payload.notificationMessage.presenceWatcherNotificationParams,u=(0,a.getAllPresence)(c()).find((e=>e.userId===l.name));if(u&&!u.isPending){d.info(`Received notification of the user(s): ${l.name} present presence.`);const e={userId:l.name,activity:l.activity,status:l.status,note:l.note};s(n.presenceReceived(e)),r(o.RECEIVED,e)}},update:async function(e,r,o){const{dispatch:a}=t;if(a(n.updatePresence(e,r,o)),-1===Object.values(c.STATUS).indexOf(e)){d.debug("Invalid presence status present.");const e=new s.default({code:s.presenceCodes.INVALID_STATUS,message:"Invalid status in presence update request."});throw a(n.updatePresenceFinish(e)),e}if(-1===Object.values(c.ACTIVITY).indexOf(r)){d.debug("Invalid presence activity present.");const e=new s.default({code:s.presenceCodes.INVALID_ACTIVITY,message:"Invalid activity in presence update request."});throw a(n.updatePresenceFinish(e)),e}try{await u.updatePresence(e,r,o),d.debug("Successfully updated presence."),a(n.updatePresenceFinish({status:e,activity:r,note:o}))}catch(e){throw d.debug(`Failed to update presence. Error is: ${e}`),a(n.updatePresenceFinish(e)),e}},fetch:async function(e){const{dispatch:r}=t;r(n.getPresence(e));try{const t=await u.watchPresence(e,"get");r(n.getPresenceFinish(t))}catch(e){throw r(n.getPresenceFinish(e)),e}},subscribe:async function(e){const{dispatch:r}=t;if(r(n.subscribePresence(e)),!e||1===e.length&&!e[0])throw new s.default({message:"No users provided to subscribe to."});try{d.info(`Subscribing to the user(s) ${e} presence.`);const t=await u.watchPresence(e,"watch");d.info(`Finished subscribing to user(s): ${e} with status code: ${t.presenceWatcherResponse.statusCode}`),t.presentityUserId=e,r(n.subscribePresenceFinish(t))}catch(t){throw d.info(`Failed to subscribe to users(s): ${e}. ${t.message}`),t.presentityUserId=e,r(n.subscribePresenceFinish(t)),t}},unsubscribe:async function(e){const{dispatch:r}=t;if(r(n.unsubscribePresence(e)),!e||1===e.length&&!e[0])throw new s.default({message:"No users provided to unsubscribe to."});try{d.info(`UnSubscribing to the user(s) ${e} presence.`);const t=await u.watchPresence(e,"stopwatch");d.info(`Finished unSubscribing to user(s): ${e} with status code: ${t.presenceWatcherResponse.statusCode}`),t.presentityUserId=e,r(n.unsubscribePresenceFinish(t))}catch(t){throw d.info(`Failed to unsubscribe to users(s): ${e}. ${t.message}`),t.presentityUserId=e,r(n.unsubscribePresenceFinish(t)),t}}}},r(62234);var n=u(r(84157)),o=u(r(84341)),a=r(22612),i=r(70506),s=u(r(75412)),c=r(86606);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},73129:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,sendRequest:n}=e,i=r.getLogger("PRESENCE");return{updatePresence:async function(e,r,s){const c=(0,o.getRequestInfo)(t.getState()),l=c.version,u=`${c.baseURL}/rest/version/${l}/user/${c.username}/presence`,d={status:e,activity:r};s&&(d.note=s);const f={method:"POST",url:u,responseType:"json",body:JSON.stringify({presenceRequest:d})},p=await n(f),{body:g,error:E,result:_}=p;if(E){if(g){const{statusCode:e}=g.presenceResponse,t=`Failed to update presence with status code ${e}.`;throw i.debug(t),new a.default({message:t})}{const{message:e}=_,t=`Update presence request failed: ${e}`;throw i.info(t),new a.default({message:t})}}if(0!==g.presenceResponse.statusCode){const e=`Failed to update presence. Code: ${g.presenceResponse.statusCode}.`;throw new a.default({message:e})}return p},watchPresence:async function(e,r){const s=(0,o.getRequestInfo)(t.getState()),c=s.version,l={method:"POST",url:`${s.baseURL}/rest/version/${c}/user/${s.username}/presenceWatcher`,responseType:"json",body:JSON.stringify({presenceWatcherRequest:{userList:e,action:r}})},u=await n(l),{body:d,error:f,result:p}=u;if(f){if(d){const{statusCode:e}=d.presenceWatcherResponse,t=`Failed to watch presence with status code ${e}.`;throw i.debug(t),new a.default({message:t})}{const{message:e}=p,t=`Watch presence request failed: ${e}`;throw i.info(t),new a.default({message:t})}}if(0!==d.presenceWatcherResponse.statusCode){const e=`Failed to execute presence operation (${r}). Code: ${d.presenceWatcherResponse.statusCode}.`;throw new a.default({message:e})}return u.body}}};var n,o=r(87075),a=(n=r(75412))&&n.__esModule?n:{default:n}},38577:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.linkAuthorization=function(e){if(!e.error)return;const t=function(e){let t;return e.body&&(e.body.statusCode?t=e.body.statusCode:Object.values(e.body).forEach((e=>{e.statusCode&&(t=e.statusCode)}))),t}(e);if(401===e.result.code)return new n.default({code:n.authCodes.INVALID_CREDENTIALS,message:"Authorization failed with server. Please check credentials."});if(403===e.result.code&&(void 0===e.body||[4,27,61,65].includes(t))){let e="Authorization failed with server. Please check credentials.";return t&&(e+=` Status code: ${t}`),new n.default({code:n.authCodes.INVALID_CREDENTIALS,message:e})}},r(62234);var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(75412));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},59195:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseOptions=t.defaultOptions=void 0;var n=r(52932);t.defaultOptions={restTimeout:3e4};const o=n.validation.schema({restTimeout:n.validation.number()});t.parseOptions=(0,n.parse)("request",o)},5168:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=(0,s.default)(n.defaultOptions,t),(0,n.parseOptions)(t),e.factory("sendRequest",o.default),e.defer((function(e){const{context:r}=e;r.dispatch((0,i.update)(t,a.default.name))})),{api:a.default.createAPI,capabilities:["restAuthorization"],name:a.default.name}};var n=r(59195),o=c(r(87937)),a=c(r(19528)),i=r(87310),s=c(r(7485));function c(e){return e&&e.__esModule?e:{default:e}}},40603:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RESPONSE=t.REQUEST=t.AUTHORIZATION_ERROR=void 0;const r="@@KANDY/";t.REQUEST=r+"REQUEST",t.RESPONSE=r+"RESPONSE",t.AUTHORIZATION_ERROR=r+"AUTHORIZATION_ERROR"},91619:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.authorizationError=function(e){return{error:!0,type:n.AUTHORIZATION_ERROR,payload:e}},t.request=function(e){return{type:n.REQUEST,payload:e,meta:{requestId:a++}}},t.response=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{type:n.RESPONSE,payload:t,error:r,meta:{requestId:e}}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(40603));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}var a=0},37892:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,context:r,API_LOG_TAG:n}=e,s=t.getLogger("REQUEST");return{request:{fetch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s.debug(n+"fetch: ",e);const c=r.getState(),l=(0,a.getRequestInfo)(c),u=l.requestOptions;return l.requestOptions=(0,o.default)(t,u),(0,i.fetchResource)(e,l)}}}};var n,o=(n=r(96042))&&n.__esModule?n:{default:n},a=r(87075),i=r(67426)},19251:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REQUEST_ERROR=void 0,t.REQUEST_ERROR="request:error"},19528:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(70321)),o=a(r(37892));function a(e){return e&&e.__esModule?e:{default:e}}t.default={name:n.default,createAPI:o.default}},70321:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="requests"},45590:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRESTTimeout=function(e){return e.config.requests.restTimeout}},18439:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e,t,r){const n=o.logManager.getLogger("REQUEST",t),u=function(e){const{url:t,responseType:r}=e;return t&&"string"==typeof t?r&&!c.hasOwnProperty(r)?l({error:"RESPONSE_TYPE",message:"Cannot make request; responseType value was invalid."}):void 0:l({error:"REQUEST_URL",message:`Invalid request url; expected url of type string but received ${t} instead`})}(e);if(u)return n.info(u.result.message),u;const{url:d,queryParams:f,responseType:p="json",...g}=e;let E=d.match(/([^/]*)$/)[0];E=E.length>15?E.substring(0,15)+"...":E,n.info(`Making ${g.method} ${E} request.`);const _=new AbortController;let y;g.signal=_.signal;try{if(y=await Promise.race([fetch(d+(0,a.default)(f),g),(0,i.delay)((0,s.getRESTTimeout)(r.getState()))]),!y){const e=new DOMException("Request timed out","TimeoutError");throw _.abort(e),e}}catch(e){return n.info(`Failed to make request, caused by ${e.message}`),l({error:"FETCH"},{code:e.name,message:e.message})}const v={ok:y.ok,code:y.status,message:y.statusText};if(y.ok){if(204===y.status)return n.info(`Finished request with successful response (status ${y.status}).`),l(void 0,{body:{},...v});const e=await async function(e,t){let r={};try{switch(t){case c.json:r=await e.json();break;case c.blob:r=await e.blob();break;case c.text:r=await e.text();break;case c.none:break;default:throw Error("Assertion failed")}}catch(e){return e}return r}(y,p);return e instanceof Error?(n.error(`Failed to parse with response type: ${p}. Error: ${e}`),l({error:"REQUEST"},{code:e.name,message:e.message})):(n.info(`Finished request with successful response (status ${y.status}).`),l(void 0,{body:e,...v}))}{let e,t;try{e=await y.headers.get("content-type")}catch(e){n.debug(`Failed to get content-type:${e.message}.`)}if(403===y.status&&e.includes("html"))return l({error:"REQUEST"},v);try{if(t=await y.json(),503===y.status){let e,r;if(t&&t.subscribeResponse?e=t.subscribeResponse.retryAfter:t&&t.authorizationResponse&&(e=t.authorizationResponse.retryAfter),e)r=e;else{try{e=await y.headers.get("retry-after")}catch(e){n.debug(`Failed to get retry-after:${e.message}.`)}e&&(r=e.endsWith(" GMT")?new Date(e).getTime()-Date.now():1e3*e)}t=r&&r>0?{subscribeResponse:{statusCode:503,retryAfter:r}}:{subscribeResponse:{statusCode:500}}}}catch(e){t={},n.debug("Failed to parse response:",e.message)}return l({error:"REQUEST"},{body:t,...v})}},r(97107),r(62234),r(57182);var n,o=r(69932),a=(n=r(2633))&&n.__esModule?n:{default:n},i=r(1011),s=r(45590);const c=Object.freeze({json:"json",blob:"blob",text:"text",none:"none"});function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{body:t.body,error:e.error,result:{ok:Boolean(t.ok),code:t.code,message:e.message||t.message}}}},87937:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{emitEvent:t,context:r,logManager:n}=e;return async function(e){const d=(0,l.getRequestInfo)(r.getState()).requestOptions;e=(0,u.default)(d,e);const f=o.request(e);r.dispatch(f);const p=n.getLogger("REQUEST",f.meta.requestId),g=(0,c.sanitizeRequest)(f.payload);p.debug(`Making REST request ${f.meta.requestId}.`,g);const E=await(0,s.default)(f.payload,f.meta.requestId,r);p.debug(`Received REST response ${f.meta.requestId}.`,E);const _=i.linkAuthorization(E);return _&&t(a.REQUEST_ERROR,{error:_}),r.dispatch(o.response(f.meta.requestId,E,!!E.error)),E}},t.logFakeAction=function(e,t){let{getState:r,container:o}=e;const a=o.logManager.getLogger("ACTION"),i=r().config.logs,{logActions:s,logLevel:c}=i;if(!s)return;const{collapsed:l,actionOnly:u,exposePayloads:d}=s,f=l?"groupCollapsed":"group",p=!1===d||t.meta&&t.meta.isSensitive?(0,n.default)("payload",t):t;a[f](`action ${t.type} @ ${function(){const e=new Date,t=(e,t)=>{return"0",r=t-e.toString().length,new Array(r+1).join("0")+e;var r};return`${t(e.getHours(),2)}:${t(e.getMinutes(),2)}:${t(e.getSeconds(),2)}.${t(e.getMilliseconds(),3)}`}()} (in 0.00 ms)`),"DEBUG"===c&&(u?a.debug("action    ",p):(a.debug("prev state",r()),a.debug("action    ",p),a.debug("next state",r()))),a.groupEnd()};var n=p(r(14017)),o=f(r(91619)),a=f(r(19251)),i=f(r(38577)),s=p(r(18439)),c=r(67426),l=r(87075),u=p(r(7485));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function p(e){return e&&e.__esModule?e:{default:e}}},67426:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchResource=async function(e,t){const{requestOptions:r}=t;"/"!==e.charAt()&&(e=`/${e}`);const n=`${t.baseURL}${e}`,o=c(r);s.debug("Making REST request",o);const i=r.queryParams||{};let l=(0,a.default)(i);e.includes("?")&&(l=l.replace("?","&"));const u=await fetch(n+l,r);return s.debug("Received REST response",u),u},t.sanitizeRequest=c,r(62234);var n=i(r(89321)),o=r(69932),a=i(r(2633));function i(e){return e&&e.__esModule?e:{default:e}}const s=o.logManager.getLogger("REQUEST");function c(e){const t=(0,n.default)(e),r=t.headers&&t.headers.Authorization;r&&(t.headers.Authorization=r.substring(0,6)+"...");const o=t.body;if(o)try{t.body=JSON.parse(o)}catch(e){}return t}},1940:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.factory("SipEventsOperations",a.default),e.factory("SipEventsRequests",i.default),e.factory("SipEventsIntervals",s.default),e.defer((e=>{e.Notifications.takeEveryAction((function(e){return e.type===c.NOTIFICATION_RECEIVED&&e.payload.notificationMessage.hasOwnProperty("genericNotificationParams")}),(t=>{e.SipEventsOperations.receiveEvent(t.payload.notificationMessage)}))})),{api:o.default,capabilities:["sipEvents"],name:n.name,reducer:n.reducer}};var n=r(35916),o=l(r(56176)),a=l(r(83840)),i=l(r(34460)),s=l(r(73758)),c=r(70506);function l(e){return e&&e.__esModule?e:{default:e}}},32335:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SIP_EVENT_UPDATE_FINISH=t.SIP_EVENT_UPDATE=t.SIP_EVENT_UNSUBSCRIBE_FINISH=t.SIP_EVENT_UNSUBSCRIBE=t.SIP_EVENT_SUBSCRIBE_FINISH=t.SIP_EVENT_SUBSCRIBE=t.SIP_EVENT_RECEIVED=void 0;const r="@@KANDY/";t.SIP_EVENT_SUBSCRIBE=r+"SIP_EVENT_SUBSCRIBE",t.SIP_EVENT_SUBSCRIBE_FINISH=r+"SIP_EVENT_SUBSCRIBE_FINISH",t.SIP_EVENT_UPDATE=r+"SIP_EVENT_UPDATE",t.SIP_EVENT_UPDATE_FINISH=r+"SIP_EVENT_UPDATE_FINISH",t.SIP_EVENT_UNSUBSCRIBE=r+"SIP_EVENT_UNSUBSCRIBE",t.SIP_EVENT_UNSUBSCRIBE_FINISH=r+"SIP_EVENT_UNSUBSCRIBE_FINISH",t.SIP_EVENT_RECEIVED=r+"SIP_EVENT_RECEIVED"},69815:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sipEventReceived=function(e,t){return{type:n.SIP_EVENT_RECEIVED,payload:{event:e,eventType:e.eventType,callId:t}}},t.sipEventSubscribe=function(e,t,r,o){return{type:n.SIP_EVENT_SUBSCRIBE,payload:{eventType:e,subscribeUserList:t,clientCorrelator:r,customParameters:o}}},t.sipEventSubscribeFinish=function(e){let{response:t,error:r,eventType:o}=e;return a(n.SIP_EVENT_SUBSCRIBE_FINISH,{response:t,error:r,eventType:o})},t.sipEventUnsubscribe=function(e){return{type:n.SIP_EVENT_UNSUBSCRIBE,payload:e}},t.sipEventUnsubscribeFinish=function(e){let{response:t,error:r,eventType:o}=e;return a(n.SIP_EVENT_UNSUBSCRIBE_FINISH,{response:t,error:r,eventType:o})},t.sipEventUpdate=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;return{type:n.SIP_EVENT_UPDATE,payload:{eventType:e,subscribeUserList:t.subscribeUserList||[],unsubscribeUserList:t.unsubscribeUserList||[],customParameters:r},meta:{isResub:o}}},t.sipEventUpdateFinish=function(e){let{response:t,error:r,eventType:o}=e;return a(n.SIP_EVENT_UPDATE_FINISH,{response:t,error:r,eventType:o})};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(32335));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function a(e,t){let{response:r,error:n,eventType:o}=t;return{type:e,error:!!n,payload:n?{error:n,eventType:o}:r}}},56176:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,SipEventsOperations:a,logManager:i,API_LOG_TAG:s}=e,c=i.getLogger("SIPEVENTS");return{sip:{async subscribe(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];c.debug(s+"sip.subscribe: ",e,t,n,i);try{await a.subscribe(e,t,n,i)}catch(e){return void r(o.EVENT_ERROR,{error:e})}r(o.EVENT_SUBSCRIPTION_CHANGED,{eventType:e,change:"newSubscription",subscribedUsers:t})},async update(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];c.debug(s+"sip.update: ",e,t,n);try{await a.update(e,t,n)}catch(e){return void r(o.EVENT_ERROR,{error:e})}r(o.EVENT_SUBSCRIPTION_CHANGED,{eventType:e,change:"updateSubscription",subscribeUserList:t.subscribeUserList||[],unsubscribeUserList:t.unsubscribeUserList||[]})},async unsubscribe(e){c.debug(s+"sip.unsubscribe: ",e);try{await a.unsubscribe(e)}catch(e){return void r(o.EVENT_ERROR,{error:e})}r(o.EVENT_SUBSCRIPTION_CHANGED,{eventType:e,change:"unsubscribe"})},getDetails(e){const{getState:r}=t;return c.debug(s+"sip.getDetails: ",e),(0,n.getSipEventInfo)(r(),e)}}}};var n=r(29962),o=r(40943)},40943:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EVENT_SUBSCRIPTION_CHANGED=t.EVENT_RECEIVED=t.EVENT_ERROR=void 0,t.EVENT_SUBSCRIPTION_CHANGED="sip:subscriptionChange",t.EVENT_ERROR="sip:error",t.EVENT_RECEIVED="sip:eventsChange"},35916:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"api",{enumerable:!0,get:function(){return n.default}}),t.name=void 0,Object.defineProperty(t,"reducer",{enumerable:!0,get:function(){return o.default}});var n=a(r(56176)),o=a(r(9016));function a(e){return e&&e.__esModule?e:{default:e}}t.name="sipEvents"},9016:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=u(r(6022)),o=u(r(43813)),a=u(r(14017)),i=u(r(35968)),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(32335)),c=r(45775);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e){return e&&e.__esModule?e:{default:e}}const d={};d[s.SIP_EVENT_SUBSCRIBE_FINISH]={next:(e,t)=>({...e,[t.payload.eventType]:{sessionData:t.payload.sessionData,subscribedUsers:t.payload.subscribedUsers}})},d[s.SIP_EVENT_UPDATE_FINISH]={next(e,t){let r=e[t.payload.eventType].subscribedUsers;if(r=(0,o.default)(t.payload.subscribeUserList,r),r=(0,n.default)(t.payload.unsubscribeUserList,r),0===r.length){const r={...e};return delete r[t.payload.eventType],r}return{...e,[t.payload.eventType]:{...e[t.payload.eventType],subscribedUsers:r}}}},d[s.SIP_EVENT_UNSUBSCRIBE_FINISH]={next:(e,t)=>(0,a.default)(t.payload.eventType,e)},d[s.SIP_EVENT_RECEIVED]=function(e,t){const r=(e[t.payload.eventType]||{}).notifications||[];return{...e,[t.payload.eventType]:{...e[t.payload.eventType],notifications:(0,i.default)(r,t.payload)}}};const f=(0,c.handleActions)(d,{});t.default=f},29962:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSipEventInfo=function(e,t){return t?(0,o.default)(e.sipEvents[t]):(0,o.default)(e.sipEvents)};var n,o=(n=r(89321))&&n.__esModule?n:{default:n}},73758:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,TimerTracker:a}=e,i=r.getLogger("SIPEVENTS");function s(e){if(!e||"string"!=typeof e)throw new Error("Invalid eventType argument, eventType must be a string.");return a.getAllById(e).some((e=>a.isRunning(e.handle)))}function c(e){a.clearAllById(e)}return{isRunning:s,stop:c,startResubInterval:function(r,l){const{SipEventsOperations:u}=e,{getState:d}=t;if(s(r))throw new Error(`There's already an interval running for ${r}.`);if("number"!=typeof l)throw new Error("The value passed for the expires argument must be a number.");const f=1e3*l/2;a.create("sipEvents",(()=>{if((0,n.getSipEventInfo)(d(),r)){i.info(`Re-subscribing for sip ${r}.`);try{u.update(r,{},null,!0)}catch(e){e.code===o.sipEventCodes.NOT_SUBSCRIBED&&c(r)}}}),f,{id:r,repeating:!0})}}},r(97107);var n=r(29962),o=r(75412)},83840:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,logManager:n,SipEventsRequests:d,SipEventsIntervals:f}=e,p=n.getLogger("SIPEVENTS");function g(e,t){f.startResubInterval(e,t)}function E(e){f.isRunning(e)&&f.stop(e)}return{subscribe:async function(e,r,n,i){const{dispatch:s,getState:l}=t;s(a.sipEventSubscribe(e,r,n,i)),p.debug(`Subscribing for sip ${e}.`,n);const f=(0,c.getSubscribedServices)(l()).filter((e=>e.startsWith("event:")));if(!(0,o.default)(e,f)){p.info(`Cannot subscribe to sip ${e}; service was not provisioned during user subscription.`);const t=new u.default({code:u.sipEventCodes.NOT_PROVISIONED,message:"Cannot subscribe to sip event; service was not provisioned during user subscription."});throw s(a.sipEventSubscribeFinish({error:t,eventType:e})),t}const{expires:E}=(0,c.getSubscriptionInfo)(l());try{const t=await d.subscribe(e,r,n,i,E);p.info(`Successfully subscribed to sip event ${e}.`);const o=a.sipEventSubscribeFinish({response:{...t.body.eventSubscriptionResponse,eventType:e,subscribedUsers:r}});g(e,o.payload.expires),s(o)}catch(t){throw s(a.sipEventSubscribeFinish({error:t,eventType:e})),t}},unsubscribe:async function(e){const{dispatch:r,getState:n}=t;r(a.sipEventUnsubscribe(e)),p.debug(`Unsubscribing from sip event subscriptions: ${e}.`);const o=(0,s.getSipEventInfo)(n(),e);if(!o){p.info(`Cannot unsubscribe from sip event ${e}; no subscription exists.`);const t=new u.default({code:u.sipEventCodes.NOT_SUBSCRIBED,message:`Cannot unsubscribe from ${e}; no subscription found.`});throw r(a.sipEventUnsubscribeFinish({error:t,eventType:e})),t}try{await d.unsubscribe(e,o),p.info(`Successfully unsubscribed from sip ${e}.`);const t=a.sipEventUnsubscribeFinish({response:{eventType:e}});E(e),r(t)}catch(t){throw r(a.sipEventUnsubscribeFinish({error:t,eventType:e})),t}},update:async function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{dispatch:i,getState:c}=t;i(a.sipEventUpdate(e,r,n)),p.debug(`Updating sip event subscription: ${e}.`);const l=(0,s.getSipEventInfo)(c(),e);if(!l){let t;throw t=o?new u.default({code:u.sipEventCodes.NOT_SUBSCRIBED,message:`Cannot resubscribe for ${e} subscription; user not subscribed.`}):new u.default({code:u.sipEventCodes.NOT_SUBSCRIBED,message:`Cannot update subscription for ${e}; user not subscribed.`}),i(a.sipEventUpdateFinish({error:t,eventType:e})),t}try{const{subscribeUserList:t,unsubscribeUserList:o}=r,s={};t&&t.length>0&&(s.subscribeUserList=t),o&&o.length>0&&(s.unsubscribeUserList=o),n||(n=[]);const c=await d.update(e,l,s,n);c&&(p.info(`Updated sip event subscription: ${e}.`),i(a.sipEventUpdateFinish({response:{...c,eventType:e,subscribeUserList:t||[],unsubscribeUserList:o||[]}})))}catch(t){throw i(a.sipEventUpdateFinish({error:t,eventType:e})),t}},startSipEventResub:g,stopSipEventResub:E,receiveEvent:function(e){const n=(0,c.getSubscribedServices)(t.getState()).filter((e=>e.startsWith("event:"))),o=e.genericNotificationParams;let u="";if(o.sessionDataType&&"call"===o.sessionDataType){const e=(0,l.getCallByWrtcsSessionId)(t.getState(),o.sessionData);e?u=e.id:p.warn("Call associated with received SIP notification cannot be found.")}n.includes(e.eventType)?(0,s.getSipEventInfo)(t.getState(),e.eventType)?p.info(`Received solicited SIP event notification of type ${e.eventType}.`,e):p.info(`Received solicited SIP event notification for untracked event of type ${e.eventType}.`,e):p.info(`Received unsolicited SIP event notification of type ${e.eventType}.`,e),t.dispatch(a.sipEventReceived(e,u)),r(i.EVENT_RECEIVED,{eventType:e.eventType,eventId:e.eventId,links:{callId:u},event:e})}}},r(62234);var n,o=(n=r(50593))&&n.__esModule?n:{default:n},a=f(r(69815)),i=f(r(40943)),s=r(29962),c=r(56512),l=r(40481),u=f(r(75412));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},34460:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,sendRequest:a}=e,i=r.getLogger("SIPEVENTS");return{subscribe:async function(e,r,s,c,l){const{getState:u}=t,{server:d,username:f}=(0,n.getConnectionInfo)(u()),p={method:"POST"};p.url=`${d.protocol}://${d.server}:${d.port}/rest/version/${d.version}/user/${f}/eventSubscription`,p.body={eventSubscriptionRequest:{subscribeUserList:r,clientCorrelator:s,eventType:e,expires:l}},c.length&&(p.body.eventSubscriptionRequest.customParameters=c),p.body=JSON.stringify(p.body);const g=await a(p),{body:E,error:_,result:y}=g;if(_){if(E){const{statusCode:t}=E.eventSubscriptionResponse,r=`Failed to subscribe to sip event ${e}, status code ${t}`;throw i.info(r),new o.default({code:o.sipEventCodes.UNKNOWN_ERROR,message:r})}{const{message:e}=y,t=`SIP event subscription request failed: ${e}.`;throw i.info(t),new o.default({code:o.sipEventCodes.UNKNOWN_ERROR,message:t})}}return g},unsubscribe:async function(e,r){const{getState:s}=t,{server:c,username:l}=(0,n.getConnectionInfo)(s()),u={method:"DELETE",responseType:"none"};u.url=`${c.protocol}://${c.server}:${c.port}/rest/version/${c.version}/user/${l}/eventSubscription/${r.sessionData}`;const d=await a(u),{body:f,error:p,result:g}=d;if(p){if(f){const{statusCode:t}=f.eventSubscriptionResponse,r=`Failed to unsubscribe from sip event ${e}, status code ${t}`;throw i.info(r),new o.default({code:o.sipEventCodes.UNKNOWN_ERROR,message:r})}{const{message:e}=g,t=`SIP event unsubscription request failed: ${e}.`;throw i.info(t),new o.default({code:o.sipEventCodes.UNKNOWN_ERROR,message:t})}}return d},update:async function(e,r,s,c){const{getState:l}=t,{server:u,username:d}=(0,n.getConnectionInfo)(l()),f={method:"PUT"};f.url=`${u.protocol}://${u.server}:${u.port}/rest/version/${u.version}/user/${d}/eventSubscription/${r.sessionData}`,f.body=JSON.stringify({eventSubscriptionRequest:{...s,eventType:e,customParameters:c,expires:r.expires}});const p=await a(f),{body:g,error:E,result:_}=p;if(E){let t;if(g){const{statusCode:r}=g.eventSubscriptionResponse;i.info(`Failed to update sip event subscription; ${e}, status code ${r}`),t=new o.default({code:o.sipEventCodes.UNKNOWN_ERROR,message:`Failed to update to sip event subscription; ${e}, status code ${r}`})}else{const{message:e}=_;i.info(`SIP event update subscription request failed: ${e}.`),t=new o.default({code:o.sipEventCodes.UNKNOWN_ERROR,message:`SIP event update subscription request failed: ${e}.`})}throw t}return g.eventSubscriptionResponse}}};var n=r(87075),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(75412));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},22191:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SUBSCRIPTION_STATE=t.OPERATIONS=t.MINIMUM_EXPIRY_SUBSCRIPTION_INTERVAL=t.CHANGE_REASONS=void 0,t.SUBSCRIPTION_STATE={FULL:"FULL",PARTIAL:"PARTIAL",NONE:"NONE"},t.CHANGE_REASONS={GONE:"GONE",LOST_CONNECTION:"LOST_CONNECTION",WS_OVERRIDDEN:"WS_OVERRIDDEN"},t.OPERATIONS={SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE"},t.MINIMUM_EXPIRY_SUBSCRIPTION_INTERVAL=6e4},34721:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UNSUBSCRIBE_FINISHED=t.UNSUBSCRIBE=t.SUBSCRIBE_FINISHED=t.SUBSCRIBE=t.RESUBSCRIPTION_FINISHED=t.PLUGIN_UNSUBSCRIPTION_FINISHED=t.PLUGIN_UNSUBSCRIPTION=t.PLUGIN_SUBSCRIPTION_FINISHED=t.PLUGIN_SUBSCRIPTION=t.CHANNEL_OPENED=t.CHANNEL_CLOSED=void 0;const r="@@KANDY/SUBSCRIPTION/";t.SUBSCRIBE=r+"SUBSCRIBE",t.SUBSCRIBE_FINISHED=r+"SUBSCRIBE_FINISHED",t.UNSUBSCRIBE=r+"UNSUBSCRIBE",t.UNSUBSCRIBE_FINISHED=r+"UNSUBSCRIBE_FINISHED",t.RESUBSCRIPTION_FINISHED=r+"RESUBSCRIPTION_FINISHED",t.PLUGIN_SUBSCRIPTION=r+"PLUGIN_SUBSCRIPTION",t.PLUGIN_SUBSCRIPTION_FINISHED=r+"PLUGIN_SUBSCRIPTION_FINISHED",t.PLUGIN_UNSUBSCRIPTION=r+"PLUGIN_UNSUBSCRIPTION",t.PLUGIN_UNSUBSCRIPTION_FINISHED=r+"PLUGIN_UNSUBSCRIPTION_FINISHED",t.CHANNEL_OPENED=r+"CHANNEL_OPENED",t.CHANNEL_CLOSED=r+"CHANNEL_CLOSED"},49561:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.channelClosed=function(e){return a(n.CHANNEL_CLOSED,{},{type:e})},t.channelOpened=function(e,t){return a(n.CHANNEL_OPENED,{...e},{type:t})},t.doPluginSubscriptions=function(e,t){return a(n.PLUGIN_SUBSCRIPTION,{services:e,type:t})},t.doPluginUnsubscriptions=function(e,t){return a(n.PLUGIN_UNSUBSCRIPTION,{services:e,type:t})},t.reportSubscriptionFinished=function(e){let{service:t,type:r,subscription:o,error:i}=e;const s=o?o.resourceURL.split("/subscriptions/")[1]:null;return a(n.PLUGIN_SUBSCRIPTION_FINISHED,{...o,subscriptionId:s,service:t,channelType:r,error:i})},t.reportUnsubscriptionFinished=function(e){let{service:t,type:r,error:o}=e;return a(n.PLUGIN_UNSUBSCRIPTION_FINISHED,{service:t,channelType:r,error:o})},t.resubscribeFinished=function(e){let{error:t,attemptNum:r}=e;var o={type:n.RESUBSCRIPTION_FINISHED,meta:{}};return t?(o.error=!0,o.payload=t,o.payload.attemptNum=r):o.payload={attemptNum:r},o},t.subscribe=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return a(n.SUBSCRIBE,{services:e,...t})},t.subscribeFinished=function(e){let{subscriptions:t,type:r,error:o}=e;return a(n.SUBSCRIBE_FINISHED,{subscriptions:t,type:r,error:o})},t.unsubscribe=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return a(n.UNSUBSCRIBE,{services:e,type:t})},t.unsubscribeFinished=function(e){let{type:t,error:r,reason:o,retryAfter:i}=e;const s=i?{type:t,error:r,reason:o,retryAfter:i}:{type:t,error:r,reason:o};return a(n.UNSUBSCRIBE_FINISHED,s)};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(34721));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{type:e,payload:{...t},error:!!t.error,meta:{...r}}}},93725:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,SubscriptionOperations:r,logManager:d,API_LOG_TAG:f,emitEvent:p}=e,g=d.getLogger("SUBSCRIPTION");async function E(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i||g.debug(f+"services.subscribeAsync: ",e,a.type),"string"==typeof a&&Object.values(c.notificationTypes).includes(a)&&(a={type:a}),a.type||(a.type=c.notificationTypes.WEBSOCKET);const d=(0,s.getUserInfo)(t.getState());if(!d||!d.username)throw new u.default({message:"Failed to subscribe user. Please ensure credentials are set.",code:u.subscriptionCodes.INVALID_STATE});e=(0,l.normalizeServices)(e),t.dispatch(n.subscribe(e,a)),i&&p(o.SUB_CHANGE,{reason:void 0});try{await r.subscribeFlow({services:e,options:a})}catch(e){throw g.debug(`Subscription failed: ${e.message}`),t.dispatch(n.subscribeFinished({error:e})),e}}async function _(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.notificationTypes.WEBSOCKET,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i||g.debug(f+"services.unsubscribeAsync: ",e,a);const l=(0,s.getUserInfo)(t.getState());if(!l||!l.username)throw new u.default({message:"Failed to unsubscribe user: Found no existing subscription with a valid username or a valid access token.",code:u.subscriptionCodes.INVALID_STATE});t.dispatch(n.unsubscribe(e,a)),i&&p(o.SUB_CHANGE,{reason:void 0});try{const o=await r.unsubscribeFlow(e,a);o?(g.info("Successfully unsubscribed from specified services."),t.dispatch(n.subscribeFinished(o))):(g.info("Successfully unsubscribed from all services."),t.dispatch(n.unsubscribeFinished({})))}catch(e){throw g.debug(`Unsubscribe failed: ${e.message}`),t.dispatch(n.unsubscribeFinished({error:e})),e}}return{services:{subscribe:async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};g.debug(f+"services.subscribe: ",e,r.type);try{const n=(0,s.getUserInfo)(t.getState());if(!n||!n.username)return void p(o.SUB_ERROR,{error:new u.default({message:"Failed to subscribe user. Please ensure credentials are set.",code:u.subscriptionCodes.INVALID_STATE})});await E(e,r,!0),p(o.SUB_CHANGE,{reason:void 0})}catch(e){p(o.SUB_ERROR,{error:e})}},subscribeAsync:E,unsubscribe:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.notificationTypes.WEBSOCKET;g.debug(f+"services.unsubscribe: ",e,t);try{await _(e,t,!0),p(o.SUB_CHANGE,{})}catch(e){p(o.SUB_ERROR,{error:e})}},unsubscribeAsync:_,getSubscriptions:()=>(g.debug(f+"services.getSubscriptions"),{subscribed:(0,a.getSubscribedServices)(t.getState()),available:(0,a.getRegisteredServices)(t.getState()),isPending:t.getState().subscription.isPending}),changeReasons:i.CHANGE_REASONS}}},r(62234);var n=f(r(49561)),o=f(r(34889)),a=r(56512),i=r(22191),s=r(87075),c=r(78215),l=r(1011),u=f(r(75412));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},34889:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SUB_RESUB=t.SUB_ERROR=t.SUB_CHANGE=void 0,t.SUB_CHANGE="subscription:change",t.SUB_ERROR="subscription:error",t.SUB_RESUB="subscription:resub"},57946:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createAPI",{enumerable:!0,get:function(){return o.default}}),t.name=void 0,Object.defineProperty(t,"reducer",{enumerable:!0,get:function(){return n.default}});var n=a(r(67261)),o=a(r(93725));function a(e){return e&&e.__esModule?e:{default:e}}t.name="subscription"},67261:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(90636))&&n.__esModule?n:{default:n},a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(34721)),i=r(22191),s=r(45775);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}const l={};function u(e,t){return(r,n)=>({...r,isPending:e,pendingOperation:t})}l[a.SUBSCRIBE]=u(!0,{operation:i.OPERATIONS.SUBSCRIBE,startTime:Date.now()}),l[a.UNSUBSCRIBE]=u(!0,{operation:i.OPERATIONS.UNSUBSCRIBE,startTime:Date.now()}),l[a.SUBSCRIBE_FINISHED]={next:(e,t)=>({...e,isPending:!1,pendingOperation:null,error:void 0,subscriptions:t.payload.subscriptions||e.subscriptions}),throw:(e,t)=>({...e,isPending:!1,pendingOperation:null,error:t.payload})},l[a.UNSUBSCRIBE_FINISHED]={next(e,t){const r={...e,isPending:!1,pendingOperation:null};return r.subscriptions=[],t.payload.reason===i.CHANGE_REASONS.LOST_CONNECTION&&(r.subscriptions=[]),r},throw:e=>({...e,isPending:!1,pendingOperation:null})},l[a.PLUGIN_SUBSCRIPTION_FINISHED]={next:(e,t)=>({...e,subscriptions:e.subscriptions.concat(t.payload)})},l[a.PLUGIN_UNSUBSCRIPTION_FINISHED]={next:(e,t)=>({...e,subscriptions:(0,o.default)((function(e){return e.channelType===t.payload.channelType&&e.service===t.payload.service}))(e.subscriptions)})},l[a.CHANNEL_OPENED]={next:(e,t)=>({...e,notificationChannels:{...e.notificationChannels,[t.meta.type]:t.payload}})},l[a.CHANNEL_CLOSED]={next:(e,t)=>({...e,notificationChannels:{...e.notificationChannels,[t.meta.type]:void 0}})};const d=(0,s.handleActions)(l,{notificationChannels:{},subscriptions:[],registeredServices:["call","Presence","IM"],isPending:!1,pendingOperation:null});t.default=d},56512:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPendingOperation=function(e){return e.subscription.pendingOperation},t.getRegisteredServices=function(e){return(0,n.default)(e.subscription.registeredServices)},t.getServiceUnavailableMaxRetries=function(e){return e.config.subscription.serviceUnavailableMaxRetries},t.getSubscribedServices=function(e,t){let r=i(e);return t&&(r=r.filter((e=>e.channelType===t))),r.reduce(((e,t)=>e.concat(t.service)),[])},t.getSubscriptionConfig=function(e){return(0,n.default)(e.config.subscription)},t.getSubscriptionExpiry=function(e){const t=e.config.subscription,r=e.config.authentication;return r.subscription&&r.subscription.expires?r.subscription.expires:t.expires},t.getSubscriptionInfo=i,t.getSubscriptions=function(e,t,r){let o=e.subscription.subscriptions;return o=o.filter((e=>e.service===t&&e.channelType===r)),(0,n.default)(o)},t.getWebsocketConfig=function(e){const t=e.config.subscription,r=e.config.authentication;return(0,o.default)(t.websocket,r.websocket)},t.getWebsocketId=function(e,t){let r,n=i(e);if(n=Array.isArray(n)?n:[n],r=t?n.find((e=>"service"===e.service||e.service.includes(t))):n[0],r&&"string"==typeof r.notificationChannel)return r.notificationChannel.split("/websocket/")[1]},r(62234);var n=a(r(89321)),o=a(r(7485));function a(e){return e&&e.__esModule?e:{default:e}}function i(e){return(0,n.default)(e.subscription.subscriptions)}},32255:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"connectionLost",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"subscribe",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"subscriptionGone",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"unsubscribe",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"updateSubscription",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"websocketOverridden",{enumerable:!0,get:function(){return c.default}});var n=l(r(23727)),o=l(r(63657)),a=l(r(32965)),i=l(r(52899)),s=l(r(35063)),c=l(r(18324));function l(e){return e&&e.__esModule?e:{default:e}}},52899:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("SubscriptionOperations.onConnectionLost",(t=>(0,o.default)(e.container)))};var n,o=(n=r(97856))&&n.__esModule?n:{default:n}},97856:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,SubscriptionIntervals:i}=e;return async function(){i.resubInterval.stopResubInterval(),t.dispatch(n.unsubscribeFinished({reason:a.CHANGE_REASONS.LOST_CONNECTION})),r(o.SUB_CHANGE,{reason:a.CHANGE_REASONS.LOST_CONNECTION})}};var n=s(r(49561)),o=s(r(34889)),a=r(22191);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},35063:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("SubscriptionOperations.onSubscriptionGone",(t=>(0,o.default)(e.container))),e.defer((e=>{e.Notifications.takeEveryAction((function(e){return e.type===a.NOTIFICATION_RECEIVED&&e.payload.notificationMessage&&"gone"===e.payload.notificationMessage.eventType}),(t=>{e.SubscriptionOperations.onSubscriptionGone(t.payload.notificationMessage)}))}))};var n,o=(n=r(8568))&&n.__esModule?n:{default:n},a=r(70506)},8568:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,Connectivity:c,SubscriptionIntervals:l}=e;return async function(e){(0,s.getConnectionState)(t.getState()).connected&&c.disconnect();const u=(0,a.getPendingOperation)(t.getState());if(u&&u.operation===i.OPERATIONS.UNSUBSCRIBE)return;l.resubInterval.stopResubInterval();const d=e&&e.retryAfter?{reason:i.CHANGE_REASONS.GONE,retryAfter:e.retryAfter}:{reason:i.CHANGE_REASONS.GONE};t.dispatch(n.unsubscribeFinished(d)),r(o.SUB_CHANGE,{reason:i.CHANGE_REASONS.GONE})}};var n=l(r(49561)),o=l(r(34889)),a=r(56512),i=r(22191),s=r(94482);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},18324:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("SubscriptionOperations.onWebsocketOverridden",(t=>(0,o.default)(e.container))),e.defer((e=>{e.Notifications.takeEveryAction((function(e){return e.type===a.NOTIFICATION_RECEIVED&&e.payload.notificationMessage&&"websocketOverridden"===e.payload.notificationMessage.eventType}),(t=>{e.SubscriptionOperations.onWebsocketOverridden()}))}))};var n,o=(n=r(35096))&&n.__esModule?n:{default:n},a=r(70506)},35096:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,Connectivity:s,SubscriptionIntervals:c}=e;return async function(){(0,i.getConnectionState)(t.getState()).connected&&s.disconnect(),c.resubInterval.stopResubInterval(),t.dispatch(n.unsubscribeFinished({reason:a.CHANGE_REASONS.WS_OVERRIDDEN})),r(o.SUB_CHANGE,{reason:a.CHANGE_REASONS.WS_OVERRIDDEN})}};var n=c(r(49561)),o=c(r(34889)),a=r(22191),i=r(94482);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function c(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},22507:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSpidrServices=function(e,t){const r=t.map((e=>e.toUpperCase())),o=e.filter((function(e){return-1===r.indexOf(e.toUpperCase())})),a={requested:e,received:t,missing:o,status:"UNKNOWN",services:{}};return 0===t.length?a.status=n.SUBSCRIPTION_STATE.NONE:t.length>0&&o.length>0?a.status=n.SUBSCRIPTION_STATE.PARTIAL:t.length>0&&e.length===t.length&&(a.status=n.SUBSCRIPTION_STATE.FULL),t.forEach((function(e){a.services[e]=!0})),o.forEach((function(e){a.services[e]=!1})),a};var n=r(22191)},23727:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("SubscriptionRequests.subscribe",(t=>(0,n.default)(e.container))),e.factory("SubscriptionOperations.subscribe",(t=>(0,o.default)(e.container))),e.factory("SubscriptionOperations.subscribeFlow",(t=>(0,a.default)(e.container)))};var n=i(r(78641)),o=i(r(34189)),a=i(r(65400));function i(e){return e&&e.__esModule?e:{default:e}}},34189:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,SubscriptionOperations:u,SubscriptionRequests:d,Notifications:f,Connectivity:p}=e,g=r.getLogger("SUBSCRIPTION");return async function(e,r){if(g.info(`Initiating subscription for services: ${e}`),!e||0===e.length)throw new c.default({code:c.subscriptionCodes.NO_SERVICE_PROVIDED,message:"No service provided"});const E=(0,o.getAuthConfig)(t.getState()),_=(0,o.getConnectionInfo)(t.getState()),y=(0,l.getSubscriptionExpiry)(t.getState());let v;e=e.map((e=>e.service));let S=1;const O=(0,l.getServiceUnavailableMaxRetries)(t.getState());for(;S<=1+O&&(v=await d.subscribe(E,y,_,e,r),v.error);){if(v.error.code!==c.authCodes.SUBSCRIBE_UNAVAILABLE||!v.retryAfter){let e=S>1?`Subscription subsequently failed: ${v.error} (after getting an initial 503 response).`:`Subscription failed: ${v.error}`;throw g.debug(e),v.error}{if(S===1+O)throw g.debug(`Subscription failed: ${v.error} after ${S-1} re-attempts.`),v.error;const e=await Promise.race([(0,s.delay)(v.retryAfter),f.takeAction(n.UNSUBSCRIBE_FINISHED)]);if(e&&e.actionType&&e.actionType===n.UNSUBSCRIBE_FINISHED)return;S++}}if(_.requestOptions.headers["x-token"]){if(!v.subscriptionParams)throw new c.default({message:"Failed user subscription using HMAC-based token.",code:c.authCodes.SUBSCRIBE_FAIL});t.dispatch((0,a.updateHmacToken)(v.subscriptionParams.sessionId))}const h={...v.subscriptionParams,servicesInfo:v.servicesInfo,url:v.subscription},{webSocketOAuthMode:T}=(0,i.getConnectivityConfig)(t.getState()),I={},C=_.bearerAccessToken;C&&"query"===T&&(I.access_token=C);const m=(0,l.getWebsocketConfig)(t.getState()),A={protocol:"wss",server:m.server,port:m.port,url:h.notificationChannel,params:I};try{await p.connect(A)}catch(e){throw await u.unsubscribe([h]),e}return g.info(`Subscribed to the following services: ${h.service}`),{subscriptions:[h]}}};var n=d(r(34721)),o=r(87075),a=r(44130),i=r(94482),s=r(1011),c=d(r(75412)),l=r(56512);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},78641:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,sendRequest:n}=e,c=r.getLogger("SUBSCRIPTION");return async function(e,r,l,u){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const f=(0,o.getUserInfo)(t.getState()).isAnonymous?"anonymous":"user";let p={method:"POST"};p.url=`${l.server.protocol}://${l.server.server}:${l.server.port}/rest/version/${l.server.version}/${f}/${l.username}/subscription`,p.body=JSON.stringify({subscribeRequest:{expires:r,service:u,localization:e.localization||"English_US",useTurn:e.useTurn||!0,notificationType:e.notificationType||"WebSocket",supported:["RingingFeedback"],clientCorrelator:d.clientCorrelator}}),p=(0,i.default)(d,p);const g=await n(p),{body:E,error:_,result:y}=g;if(_){let e=s.authCodes.SUBSCRIBE_FAIL;if(E){let t,r;E.statusCode&&E.reason?(t=E.statusCode,503===t&&(r=E.retryAfter,e=s.authCodes.SUBSCRIBE_UNAVAILABLE)):E.subscribeResponse&&(t=E.subscribeResponse.statusCode,503===t&&(r=E.subscribeResponse.retryAfter,e=s.authCodes.SUBSCRIBE_UNAVAILABLE)),c.debug(`Failed user subscription with status code ${t}.`);const n={message:`Failed to subscribe user. Status Code: ${t}.`,code:e},o={error:new s.default(n)};return r&&r>0&&(o.retryAfter=r),o}return c.debug("Failed user subscription.",y.message),{error:new s.default({message:`Subscribe request failed: ${y.message}.`,code:e})}}{const e=E.subscribeResponse,t=e.subscriptionParams.service,r=(0,a.parseSpidrServices)(u,t);return c.debug(`Subscribed user. Service subscription status: ${r.status}`),{error:!1,servicesInfo:r,...e}}}};var n,o=r(87075),a=r(22507),i=(n=r(7485))&&n.__esModule?n:{default:n},s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}},65400:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,SubscriptionOperations:r,Notifications:s,SubscriptionIntervals:c}=e;return async function(e){const{services:l,options:u}=e;let d;const f=(0,a.getSubscriptionInfo)(t.getState());if(f&&f[0])d=await Promise.race([r.updateSubscription(l,!0),s.takeAction(o.UNSUBSCRIBE)]);else{if(!l||0===l.length)throw new i.default({code:i.subscriptionCodes.NO_SERVICE_PROVIDED,message:"No service provided"});d=await Promise.race([r.subscribe(l,u),s.takeAction(o.UNSUBSCRIBE)])}if(!d||d.type!==o.UNSUBSCRIBE)return t.dispatch(n.subscribeFinished({subscriptions:d.subscriptions})),c.resubInterval.startResubInterval(),d;r.unsubscribe()}};var n=c(r(49561)),o=c(r(34721)),a=r(56512),i=c(r(75412));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function c(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},63657:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("SubscriptionRequests.unsubscribe",(t=>(0,n.default)(e.container))),e.factory("SubscriptionOperations.unsubscribe",(t=>(0,o.default)(e.container))),e.factory("SubscriptionOperations.unsubscribeFlow",(t=>(0,a.default)(e.container)))};var n=i(r(27388)),o=i(r(60508)),a=i(r(76248));function i(e){return e&&e.__esModule?e:{default:e}}},60508:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,SubscriptionRequests:i,Connectivity:s}=e,c=r.getLogger("SUBSCRIPTION");return async function(e){c.info("Unsubscribing from existing subscription:",e),e||(e=(0,n.getSubscriptionInfo)(t.getState())),e=e[0];const r=(0,o.getConnectionInfo)(t.getState());e&&r&&(await i.unsubscribe(r,e.url),(0,a.getConnectionState)(t.getState()).connected&&s.disconnect())}};var n=r(56512),o=r(87075),a=r(94482)},27388:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,sendRequest:r}=e,n=t.getLogger("SUBSCRIPTION");return async function(e,t){const a={method:"DELETE"};a.url=`${e.server.protocol}://${e.server.server}:${e.server.port}`+t;const i=await r(a),{body:s,error:c,result:l}=i;if(c){if(s&&s.subscribeResponse){const{statusCode:e}=s.subscribeResponse;throw n.debug(`Encountered error unsubscribing user with status code ${e}.`),new o.default({message:`Failed to unsubscribe. Status Code: ${e}`,code:e})}{const{message:e,code:t}=l;throw n.debug("Encountered error unsubscribing user.",e),new o.default({message:e,code:t})}}n.debug("User unsubscribed successfully.")}};var n,o=(n=r(75412))&&n.__esModule?n:{default:n}},76248:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,SubscriptionOperations:r,SubscriptionIntervals:c}=e;return async function(e){if(arguments.length>1&&void 0!==arguments[1]||i.notificationTypes.WEBSOCKET,!e||0===e.length)throw new s.default({code:s.subscriptionCodes.NO_SERVICE_PROVIDED,message:"No service provided"});const l=(0,a.getSubscriptionInfo)(t.getState());if(l&&l[0]){const t=l[0].service.filter((t=>!e.includes(t)));if(0===t.length)return await r.unsubscribe(),void c.resubInterval.stopResubInterval();if((0,o.default)((0,n.default)(l[0].service,t)))throw new s.default({message:`No subscription found for ${JSON.stringify(e)}, can't unsubscribe.`,code:s.authCodes.UNSUBSCRIBE_FAIL});return e=t.map((e=>({service:e}))),r.updateSubscription(e,!1)}throw new s.default({message:"No subscription found, can't unsubscribe.",code:s.authCodes.UNSUBSCRIBE_FAIL})}},r(62234);var n=l(r(37011)),o=l(r(84499)),a=r(56512),i=r(78215),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}function l(e){return e&&e.__esModule?e:{default:e}}},32965:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("SubscriptionRequests.resubscribe",(t=>(0,n.default)(e.container))),e.factory("SubscriptionOperations.updateSubscription",(t=>(0,o.default)(e.container)))};var n=a(r(82912)),o=a(r(55608));function a(e){return e&&e.__esModule?e:{default:e}}},55608:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,SubscriptionRequests:n}=e,s=r.getLogger("SUBSCRIPTION");return async function(e){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];s.info("Updating subscription using new services: ",e);const c=(0,i.getConnectionInfo)(t.getState()),l=(0,a.getSubscriptionInfo)(t.getState()),u=e.map((e=>e.service));l[0].service=r?(0,o.default)(u,l[0].service):l[0].service.filter((e=>u.includes(e)));const d=await n.resubscribe(c,l),f={...d.subscriptionParams,servicesInfo:d.servicesInfo,url:d.subscription};return s.info(`Subscribed to the following services: ${l[0].service}`),{subscriptions:[f]}}},r(62234);var n,o=(n=r(43813))&&n.__esModule?n:{default:n},a=r(56512),i=r(87075)},82912:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,sendRequest:r}=e,a=t.getLogger("SUBSCRIPTION");return async function(e,t){let[i]=t;const s={method:"PUT"};i.clientCorrelator?s.url=`${e.server.protocol}://${e.server.server}:${e.server.port}/rest/version/${e.server.version}/user/${e.username}/subscription/clientCorrelator/${i.clientCorrelator}`:s.url=`${e.server.protocol}://${e.server.server}:${e.server.port}`+i.url,s.body=JSON.stringify({subscribeRequest:{expires:i.expires,service:i.service,localization:i.localization||"English_US",useTurn:i.useTurn||!0,notificationType:i.notificationType||"WebSocket",supported:["RingingFeedback"]}});const c=await r(s),{body:l,error:u,result:d}=c;if(u){if(l){const{statusCode:e}=l.subscribeResponse;let t,r;throw a.debug(`Failed to update user subscription with status code ${e}.`),404===d.code&&39===e?(t=`Subscription no longer exists. Code ${e}.`,r=e):(t=`Failed to update user subscription with status code ${e}.`,r=o.authCodes.UPDATE_SUBSCRIPTION_FAIL),new o.default({message:t,code:r})}{const{message:e}=d;throw a.debug("User subscription update request failed.",e),new o.default({message:`Update subscription request failed.: ${e}.`,code:o.authCodes.UPDATE_SUBSCRIPTION_FAIL})}}{const e=l.subscribeResponse;if(0===e.statusCode||2===e.statusCode){const t=e.subscriptionParams.service,r=(0,n.parseSpidrServices)(i.service,t);return a.debug(`Resubscribed user. Service resubscription status: ${r.status}`),{error:!1,servicesInfo:r,...e}}throw new o.default({message:`Unknown error; statusCode: ${e.statusCode}.`,code:o.authCodes.UPDATE_SUBSCRIPTION_FAIL})}}};var n=r(22507),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(75412));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},29799:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=a.MINIMUM_EXPIRY_SUBSCRIPTION_INTERVAL/1e3,n=u.validation.schema({expires:u.validation.positive().greaterThanOrEqual(r),serviceUnavailableMaxRetries:u.validation.positive(),websocket:u.validation.schema({server:u.validation.string(),protocol:u.validation.string(),port:u.validation.positive()})}),d=(0,u.parse)("subscription",n);t=(0,l.default)({expires:3600,serviceUnavailableMaxRetries:3,websocket:{protocol:"wss",port:443}},t),d(t);for(const t in i)i[t](e);for(const t in s)s[t](e);return e.defer((function(e){const{context:n}=e;t.expires<r&&(t.expires=r),n.dispatch((0,c.update)(t,o.name))})),{api:o.createAPI,capabilities:["subscription"],reducer:o.reducer,name:o.name}};var n,o=r(57946),a=r(22191),i=f(r(32255)),s=f(r(52118)),c=r(87310),l=(n=r(7485))&&n.__esModule?n:{default:n},u=r(52932);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},52118:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.factory("SubscriptionIntervals.resubInterval",(()=>(0,o.default)(e.container)))};var n,o=(n=r(59805))&&n.__esModule?n:{default:n}},59805:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,TimerTracker:r,SubscriptionRequests:c,SubscriptionOperations:l,emitEvent:u}=e;let d=1;function f(e,t){let n=1e3*t/Math.pow(2,d);const o=a.MINIMUM_EXPIRY_SUBSCRIPTION_INTERVAL/2;n=n>o?n:o;const i=.8*n,s=1.2*n,c=Math.floor(Math.random()*(s-i)+1);r.create("subscription",e,i+c,{id:"resubscribe"})}function p(){r.clearAllById("resubscribe")}return{startResubInterval:async function(){r.getAllById("resubscribe").some((e=>r.isRunning(e.handle)))&&p();const e=(0,i.getConnectionInfo)(t.getState()),a=(0,n.getSubscriptionInfo)(t.getState());a&&a[0]?a.length>0&&f((async function r(){try{await c.resubscribe(e,a),t.dispatch(o.resubscribeFinished({attemptNum:d})),u(s.SUB_RESUB,{attemptNum:d,isFailure:!1}),d=1,p(),f(r,a[0].expires)}catch(e){if(39===e.code)return p(),void await l.onSubscriptionGone();t.dispatch(o.resubscribeFinished({error:e,attemptNum:d})),u(s.SUB_RESUB,{attemptNum:d,isFailure:!0}),d++,p(),f(r,a[0].expires)}}),a[0].expires):p()},stopResubInterval:function(){p()}}};var n=r(56512),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(49561)),a=r(22191),i=r(87075),s=r(34889);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}},28686:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_CONTACT_FINISH=t.UPDATE_CONTACT=t.SEARCH_DIRECTORY_FINISH=t.SEARCH_DIRECTORY=t.REMOVE_CONTACT_FINISH=t.REMOVE_CONTACT=t.REFRESH_CONTACTS_FINISH=t.REFRESH_CONTACTS=t.FETCH_USER_FINISH=t.FETCH_USER=t.FETCH_CONTACT_FINISH=t.FETCH_CONTACT=t.ADD_CONTACT_FINISH=t.ADD_CONTACT=void 0;const r="@@KANDY/";t.ADD_CONTACT=r+"ADD_CONTACT",t.ADD_CONTACT_FINISH=r+"ADD_CONTACT_FINISH",t.REFRESH_CONTACTS=r+"REFRESH_CONTACTS",t.REFRESH_CONTACTS_FINISH=r+"REFRESH_CONTACTS_FINISH",t.REMOVE_CONTACT=r+"REMOVE_CONTACT",t.REMOVE_CONTACT_FINISH=r+"REMOVE_CONTACT_FINISH",t.UPDATE_CONTACT=r+"UPDATE_CONTACT",t.UPDATE_CONTACT_FINISH=r+"UPDATE_CONTACT_FINISH",t.FETCH_CONTACT=r+"FETCH_CONTACT",t.FETCH_CONTACT_FINISH=r+"FETCH_CONTACT_FINISH",t.FETCH_USER=r+"FETCH_USER",t.FETCH_USER_FINISH=r+"FETCH_USER_FINISH",t.SEARCH_DIRECTORY=r+"SEARCH_DIRECTORY",t.SEARCH_DIRECTORY_FINISH=r+"SEARCH_DIRECTORY_FINISH"},42340:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addContact=function(e){return{type:n.ADD_CONTACT,payload:e}},t.addContactFinish=function(e){let{contact:t,error:r}=e;return{payload:r||t,error:Boolean(r),type:n.ADD_CONTACT_FINISH}},t.fetchContact=function(e){return{type:n.FETCH_CONTACT,payload:e}},t.fetchContactFinish=function(e){let{contact:t,error:r}=e;return{type:n.FETCH_CONTACT_FINISH,payload:r||t,error:Boolean(r)}},t.refreshContacts=function(){return{type:n.REFRESH_CONTACTS,payload:null}},t.refreshContactsFinish=function(e){let{contacts:t,error:r}=e;return{type:n.REFRESH_CONTACTS_FINISH,payload:r||t,error:Boolean(r)}},t.removeContact=function(e){return{type:n.REMOVE_CONTACT,payload:e}},t.removeContactFinish=function(e){let{contactId:t,error:r}=e;return{type:n.REMOVE_CONTACT_FINISH,payload:t||r,error:!!r}},t.updateContact=function(e){return{type:n.UPDATE_CONTACT,payload:e}},t.updateContactFinish=function(e){let{contact:t,error:r}=e;return{type:n.UPDATE_CONTACT_FINISH,payload:r||t,error:!!r}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(28686));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},12585:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchUser=function(e){return{type:n.FETCH_USER,payload:e}},t.fetchUserFinish=function(e,t){return{type:n.FETCH_USER_FINISH,payload:t||e,error:Boolean(t)}},t.searchDirectory=function(e,t){return{type:n.SEARCH_DIRECTORY,payload:{filters:e,options:t}}},t.searchDirectoryFinish=function(e){let{users:t,error:r}=e;return{type:n.SEARCH_DIRECTORY_FINISH,payload:r||t,error:Boolean(r)}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(28686));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},2321:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,UsersOperations:a,logManager:i,API_LOG_TAG:s}=e,c=i.getLogger("USERS");return{async add(e){let t;c.debug(s+"contacts.add: ",e);try{t=await a.addContact(e)}catch(e){return void r(o.CONTACTS_ERROR,{error:e})}r(o.CONTACTS_CHANGE,{contactData:t}),r(o.CONTACTS_CHANGE,{})},get:e=>(c.debug(s+"contacts.get: ",e),(0,n.getContact)(t.getState(),e)),getAll:()=>(c.debug(s+"contacts.getAll"),(0,n.getContacts)(t.getState())),refresh(){let e;c.debug(s+"contacts.refresh");try{e=a.refreshContacts()}catch(e){return void r(o.CONTACTS_ERROR,{error:e})}r(o.CONTACTS_CHANGE,{contactData:e})},async remove(e){let t;c.debug(s+"contacts.remove: ",e);try{t=await a.removeContact(e)}catch(e){return void r(o.CONTACTS_ERROR,{error:e})}r(o.CONTACTS_CHANGE,{contactId:t})},async update(e){let t;c.debug(s+"contacts.update: ",e);try{t=await a.updateContact(e)}catch(e){return void r(o.CONTACTS_ERROR,{error:e})}r(o.CONTACTS_CHANGE,{contactData:t})},async fetch(e){let t;c.debug(s+"contacts.fetch: ",e);try{t=await a.fetchContact(e)}catch(e){return void r(o.CONTACTS_ERROR,{error:e})}r(o.CONTACTS_CHANGE,{contact:t})}}};var n=r(49639),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(62318));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},88398:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{contacts:(0,o.default)(e),user:(0,n.default)(e)}};var n=a(r(58526)),o=a(r(2321));function a(e){return e&&e.__esModule?e:{default:e}}},58526:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,UsersOperations:a,logManager:i,API_LOG_TAG:s}=e,c=i.getLogger("USERS");return{async fetch(e){let t;c.debug(s+"user.fetch: ",e);try{t=await a.fetchUser(e),t&&r(o.USERS_CHANGE,{results:[t]})}catch(e){r(o.USERS_ERROR,{error:e})}},get:e=>(c.debug(s+"user.get: ",e),(0,n.getUser)(t.getState(),e)),getAll:()=>(c.debug(s+"user.getAll"),(0,n.getUsers)(t.getState())),async search(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c.debug(s+"user.search: ",t,n);try{e=await a.searchDirectory(t,n)}catch(e){return void r(o.DIRECTORY_ERROR,{error:e})}r(o.DIRECTORY_CHANGE,{results:e})}}};var n=r(49639),o=r(62318)},62318:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USERS_ERROR=t.USERS_CHANGE=t.DIRECTORY_ERROR=t.DIRECTORY_CHANGE=t.CONTACTS_NEW=t.CONTACTS_ERROR=t.CONTACTS_CHANGE=void 0,t.CONTACTS_NEW="contacts:new",t.CONTACTS_ERROR="contacts:error",t.CONTACTS_CHANGE="contacts:change",t.DIRECTORY_CHANGE="directory:change",t.DIRECTORY_ERROR="directory:error",t.USERS_CHANGE="users:change",t.USERS_ERROR="users:error"},2549:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createAPI",{enumerable:!0,get:function(){return n.default}}),t.name=void 0,Object.defineProperty(t,"reducer",{enumerable:!0,get:function(){return o.default}});var n=a(r(88398)),o=a(r(72079));function a(e){return e&&e.__esModule?e:{default:e}}t.name="users"},92778:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(65891))&&n.__esModule?n:{default:n},a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(28686));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}const s={},c={next:e=>({...e,isPending:!0})};s[a.ADD_CONTACT]=c,s[a.REFRESH_CONTACTS]=c,s[a.FETCH_CONTACT]=c,s[a.UPDATE_CONTACT]=c,s[a.ADD_CONTACT_FINISH]={next:(e,t)=>({...e,contacts:{...e.contacts,[t.payload.contactId]:t.payload},isPending:!1}),throw:(e,t)=>({...e,isPending:!1,errors:e.errors.concat(t.payload)})},s[a.REFRESH_CONTACTS_FINISH]={next(e,t){const r={};for(const e of t.payload)r[e.contactId]=e;return{...e,contacts:r,isPending:!1}},throw:(e,t)=>({...e,isPending:!1,errors:e.errors.concat(t.payload)})},s[a.FETCH_CONTACT_FINISH]={next:(e,t)=>({...e,contacts:{...e.contacts,[t.payload.contactId]:t.payload},isPending:!1}),throw:(e,t)=>({...e,isPending:!1,errors:e.errors.concat(t.payload)})},s[a.REMOVE_CONTACT_FINISH]={next:(e,t)=>({...e,contacts:(0,o.default)(t.payload,e.contacts),isPending:!1}),throw:(e,t)=>({...e,isPending:!1,errors:e.errors.concat(t.payload)})},s[a.UPDATE_CONTACT_FINISH]={next:(e,t)=>({...e,contacts:{...e.contacts,[t.payload.contactId]:t.payload},isPending:!1}),throw:(e,t)=>({...e,isPending:!1,errors:e.errors.concat(t.payload)})},t.default=s},72079:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(92778)),o=a(r(13995));function a(e){return e&&e.__esModule?e:{default:e}}const i=(0,r(45775).handleActions)({...n.default,...o.default},{errors:[],contacts:{},users:{},isPending:!0});t.default=i},13995:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(28686));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}const a={};a[n.FETCH_USER_FINISH]={next(e,t){const r=t.payload;return{...e,users:{...e.users,[r.primaryContact]:r},isPending:!1}},throw:(e,t)=>({...e,isPending:!1,errors:e.errors.concat(t.payload)})},a[n.SEARCH_DIRECTORY_FINISH]={next(e,t){const r={};for(const e of t.payload)r[e.primaryContact]=e;return{...e,users:{...e.users,...r},isPending:!1}},throw:(e,t)=>({...e,isPending:!1,errors:e.errors.concat(t.payload)})},t.default=a},49639:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContact=function(e,t){return(0,o.default)(e.users.contacts[t])},t.getContacts=function(e){return(0,o.default)(e.users.contacts)},t.getUser=function(e,t){return(0,o.default)(e.users.users[t])},t.getUsers=function(e){const t=(0,o.default)(e.users.users);return Object.values(t)};var n,o=(n=r(89321))&&n.__esModule?n:{default:n}},93914:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.factory("UsersOperations",o.default),e.factory("UsersRequests",a.default),{api:n.createAPI,capabilities:["addContactAsFriend","limitedSearch"],name:n.name,reducer:n.reducer}};var n=r(2549),o=i(r(36786)),a=i(r(33558));function i(e){return e&&e.__esModule?e:{default:e}}},36786:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,UsersRequests:n}=e,l=r.getLogger("USERS");function u(e){switch(e){case"first_name":case"firstName":case"FIRSTNAME":return 1;case"last_name":case"lastName":case"LASTNAME":return 2;case"name":case"NAME":return 3;case"phone_number":case"phoneNumber":case"PHONENUMBER":return 4;case"user_id":case"userId":case"USERID":case"user_name":case"userName":case"USERNAME":return 5}}function d(e){"contactId"in e&&(e.nickname=e.contactId,delete e.contactId);for(const t in e)e[t]&&0!==e[t].length||delete e[t];return e}function f(e){return"nickname"in e&&(e.contactId=e.nickname,delete e.nickname),e}function p(e){return{...e,userId:e.primaryContact||e.userId}}return{fetchUser:async function(e){const{dispatch:r}=t;r(a.fetchUser(e));const o={searchCriteria:e,searchType:u("user_id")};try{const e=(0,s.getConnectionInfo)(t.getState()),i=await n.getDirectory(e,o);if(i.length>0)return r(a.fetchUserFinish(i[0])),i[0];l.debug("Fetch user request was successful, but result was empty")}catch(e){throw r(a.fetchUserFinish(e)),e}},addContact:async function(e){const{dispatch:r}=t;if(r(i.addContact(e)),l.info("Attempting to add contact(s):",e),!e||(0,o.default)(e)){l.info("Could not add contact(s); invalid input.");const e=new c.default({code:c.usersCodes.INVALID_PARAM,message:"Could not add contact(s); invalid input."});throw r(i.addContactFinish({error:e})),e}try{const t={addressBookRequest:{addressBookEntries:[d({...e})]}},o=await n.contactRequest({extraURL:"contacts/",body:JSON.stringify(t),method:"POST"});let a={};return o&&(a=f(o),r(i.addContactFinish({contact:a}))),a}catch(e){throw r(i.addContactFinish({error:e})),e}},removeContact:async function(e){const{dispatch:r}=t;if(r(i.removeContact(e)),l.info("Attempting to remove the contact: ",e),!e){l.info("Could not remove contact; invalid id.");const e=new c.default({code:c.usersCodes.INVALID_PARAM,message:"Could not remove contact; invalid id."});throw r(i.removeContactFinish({error:e})),e}try{const t=await n.contactRequest({extraURL:"contacts/"+encodeURIComponent(e),method:"DELETE"});let o="";return t&&(r(i.removeContactFinish({contactId:e})),o=e),o}catch(e){throw r(i.removeContactFinish({error:e})),e}},updateContact:async function(e){const{dispatch:r}=t;if(r(i.updateContact(e)),!e||(0,o.default)(e)){l.info("Could not update contact; invalid input.");const e=new c.default({code:c.usersCodes.INVALID_PARAM,message:"Could not update contact(s); invalid input."});throw r(i.updateContactFinish({error:e})),e}try{const t={addressBookRequest:{addressBookEntries:[d({...e})]}};if(await n.contactRequest({extraURL:"contacts/"+e.contactId,body:JSON.stringify(t),method:"PUT"}))return r(i.updateContactFinish({contact:e})),e}catch(e){throw r(i.updateContactFinish({error:e})),e}},fetchContact:async function(e){const{dispatch:r}=t;if(r(i.fetchContact(e)),l.info("Attempting to fetch the contact: ",e),!e){l.info("Could not fetch contact; invalid id.");const e=new c.default({code:c.usersCodes.INVALID_PARAM,message:"Could not fetch contact; invalid id."});throw r(i.fetchContactFinish({error:e})),e}try{const t=await n.contactRequest({extraURL:`contacts/${e}`,method:"GET"});if(t){const e=f(t.result.addressBookEntries[0]);return r(i.fetchContactFinish({contact:e})),e}}catch(e){throw r(i.fetchContactFinish({error:e})),e}},searchDirectory:async function(e,r){const{dispatch:o}=t;let i;o(a.searchDirectory(e,r));for(const t in e)if(e.hasOwnProperty(t)&&e[t]){i=t;break}l.debug(`Using criteria '${i}' with value '${e[i]}' to search directory.`);const c={searchCriteria:e[i],searchType:u(i)};try{const e=(0,s.getConnectionInfo)(t.getState()),r=(await n.getDirectory(e,c)).map(p);return o(a.searchDirectoryFinish({users:r})),r}catch(e){throw o(a.searchDirectoryFinish({error:e})),e}},refreshContacts:async function(){const{dispatch:e}=t;try{e(i.refreshContacts());const t=await n.contactRequest({method:"GET"});let r=[];return t&&(r=t.result.addressBookEntries?t.result.addressBookEntries.map(f):[],e(i.refreshContactsFinish({contacts:r}))),r}catch(t){throw e(i.refreshContactsFinish({error:t})),t}}}};var n,o=(n=r(84499))&&n.__esModule?n:{default:n},a=u(r(12585)),i=u(r(42340)),s=r(87075),c=u(r(75412));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},33558:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,sendRequest:n}=e,s=r.getLogger("USERS");return{getDirectory:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e.server.version;var o=`${e.server.protocol}://${e.server.server}:${e.server.port}/rest/version/${r}/user/${e.username}/directory`;const a={};t.searchType?(a.criteria=t.searchCriteria,a.criteriaType=t.searchType):t.searchCriteria&&(a.criteria=t.searchCriteria);const c=await n({url:o,queryParams:a,method:"GET"}),{error:l,result:u,body:d}=c;if(l){if(d){const{statusCode:e}=d.directory;throw s.debug(`Failed to search directory with status code ${e}.`),new i.default({code:e,message:`Failed to search directory; status ${e}.`})}{const{message:e}=u;throw s.debug(`Directory search request failed: ${e}`),new i.default({message:`Directory search request failed: ${e}`})}}if(d&&0===d.directory.statusCode)return d.directory.directoryItems||[];throw s.debug("Unknown error case for directory search."),new i.default({message:"Unknown error."})},contactRequest:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=(0,a.getRequestInfo)(t.getState()),c=r.version,{extraURL:l,method:u}=e;let d;d=l?`${r.baseURL}/rest/version/${c}/user/${r.username}/addressbook/${l}`:`${r.baseURL}/rest/version/${c}/user/${r.username}/addressbook`;const f={method:u,url:d,body:e.body},p={4:i.usersCodes.REFRESH_CONTACTS_FAIL,27:i.usersCodes.REFRESH_CONTACTS_FAIL,35:i.usersCodes.REFRESH_CONTACTS_FAIL};if(!r.username){const e="Failed to add contact; user not authenticated (credentials not set).";throw s.info(e),new i.default({code:i.usersCodes.REFRESH_CONTACTS_FAIL,message:e})}const g=await n(f),{body:E,error:_,result:y}=g;if(!_){const{addressBookResponse:e}=E;return s.info(`${u} contact(s) performed successfully; Status code: ${e.statusCode}`),{result:e||{}}}let v="",S="";if((0,o.default)(E)){const{code:e,message:t}=y;S=`Failed to ${u} contact(s); ${t}.`,v=403===e?i.usersCodes.REFRESH_CONTACTS_FAIL:i.usersCodes.UNKNOWN}else{const{statusCode:e}=E.addressBookResponse;S=`Failed to ${u} contact(s). Status Code ${e}`,v=p[e]||i.usersCodes.UNKNOWN}throw s.info(S),new i.default({code:v,message:S})}}};var n,o=(n=r(84499))&&n.__esModule?n:{default:n},a=r(87075),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},42140:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=r=>{e.checkDevices().then((e=>{const a=n.deviceActions.devicesChanged(e),i=r?void 0:{type:o.DEVICES_CHANGED,args:{}};t(a,i)}))};return e.on("change",r),()=>{e.off("change",r)}};var n=r(66446),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(51709));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},76207:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createHandler=p,t.default=function(e){const{WebRTC:t}=e,r=p(e);(0,n.default)(t.devices,r),(0,o.default)(t.track,r),(0,i.default)(t.media,r),(0,a.default)(t.sessionManager,r)};var n=f(r(42140)),o=f(r(91173)),a=f(r(68244)),i=f(r(70620)),s=r(51709),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(81997)),l=r(51918),u=r(40481);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}function f(e){return e&&e.__esModule?e:{default:e}}function p(e){return function(t,r){try{e.context.getState()}catch(e){return}if(t){const r=function(e,t){switch(t.type){case c.SESSION_ICE_CONNECTION_STATE_CHANGE:{const r=(0,u.getCallByWebrtcSessionId)(e.getState(),t.payload.id);if(r)return{type:l.MEDIA_CONNECTION_CHANGE,args:{callId:r.id,previous:{state:r.mediaConnectionState}}};break}case c.SESSION_TRACK_ENDED:{const{trackId:r,local:n,isUnsolicited:o,id:a}=t.payload;if(n&&o){const t=(0,u.getCallByWebrtcSessionId)(e.getState(),a);return{type:s.TRACK_ENDED,args:{callId:t.id,trackId:r,isLocal:n}}}break}}}(e.context,t);e.context.dispatch(t),r&&e.emitEvent(r.type,r.args)}r&&e.emitEvent(r.type,r.args)}}},18487:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=e=>{let{mediaId:r,trackId:o}=e;const a=n.mediaActions.mediaNewTrack(r,{trackId:o});t(a)},o=e=>{let{mediaId:r,trackId:o}=e;const a=n.mediaActions.mediaTrackEnded(r,{trackId:o});t(a)},a=()=>{e.off("media:stopped",a),e.off("track:new",r),e.off("track:ended",o)};return e.on("media:stopped",a),e.on("track:new",r),e.on("track:ended",o),a};var n=r(66446)},70620:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=r=>{const n=e.get(r);(0,a.default)(n,t);const i=n.getTracks().some((e=>e.isDetached())),s=o.mediaActions.newMedia(r,{local:n.getState().isLocal,detached:i,tracks:n.getTracks().map((e=>e.id))});t(s)},n=e=>{const r=o.mediaActions.removedMedia(e);t(r)};return e.on("media:new",r),e.on("media:removed",n),()=>{e.off("media:new",r),e.off("media:removed",n)}};var n,o=r(66446),a=(n=r(18487))&&n.__esModule?n:{default:n}},10975:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=r=>{let{local:o,trackId:a}=r;const i=n.sessionActions.sessionNewTrack(e.id,{local:o,trackId:a});t(i)},o=r=>{let{local:o,trackId:a,isUnsolicited:i}=r;t(n.sessionActions.sessionTrackEnded(e.id,{local:o,trackId:a,isUnsolicited:i}))},a=r=>{let{oldTrackId:o,trackId:a}=r;const i=n.sessionActions.sessionTrackReplaced(e.id,{oldTrackId:o,trackId:a});t(i)},i=r=>{const o=n.sessionActions.sessionIceConnectionStateChange(e.id,{iceConnectionState:r.iceConnectionState});t(o)},s=r=>{const o=n.sessionActions.sessionIceCandidateCollected(e.id,r);t(o)},c=r=>{const o=n.sessionActions.sessionIceGatheringStateChange(e.id,r);t(o)},l=r=>{const o=n.sessionActions.sessionIceCollectionScheduledCheck(e.id,r);t(o)},u=r=>{t(n.sessionActions.sessionAudioEnded(e.id,{error:!r}))};return e.on("new:track",r),e.on("track:ended",o),e.on("track:replaced",a),e.on("peer:iceConnectionStateChange",i),e.on("peer:iceGatheringStateChange",c),e.on("peer:iceCandidateCollected",s),e.on("peer:iceCollectionScheduledCheck",l),e.on("audioFileEnded",u),()=>{e.off("new:track",r),e.off("track:ended",o),e.off("track:replaced",a),e.off("peer:iceConnectionStateChange",i),e.off("peer:iceGatheringStateChange",c),e.off("peer:iceCandidateCollected",s),e.off("peer:iceCollectionScheduledCheck",l),e.off("audioFileEnded",u)}};var n=r(66446)},68244:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=r=>{const n=e.get(r),i=n.getState();delete i.id,(0,a.default)(n,t);const s=o.sessionActions.sessionAdded(r,i);t(s)},n=e=>{const r=o.sessionActions.sessionRemoved(e);t(r)};return e.on("session:new",r),e.on("session:removed",n),()=>{e.off("session:new",r),e.off("session:removed",n)}};var n,o=r(66446),a=(n=r(10975))&&n.__esModule?n:{default:n}},48240:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=e=>{const r=n.trackActions.trackSourceMuted([e.trackId],{mediaId:e.mediaId,isLocal:e.isLocal}),a={type:o.TRACK_SOURCE_MUTED,args:{trackIds:[e.trackId],trackId:e.trackId,isLocal:e.isLocal,id:e.mediaId}};t(r,a)},a=e=>{const r=n.trackActions.trackSourceUnmuted([e.trackId],{mediaId:e.mediaId,isLocal:e.isLocal}),a={type:o.TRACK_SOURCE_UNMUTED,args:{trackIds:[e.trackId],trackId:e.trackId,isLocal:e.isLocal,id:e.mediaId}};t(r,a)},i=()=>{e.off("ended",i),e.off("muted",r),e.off("unmuted",a)};return e.on("ended",i),e.on("muted",r),e.on("unmuted",a),i};var n=r(66446),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(51709));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},91173:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=r=>{const n=e.get(r),a=n.getState();a.sourceMuted=a.muted,a.muted=!a.enabled,delete a.enabled,delete a.id,(0,i.default)(n,t);const s=o.trackActions.trackAdded(r,a);t(s)},n=r=>{const n=o.trackActions.trackRemoved(r),i=e.get(r).isDetached()?{type:a.TRACK_ENDED,args:{trackId:r,isLocal:!0,detached:!0}}:void 0;t(n,i)};return e.on("add",r),e.on("remove",n),()=>{e.off("add",r),e.off("remove",n)}};var n,o=r(66446),a=r(51709),i=(n=r(48240))&&n.__esModule?n:{default:n}},74582:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e){const{context:t,logManager:r,WebRTC:o,WebRTCMediaOperations:a}=e;r.getLogger("WEBRTC").info("Cleaning up webrtc plugin.");const i=(0,n.getDetachedMedia)(t.getState());await Promise.all([...i.map((e=>Promise.all(e.tracks.map((e=>a.disposeLocalMedia(e)))))),o.devices.cleanup()])};var n=r(69260)},97002:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{mediaDevices:t,peerConnection:r}=(0,g.getWebRTCSupportCapabilities)();if(!t||!r)return void y.warn("Calls are not supported on this platform due to lack of WebRTC support. Media APIs will not be available.");const c=(0,g.default)();return e.factory("WebRTCMediaOperations",a.default),e.factory("WebRTCLogOperations",i.default),e.factory("WebRTCOperations",s.default),e.factory("WebRTC",(()=>c.managers)),e.defer(v),e.defer(S),e.defer(l.default),{api:o.default,middleware:u.default,name:"webrtc",reducer:n.default.reducer,cleanup:d.default}},t.initLogLevel=S,t.initWebrtc=v;var n=_(r(80678)),o=_(r(94733)),a=_(r(39781)),i=_(r(80994)),s=_(r(66784)),c=r(66446),l=_(r(76207)),u=_(r(3480)),d=_(r(74582)),f=r(69932),p=r(98530),g=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=E(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(37654));function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(E=function(e){return e?r:t})(e)}function _(e){return e&&e.__esModule?e:{default:e}}const y=f.logManager.getLogger("WEBRTC");function v(e){const{logManager:t,context:r}=e,n=t.getLogger("WEBRTC"),o=(0,g.getBrowserDetails)();n.info(`Browser details: ${o.browser}, version ${o.version}.`),r.dispatch(c.miscActions.setBrowserDetails(o))}function S(e){const{context:t,WebRTCLogOperations:r}=e,n=(0,p.getLevel)(t.getState(),"WEBRTC");r.updateLogLevel({payload:{WEBRTC:n}})}},81997:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UNMUTE_TRACKS_FINISH=t.UNMUTE_TRACKS=t.TRACK_SOURCE_UNMUTED=t.TRACK_SOURCE_MUTED=t.TRACK_REMOVED=t.TRACK_ADDED=t.SET_BROWSER_DETAILS=t.SESSION_TRACK_REPLACED=t.SESSION_TRACK_ENDED=t.SESSION_REMOVED=t.SESSION_NEW_TRACK=t.SESSION_ICE_GATHERING_STATE_CHANGE=t.SESSION_ICE_CONNECTION_STATE_CHANGE=t.SESSION_ICE_COLLECTION_SCHEDULED_CHECK=t.SESSION_ICE_CANDIDATE_COLLECTED=t.SESSION_AUDIO_ENDED=t.SESSION_ADDED=t.RENDER_TRACKS_FINISH=t.RENDER_TRACKS=t.REMOVE_TRACKS_FINISH=t.REMOVE_TRACKS=t.MUTE_TRACKS_FINISH=t.MUTE_TRACKS=t.MEDIA_TRACK_ENDED=t.MEDIA_REMOVED=t.MEDIA_NEW_TRACK=t.MEDIA_NEW=t.MEDIA_CHANGE=t.INITIALIZE_DEVICES_FINISH=t.INITIALIZE_DEVICES=t.DEVICES_CHANGE=void 0;const r="@@KANDY/WEBRTC/",n=(t.DEVICES_CHANGE=r+"DEVICES/CHANGE",t.INITIALIZE_DEVICES=r+"INITIALIZE_DEVICES",t.INITIALIZE_DEVICES_FINISH=r+"INITIALIZE_DEVICES_FINISH",r+"TRACK/"),o=(t.TRACK_ADDED=n+"ADDED",t.TRACK_REMOVED=n+"REMOVED",t.RENDER_TRACKS=n+"RENDER",t.RENDER_TRACKS_FINISH=n+"RENDER_FINISH",t.REMOVE_TRACKS=n+"REMOVE",t.REMOVE_TRACKS_FINISH=n+"REMOVE_FINISH",t.MUTE_TRACKS=n+"MUTE",t.MUTE_TRACKS_FINISH=n+"MUTE_FINISH",t.UNMUTE_TRACKS=n+"UNMUTE",t.UNMUTE_TRACKS_FINISH=n+"UNMUTE_FINISH",t.TRACK_SOURCE_MUTED=n+"SOURCE_MUTED",t.TRACK_SOURCE_UNMUTED=n+"SOURCE_UNMUTED",r+"SESSION/"),a=(t.SESSION_ADDED=o+"ADDED",t.SESSION_REMOVED=o+"REMOVED",t.SESSION_NEW_TRACK=o+"NEW_TRACK",t.SESSION_TRACK_ENDED=o+"TRACK_ENDED",t.SESSION_TRACK_REPLACED=o+"TRACK_REPLACED",t.SESSION_AUDIO_ENDED=o+"AUDIO_ENDED",t.SESSION_ICE_CONNECTION_STATE_CHANGE=o+"ICE_CONNECTION_STATE_CHANGE",t.SESSION_ICE_GATHERING_STATE_CHANGE=o+"ICE_GATHERING_STATE_CHANGE",t.SESSION_ICE_CANDIDATE_COLLECTED=o+"ICE_CANDIDATE_COLLECTED",t.SESSION_ICE_COLLECTION_SCHEDULED_CHECK=o+"ICE_CANDIDATE_SCHEDULED_CHECK",r+"MEDIA/");t.MEDIA_NEW=a+"NEW",t.MEDIA_REMOVED=a+"REMOVED",t.MEDIA_CHANGE=a+"CHANGE",t.MEDIA_NEW_TRACK=a+"NEW_TRACK",t.MEDIA_TRACK_ENDED=a+"TRACK_ENDED",t.SET_BROWSER_DETAILS=r+"SET_BROWSER_DETAILS"},93269:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.devicesChanged=function(e){return{type:n.DEVICES_CHANGE,payload:e}},t.initializeDevice=function(e){return{type:n.INITIALIZE_DEVICES,payload:e}},t.initializeDeviceFinish=function(e){let{devices:t,error:r}=e;return{payload:r||t,error:Boolean(r),type:n.INITIALIZE_DEVICES_FINISH}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(81997));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},66446:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trackActions=t.sessionActions=t.miscActions=t.mediaActions=t.deviceActions=void 0;var n=l(r(93269)),o=l(r(17524)),a=l(r(48377)),i=l(r(80850)),s=l(r(79616));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}t.deviceActions=n,t.trackActions=o,t.sessionActions=a,t.mediaActions=i,t.miscActions=s},80850:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mediaNewTrack=function(e,t){return s(a.MEDIA_NEW_TRACK,e,t)},t.mediaTrackEnded=function(e,t){return s(a.MEDIA_TRACK_ENDED,e,t)},t.newMedia=function(e,t){return s(a.MEDIA_NEW,e,t)},t.removedMedia=function(e,t){return s(a.MEDIA_REMOVED,e,t)};var n,o=(n=r(84499))&&n.__esModule?n:{default:n},a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(81997));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a={type:e,payload:{...r,id:t}};return(0,o.default)(n)||(a.meta=n),r.error&&(a.error=!0),a}},79616:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setBrowserDetails=function(e){return{type:n.SET_BROWSER_DETAILS,payload:e}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(81997));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},48377:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sessionAdded=function(e,t){return s(a.SESSION_ADDED,e,t)},t.sessionAudioEnded=function(e,t){return{type:a.SESSION_AUDIO_ENDED,payload:{id:e,...t},error:Boolean(t.error)}},t.sessionIceCandidateCollected=function(e,t){return s(a.SESSION_ICE_CANDIDATE_COLLECTED,e,t)},t.sessionIceCollectionScheduledCheck=function(e,t){return s(a.SESSION_ICE_COLLECTION_SCHEDULED_CHECK,e,t)},t.sessionIceConnectionStateChange=function(e,t){return s(a.SESSION_ICE_CONNECTION_STATE_CHANGE,e,t)},t.sessionIceGatheringStateChange=function(e,t){return s(a.SESSION_ICE_GATHERING_STATE_CHANGE,e,t)},t.sessionNewTrack=function(e,t){return s(a.SESSION_NEW_TRACK,e,t)},t.sessionRemoved=function(e,t){return s(a.SESSION_REMOVED,e,t)},t.sessionTrackEnded=function(e,t){return s(a.SESSION_TRACK_ENDED,e,t)},t.sessionTrackReplaced=function(e,t){return s(a.SESSION_TRACK_REPLACED,e,t)};var n,o=(n=r(84499))&&n.__esModule?n:{default:n},a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(81997));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a={type:e,payload:{...r,id:t}};return(0,o.default)(n)||(a.meta=n),r.error&&(a.error=!0),a}},17524:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.muteTracks=function(e){return i(n.MUTE_TRACKS,e)},t.muteTracksFinish=function(e,t){return i(n.MUTE_TRACKS_FINISH,{trackIds:e,...t})},t.removeTracks=function(e,t){return i(n.REMOVE_TRACKS,{trackIds:e,...t})},t.removeTracksFinish=function(e,t){return i(n.REMOVE_TRACKS_FINISH,{trackIds:e,...t})},t.renderTracks=function(e,t){return i(n.RENDER_TRACKS,{trackIds:e,...t})},t.renderTracksFinish=function(e,t){return i(n.RENDER_TRACKS_FINISH,{trackIds:e,...t})},t.trackAdded=function(e,t){return a(n.TRACK_ADDED,e,t)},t.trackRemoved=function(e,t){return a(n.TRACK_REMOVED,e,t)},t.trackSourceMuted=function(e,t){return i(n.TRACK_SOURCE_MUTED,{trackIds:e,...t})},t.trackSourceUnmuted=function(e,t){return i(n.TRACK_SOURCE_UNMUTED,{trackIds:e,...t})},t.unmuteTracks=function(e){return i(n.UNMUTE_TRACKS,e)},t.unmuteTracksFinish=function(e,t){return i(n.UNMUTE_TRACKS_FINISH,{trackIds:e,...t})};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(81997));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function a(e,t){return{type:e,payload:{...arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},trackId:t},meta:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}}}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={type:e,payload:t,meta:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}};return t.error&&(r.error=!0),r}},94733:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,logManager:r,API_LOG_TAG:i,WebRTCOperations:s}=e,c=r.getLogger("WEBRTC");return{media:(0,a.default)(e),getBrowserDetails:function(){return c.debug(i+"getBrowserDetails"),(0,o.getBrowserDetails)(t.getState())},webrtc:{setupProxy:function(e){c.debug(i+"webrtc.setupProxy"),(0,n.default)(e)?s.setupProxies(e):c.error("Provided proxies is not an appropriate object.")},teardownProxy:async function(){c.debug(i+"webrtc.teardownProxy"),await s.teardownProxies()}}}};var n=i(r(36705)),o=r(69260),a=i(r(66449));function i(e){return e&&e.__esModule?e:{default:e}}},66449:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,WebRTCMediaOperations:r,logManager:i,API_LOG_TAG:s,emitEvent:c}=e,l=i.getLogger("MEDIA");return{getDevices:()=>(l.debug(s+"media.getDevices"),(0,n.getDevices)(t.getState())),getById:e=>(l.debug(s+"media.getById: ",e),(0,n.getMediaById)(t.getState(),e)),getTrackById:e=>(l.debug(s+"media.getTrackById: ",e),(0,n.getTrackById)(t.getState(),e)),async initializeDevices(e){l.debug(s+"media.initializeDevices: ",e);const t={audio:void 0===e||e.audio,video:void 0===e||e.video};try{await r.initializeDevices(t)}catch(e){return void c(o.INITIALIZE_DEVICES_ERROR,{error:e})}c(o.DEVICES_CHANGED,{})},createLocalMedia:async e=>(l.debug(`${s}media.createLocalMedia: `,e),(await r.createLocal(e,!0)).map((e=>({type:e.type,media:(0,n.getMediaById)(t.getState(),e.media.id)})))),getLocalMedia(){l.debug(s+"media.getLocalMedia");const e=t.getState();return(0,n.getDetachedMedia)(e).reduce(((t,r)=>{const{tracks:o}=r;for(const a of o){const{type:o}=(0,n.getTrackById)(e,a);t.push({type:o,media:r})}return t}),[])},async disposeLocalMedia(e){if(l.debug(s+"media.disposeLocalMedia: "+e),e)if(e.media)for(const t of e.media.tracks)await r.disposeLocalMedia(t);else"string"==typeof e&&await r.disposeLocalMedia(e);else l.warn(s+"media.disposeLocalMedia: local media must be provided to dispose local tracks.")},async renderTracks(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};l.debug(s+"media.renderTracks: ",e,(0,a.logCssSelector)(t),i);try{n=await r.renderTracks(e,t,i)}catch(e){return void c(o.TRACK_RENDERED,{trackIds:e.filteredTrackIds,error:e.basicError})}c(o.TRACK_RENDERED,n)},async removeTracks(e,t){l.debug(s+"media.removeTracks: ",e,(0,a.logCssSelector)(t)),await r.removeTracks(e,t)},async muteTracks(e){let t;l.debug(s+"media.muteTracks: ",e);try{t=await r.muteTracks(e)}catch(e){return void c(o.TRACKS_MUTED,{trackIds:e.trackIds,tracks:e.trackIds,error:e.basicError})}c(o.TRACKS_MUTED,{trackIds:t,tracks:t})},async unmuteTracks(e){let t;l.debug(s+"media.unmuteTracks: ",e);try{t=await r.unmuteTracks(e)}catch(e){return void c(o.TRACKS_UNMUTED,{trackIds:e.trackIds,tracks:e.trackIds,error:e.basicError})}c(o.TRACKS_UNMUTED,{trackIds:t,tracks:t})}}},r(69375);var n=r(69260),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(51709)),a=r(1011);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},51709:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TRACK_SOURCE_UNMUTED=t.TRACK_SOURCE_MUTED=t.TRACK_RENDERED=t.TRACK_ENDED=t.TRACKS_UNMUTED=t.TRACKS_MUTED=t.INITIALIZE_DEVICES_ERROR=t.DEVICES_CHANGED=void 0,t.DEVICES_CHANGED="devices:change",t.INITIALIZE_DEVICES_ERROR="devices:error",t.TRACKS_MUTED="media:muted",t.TRACKS_UNMUTED="media:unmuted",t.TRACK_SOURCE_MUTED="media:sourceMuted",t.TRACK_SOURCE_UNMUTED="media:sourceUnmuted",t.TRACK_RENDERED="media:trackRendered",t.TRACK_ENDED="media:trackEnded"},80678:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(94733)),o=a(r(96354));function a(e){return e&&e.__esModule?e:{default:e}}t.default={name:"webrtc",api:n.default,reducer:o.default}},2178:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(81997)),o=r(45775);function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}const i={};i[n.SET_BROWSER_DETAILS]={next:(e,t)=>t.payload};const s=(0,o.handleActions)(i,{});t.default=s},7249:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(81997)),o=r(45775);function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}const i={};i[n.DEVICES_CHANGE]={next:(e,t)=>t.payload},i[n.INITIALIZE_DEVICES_FINISH]={next:(e,t)=>t.payload};const s=(0,o.handleActions)(i,{camera:[],microphone:[],speaker:[]});t.default=s},96354:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return{devices:(0,n.default)(e.devices,t),tracks:(0,a.default)(e.tracks,t),sessions:(0,i.default)(e.sessions,t),media:(0,o.default)(e.media,t),browser:(0,s.default)(e.browser,t)}};var n=c(r(7249)),o=c(r(50774)),a=c(r(70272)),i=c(r(18133)),s=c(r(2178));function c(e){return e&&e.__esModule?e:{default:e}}},50774:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=c(r(90636)),o=c(r(35968)),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(81997)),i=r(45775);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function c(e){return e&&e.__esModule?e:{default:e}}const l={};l[a.MEDIA_NEW]={next:(e,t)=>(0,o.default)(e,{...t.payload})},l[a.MEDIA_REMOVED]={next:(e,t)=>(0,n.default)((e=>e.id===t.payload.id))(e)};const u={};u[a.MEDIA_NEW_TRACK]={next:(e,t)=>({...e,tracks:(0,o.default)(e.tracks,[t.payload.trackId])})},u[a.MEDIA_TRACK_ENDED]={next:(e,t)=>({...e,tracks:(0,n.default)((e=>e===t.payload.trackId),e.tracks)})};const d=(0,i.handleActions)(u,{});l[(0,i.combineActions)(a.MEDIA_NEW_TRACK,a.MEDIA_TRACK_ENDED)]=(e,t)=>e.map((e=>e.id===t.payload.id?d(e,t):e));const f=(0,i.handleActions)(l,[]);t.default=f},18133:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(62234),r(69375);var n=c(r(90636)),o=c(r(35968)),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(81997)),i=r(45775);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function c(e){return e&&e.__esModule?e:{default:e}}const l={};l[a.SESSION_ADDED]={next:(e,t)=>(0,o.default)(e,t.payload)},l[a.SESSION_REMOVED]={next:(e,t)=>(0,n.default)((e=>e.id===t.payload.id))(e)};const u={};u[a.SESSION_NEW_TRACK]={next:(e,t)=>t.payload.local?{...e,localTracks:e.localTracks.includes(t.payload.trackId)?e.localTracks:(0,o.default)(e.localTracks,[t.payload.trackId])}:{...e,remoteTracks:e.remoteTracks.includes(t.payload.trackId)?e.remoteTracks:(0,o.default)(e.remoteTracks,[t.payload.trackId])}},u[a.SESSION_TRACK_ENDED]={next(e,t){const r=e=>e===t.payload.trackId;return t.payload.local?{...e,localTracks:(0,n.default)(r,e.localTracks)}:{...e,remoteTracks:(0,n.default)(r,e.remoteTracks)}}},u[a.SESSION_TRACK_REPLACED]={next(e,t){const r=(0,n.default)((e=>e===t.payload.oldTrackId),e.localTracks);return-1===r.indexOf(t.payload.trackId)&&r.push(t.payload.trackId),{...e,localTracks:r}}};const d=(0,i.handleActions)(u,{});l[(0,i.combineActions)(a.SESSION_NEW_TRACK,a.SESSION_TRACK_ENDED,a.SESSION_TRACK_REPLACED)]=(e,t)=>e.map((e=>e.id===t.payload.id?d(e,t):e));const f=(0,i.handleActions)(l,[]);t.default=f},70272:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(62234);var n=c(r(90636)),o=c(r(35968)),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(81997)),i=r(45775);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function c(e){return e&&e.__esModule?e:{default:e}}const l={};l[a.TRACK_ADDED]={next:(e,t)=>(0,o.default)(e,t.payload)},l[a.TRACK_REMOVED]={next:(e,t)=>e.map((e=>t.payload.trackId===e.trackId?{...e,state:"ended"}:e))},l[a.RENDER_TRACKS_FINISH]={next:(e,t)=>e.map((e=>t.payload.trackIds.includes(e.trackId)?{...e,containers:(0,o.default)(e.containers,t.payload.selector)}:e))},l[a.REMOVE_TRACKS_FINISH]={next(e,t){const r=e=>e===t.payload.selector;return e.map((e=>t.payload.trackIds.includes(e.trackId)?{...e,containers:(0,n.default)(r)(e.containers)}:e))}},l[a.MUTE_TRACKS_FINISH]={next:(e,t)=>e.map((e=>t.payload.trackIds.includes(e.trackId)?{...e,muted:!0}:e))},l[a.UNMUTE_TRACKS_FINISH]={next:(e,t)=>e.map((e=>t.payload.trackIds.includes(e.trackId)?{...e,muted:!1}:e))},l[a.TRACK_SOURCE_MUTED]={next:(e,t)=>e.map((e=>t.payload.trackIds.includes(e.trackId)?{...e,sourceMuted:!0}:e))},l[a.TRACK_SOURCE_UNMUTED]={next:(e,t)=>e.map((e=>t.payload.trackIds.includes(e.trackId)?{...e,sourceMuted:!1}:e))};const u=(0,i.handleActions)(l,[]);t.default=u},69260:(e,t)=>{"use strict";function r(e){return e.webrtc.sessions}function n(e){return e.webrtc.tracks}function o(e){return e.webrtc.media}Object.defineProperty(t,"__esModule",{value:!0}),t.getBrowserDetails=function(e){return e.webrtc.browser},t.getDetachedMedia=function(e){return o(e).filter((e=>e.detached))},t.getDevices=function(e){return e.webrtc.devices},t.getMedia=o,t.getMediaById=function(e,t){return o(e).find((e=>e.id===t))},t.getSessionById=function(e,t){return r(e).find((e=>e.id===t))},t.getSessions=r,t.getTrackById=function(e,t){return n(e).find((e=>e.trackId===t))},t.getTracks=n},3480:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.container.WebRTCLogOperations;return e=>r=>(r.type===n.LEVELS_CHANGE&&t.updateLogLevel(r),r.type===n.HANDLERS_CHANGE&&t.updateLogHandler(r),e(r))};var n=r(42791)},80994:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{WebRTC:t}=e,r=t.logs;return{updateLogLevel:async function(e){e.payload.WEBRTC&&(await r.setLevel(e.payload.WEBRTC),(await r.getLoggers()).map((t=>t.setLevel(e.payload.WEBRTC))))},updateLogHandler:async function(e){e.payload.WEBRTC&&(await r.setHandler(e.payload.WEBRTC),(await r.getLoggers()).map((t=>t.setHandler(e.payload.WEBRTC))))}}}},39781:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{WebRTC:t,context:r,logManager:c}=e,l=c.getLogger("MEDIA");return{createLocal:async function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(l.debug("Getting media with constraints: ",e),!e||!Object.keys(e).every((e=>["audio","video","screen","medias"].includes(e))))throw new i.default({code:i.callCodes.USER_MEDIA_ERROR,message:"mediaConstraints must be an object containing at least one of the following media types (and only these types): 'audio', 'video', and 'screen'"});const n=[];try{if(e.screen){const o={video:e.screen},a=await t.media.createLocalScreen(o,r);n.push({type:"screen",media:a})}if(e.audio){const o={audio:e.audio},a=await t.media.createLocal(o,r);n.push({type:"audio",media:a})}if(e.video){const o={video:e.video},a=await t.media.createLocal(o,r);n.push({type:"video",media:a})}}catch(e){let t;t="OverconstrainedError"===e.name?`Failed to get media due to constraint: ${e.constraint}.`:`Failed to get media => Name: ${e.name}; Error Message :${e.message}.`,l.info(t);for(const e of n)await e.media.stop();throw new i.default({message:t,code:i.callCodes.USER_MEDIA_ERROR})}return n},disposeLocalMedia:async function(e){const{dispatch:n}=r;if(!e)throw new i.default({message:"Track id is `undefined`. You must pass an existing track id to dispose of the associated track.",code:i.webrtcCodes.INVALID_PARAM});let o=await t.track.get(e);if(!o)throw new i.default({message:`Either ${e} is not a valid track id type or track does not exist.`,code:i.webrtcCodes.INVALID_TRACK_ID});if((await t.sessionManager.getAll()).forEach((t=>{if(t.localTracks.find((t=>t.id===e)))throw new i.default({message:`Can't dispose track: ${e}. It's in use by session: ${t.id}`,code:i.webrtcCodes.TRACK_IN_USE})})),o){if(!await o.isDetached())throw new i.default({message:`Can't dispose track: ${e}. Track was not created locally.`,code:i.webrtcCodes.TRACK_NOT_LOCAL});await o.stop()}n(a.trackActions.trackRemoved(e))},renderTracks:async function(e,c,u){const{dispatch:d}=r;d(a.trackActions.renderTracks(e,{selector:c,...u}));const f=(await t.track.getTracks(e)).filter((e=>!(0,o.default)(e)));let p={};if(!(e&&e instanceof Array&&e.length>0&&c&&((0,n.default)(c)||"tagName"in c))){const e="Failed to render tracks. One of trackIds or cssSelector is missing from request.";l.info(e,f.map((e=>e.id))),p.error=new i.default({message:e,code:i.webrtcCodes.INVALID_PARAM});const t={basicError:p.error,filteredTrackIds:f.map((e=>e.id))};throw d(a.trackActions.renderTracksFinish(f.map((e=>e.id)),p)),t}return l.info(`Rendering track(s) in element ${(0,s.logCssSelector)(c)}.`,e),await Promise.all(f.map((async e=>{await t.renderer.renderTrack(e,c,u.speakerId)}))),l.info("Finished rendering track(s).",f.map((e=>e.id))),p={selector:c},d(a.trackActions.renderTracksFinish(f.map((e=>e.id)),p)),{trackIds:f.map((e=>e.id)),selector:c}},removeTracks:async function(e,n){const{dispatch:o}=r;o(a.trackActions.removeTracks(e,{selector:n})),l.info(`Removing track(s) from element ${(0,s.logCssSelector)(n)}.`,e),await Promise.all(e.map((async e=>{await t.renderer.unrenderTrack(e,n)}))),l.info("Finished removing track(s).",e),o(a.trackActions.removeTracksFinish(e,{selector:n}))},muteTracks:async function(e){const{dispatch:n}=r;if(n(a.trackActions.muteTracks(e)),l.info("Muting track(s).",e),e&&e instanceof Array&&e.length>0){const r=(await t.track.getTracks()).filter((t=>e.includes(t.id)));Promise.all(r.map((e=>e.mute())));const o=r.map((e=>e.id));return l.info("Finished muting track(s).",o),n(a.trackActions.muteTracksFinish(o)),o}{const t="Failed to mute tracks. trackIds is missing (or empty) from request.";l.info(t,e);const r={};throw r.error=new i.default({message:t,code:i.webrtcCodes.INVALID_PARAM}),n(a.trackActions.muteTracksFinish(e,r)),{basicError:r.error,trackIds:e}}},unmuteTracks:async function(e){const{dispatch:n}=r;if(n(a.trackActions.unmuteTracks(e)),l.info("Unmuting track(s).",e),e&&e instanceof Array&&e.length>0){const r=(await t.track.getTracks()).filter((t=>e.includes(t.id)));Promise.all(r.map((e=>e.unmute())));const o=r.map((e=>e.id));return l.info("Finished unmuting track(s).",o),n(a.trackActions.unmuteTracksFinish(o)),o}{const t="Failed to unmute tracks. trackIds is missing (or empty) from request.";l.info(t,e);const r={};throw r.error=new i.default({message:t,code:i.webrtcCodes.INVALID_PARAM}),n(a.trackActions.unmuteTracksFinish(e,r)),{basicError:r.error,trackIds:e}}},initializeDevices:async function(e){const{dispatch:n}=r;n(a.deviceActions.initializeDevice(e));try{const r=await t.devices.setupDeviceInitialization(e);if(r.error)throw r;l.info("Successfully initialized devices.",r),n(a.deviceActions.initializeDeviceFinish({devices:r}))}catch(e){throw l.info(`Encountered error while initializing devices: ${e.message}.`),n(a.deviceActions.initializeDeviceFinish({error:e})),e}}}},r(62234),r(69375);var n=l(r(73173)),o=l(r(54502)),a=r(66446),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412)),s=r(1011);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}function l(e){return e&&e.__esModule?e:{default:e}}},66784:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logManager:t,WebRTC:r,emitEvent:n,context:s}=e,c=t.getLogger("WEBRTC"),l={},u={};return{setupProxies:function(e){c.info("Setting up external proxies in WebRTC."),(0,o.default)(e)&&r.webrtcManager.setProxies(e),e.managers&&Object.keys(e.managers).forEach((t=>{t in l||(l[t]=r[t]),r[t]=e.managers[t],c.debug(`Replaced WebRTC ${t} manager with proxy version.`)})),e.managerEventHandlers&&Object.keys(e.managerEventHandlers).forEach((t=>{t in r?(e.managerEventHandlers[t].forEach((e=>{r[t].on(e.eventName,e.eventFn),c.debug(`Added new '${e.eventName}' event handler on ${t} manager.`)})),u[t]=e.managerEventHandlers[t]):c.debug(`Provided '${t}' manager is not a WebRTC manager, skipping event handler proxies.`)})),c.info("Successfully set up external proxies in WebRTC.")},teardownProxies:async function(){c.info("Tearing down all external proxies in WebRTC."),r.webrtcManager.setProxies(void 0),Object.keys(l).forEach((e=>{r[e]=l[e],delete l[e],c.debug(`Reverted WebRTC ${e} manager to original version.`)})),Object.keys(u).forEach((e=>{u[e].forEach((t=>{r[e].off(t.eventName,t.eventFn),c.debug(`Removed added '${t.eventName}' event handler from ${e} manager.`)})),delete u[e]})),c.info("Successfully tore down proxies in WebRTC."),c.info("Updating devices after teardown.");const e=await r.devices.checkDevices();s.dispatch((0,a.devicesChanged)(e)),n(i.DEVICES_CHANGED,{})}}};var n,o=(n=r(36705))&&n.__esModule?n:{default:n},a=r(93269),i=r(51709)},46937:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jsonChannel=function(e){const t={receive:void 0,send(t){try{e.send(JSON.stringify(t))}catch(e){n.error("Failed to send JSON message over channel: ",e)}}};return e.receive=function(e){try{t.receive&&t.receive(JSON.parse(e))}catch(e){n.error("Failed to receive JSON message on channel: ",e)}},t},t.replyChannel=function(e){const t={};e.receive=function(e){const{messageId:o,data:a}=e;o&&t[o]?t[o].isExpired?(n.debug(`Received reply from timed-out message ${o}. Ignoring.`),delete t[o]):(n.debug(`Received reply from message ${o}.`),t[o].resolve(a)):o&&!t[o]?r.receive?(n.debug(`Received new message ${o}.`),r.receive(o,a)):n.error("No listener set for handling received messages.",a):n.warn("Received message without an ID on the channel; ignoring.",e)};const r={send:(r,o,a)=>{if(t[r])return void a(null,new Error("Cannot send message; ID already used."));const i={data:o,messageId:r};a?new Promise((o=>{const s=setTimeout((()=>{n.debug(`Message ${r} timed-out. Failing operation.`),t[r].isExpired=!0,a(null,new Error("Operation timed-out; no reply from other side of channel."))}),12e3);t[r]={resolve:o,timeoutId:s,isExpired:!1},n.debug(`Sending new message ${r} with reply expected.`),e.send(i)})).then((e=>{clearTimeout(t[r].timeoutId),delete t[r],"function"==typeof a&&a(e)})):(n.debug(`Sending new message ${r}.`),e.send(i))},receive:void 0,reply:(t,r)=>{const o={data:r,messageId:t};n.debug(`Replying to message ${t}.`),e.send(o)}};return r},r(97107);const n=r(69932).logManager.getLogger("CHANNEL")},31486:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{mediaDevices:t,peerConnection:r}=(0,s.getWebRTCSupportCapabilities)();if(!t||!r)return void f.warn("Calls are not supported on this platform due to lack of WebRTC support. Proxy APIs will not be available.");e.factory("ProxyOperations",c.default),e.decorator("WebRTC",(function(e){return e.devices.setListening(!1),e.devices.cleanup(),u.managers})),e.defer(d);const i=(0,s.default)(),u=(0,a.default)(i);function d(e){const{ProxyStack:t,logManager:r}=e,o=r.getLogger("PROXY");t.setProxyMode&&(0,n.default)(t.setProxyMode)||o.error("Cannot setup Proxy Plugin: Proxy Stack not found.")}return e.value("ProxyStack",u),{api:l.default,capabilities:["mediaProxy"],initProxy:d,name:o.default.name,reducer:o.default.reducer}};var n=d(r(30524)),o=d(r(93722)),a=d(r(14816)),i=r(69932),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(37654)),c=d(r(4398)),l=d(r(94922));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function d(e){return e&&e.__esModule?e:{default:e}}const f=i.logManager.getLogger("PROXY")},13377:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SET_MODE_FINISH=t.SET_MODE=t.SET_CHANNEL_FINISH=t.SET_CHANNEL=t.INITIALIZE_FINISH=t.INITIALIZE=void 0;const r="@@KANDY/PROXY/";t.SET_MODE=r+"SET_MODE",t.SET_MODE_FINISH=r+"SET_MODE_FINISH",t.SET_CHANNEL=r+"SET_CHANNEL",t.SET_CHANNEL_FINISH=r+"SET_CHANNEL_FINISH",t.INITIALIZE=r+"INITIALIZE",t.INITIALIZE_FINISH=r+"INITIALIZE_FINISH"},12825:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initializeRemote=function(e){return a(n.INITIALIZE,{config:e})},t.initializeRemoteFinish=function(e){let{error:t,browser:r}=e;return a(n.INITIALIZE_FINISH,{error:t,browser:r})},t.setChannel=function(e){return a(n.SET_CHANNEL,{channel:e})},t.setChannelFinish=function(e){let{error:t}=e;return a(n.SET_CHANNEL_FINISH,{error:t})},t.setProxyMode=function(e){return a(n.SET_MODE,{value:e})},t.setProxyModeFinish=function(e){let{error:t,value:r}=e;return a(n.SET_MODE_FINISH,{error:t,value:r})};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(13377));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={type:e,payload:{...t}};return t.error&&(r.error=!0),r}},94922:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,ProxyOperations:a,logManager:i,API_LOG_TAG:s}=e,c=i.getLogger("PROXY");return{proxy:{async setProxyMode(e){c.debug(s+"proxy.setProxyMode: ",e);try{await a.setProxyMode(e)}catch(e){return void r(o.PROXY_ERROR,{error:e})}r(o.PROXY_CHANGE)},getProxyMode(){const{getState:e}=t;return c.debug(s+"proxy.getProxyMode"),(0,n.getProxyState)(e()).proxyMode},getInfo(){const{getState:e}=t;return c.debug(s+"proxy.getInfo"),(0,n.getProxyState)(e())},getProxyDetails(){const{getState:e}=t;return c.debug(s+"proxy.getProxyDetails"),(0,n.getProxyState)(e()).browser},async setChannel(e){c.debug(s+"proxy.setChannel: ",e);try{await a.setChannel(e)}catch(e){return void r(o.PROXY_ERROR,{error:e})}r(o.PROXY_CHANGE)},async initializeRemote(e){c.debug(s+"proxy.initializeRemote: ",e);try{await a.initializeRemote(e)}catch(e){return void r(o.PROXY_ERROR,{error:e})}r(o.PROXY_CHANGE)}}}};var n=r(96448),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(92521));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}},92521:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROXY_ERROR=t.PROXY_CHANGE=void 0,t.PROXY_CHANGE="proxy:change",t.PROXY_ERROR="proxy:error"},93722:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(94922)),o=a(r(34621));function a(e){return e&&e.__esModule?e:{default:e}}t.default={name:"proxy",api:n.default,reducer:o.default}},34621:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(13377)),o=r(45775);function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}const i={};i[n.SET_MODE_FINISH]={next:(e,t)=>({...e,proxyMode:t.payload.value})},i[n.SET_CHANNEL_FINISH]={next:(e,t)=>({...e,hasChannel:!0,remoteInitialized:!1})},i[n.INITIALIZE_FINISH]={next:(e,t)=>({...e,browser:t.payload.browser,remoteInitialized:!0})};const s=(0,o.handleActions)(i,{proxyMode:!1,hasChannel:!1,remoteInitialized:!1,browser:{}});t.default=s},96448:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProxyState=function(e){return(0,o.default)(e.proxy)};var n,o=(n=r(89321))&&n.__esModule?n:{default:n}},4398:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{context:t,emitEvent:r,ProxyStack:n,logManager:p}=e,g=p.getLogger("PROXY");return{setProxyMode:async function(e){const{dispatch:o}=t;g.info(`Setting proxy mode to ${e}.`),o(c.setProxyMode(e));const u=(0,a.getActiveCalls)(t.getState()),f=(0,d.getProxyState)(t.getState());if(u.length>0){g.info("Cannot change proxy mode while there are on-going calls.");const e=new i.default({code:i.proxyCodes.IN_ACTIVE_CALL,message:"Cannot change proxy mode while there are on-going calls."});throw o(c.setProxyModeFinish({error:e})),e}if(f.proxyMode===e){g.info("Proxy mode already set to provided value.");const e=new i.default({code:i.proxyCodes.INVALID_PARAM,message:"Proxy mode already set to provided value."});throw o(c.setProxyModeFinish({error:e})),e}const p={value:e};if(!await n.setProxyMode(e)){g.info(`Failed to set proxy mode to ${e}.`);const t=new i.default({code:"proxy:1",message:`Failed to set proxy mode to ${e}.`});throw p.error=t,o(c.setProxyModeFinish(p)),t}if(g.info(`Finished setting proxy mode to ${e}.`),o(c.setProxyModeFinish(p)),e&&!f.remoteInitialized)return void g.warn("Proxy mode has been enabled, but the Remote SDK has not been inititalized yet. Call functionality will fail in this state.");const E=await n.managers.devices.checkDevices();E.microphone&&E.camera&&E.speaker&&(g.debug("Updating available media devices based on proxy mode change.",E),o((0,s.devicesChanged)(E)),r(l.DEVICES_CHANGED,{}))},initializeRemote:async function(e){const{dispatch:r}=t;g.info("Initializing the Remote SDK for proxy mode."),r(c.initializeRemote(e));const o={WEBRTC:(0,u.getLevel)(t.getState(),"WEBRTC"),PROXY:(0,u.getLevel)(t.getState(),"PROXY"),CHANNEL:(0,u.getLevel)(t.getState(),"CHANNEL")},a=await n.initialize(e,o);if(a.error)throw g.info("Failed to initialize the Remote SDK."),r(c.initializeRemoteFinish({error:a.error.message})),a.error;return g.info("Finished initializing the Remote SDK."),r(c.initializeRemoteFinish({browser:a.browser})),{browser:a.browser}},setChannel:async function(r){const{dispatch:s}=t;if(g.info("Setting channel for use in proxy mode."),s(c.setChannel(r)),!r||(0,o.default)(r)){g.info("Could not set channel; Invalid input.");const e=new i.default({code:i.proxyCodes.INVALID_PARAM,message:"Could not set channel; Invalid input."});throw s(c.setChannelFinish({error:e})),e}if((0,a.getActiveCalls)(t.getState()).length>0){g.info("Cannot set channel while there are on-going calls.");const e=new i.default({code:i.proxyCodes.IN_ACTIVE_CALL,message:"Cannot set channel while there are on-going calls."});throw s(c.setChannelFinish({error:e})),e}const l={};if(!await n.setChannel(r)){g.info("Failed to set channel for proxy mode.");const e=new i.default({code:i.proxyCodes.SET_PROXY_CHANNEL_FAIL,message:"Failed to set proxy channel."});throw l.error=e,s(c.setChannelFinish(l)),e}return g.info("Finished setting channel for proxy mode."),function(r){const n=(0,f.createHandler)(e);r.onMessage(((e,r)=>{(0,d.getProxyState)(t.getState()).proxyMode?r&&(r.action||r.event)?(g.debug(`Received event from remote webrtc stack (${r.action.type}).`),n(r.action,r.event)):g.debug(`Received unknown message type; ignoring message (${e}).`,r):g.debug(`Not in Proxy mode, ignoring previous message (${e}).`)}))}(n),s(c.setChannelFinish(l)),l}}};var n,o=(n=r(3514))&&n.__esModule?n:{default:n},a=r(40481),i=g(r(75412)),s=r(93269),c=g(r(12825)),l=g(r(51709)),u=r(98530),d=r(96448),f=r(76207);function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},95398:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.id="manager";const r=i.logManager.getLogger("PROXY",e.modelType);return r.debug(`Creating manager proxy for ${e.modelType}.`,e),new Proxy(e,{get:function(e,i,c){return e.proxyMode&&e.channel?e[i]||"then"!==i?e[i]?e[i]:new Proxy((()=>{}),{apply:function(e,t,c){const l={modelType:t.modelType,id:t.id,operation:i,params:c};if(t.proxyMode&&t.channel&&t.channel.send)return new Promise(((e,i)=>{const c=Date.now(),u=(0,s.v4)().substring(0,8);r.debug(`Sending manager ${l.operation} operation (${u}).`,l),t.channel.send(u,l,(function(s,d){if(s){const{opTiming:e}=s;if(s=s.result,e){const t=Date.now();r.debug(`Received manager ${l.operation} response (${u}).`,s),e&&r.debug(`Remote operation ${l.operation} timing sent: ${c}, receivedRemote: ${e.start}, remoteReplied: ${e.end}, receivedLocal: ${t}`)}}function f(e){if(e&&"multiple"===e.modelType){const t={};return Object.keys(e).forEach((r=>{"modelType"===r||(Array.isArray(r)?t[r]=e[r].map(f):t[r]=f(e[r]))})),t}if(e&&e.modelType)return(0,a.default)(e,t.channel);if(!(0,n.default)(e)){if(!(e&&e.error&&e.error.name))return e;{const t=new Error;for(const[r,n]of Object.entries(e.error))t[r]=n;i(t)}}}if(d)i(d);else if((0,o.default)(s)){const t=s.map(f);e(t)}else e(f(s))}))}))}}):void 0:t[i]}})},r(97107);var n=c(r(64181)),o=c(r(90283)),a=c(r(16128)),i=r(69932),s=r(84596);function c(e){return e&&e.__esModule?e:{default:e}}},16128:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,r){const a=n.logManager.getLogger("PROXY",`${t.modelType}/${t.id}`);return a.debug(`Creating model proxy for ${t.modelType}/${t.id}.`),new Proxy(t,{get:function(t,n,i){if(t[n]||"then"!==n)return"toJSON"===n?()=>t:["localTracks","allLocalTracks","remoteTracks","tracks"].includes(n)?t[n].map((t=>e(t,r))):t[n]?t[n]:new Proxy((()=>{}),{apply:function(t,i,s){const c={modelType:i.modelType,id:i.id,operation:n,params:s};return new Promise(((t,n)=>{const i=Date.now();const s=(0,o.v4)().substring(0,8);a.debug(`Sending model ${c.operation} operation (${s}).`,c),r.send(s,c,(function(o,l){if(o){const{opTiming:e}=o;if(o=o.result,e){const t=Date.now();a.debug(`Received model ${c.operation} response (${s}).`,o),e&&a.debug(`Remote operation ${c.operation} timing sent: ${i}, receivedRemote: ${e.start}, remoteReplied: ${e.end}, receivedLocal: ${t}`)}}function u(t){return t&&t.modelType&&"getTracks"===c.operation?e(t,r):null===t?void 0:t}if("getStats"===c.operation&&(o=new Map(o)),a.debug(`Received model response for ${s}.`,o),l)n(l);else if(Array.isArray(o)){const e=o.map(u);t(e)}else t(u(o));t(o)}))}))}})}})},r(62234);var n=r(69932),o=r(84596)},14816:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={proxyMode:!1,channel:void 0,clientReady:!1,managers:{}};for(const r in e.managers)t.managers[r]=(0,o.default)({modelType:r,proxyMode:t.proxyMode,channel:t.channel},e.managers[r]);return{setProxyMode:r=>{if("boolean"!=typeof r)return d.debug("Provided value is not a boolean; cannot set proxy mode."),!1;d.debug("Setting proxyMode for managers to "+r),t.proxyMode=r;for(const e in t.managers)t.managers[e].proxyMode=r;return e.managers.devices.setListening(!r),!0},getProxyMode:()=>t.proxyMode,setChannel:e=>{if(!e||!e.send)return d.debug("Provided channel does not support the expected interface."),!1;const r=(0,a.replyChannel)((0,a.jsonChannel)(e));t.channel=r,t.clientReady=!1;for(const e in t.managers)t.managers[e].channel=r;return!0},getChannel:()=>t.channel,onMessage:e=>{t.channel.receive=e},initialize:(e,r)=>{const n=(0,s.getVersion)();return new Promise((o=>{if(t.clientReady)d.debug("Cannot initialize remote: Already initialized."),o({error:new c.default({message:"Remote SDK has already been initialized.",code:c.proxyCodes.INVALID_STATE})});else if(t.channel){const a=(e,r)=>{if(d.debug("Received initialize response.",e),r){const e=r.message.includes("timed-out");o({error:new c.default({message:r.message,code:e?c.proxyCodes.TIMEOUT:c.proxyCodes.UNKNOWN})})}else if(e.error){const t=new c.default(e.error);t.code===c.proxyCodes.INVALID_STATE&&e.initialized?(d.warn("Remote SDK responded as already initialized."),o({error:t})):t.code===c.proxyCodes.VERSION_MISMATCH?(d.error(`Remote SDK responded with a version mismatch error. Remote SDK version: ${e.remoteVersion}`),o({error:t})):(d.info("Remote SDK responded with an error."),o({error:t}))}else e.remoteVersion!==n?(d.error(`Remote SDK responded with a version mismatch error. Remote SDK version: ${e.remoteVersion}`),o({error:new c.default({code:c.proxyCodes.VERSION_MISMATCH,message:"Remote SDK version does not match; initialization failed."})})):e.initialized?(t.clientReady=!0,o({browser:e.browser})):(d.debug("Remote SDK responded with an unhandled message."),o({error:new c.default({message:"Unknown error; could not process response.",code:c.proxyCodes.INVALID_STATE})}))},i=(0,l.v4)();t.channel.send(i,{initialize:!0,version:n,config:e,logLevels:r},a)}else d.debug("Cannot initialize remote: Proxy channel not found."),o({error:new c.default({message:"Proxy channel not found.",code:c.proxyCodes.INVALID_STATE})})}))},sdp:{pipeline:{setHandlers:function(t){e.sdp.pipeline.setHandlers(t)}}},managers:t.managers,getBrowserDetails:function(){if(!t.proxyMode)return e.getBrowserDetails()}}},r(62234);var n,o=(n=r(95398))&&n.__esModule?n:{default:n},a=r(46937),i=r(69932),s=r(13126),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75412)),l=r(84596);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}const d=i.logManager.getLogger("PROXY")},53453:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(54507);t.default={trickleIceMode:n.PEER.TRICKLE_ICE.FULL,removeBundling:!1,halfTrickleThreshold:function(e){let{sdp:t,iceCandidate:r,time:n}=e;return-1!==r.candidate.indexOf("relay")}}},19957:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{nativePeer:t,proxyPeer:r,config:o,iceTimer:a,emitter:i,iceCandidates:s,log:c}=this;return t.onicecandidate=t=>{c.debug(`ICE candidate received (trickling?: ${o.trickleIceMode===n.PEER.TRICKLE_ICE.FULL}): `,t.candidate),null!==t.candidate&&s.push(t.candidate);const l=a.timeFromStart();i.emit("iceCandidateCollected",{iceCollectionDuration:l,iceCandidates:s,iceGatheringState:r.iceGatheringState,rtcPeerConnectionConfig:o,rtcLocalSessionDescription:r.localDescription}),o.trickleIceMode===n.PEER.TRICKLE_ICE.FULL?t.candidate&&e(t):o.trickleIceMode===n.PEER.TRICKLE_ICE.HALF&&(o.halfTrickleThreshold({sdp:r.localDescription.sdp,iceCandidate:t.candidate,time:l})?(c.debug("Half ICE collection process complete; ready for negotiation."),o.trickleIceMode=n.PEER.TRICKLE_ICE.FULL,i.emit("onnegotiationready")):c.debug("Peer's half trickle threshold not reached."))},!0},r(69375);var n=r(54507)},27137:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{nativePeer:t,log:r}=this;return t.oniceconnectionstatechange=function(n){r.debug(`Peer received iceconnectionstatechange event: ${t.iceConnectionState}`),e(n)},!0}},2988:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{nativePeer:t,iceTimer:r,log:o}=this;return t.onicegatheringstatechange=t=>{const a=t.target.iceGatheringState;o.debug(`Peer iceGatheringState changed to ${a}.`),a===n.PEER.ICE_GATHERING_STATE.GATHERING?r.start():a===n.PEER.ICE_GATHERING_STATE.COMPLETE&&(o.debug(`Peer took ${r.timeFromStart()}ms to collect ICE candidates.`),r.stop()),e(t)},!0};var n=r(54507)},21725:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=l(r(19957)),o=l(r(27137)),a=l(r(2988)),i=l(r(57989)),s=l(r(71280)),c=l(r(5094));function l(e){return e&&e.__esModule?e:{default:e}}t.default={onicecandidate:n.default,oniceconnectionstatechange:o.default,onicegatheringstatechange:a.default,onnegotiationneeded:i.default,onsignalingstatechange:s.default,ontrack:c.default}},57989:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{nativePeer:t,log:r}=this;return t.onnegotiationneeded=function(t){r.debug("Peer received negotiationneeded event."),e(t)},!0}},71280:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{nativePeer:t,log:r}=this;return t.onsignalingstatechange=function(n){r.debug(`Peer received signalingstatechange event: ${t.signalingState}`),e(n)},!0}},5094:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{proxyPeer:t,nativePeer:r,trackManager:n,log:o}=this;return r.ontrack=async r=>{const{track:a,streams:i,transceiver:s}=r;let c;o.debug(`Peer received ${a.kind} Track ${a.id}.`),t.transceivers.find((e=>e.mid===s.mid))||t.transceivers.push(s),0===i.length?(c=await new MediaStream([a]),o.debug("New Track is not associated with remote Stream.")):(c=i[0],o.debug(`New Track is associated with remote Stream ${c.id}.`));const l=n.add(a,a.kind,c,!1);e(l)},!0},r(69375)},11655:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;const d=s.logManager.getLogger("Peer",e);t=(0,c.default)(i.default,t),d.info("Creating new Peer.");const p=(0,u.createTimer)(),g=new l.default;d.debug("Creating native PeerConnection.",t.rtcConfig);const E=new RTCPeerConnection(t.rtcConfig,{optional:[{googDscp:!0}]}),_={...o.default,...f.methods,on:g.on.bind(g),off:g.off.bind(g),once:g.once.bind(g)},y={...n.default,...f.events},v={nativePeer:E,proxyPeer:void 0,id:e,dtlsRole:null,config:t,trackManager:r,log:d,iceTimer:p,emitter:g,iceCandidates:[],iceLoop:void 0,transceivers:[]};v.proxyPeer=new Proxy(v,{get:function(e,t,r){return"function"==typeof v.nativePeer[t]?Object.keys(_).includes(t)?_[t].bind(v):v.nativePeer[t].bind(v.nativePeer):_[t]&&"function"==typeof _[t]?_[t].bind(v):a.default[t]?"function"==typeof a.default[t]?a.default[t].bind(v)():v.nativePeer[t]:"nativePeer"!==t&&v[t]?v[t]:v.nativePeer[t]},set:function(e,t,r,n){return y[t]?y[t].bind(v)(r):"dtlsRole"===t?(v.dtlsRole=r,!0):Reflect.set(v.nativePeer,t,r)}});for(const e in y)v.proxyPeer[e]=()=>{};return v.proxyPeer},t.setPeerProxies=function(){f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{methods:{},events:{}}},r(62234);var n=d(r(21725)),o=d(r(82254)),a=d(r(50217)),i=d(r(53453)),s=r(40271),c=d(r(7485)),l=d(r(19353)),u=r(67208);function d(e){return e&&e.__esModule?e:{default:e}}let f={methods:{},events:{}}},66353:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{nativePeer:t,proxyPeer:r,id:n,log:o}=this;return o.info("Adding ICE candidate."),new Promise(((a,i)=>{r.remoteDescription.type&&r.remoteDescription.sdp?t.addIceCandidate(e).then(a).catch(i):(o.info("Cannot set remote ICE candidate without a remote description."),i(new Error(`Peer ${n} cannot set remote ICE candidate without a remote description.`)))}))},r(97107)},73331:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{proxyPeer:t,nativePeer:r,log:n}=this;let o;n.info(`Adding new ${e.track.kind} track.`);try{o=r.addTransceiver(e.track,{direction:"sendrecv",streams:[e.getStream()]}),t.transceivers.push(o)}catch(e){n.info(`Failed to add track: ${e.message}`)}return o},r(69375)},18478:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const{nativePeer:e,id:t,emitter:r,iceLoop:n,log:o}=this;o.info("Closing Peer."),n&&clearTimeout(n),e.close(),r.emit("peer:closed",t)}},83570:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{nativePeer:t,config:r,dtlsRole:i,log:s}=this;return s.info("Creating local answer."),delete e.mediaDirections,new Promise(((c,l)=>{t.createAnswer(e).then((t=>{const l=[];l.push(a.preventDtlsRoleChange),r.trickleIceMode===n.PEER.TRICKLE_ICE.NONE&&l.push(a.removeTrickleIce),r.removeBundling&&l.push(a.removeBundling),e.mediaDirections&&l.push((0,a.changeMediaDirection)(e.mediaDirections)),l.length>0&&(t.sdp=(0,o.runPipeline)(l,t.sdp,{type:t.type,endpoint:n.PEER.ENDPOINT.LOCAL,dtlsRole:i})),s.info("Finished creating local answer."),c(t)})).catch(l)}))},r(69375);var n=r(54507),o=r(28851),a=r(75424)},98016:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{nativePeer:t,config:r,log:i}=this;return i.info("Creating local offer."),delete e.mediaDirections,new Promise(((s,c)=>{t.createOffer(e).then((t=>{const c=[];r.trickleIceMode===n.PEER.TRICKLE_ICE.NONE&&c.push(a.removeTrickleIce),r.removeBundling&&c.push(a.removeBundling),e.mediaDirections&&c.push((0,a.changeMediaDirection)(e.mediaDirections)),c.length>0&&(t.sdp=(0,o.runPipeline)(c,t.sdp,{type:t.type,endpoint:n.PEER.ENDPOINT.LOCAL})),i.info("Finished creating local offer."),s(t)})).catch(c)}))},r(69375);var n=r(54507),o=r(28851),a=r(75424)},75650:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{proxyPeer:t}=this;return t.getTransceivers().find((t=>null==t.sender.track&&t.receiver&&t.receiver.track&&t.receiver.track.kind===e&&"stopped"!==t.currentDirection))}},96949:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const{proxyPeer:e,config:t,id:r}=this;return{id:r,config:t,localDesc:e.localDescription,signalingState:e.signalingState,localTracks:e.localTracks,remoteTracks:e.remoteTracks,senderTracks:e.senderTracks}}},10503:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{nativePeer:t,proxyPeer:r,log:n}=this;return n.info("Getting stats "+(e?"for track.":".")),e?new Promise(((t,o)=>{const a=r.getSenders().find((t=>t.track.id===e));if(a)a.getStats().then(t).catch(o);else{const t=`Cannot find sender with trackId: ${e}`;n.info(t),o(new Error(t))}})):t.getStats()},r(97107)},68729:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const{proxyPeer:e}=this;return e.transceivers}},82254:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=y(r(66353)),o=y(r(73331)),a=y(r(18478)),i=y(r(83570)),s=y(r(98016)),c=y(r(75650)),l=y(r(96949)),u=y(r(10503)),d=y(r(68729)),f=y(r(4069)),p=y(r(17111)),g=y(r(74825)),E=y(r(5349)),_=y(r(71404));function y(e){return e&&e.__esModule?e:{default:e}}const v={addIceCandidate:n.default,addTransceiver:o.default,close:a.default,createAnswer:i.default,createOffer:s.default,findReusableTransceiver:c.default,getState:l.default,getStats:u.default,getTransceivers:d.default,removeTrack:f.default,replaceTrack:p.default,sendDTMF:g.default,setLocalDescription:E.default,setRemoteDescription:_.default};t.default=v},4069:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{nativePeer:t,proxyPeer:r,log:n}=this;if(n.info(`Removing track ${e}.`),!r.senderTracks.find((t=>t.id===e)))return void n.info(`Invalid track ID ${e}; no such track found.`);if(" closed"===r.signalingState)return void n.info("Peer is closed; cannot remove track.");const o=r.getSenders().filter((e=>null!==e.track)).find((t=>t.track.id===e));t.removeTrack(o)}},17111:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const{proxyPeer:r,log:n}=this;return n.info(`Replacing track ${t.trackId} with new ${e.kind} track.`),new Promise(((o,a)=>{const i=r.getTransceivers().find((e=>e.sender.track&&e.sender.track.id===t.trackId)),s=i?i.sender:void 0;s?s.replaceTrack(e).then(o).catch((e=>{n.info(`Failed to replace track; ${e.message}`),a(e)})):(n.info(`Failed to replace track; could not find track ${t.trackId}.`),a(new Error(`Sender for track ${t.trackId} not found.`)))}))},r(97107)},74825:(e,t)=>{"use strict";function r(e,t,r,n,o,a){if(!e.dtmf)return a.debug("The sender requires DTMF which is not support by this browser."),!1;{const i=e.dtmf;i.ontonechange=o||function(e){""!==e.tone?a.debug("Tone played: "+e.tone):a.debug("All tones have played.")};try{return i.insertDTMF(t,r,n),!0}catch(e){return a.debug(e.message),!1}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let{tone:n,duration:o=100,intertoneGap:a=70}=e,{callback:i,trackId:s}=t;const{proxyPeer:c,log:l}=this;if(l.info("Sending DTMF tones.",n),!c.getSenders)return l.info("Failed to send tones; getSenders is not supported by this browser."),!1;const u=c.getSenders();if(s){const e=u.find((e=>e.track.id===s));return e?(r(e,n,o,a,i,l),!0):(l.info(`Failed to send tones; could not find track ${s}.`),!1)}{let e;for(let t=0;t<u.length;t++)if(e=r(u[t],n,o,a,i,l),e)return!0;return l.info("Failed to send tones; could not find an appropriate track."),!1}}},5349:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{nativePeer:t,proxyPeer:r,config:n,id:i,emitter:s,iceTimer:c,log:l}=this;if(l.info(`Setting local description ${e.type} in ${r.signalingState} state.`),l.debug(`Setting local description ${e.type}:`,e.sdp),!this.dtlsRole&&"answer"===e.type){const t=e.sdp.match(/a=setup:(\w*?)[\r\n]/);t&&(l.debug(`Selecting DTLS role ${t[1]}.`),this.dtlsRole=t[1])}return new Promise(((u,d)=>{s.once("onnegotiationready",(()=>{c.isStarted()&&l.debug(`Took ${c.timeFromStart()}ms to collect ICE candidates before negotiation.`),u()})),t.setLocalDescription(e).then((()=>{l.info("Finished setting local description."),l.debug(`State is now ${r.signalingState}.`),n.trickleIceMode===o.PEER.TRICKLE_ICE.FULL?(l.debug("Ready for negotiation (full trickleICE)."),s.emit("onnegotiationready")):setTimeout((()=>{"complete"===r.iceGatheringState?(l.debug("Ready for negotiation; ICE candidate collection not needed."),s.emit("onnegotiationready")):(l.debug(`Waiting for ICE collection process (${n.trickleIceMode}).`),r.isIceCollectionCheckOngoing=!0,(0,a.default)(this))}),25)})).catch((e=>{l.info("Failed to set local description."),l.debug(`Peer ${i}: ${e}`),d(e)}))}))};var n,o=r(54507),a=(n=r(74839))&&n.__esModule?n:{default:n}},71404:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{nativePeer:t,proxyPeer:r,id:n,log:o}=this;if(o.info(`Setting remote description ${e.type} in ${r.signalingState} state.`),o.debug(`Setting remote description ${e.type}:`,e.sdp),!this.dtlsRole&&"answer"===e.type){const t=e.sdp.match(/a=setup:(\w*?)[\r\n]/);if(t){const e="active"===t[1]?"passive":"active";o.debug(`Selecting DTLS role ${e}. Remote Peer selected ${t[1]} DTLS role.`),this.dtlsRole=e}}return new Promise(((a,i)=>{t.setRemoteDescription(e).then((()=>{o.info("Finished setting remote description."),o.debug(`State is now ${r.signalingState}.`),a()})).catch((e=>{o.info("Failed to set remote description."),o.debug(`Peer ${n}: ${e}`),i(e)}))}))}},50217:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=l(r(80406)),o=l(r(99890)),a=l(r(95397)),i=l(r(48545)),s=l(r(21203)),c=l(r(43692));function l(e){return e&&e.__esModule?e:{default:e}}t.default={localDescription:n.default,localTracks:o.default,remoteDescription:a.default,remoteTracks:i.default,remoteTracksAll:s.default,senderTracks:c.default}},80406:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const{nativePeer:e,log:t}=this;t.info("Getting local description.");const r=e.localDescription;return r&&r.sdp&&r.type?r:void 0}},99890:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const{proxyPeer:e,trackManager:t,log:r}=this;return r.info("Getting local tracks."),e.getSenders().filter((e=>Boolean(e.track))).map((e=>t.get(e.track.id))).filter((e=>e&&"live"===e.getState().state&&e.getStream().active))}},95397:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const{nativePeer:e,log:t}=this;t.info("Getting remote description.");const r=e.remoteDescription;return r&&r.sdp&&r.type?r:void 0}},21203:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const{proxyPeer:e,trackManager:t,log:r}=this;return r.info("Getting remote tracks."),e.getReceivers().filter((e=>Boolean(e.track))).map((e=>t.get(e.track.id))).filter((e=>e&&"live"===e.getState().state))}},48545:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const{proxyPeer:e,trackManager:t,log:r}=this;return r.info("Getting remote tracks."),e.getReceivers().filter((e=>Boolean(e.track))).map((e=>t.get(e.track.id))).filter((e=>e&&"live"===e.getState().state&&e.getStream().active))}},43692:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const{proxyPeer:e,log:t}=this;return t.info("Getting sender tracks."),e.getSenders().filter((e=>Boolean(e.track))).map((e=>e.track))}},74839:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{proxyPeer:t,iceTimer:r,iceCandidates:n,emitter:o,config:a}=e,i=r.timeFromStart();o.emit("scheduledCheck",{iceCollectionDuration:i,iceCandidates:n,iceGatheringState:t.iceGatheringState,rtcPeerConnectionConfig:a,rtcLocalSessionDescription:t.localDescription})}},67208:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTimer=function(){return Object.create(r)};const r={start(){return!this.isStarted()&&(this._startTime=n(),!0)},stop(){return!!this.isStarted()&&(this._startTime=void 0,!0)},isStarted(){return Boolean(this._startTime)},timeFromStart(){return this.isStarted()?n()-this._startTime:0}};function n(){return(new Date).getTime()}},54507:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PEER=t.MEDIA_DIR=t.ICE_COLLECTION_RESULT_TYPES=t.ICE_COLLECTION_CHECK_REASONS=void 0,t.PEER={TRICKLE_ICE:{FULL:"FULL",HALF:"HALF",NONE:"NONE"},ICE_GATHERING_STATE:{NEW:"new",GATHERING:"gathering",COMPLETE:"complete"},ENDPOINT:{LOCAL:"local",REMOTE:"remote"}},t.MEDIA_DIR={INACTIVE:"inactive",SEND_ONLY:"sendonly",RECV_ONLY:"recvonly",SEND_RECV:"sendrecv"},t.ICE_COLLECTION_CHECK_REASONS={ICE_GATHERING_STATE_CHANGE:"IceGatheringStateChanged",NEW_CANDIDATE:"NewCandidate",SCHEDULED:"Scheduled"},t.ICE_COLLECTION_RESULT_TYPES={START_CALL:"StartCall",WAIT:"Wait",ERROR:"Error"}},37654:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=p.logManager.getLogger("WebRTC"),t=S();t.version?e.debug(`Browser details: ${t.browser}, version ${t.version}.`):e.debug("Browser details: Not supported by webRTC adapter.");const r=new f.default,_=new l.default,y=new u.default,v=new i.default({trackManager:y}),O=new s.default({trackManager:y}),h=new c.default({peerManager:O,mediaManager:v,trackManager:y,deviceManager:_}),T=new d.default;return{models:{Track:n.default,Media:o.default,Peer:a.default},managers:{devices:_,media:v,peerManager:O,sessionManager:h,track:y,logs:p.logManager,webrtcManager:T,renderer:r},sdp:{pipeline:g.default,handlers:E},getBrowserDetails:S}},t.getBrowserDetails=void 0,t.getWebRTCSupportCapabilities=function(){return{mediaDevices:Boolean(navigator.mediaDevices),peerConnection:Boolean(window.RTCPeerConnection)}};var n=v(r(15626)),o=v(r(87237)),a=v(r(11655)),i=v(r(40276)),s=v(r(79908)),c=v(r(98876)),l=v(r(45902)),u=v(r(95469)),d=v(r(46371)),f=v(r(60088)),p=r(40271),g=v(r(28851)),E=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=y(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(75424)),_=r(76555);function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(y=function(e){return e?r:t})(e)}function v(e){return e&&e.__esModule?e:{default:e}}const S=t.getBrowserDetails=_.getBrowserDetails},40271:(e,t,r)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.logManager=void 0;const o=(0,((n=r(44413))&&n.__esModule?n:{default:n}).default)({level:"DEBUG"});t.logManager=o},45902:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WEBRTC_DEVICE_KINDS=void 0,t.default=function(){const e=o.logManager.getLogger("Manager","Device"),t=new a.default;let r=[],n=[],s=[],c=[];d().then((()=>{l?t.emit("change"):e.info("Initial media device discovery ignored.")}));let l=!0,u=!1;function d(){return e.info("Checking media devices."),new Promise(((e,t)=>{navigator.mediaDevices.enumerateDevices().then((t=>{r=[],n=[],s=[],t.forEach((e=>{switch(i[e.kind]){case"microphone":r.push(e);break;case"camera":n.push(e);break;case"speaker":s.push(e)}})),e(f())})).catch(t)}))}function f(){return{microphone:r,camera:n,speaker:s}}return p="devicechange",g=()=>{!u&&l?(e.info("Media device change detected."),u=!0,setTimeout((()=>{u=!1,d().then((()=>{l?t.emit("change"):e.info("Media device change ignored after being detected.")}))}),50)):e.info(`Media device change detected, but ${l?"throttling":"ignoring"}.`)},navigator.mediaDevices.addEventListener(p,g),c.push({event:p,handler:g}),{setListening:function(t){e.debug(`Listening for device changes: ${t}`),l=t},checkDevices:d,setupDeviceInitialization:function(e){return new Promise(((t,r)=>{navigator.mediaDevices.getUserMedia(e).then((e=>{e.getTracks().forEach((e=>{e.stop()}));const r=d();t(r)})).catch(r)}))},cleanup:function(){c.forEach((e=>{let{event:t,handler:r}=e;navigator.mediaDevices.removeEventListener(t,r)})),c=[]},get:f,on:function(){return t.on(...arguments)},once:function(){return t.once(...arguments)},off:function(){return t.off(...arguments)},emit:function(){return t.emit(...arguments)}};var p,g},r(69375);var n,o=r(40271),a=(n=r(19353))&&n.__esModule?n:{default:n};const i=t.WEBRTC_DEVICE_KINDS={audioinput:"microphone",videoinput:"camera",audiooutput:"speaker"}},40276:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=n.logManager.getLogger("Manager","Media"),r=e.trackManager,i=new Map,s=new a.default;function c(e){for(const t in e)if(e[t]&&"object"==typeof e[t]&&"string"==typeof e[t].deviceId){const r=e[t].deviceId;e[t].deviceId={exact:r}}return e}function l(e,n,a){const i=new o.default(e,!0);return t.debug(`Creating Media with ID: ${i.id}.`),e.getTracks().forEach((t=>{const o=r.add(t,n||t.kind,e,!0,a);i.addTrack(o)})),i.once("media:stopped",(e=>{u(e)})),i.on("track:ended",(e=>{let{mediaId:t,trackId:r}=e;0===i.getTracks().length&&u(t)})),i.on("track:muted",(e=>{let{mediaId:t,trackId:r}=e})),i}function u(e){d(e)&&(i.delete(e),s.emit("media:removed",e))}function d(e){const r=i.get(e);return r||t.debug(`No media found with ID: ${e}.`),r}function f(){return Array.from(i.keys())}return{get:d,getAll:f,getState:function(){return f().map((e=>d(e).getState()))},findTrack:function(e){const r=Array.from(i.values()).find((t=>t.getTrack(e)));if(r)return t.debug(`Found Media (${r.id}) with Track ${e}.`),r.id;t.debug(`Found no Media with Track ${e}.`)},createLocal:function(e,t){const r=c(e);return new Promise(((e,n)=>{navigator.mediaDevices.getUserMedia(r).then((r=>{const n=l(r,void 0,t);i.set(n.id,n),s.emit("media:new",n.id),e(n)})).catch(n)}))},createLocalScreen:function(e,t){const r=c(e);return new Promise(((e,n)=>{navigator.mediaDevices.getDisplayMedia(r).then((r=>{const n=l(r,"screen",t);i.set(n.id,n),s.emit("media:new",n.id),e(n)})).catch(n)}))},createRemote:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=new o.default(e,!1);return t.forEach((e=>{r.addTrack(e)})),r.once("media:stopped",(e=>{u(e)})),r.on("track:ended",(e=>{let{mediaId:t,trackId:n}=e;0===r.getTracks().length&&u(t)})),i.set(r.id,r),s.emit("media:new",r.id),r},on:function(){return s.on(...arguments)},once:function(){return s.once(...arguments)},off:function(){return s.off(...arguments)}}};var n=r(40271),o=i(r(87237)),a=i(r(19353));function i(e){return e&&e.__esModule?e:{default:e}}},79908:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=n.logManager.getLogger("Manager","Peer"),r=e.trackManager,s=new Map,c=new i.default;function l(e){const r=s.get(e);return r||t.debug(`No Peer found with ID: ${e}.`),r}function u(){return Array.from(s.keys())}return{getState:function(){return u().map((e=>l(e).getState()))},get:l,getAll:u,create:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new o.default((0,a.v4)(),e,r);return t.once("peer:closed",(e=>s.delete(e))),s.set(t.id,t),c.emit("peer:new",t.id),t},on:function(){return c.on(...arguments)},once:function(){return c.once(...arguments)},off:function(){return c.off(...arguments)}}};var n=r(40271),o=s(r(11655)),a=r(84596),i=s(r(19353));function s(e){return e&&e.__esModule?e:{default:e}}},60088:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e={};return{renderTrack:function(t,r,a){const i=n.logManager.getLogger("Track",t.id);let s;if("string"==typeof r){if(i.info(`Rendering track in element using selector: ${r}`),s=document.querySelector(r),!s)return i.error(`Unable to get container with selector: ${r}.`),!1}else i.info("Rendering track in provided HTMLElement."),s=r;const c=t.getState().kind,l=`${c}-${(0,o.makeSafeForCSS)(t.id)}`;let u=e[t.id];if(u){if(u.containers.indexOf(s)>-1)return i.warn("Failed to render track; already rendered in element."),!1}else u={containers:[],rendererId:l};u.containers.push(s);const d=document.createElement(c);d.id=l,d.style.height="100%",d.style.width="100%";const f=t.getStream();try{d.srcObject=f}catch(e){i.debug("srcObject property not supported; reverting to createObjectURL."),d.src=window.URL.createObjectURL(f)}return d.autoplay="true","video"===c&&(d.muted="true",d.playsInline="true",d.play().catch((e=>{i.debug(`Could not autoplay renderer #${d.id}: ${e.message}`)}))),a&&void 0!==d.setSinkId?d.setSinkId(a).then((()=>{i.debug(`Set to use speaker: ${a}.`)})).catch((e=>{i.debug(`Could not set speaker to use ${a}: ${e.message}`)})):a&&void 0===d.setSinkId&&i.info("Failed to set speaker; setSinkId not supported in this browser."),s.appendChild(d),e[t.id]=u,!0},unrenderTrack:function(t,r){const o=n.logManager.getLogger("Track",t),a=e[t];if(!a)return o.info("Failed to unrender track; not rendered anywhere."),!1;let i;if("string"==typeof r){if(o.info(`Unrendering track from element using selector: ${r}`),i=document.querySelector(r),!i)return o.error(`Unable to get container with selector: ${r}.`),!1}else o.info("Unrendering track from provided HTMLElement."),i=r;const s=a.containers.findIndex((e=>e===i));if(-1===s)return o.info("Failed to unrender track; not rendered in element."),!1;const c=i.querySelector(`#${a.rendererId}`);return c.srcObject?c.srcObject=null:c.src&&(c.src=null),i.removeChild(c),a.containers.splice(s,1),0===a.containers.length&&delete e[t],!0}}},r(69375),r(61412),r(91883),r(70286);var n=r(40271),o=r(76555)},98876:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=n.logManager.getLogger("Manager","Session"),r=new Map,s=new i.default;return{create:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=new o.default((0,a.v4)(),e,t);return n.once("session:ended",(e=>{r.delete(e),s.emit("session:removed",e)})),r.set(n.id,n),s.emit("session:new",n.id),n},get:function(e){const n=r.get(e);return n||t.debug(`No session found with ID: ${e}.`),n},getAll:function(){return Array.from(r.values())},getWithMedia:function(e,n,o){const a=r.get(e);if(a)return new Promise(((e,t)=>{a.addNewMedia(n,o).then((t=>{e({session:a,medias:t})})).catch(t)}));t.debug(`No session found with ID: ${e}.`)},on:function(){return s.on(...arguments)},once:function(){return s.once(...arguments)},off:function(){return s.off(...arguments)}}};var n=r(40271),o=s(r(68529)),a=r(84596),i=s(r(19353));function s(e){return e&&e.__esModule?e:{default:e}}},95469:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=new Map,t=new o.default;function r(t){return e.get(t)}function a(n){let{trackId:o}=n;const i=r(o);return i&&(t.emit("remove",o),e.delete(o),i.off("ended",a)),Boolean(i)}return{get:r,getTracks:function(t){return t?t.map((t=>e.get(t))):Array.from(e.values())},add:function(r,o,i,s,c){const l=e.get(r.id);if(l&&!l.getStream().active&&i.active)return l.setStream(i),l;if(l)return l;{const l=new n.default(r,i);return l.setType(o),l.setIsLocal(s),l.setIsDetached(c),e.set(r.id,l),l.once("ended",(e=>{e.isUnsolicited&&!e.isDetached||a({trackId:r.id})})),t.emit("add",l.id),l}},remove:a,on:function(){return t.on(...arguments)},once:function(){return t.once(...arguments)},off:function(){return t.off(...arguments)}}};var n=a(r(15626)),o=a(r(19353));function a(e){return e&&e.__esModule?e:{default:e}}},46371:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=o.logManager.getLogger("Manager","WebRTC");return{getAvailableCodecs:function(e){const t=RTCRtpSender.getCapabilities(e);if(t&&t.codecs)return t.codecs},setProxies:function(e){void 0===e||void 0===e.peer?(t.debug("Peer functionality has been updated to remove proxies."),(0,n.setPeerProxies)()):(t.debug("Peer functionality has been updated with proxies."),(0,n.setPeerProxies)(e.peer))}}};var n=r(11655),o=r(40271)},87237:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=o.logManager.getLogger("Media",e.id);r.info(`Creating new ${t?"local":"remote"} Media.`);const n=e.id,i=e,s=new a.default,c=new Map;function l(){return Array.from(c.values())}function u(e){return c.get(e)}return{id:n,tracks:c,isLocal:t,getState:function(){return{id:n,tracks:Array.from(c.values()).map((e=>e.getState())),isLocal:t}},getTracks:l,getTrack:u,addTrack:function(e){c.has(e.id)?r.debug(`Track (${e.id}) is already in Media (${n}).`):(i.getTracks().find((t=>t.id===e.id))||i.addTrack(e.track),c.set(e.id,e),e.on("ended",(()=>{const t=function(e){const t=u(e);if(t)return c.delete(e),t}(e.id);t&&s.emit("track:ended",{mediaId:n,trackId:t.id})})),s.emit("track:new",{mediaId:n,trackId:e.id}),e.on("muted",(e=>{const t=u(e.trackId);t&&t.track&&t.track.muted&&s.emit("track:muted",{mediaId:n,trackId:e.trackId})})),e.on("unmuted",(e=>{const t=u(e.trackId);t&&t.track&&!1===t.track.muted&&s.emit("track:unmuted",{mediaId:n,trackId:e.trackId})})))},stop:function(){l().forEach((e=>{e.stop()})),s.emit("media:stopped",this.id)},on:function(){return s.on(...arguments)},once:function(){return s.once(...arguments)},off:function(){return s.off(...arguments)}}};var n,o=r(40271),a=(n=r(19353))&&n.__esModule?n:{default:n}},68529:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=o.logManager.getLogger("Session",e);n.info("Creating new Session.");const p=e;let E;const _=t.peerManager,y=t.mediaManager,v=t.trackManager,S=t.deviceManager,O=new f.default,h={dscpControls:{}},T=new Map;let I,C=_.create(r.peer);if(!C)throw new Error(`Peer creation error in Session ${p}.`);function m(){const e=(0,c.getSdpSessionId)(C.remoteDescription.sdp);T.get(e)||T.set(e,C.dtlsRole)}function A(){const e=_.get(E);return e?e.localTracks:[]}function b(){const e=_.get(E);return e?e.senderTracks.map((e=>v.get(e.id))):[]}function R(){const e=_.get(E);return e?e.remoteTracks:[]}function N(e,t){const r=_.get(E);if(r){const o=e.map((async e=>{const o=r.findReusableTransceiver(e.track.kind);if(o){try{await o.sender.replaceTrack(e.track)}catch(e){throw n.error(e),e}o.direction=["sendrecv","recvonly"].includes(o.direction)?"sendrecv":"sendonly",n.info(`Track (${e.track.kind} : ${e.id}) reused transceiver (mid: ${o.mid}).`)}else await r.addTransceiver(e),n.info(`Added track (${e.track.kind} : ${e.id}).`);O.emit("new:track",{local:!0,trackId:e.id}),h.dscpControls=(0,d.default)(h.dscpControls,t),e.once("ended",(t=>{let{isUnsolicited:r}=t;const o=_.get(E);o&&("closed"!==o.signalingState?(r?(S.emit("change",!0),setTimeout((()=>{O.emit("track:ended",{local:!0,trackId:e.id,isUnsolicited:r})}),50)):(o.removeTrack(e.id),O.emit("track:ended",{local:!0,trackId:e.id,isUnsolicited:r})),h.dscpControls.hasOwnProperty(e.id)&&(n.debug(`Removing track ${e.id} from session dscp settings`),delete h.dscpControls[e.id])):n.debug(`Received ended event for track ${e.id}, but its associated Peer ${o.id} is closed. Ignoring this event...`))}))}));return Promise.all(o)}}function P(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(((t,r)=>{const o=_.get(E);o||r(new Error(`Peer not found in Session ${p}.`)),e.mediaDirections&&(D(e.mediaDirections),delete e.mediaDirections),o.createOffer(e).then((r=>{(e.sdpHandlers||s.default.getHandlers().length)&&(n.debug("Modifying local offer with SDP pipeline."),r.sdp=s.default.run(e.sdpHandlers,r.sdp,{type:r.type,endpoint:i.PEER.ENDPOINT.LOCAL})),t(r)})).catch(r)}))}function w(e){return new Promise(((t,r)=>{const n=_.get(E);n||r(new Error(`Peer not found in Session ${p}.`)),n.setLocalDescription(e).then((()=>{"answer"===e.type&&m(),M(),t(n.localDescription)})).catch(r)}))}function M(e){if("firefox"===(0,l.getBrowserDetails)().browser)return void n.debug("Setting sender parameters not supported on Firefox; skipping.");const t=[];for(const e in h.dscpControls)t.push(new Promise(((t,r)=>{n.debug(`Setting networkPriority ${h.dscpControls[e]} for sender with track ${e}`),L(e,h.dscpControls[e]).then(t).catch(r)})));return Promise.all(t)}async function L(e,t){const r=_.get(E).getSenders().find((t=>t.track.id===e));if(r){const e=await r.getParameters();return e.encodings.forEach((e=>{e.networkPriority=t})),r.setParameters(e)}{const t=`Cannot find sender associated with trackId: ${e}`;return n.info(t),Promise.reject(t)}}function D(e){_.get(E).getTransceivers().forEach((t=>{const r=t.receiver.track.kind;(0,a.setTransceiverDirection)(t,e[r])}))}function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(((t,r)=>{const o=_.get(E);o||r(new Error(`Peer not found in Session ${p}.`)),e.mediaDirections&&(D(e.mediaDirections),delete e.mediaDirections);const a=(0,c.getSdpSessionId)(o.remoteDescription.sdp),l=T.get(a);!o.dtlsRole&&l&&(o.dtlsRole=l),o.createAnswer(e).then((r=>{(e.sdpHandlers||s.default.getHandlers().length)&&(n.debug("Modifying local answer with SDP pipeline."),r.sdp=s.default.run(e.sdpHandlers,r.sdp,{type:r.type,endpoint:i.PEER.ENDPOINT.LOCAL})),t(r)})).catch(r)}))}function j(){n.info("Ending Session.");const e=_.get(E);e&&e.close(),O.emit("session:ended",p)}function F(e){e.oniceconnectionstatechange=t=>{O.emit("peer:iceConnectionStateChange",{iceConnectionState:e.iceConnectionState})},e.onicecandidate=e=>{O.emit("onicecandidate",{candidate:e.candidate})},e.onicegatheringstatechange=t=>{e.isIceCollectionCheckOngoing&&(e.iceLoop&&(clearTimeout(e.iceLoop),e.iceLoop=void 0),O.emit("peer:iceGatheringStateChange",{reason:i.ICE_COLLECTION_CHECK_REASONS.ICE_GATHERING_STATE_CHANGE,iceCollectionDuration:e.iceTimer.timeFromStart(),iceCandidates:e.iceCandidates,iceGatheringState:e.iceGatheringState,rtcPeerConnectionConfig:e.config,rtcLocalSessionDescription:e.localDescription}))},e.on("iceCandidateCollected",g(50)((t=>{e.isIceCollectionCheckOngoing&&(e.iceLoop&&(clearTimeout(e.iceLoop),e.iceLoop=void 0),O.emit("peer:iceCandidateCollected",{reason:i.ICE_COLLECTION_CHECK_REASONS.NEW_CANDIDATE,...t}))}),{leading:!0})),e.on("scheduledCheck",(t=>{e.isIceCollectionCheckOngoing&&(e.iceLoop&&(clearTimeout(e.iceLoop),e.iceLoop=void 0),O.emit("peer:iceCollectionScheduledCheck",{reason:i.ICE_COLLECTION_CHECK_REASONS.SCHEDULED,...t}))})),e.ontrack=e=>{let t=y.get(e.getStream().id);t?t.addTrack(e):t=y.createRemote(e.getStream(),[e]),e.once("ended",(()=>{O.emit("track:ended",{local:!1,trackId:e.id,isUnsolicited:!1})}));const{kind:r}=e.getState();n.info(`Received new track (${r} : ${e.id})`),O.emit("new:track",{local:!1,trackId:e.id})}}return E=C.id,F(C),{id:p,config:r,get peer(){return C},getState:function(){return{id:p,localTracks:A(),remoteTracks:R(),allLocalTracks:b()}},get localTracks(){return A()},get remoteTracks(){return R()},get allLocalTracks(){return b()},warmup:function(){},addTracks:N,removeTracks:function(e){const t=_.get(E);if(t){const r=t.senderTracks;e.forEach((e=>{r.findIndex((t=>t.id===e))>-1&&(t.removeTrack(e),h.dscpControls.hasOwnProperty(e)&&(n.debug(`Removing track ${e} from session dscp settings`),delete h.dscpControls[e]))}))}},replaceTrack:function(e,t){const r=_.get(E),o=v.get(e.id);return r.replaceTrack(o.track,t).then((()=>{o.once("ended",(e=>{let{isUnsolicited:t}=e;const r=_.get(E);r&&("closed"!==r.signalingState?(t||r.removeTrack(o.id),O.emit("track:ended",{local:!0,trackId:o.id,isUnsolicited:t}),h.dscpControls.hasOwnProperty(o.id)&&(n.debug(`Removing track ${o.id} from session dscp settings`),delete h.dscpControls[o.id])):n.debug(`Received ended event for track ${o.id}, but its associated Peer ${r.id} is closed. Ignoring this event...`))})),O.emit("track:replaced",{oldTrackId:t.trackId,trackId:e.id})})).catch((e=>e))},setTransceiversDirection:D,createOffer:P,createAnswer:k,setLocalDescription:w,getRemoteDescription:function(){return C.remoteDescription},getLatestRemoteDesc:function(){return I},generateOffer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(((t,r)=>{P(e).then(w).then(t).catch(r)}))},processOffer:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((r,o)=>{const a=_.get(E);a||o(new Error(`Peer not found in Session ${p}.`)),(t.sdpHandlers||s.default.getHandlers().length)&&(n.debug("Modifying remote offer with SDP pipeline."),e.sdp=s.default.run(t.sdpHandlers,e.sdp,{type:e.type,endpoint:i.PEER.ENDPOINT.REMOTE})),a.setRemoteDescription(e).then((()=>{I=e,r()})).catch(o)}))},generateAnswer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(((t,r)=>{k(e).then(w).then(t).catch(r)}))},processAnswer:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(t.sdpHandlers||s.default.getHandlers().length)&&(n.debug("Modifying remote answer with SDP pipeline."),e.sdp=s.default.run(t.sdpHandlers,e.sdp,{type:e.type,endpoint:i.PEER.ENDPOINT.REMOTE})),new Promise(((t,r)=>{const n=_.get(E);n||r(new Error(`Peer not found in Session ${p}.`)),n.setRemoteDescription(e).then((()=>{m(),I=e,t()})).catch(r)}))},iceCollectionCheckResult:function(e){const t=_.get(E);if(!t)return new Error(`Peer not found in Session ${p}.`);e.type===i.ICE_COLLECTION_RESULT_TYPES.START_CALL?(n.info("Proceeding with the negotiation as instructed by the ice collection check."),t.isIceCollectionCheckOngoing=!1,t.emitter.emit("onnegotiationready")):e.type===i.ICE_COLLECTION_RESULT_TYPES.ERROR?(n.info("Cleaning up session as instructed by the ice collection check."),t.isIceCollectionCheckOngoing=!1,A().forEach((e=>e.stop())),j()):e.type===i.ICE_COLLECTION_RESULT_TYPES.WAIT?e.wait&&(n.debug(`Setting a scheduled check for the ice collection check after ${e.wait} ms`),t.iceLoop=setTimeout((()=>(0,u.default)(t)),e.wait)):(n.info("Unexpected result type from ICE collection check function, ending call."),t.isIceCollectionCheckOngoing=!1,A().forEach((e=>e.stop())),j())},recreatePeer:async function(){const e=C,t=_.create(r.peer);if(!t)throw new Error(`Peer creation error in Session ${p}.`);E=t.id,n.debug(`Recreated Peer with ID: ${E}`),C=t,await Promise.all(e.localTracks.map((async e=>{await t.addTransceiver(e)}))),F(t),e.close()},rollbackLocalDescription:function(){return new Promise(((e,t)=>{const r=_.get(E);r||t(new Error(`Peer not found in Session ${p}.`)),r.setLocalDescription({type:"rollback"}).then((()=>{e(r.localDescription)})).catch(t)}))},addIceCandidate:function(e){return new Promise(((t,r)=>{const n=_.get(E);n||r(new Error(`Peer not found in Session ${p}.`)),n.addIceCandidate(e).then(t).catch(r)}))},restartIce:function(){const e=_.get(E);e&&e.restartIce()},getDtlsRole:function(){const e=_.get(E);if(e)return e.dtlsRole},end:j,sendDTMF:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=_.get(E);return!!r&&r.sendDTMF(e,t)},getStats:function(e){return new Promise(((t,r)=>{const n=_.get(E);n?n.getStats(e).then(t).catch(r):r(new Error(`Peer not found in Session ${p}.`))}))},setParameters:M,getRemoteTrackIdsFromTransceivers:function(e){const t=C.getTransceivers(),r=[];return t.forEach((t=>{if(e.some((e=>e+""===t.mid))){const e=t.receiver.track.id;r.push(e)}})),r},getIncomingRemoteTrackIds:function(){const e=C.getTransceivers(),t=[];return e.forEach((e=>{null!==e.mid&&e.direction.includes("recv")&&"live"===e.receiver.track.readyState&&t.push(e.receiver.track.id)})),t},getActiveRemoteTrackIds:function(){const e=C.getTransceivers(),t=[];return e.forEach((e=>{null!==e.mid&&e.currentDirection&&e.currentDirection.includes("recv")&&"live"===e.receiver.track.readyState&&t.push(e.receiver.track.id)})),t},insertAudio:function(e){return new Promise(((t,r)=>{let o=!1;function a(){o?u.play():o=!0}function i(){n.info(`Stopping track ${c.id} to release the microphone after error.`),c.track.stop(),c.track.onended(new Event("track-error"))}const s=_.get(E),c=s.localTracks.find((e=>"audio"===e.track.kind&&"live"===e.track.readyState));c||r(new Error("No valid local audio track found to insert audio file on."));let l=c.id;const u=new Audio(e);u.volume=.2;const d=new AudioContext,f=d.createMediaElementSource(u),p=d.createMediaStreamDestination();f.connect(p);const g=p.stream.getAudioTracks()[0];s.replaceTrack(g,{trackId:c.id}).then((()=>{l=g.id,n.debug("Replaced audio from file media."),a()})).catch((e=>{n.info(`Failed to replace audio with file media: ${e.message}.`),r(new Error("Failed to replace audio track with file media."))})),u.oncanplaythrough=()=>{n.debug("File media ready to be played."),a()},u.onplay=()=>{n.debug(`Audio file started playing. Duration of ${u.duration} seconds.`),t(u.duration)},u.onerror=()=>{n.info("Encountered error trying to play audio file."),l!==c.id&&s.replaceTrack(c.track,{trackId:g.id}).catch((()=>{i()})),r(new Error("Failed to play audio file.")),O.emit("audioFileEnded",!1)},u.onended=e=>{n.debug("Audio file ended playing."),s.replaceTrack(c.track,{trackId:g.id}).then((()=>{n.debug("Replaced original audio track."),O.emit("audioFileEnded",!0)})).catch((e=>{n.info("Failed to replace original audio track.",e),i(),O.emit("audioFileEnded",!1)}))}}))},addNewMedia:function(e,r){function o(e){const{audio:t,video:r,screen:n}=e;return new Promise((e=>{t||r?y.createLocal({audio:t,video:r}).then((t=>{e({status:"fulfilled",value:t})})).catch((t=>{e({status:"rejected",value:t})})):n&&y.createLocalScreen({video:n}).then((t=>{e({status:"fulfilled",value:t})})).catch((t=>{e({status:"rejected",value:t})}))}))}return new Promise(((a,i)=>{const{audio:s,video:c,screen:l}=e,u=[];s&&u.push(o({audio:s})),c&&u.push(o({video:c})),l&&u.push(o({screen:l})),Promise.all(u).then((o=>{if(o.some((e=>e&&"rejected"===e.status))){const e=o.filter((e=>e&&"fulfilled"===e.status)).map((e=>e.value));Promise.all(e.map((e=>e.stop))).then((()=>{const e=o.find((e=>"rejected"===e.status)).value;let t;t="OverconstrainedError"===e.name?`Failed to get media due to constraint: ${e.constraint}.`:`Failed to get media => Name: ${e.name}; Error Message :${e.message}.`,n.info(t);const r=new Error(t);r.name=e.name,i(r)}))}else{if(e.medias)for(const r of e.medias){const e=t.mediaManager.get(r.media.id);e&&o.push({value:e})}const n={};N(o.reduce(((e,t)=>{if(t){const o=t.value.getTracks();if(r)for(const e of o)"audio"===e.getType()&&r.audioNetworkPriority?n[e.id]=r.audioNetworkPriority:"video"===e.getType()&&r.videoNetworkPriority?n[e.id]=r.videoNetworkPriority:"screen"===e.getType()&&r.screenNetworkPriority&&(n[e.id]=r.screenNetworkPriority);return e.concat(o)}return e}),[]),n).then((()=>{const e=o.filter((e=>e&&e.value)).map((e=>e.value));a(e)})).catch(i)}}))}))},on:function(){return O.on(...arguments)},once:function(){return O.once(...arguments)},off:function(){return O.off(...arguments)}}},r(97107),r(62234),r(69375);var n=p(r(4255)),o=r(40271),a=r(16106),i=r(54507),s=p(r(28851)),c=r(19556),l=r(76555),u=p(r(74839)),d=p(r(7485)),f=p(r(19353));function p(e){return e&&e.__esModule?e:{default:e}}const g=n.default.convert({fixed:!1})},15626:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=o.logManager.getLogger("Track",e.id);r.info(`Creating new ${e.kind} Track.`);const n=e.id,i=e;let s,c,l,u=t,d={};const f=new a.default;function p(){return l}return i.onended=e=>{const t=e instanceof Event,n=c?"local":"remote",o=t?"unsolicited":"solicited";r.debug(`Track ended (${n}, ${o}).`,e),f.emit("ended",{trackId:i.id,isUnsolicited:t,isDetached:p()})},i.onmute=e=>{r.debug("Event emitted: ",e),f.emit("muted",{trackId:i.id,mediaId:u.id,isLocal:c})},i.onunmute=e=>{r.debug("Event emitted: ",e),f.emit("unmuted",{trackId:i.id,mediaId:u.id,isLocal:c})},{id:n,getState:function(){return{id:n,streamId:u.id,kind:i.kind,type:s,isLocal:c,label:i.label,muted:i.muted,enabled:i.enabled,state:i.readyState,detached:l}},mute:function(){i.enabled=!1},unmute:function(){i.enabled=!0},stop:function(){"ended"!==i.readyState?(i.stop(),i.onended()):r.debug("Track already ended.")},getConstraints:function(){return d},setConstraints:function(e){d=e},on:function(){return f.on(...arguments)},off:function(){return f.off(...arguments)},once:function(){return f.once(...arguments)},track:i,setStream:function(e){u=e},getStream:function(){return u},setType:function(e){s=e},getType:function(){return s},setIsLocal:function(e){c=e},isLocal:function(){return c},setIsDetached:function(e){l=e},isDetached:p}};var n,o=r(40271),a=(n=r(19353))&&n.__esModule?n:{default:n}},19556:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSdpSessionId=function(e){const t=e.match(/o=.*/gm);if(t&&t[0])return t[0].split(" ")[1]}},75424:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changeMediaDirection=function(e){let{audio:t,video:r}=e;function n(e){return Object.values(o.MEDIA_DIR).includes(e)}return(e,o,a)=>(e.media.forEach((e=>{"audio"===e.type&&n(t)?e.direction=t:"video"===e.type&&n(r)&&(e.direction=r)})),e)},t.preventDtlsRoleChange=function(e,t,r){if("local"===t.endpoint&&"answer"===t.type)for(const r of e.media)r.setup&&t.dtlsRole&&r.setup!==t.dtlsRole&&(a.debug(`Changing DTLS role from ${r.setup} to ${t.dtlsRole}.`),r.setup=t.dtlsRole);return e},t.removeBundling=function(e,t,r){return e.groups&&(a.debug("Removing SDP bundling groups."),delete e.groups),e},t.removeTrickleIce=function(e,t,r){return e.media.forEach((e=>{"trickle"===e.iceOptions&&(a.debug(`Removing trickle ICE option from ${e.type} media.`),delete e.iceOptions)})),e},r(62234);var n=r(40271),o=r(54507);const a=n.logManager.getLogger("SdpPipeline")},28851:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.runPipeline=l;var n=s(r(30524)),o=s(r(90283)),a=s(r(89321)),i=s(r(54722));function s(e){return e&&e.__esModule?e:{default:e}}const c=r(40271).logManager.getLogger("SdpPipeline");function l(e,t,r){const s=i.default.parse(t),l=Object.freeze(s);let u=(0,a.default)(l);return(0,o.default)(e)&&e.forEach((e=>{(0,n.default)(e)?u=e(u,r,l):c.error("SDP handler not a function; skipping.")})),i.default.write(u)}t.default=function(){let e=[];return{run:function(){let t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;return l((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat(e),t,r)},setHandlers:function(t){(0,o.default)(t)&&(e=e.concat(t))},getHandlers:function(){return e}}}()},16106:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setTransceiverDirection=function(e,t){return(0,n.default)(t,(0,o.default)(a.MEDIA_DIR))?(e.setDirection?e.setDirection(t):e.direction=t,!0):(s.info(`Invalid direction "${t}"`),!1)};var n=i(r(50593)),o=i(r(30186)),a=r(54507);function i(e){return e&&e.__esModule?e:{default:e}}const s=r(40271).logManager.getLogger("SdpPipeline")},76555:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBrowserDetails=function(){return o.default.browserDetails},t.makeSafeForCSS=function(e){return e?e.replace(/[^a-z0-9]/g,""):e};var n,o=(n=r(89339))&&n.__esModule?n:{default:n}},19353:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=[],r=[],n=!1;function o(e){if(n&&!t[e])throw new Error("Invalid event type: "+e)}function a(e,t){for(var r=e.length;r--;)t===e[r]&&e.splice(r,1)}return Object.assign(e,{define:function(e){t[e]=t[e]||[]},alias:function(e,r){o(e),t[r]=t[e]=t[e]||[]},on:function(e,r){o(e),(t[e]=t[e]||[]).push(r)},off:function(e,r){o(e),a(t[e]||[],r)},once:function(e,r){o(e),r.once=!0,(t[e]=t[e]||[]).push(r)},emit:function(e){o(e);for(var n=Array.prototype.slice.call(arguments,1),i=t[e]||[],s=0,c=function(){},l=i.slice();s<l.length;s++){var u=l[s];u.once&&(i[s]=c),u.apply(void 0,n)}a(i,c);for(var d=0;d<r.length;d++)r[d].call(void 0,e,n)},subscribe:function(e){if("function"!=typeof e)throw new Error("Listener not a function");r.push(e)},unsubscribe:function(e){if("function"!=typeof e)throw new Error("Listener not a function");a(r,e)},setStrictMode:function(e){n=e}})},r(97107),r(69375)},75188:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timeLevel=t.logMethods=t.logLevels=t.levelValues=void 0;const r=t.logLevels={TRACE:"TRACE",DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR",SILENT:"SILENT"};t.levelValues={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},t.logMethods={trace:r.TRACE,debug:r.DEBUG,info:r.INFO,warn:r.WARN,error:r.ERROR,log:r.DEBUG,group:r.DEBUG,groupEnd:r.DEBUG,groupCollapsed:r.DEBUG},t.timeLevel=r.DEBUG},44413:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logLevels=t.logFormatter=t.default=void 0;var n=i(r(64400)),o=i(r(42501)),a=r(75188);function i(e){return e&&e.__esModule?e:{default:e}}t.default=n.default,t.logLevels=a.logLevels,t.logFormatter=o.default},42501:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{timestamp:t,level:r,target:n}=e,o=n.id&&n.id.length>8?n.id.substring(0,6):n.id;return`${`${t} - ${o?`${n.type}/${o}`:n.type} - ${r}`} - ${e.messages[0]}`}},92807:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{method:t}=e;t.includes("time")&&(t="debug");const r=(0,o.default)(e),n=e.messages.slice(1);console[t](r,...n)},r(62234);var n,o=(n=r(42501))&&n.__esModule?n:{default:n}},64400:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={},r={[c]:{handler:e.handler?(0,i.checkHandler)(e.handler):o.default,level:e.level?(0,i.checkLevel)(e.level):a.logLevels.INFO}};function s(e){return r[e=e||c]&&r[e].level||r[c].level}function l(e){return r[e=e||c]&&r[e].handler||r[c].handler}return{getLogger:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";r=String(r);const o=r?`${e}-${r}`:e;let a=t[o];if(!a){const i={type:e,id:r,name:o},c={level:s(e),handler:l(e)};a=(0,n.default)(i,c),t[o]=a}return a},getLoggers:function(e){return e?Object.values(t).filter((t=>t.type===e)):Object.values(t)},setLevel:function(e,t){void 0===t&&(t=e,e=c),r[e]||(r[e]={}),r[e].level=(0,i.checkLevel)(t)},getLevel:s,setHandler:function(e,t){"function"==typeof e&&void 0===t&&(t=e,e=c),r[e]||(r[e]={}),r[e].handler=(0,i.checkHandler)(t)},getHandler:l}};var n=s(r(16469)),o=s(r(92807)),a=r(75188),i=r(87398);function s(e){return e&&e.__esModule?e:{default:e}}const c=Symbol("Default")},16469:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={target:e,level:(0,a.checkLevel)(t.level),handler:(0,a.checkHandler)(t.handler)};function n(e,t,n){return function(){if(!(o.levelValues[t]>=o.levelValues[r.level]))return;for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];const c={...n,method:e,timestamp:Date.now(),level:t,target:r.target,messages:[...i]};r.handler(c)}}const s={getHandler:function(){return r.handler},setHandler:function(e){r.handler=(0,a.checkHandler)(e)},getLevel:function(){return r.level},setLevel:function(e){r.level=(0,a.checkLevel)(e)},get type(){return r.target.type},get id(){return r.target.id},get name(){return r.target.name}};for(const e in o.logMethods)s[e]=n(e,o.logMethods[e]);const c=(0,i.default)(((e,t)=>n(t.event,o.timeLevel,{timer:t})(e)),((e,t)=>n("warn",o.logLevels.WARN,{timer:t})(e)));return{...s,...c}};var n,o=r(75188),a=r(87398),i=(n=r(1140))&&n.__esModule?n:{default:n}},1140:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){(0,n.checkHandler)(e),(0,n.checkHandler)(t);const r={};return{time:function(n){const o=Date.now(),a={event:"time",name:n};r.hasOwnProperty(n)?(a.start=r[n],t(`Timer ${n} already started.`,a)):(r[n]=o,a.start=o,e(`Timer ${n} started.`,a))},timeEnd:function(n){const o=Date.now(),a={event:"timeEnd",name:n,start:r[n]};if(r.hasOwnProperty(n)){const t=r[n];delete r[n];const i=o-t;a.end=o,a.elapsed=i,e(`Timer ${n} ended, taking ${i}ms.`,a)}else t(`Timer ${n} has not been started.`,a)},timeLog:function(n){const o=Date.now(),a={event:"timeLog",name:n,start:r[n]};if(r.hasOwnProperty(n)){const t=o-r[n];a.split=o,a.elapsed=t,e(`Timer ${n} split, at ${t}ms so far.`,a)}else t(`Timer ${n} has not been started.`,a)}}};var n=r(87398)},87398:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkHandler=function(e){if(e&&"function"==typeof e)return e;throw new Error("Provided log handler is not a function.")},t.checkLevel=function(e){const t=e&&e.toUpperCase&&e.toUpperCase();if(t&&n.logLevels[t])return n.logLevels[t];throw new Error("Provided level is not a valid log level.")},r(97107);var n=r(75188)},14132:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(65275))&&n.__esModule?n:{default:n};t.default=o.default},38724:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r="API invoked: ",a=[],i={},s=[],c={};function l(e,t){if(!e||!(0,n.default)(e))throw new Error(`${r}report.addEventIdToMetric: Invalid type (${typeof e}), must be of type string.`);if(!t||!(0,n.default)(t))throw new Error(`${r}report.addEventIdToMetric: Invalid eventId (${typeof t}), must be of type string.`);const o=s.find((t=>t.type===e));o&&(o.eventIds||(o.eventIds=[]),o.eventIds.push(t))}function u(e){if(!e.error)for(const t in c)c[t].events.includes(e.type)&&(c[t].handler(d,e),l(t,e.id))}const d={type:e,id:t,timeline:a,metrics:s,addEvent:function(e){if(!e||!(0,n.default)(e))throw new Error(`${r}report.addEvent: Invalid type (${typeof e}), must be of type string.`);const t=(0,o.default)(e,u);return a.push(t),t},getEvent:function(e){for(let t=0;t<a.length;t++){if(a[t].id===e)return a[t];{const r=a[t].getEvent(e);if(r)return r}}},findLastOngoingEvent:function(e){return[...a].reverse().find((t=>e||t.isEnded()?Array.isArray(e)&&e.includes(t.type)&&!t.isEnded()?t:t.type!==e||t.isEnded()?void 0:t:t))},addData:function(e,t){if(!e||!(0,n.default)(e))throw new Error(`${r}report.addData: Invalid type (${typeof e}), must be of type string.`);if(void 0===t)throw new Error(`${r}report.addData: No data provided.`);i[e]=t},getData:function(e){return e?i[e]:i},addMetric:function(e,t){if(!e||!(0,n.default)(e))throw new Error(`${r}report.addMetric: Invalid type (${typeof e}), must be of type string.`);if(void 0===t)throw new Error(`${r}report.addMetric: No data provided.`);s.push({type:e,data:t})},getMetric:function(e){if(!e||!(0,n.default)(e))throw new Error(`${r}report.getMetric: Invalid type (${typeof e}), must be of type string.`);return s.filter((t=>t.type===e)).map((e=>e.data))},registerMetricHandler:function(e,t,o){if(!e||!(0,n.default)(e))throw new Error(`${r}report.registerMetricHandler: Invalid type (${typeof e}), must be of type string.`);if(!t)throw new Error(`${r}report.registerMetricHandler: Invalid events (${typeof e}), must be a string or an array with at least one event type.`);if(!o||"function"!=typeof o)throw new Error(`${r}report.registerMetricHandler: Invalid handler (${typeof o}, must be a function.)`);(0,n.default)(t)&&(t=[t]),c[e]={events:t,handler:o}},unregisterMetricHandler:function(e){e&&delete c[e]},getSerializable:function(){return{type:e,id:t,timeline:a.map((e=>e.getSerializable())),data:i,metrics:s}}};return d},r(97107),r(62234),r(69375);var n=a(r(73173)),o=a(r(68809));function a(e){return e&&e.__esModule?e:{default:e}}},65275:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e="API invoked: ",t={};return{createReport:function(r,a){if(!r||!(0,n.default)(r))throw new Error(`${e}reporter.createReport: Invalid type (${typeof r}), must be of type string.`);if(!a||!(0,n.default)(a))throw new Error(`${e}reporter.createReport: Invalid id (${typeof a}), must be of type string.`);if(t.hasOwnProperty(a))throw new Error(`${e}reporter.createReport: Cannot create report. One already exists for id: ${a}`);const i=(0,o.default)(r,a);return t[a]=i,i},getReport:function(e){return t[e]},deleteReport:function(r){if(!r||!(0,n.default)(r))throw new Error(`${e}reporter.deleteReport: Invalid id ${typeof r} (must be of type string).`);delete t[r]}}},r(97107);var n=a(r(73173)),o=a(r(38724));function a(e){return e&&e.__esModule?e:{default:e}}},68809:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,r,n){const i=(new Date).getTime(),s=(0,a.v4)(),c=n,l=[],u={},d=[],f="API invoked: ";const p={type:t,id:s,parentId:c,timeline:l,metrics:d,start:i,addEvent:function(t){if(this.end)throw new Error(`${f}timelineEvent.addEvent: Cannot add further sub-events. Event has been marked as ended.`);if(!t||!(0,o.default)(t))throw new Error(`${f}timelineEvent.addEvent: Invalid type (${typeof t}), must be of type string.`);const n=e(t,r,s);return l.push(n),n},isEnded:function(){return!!this.end},getEvent:function(e){for(let t=0;t<l.length;t++){if(l[t].id===e)return l[t];{const r=l[t].getEvent(e);if(r)return r}}},findLastOngoingEvent:function(e){return[...l].reverse().find((t=>{if(t.type===e&&!t.isEnded())return t}))},addData:function(e,t){if(!e||!(0,o.default)(e))throw new Error(`${f}timelineEvent.addData: Invalid type (${typeof e}), must be of type string.`);if(void 0===t)throw new Error(`${f}timelineEvent.addData: No data provided.`);u[e]=t},getData:function(e){return e?u[e]:u},addMetric:function(e,t){if(!e||!(0,o.default)(e))throw new Error(`${f}timelineEvent.addMetric: Invalid type (${typeof e}), must be of type string.`);if(void 0===t)throw new Error(`${f}timelineEvent.addMetric: No data provided.`);d.push({type:e,data:t})},getMetric:function(e){if(!e||!(0,o.default)(e))throw new Error(`${f}timelineEvent.getMetric: Invalid type (${typeof e}), must be of type string.`);return d.filter((t=>t.type===e)).map((e=>e.data))},endEvent:function(e){this.end||(e&&(this.error=e),this.end=(new Date).getTime(),r(p))},setError:function(e){if(this.end)throw new Error("Can't set error on an event that has already ended.");this.error=e},getError:function(){return this.error},getSerializable:function(){return{type:t,id:s,parentId:c,timeline:l.map((e=>e.getSerializable())),data:u,metrics:d,start:i,end:this.end,error:this.error}}};return p},r(97107),r(69375);var n,o=(n=r(73173))&&n.__esModule?n:{default:n},a=r(84596)},17249:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"timerFactory",{enumerable:!0,get:function(){return o.default}});var n,o=(n=r(82108))&&n.__esModule?n:{default:n}},82108:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e={};function t(t){clearTimeout(t),Object.keys(e).forEach((r=>{const n=e[r].findIndex((e=>e.handle===t));n>-1&&e[r].splice(n,1)}))}return{create:function(r,n,o,a){if(!r||"string"!=typeof r)throw new Error("No valid type provided for timer operation.");if(!n||"function"!=typeof n)throw new Error("No valid callback function provided for timer operation.");if(!o||"number"!=typeof o||o<0)throw new Error("No valid delay period provided for timer operation.");const{id:i,params:s=[],repeating:c}=a||{},l=c?setInterval((async()=>{await n(...s)}),o):setTimeout((function(){t(l),n(...s)}),o,...s);return e[r]||(e[r]=[]),e[r].push({id:i,handle:l}),l},getAll:function(){return e},getAllByType:function(t){if(!t||"string"!=typeof t)throw new Error("No valid type provided for timers operation.");return e[t]||[]},getAllById:function(t){if(!t||"string"!=typeof t)throw new Error("No valid id provided for timers operation.");const r=[];return Object.keys(e).forEach((n=>{const o=e[n].filter((e=>e.id===t));r.push(...o)})),r},clear:t,clearAllByType:function(r){if(!r||"string"!=typeof r)throw new Error("No valid type provided for timer operation.");e[r]&&(e[r].forEach((e=>t(e.handle))),delete e[r])},clearAllById:function(r){if(!r||"string"!=typeof r)throw new Error("No valid id provided for timer operation.");Object.keys(e).forEach((n=>{let o;for(;(o=e[n].findIndex((e=>e.id===r)))>-1;)t(e[n][o].handle)}))},isRunning:function(t){let r=!1;return Object.keys(e).forEach((n=>{e[n].findIndex((e=>e.handle===t))>-1&&(r=!0)})),r}}},r(97107),r(69375)},7485:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.default)(((e,t)=>{if((0,n.default)(e))return t}),t)};var n=a(r(90283)),o=a(r(81175));function a(e){return e&&e.__esModule?e:{default:e}}},2633:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).length>0?"?"+o.default.stringify(e,t):""};var n,o=(n=r(68032))&&n.__esModule?n:{default:n}},86125:function(e,t,r){var n;e=r.nmd(e),function(o){var a=(e&&e.exports,"object"==typeof r.g&&r.g);a.global!==a&&a.window;var i=function(e){this.message=e};(i.prototype=new Error).name="InvalidCharacterError";var s=function(e){throw new i(e)},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=/[\t\n\f\r ]/g,u={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&s("The string to be encoded contains characters outside of the Latin1 range.");for(var t,r,n,o,a=e.length%3,i="",l=-1,u=e.length-a;++l<u;)t=e.charCodeAt(l)<<16,r=e.charCodeAt(++l)<<8,n=e.charCodeAt(++l),i+=c.charAt((o=t+r+n)>>18&63)+c.charAt(o>>12&63)+c.charAt(o>>6&63)+c.charAt(63&o);return 2==a?(t=e.charCodeAt(l)<<8,r=e.charCodeAt(++l),i+=c.charAt((o=t+r)>>10)+c.charAt(o>>4&63)+c.charAt(o<<2&63)+"="):1==a&&(o=e.charCodeAt(l),i+=c.charAt(o>>2)+c.charAt(o<<4&63)+"=="),i},decode:function(e){var t=(e=String(e).replace(l,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&s("Invalid character: the string to be decoded is not correctly encoded.");for(var r,n,o=0,a="",i=-1;++i<t;)n=c.indexOf(e.charAt(i)),r=o%4?64*r+n:n,o++%4&&(a+=String.fromCharCode(255&r>>(-2*o&6)));return a},version:"1.0.0"};void 0===(n=function(){return u}.call(t,r,t,e))||(e.exports=n)}()},8997:(e,t,r)=>{"use strict";var n;r.r(t),r.d(t,{default:()=>N});var o=".",a="function",i="string",s="__global__",c="Provider",l=0,u=Array.prototype.slice,d=function(e,t){var r=e[t];if(void 0===r&&n.config.strict)throw new Error("Bottle was unable to resolve a service.  `"+t+"` is undefined.");return r},f=function(e){var t;return this.nested[e]||(t=n.pop(),this.nested[e]=t,this.factory(e,(function(){return t.container}))),this.nested[e]},p=function(e){return e.split(o).reduce(d,this)},g=function(e,t){return t(e)},E=function(e,t){return(e[t]||[]).concat(e.__global__||[])},_=function(e,t){var r,n,o,a,i;return this.id,o=this.container,a=this.decorators,i=this.middlewares,r=e+c,(n=Object.create(null))[r]={configurable:!0,enumerable:!0,get:function(){var e=new t;return delete o[r],o[r]=e,e}},n[e]={configurable:!0,enumerable:!0,get:function(){var t,n=o[r];return n&&(t=E(a,e).reduce(g,n.$get(o)),delete o[r],delete o[e]),void 0===t?t:function(e,t,r,n){var o={configurable:!0,enumerable:!0};return e.length?o.get=function(){var t=0,n=function(o){if(o)throw o;e[t]&&e[t++](r,n)};return n(),r}:(o.value=r,o.writable=!0),Object.defineProperty(n,t,o),n[t]}(E(i,e),e,t,o)}},Object.defineProperties(o,n),this},y=function(e,t){var r,n;return r=e.split(o),this.providerMap[e]&&1===r.length&&!this.container[e+c]?console.error(e+" provider already instantiated."):(this.originalProviders[e]=t,this.providerMap[e]=!0,n=r.shift(),r.length?(f.call(this,n).provider(r.join(o),t),this):_.call(this,n,t))},v=function(e,t){return y.call(this,e,(function(){this.$get=t}))},S=function(e,t,r){var n=arguments.length>3?u.call(arguments,3):[],o=this;return v.call(this,e,(function(){var e=t,a=n.map(p,o.container);return r?new(t.bind.apply(t,[null].concat(a))):e.apply(null,a)}))},O=function(e,t){Object.defineProperty(this,e,{configurable:!0,enumerable:!0,value:t,writable:!0})},h=function(e,t){var r=e[t];return r||O.call(e,t,r={}),r},T=function(e,t){Object.defineProperty(this,e,{configurable:!1,enumerable:!0,value:t,writable:!1})},I=function(e,t){var r,n;return typeof e===a&&(t=e,e=s),n=(r=e.split(o)).shift(),r.length?f.call(this,n).decorator(r.join(o),t):(this.decorators[n]||(this.decorators[n]=[]),this.decorators[n].push(t)),this},C=function(e){return!/^\$(?:decorator|register|list)$|Provider$/.test(e)},m=function(e){return Object.keys(e||this.container||{}).filter(C)},A={},b=function(e){var t=void 0===e.$value?e:e.$value;return this[e.$type||"service"].apply(this,[e.$name,t].concat(e.$inject||[]))},R=function(e){delete this.providerMap[e],delete this.container[e],delete this.container[e+c]};(n=function e(t){if(!(this instanceof e))return e.pop(t);this.id=l++,this.decorators={},this.middlewares={},this.nested={},this.providerMap={},this.originalProviders={},this.deferred=[],this.container={$decorator:I.bind(this),$register:b.bind(this),$list:m.bind(this)}}).prototype={constant:function(e,t){var r=e.split(o);return e=r.pop(),T.call(r.reduce(h,this.container),e,t),this},decorator:I,defer:function(e){return this.deferred.push(e),this},digest:function(e){return(e||[]).map(p,this.container)},factory:v,instanceFactory:function(e,t){return v.call(this,e,(function(e){return{instance:t.bind(t,e)}}))},list:m,middleware:function(e,t){var r,n;return typeof e===a&&(t=e,e=s),n=(r=e.split(o)).shift(),r.length?f.call(this,n).middleware(r.join(o),t):(this.middlewares[n]||(this.middlewares[n]=[]),this.middlewares[n].push(t)),this},provider:y,resetProviders:function(e){var t=this.originalProviders,r=Array.isArray(e);Object.keys(this.originalProviders).forEach((function(n){if(!r||-1!==e.indexOf(n)){var a=n.split(o);a.length>1&&a.forEach(R,f.call(this,a[0])),R.call(this,n),this.provider(n,t[n])}}),this)},register:b,resolve:function(e){return this.deferred.forEach((function(t){t(e)})),this},service:function(e,t){return S.apply(this,[e,t,!0].concat(u.call(arguments,2)))},serviceFactory:function(e,t){return S.apply(this,[e,t,!1].concat(u.call(arguments,2)))},value:function(e,t){var r;return r=e.split(o),e=r.pop(),O.call(r.reduce(h,this.container),e,t),this}},n.pop=function(e){var t;return typeof e===i?((t=A[e])||(A[e]=t=new n,t.constant("BOTTLE_NAME",e)),t):new n},n.clear=function(e){typeof e===i?delete A[e]:A={}},n.list=m,n.config={strict:!1};const N=n},33839:(e,t,r)=>{"use strict";e=r.nmd(e);const n=(e,t)=>(...r)=>`[${e(...r)+t}m`,o=(e,t)=>(...r)=>{const n=e(...r);return`[${38+t};5;${n}m`},a=(e,t)=>(...r)=>{const n=e(...r);return`[${38+t};2;${n[0]};${n[1]};${n[2]}m`},i=e=>e,s=(e,t,r)=>[e,t,r],c=(e,t,r)=>{Object.defineProperty(e,t,{get:()=>{const n=r();return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0}),n},enumerable:!0,configurable:!0})};let l;const u=(e,t,n,o)=>{void 0===l&&(l=r(99047));const a=o?10:0,i={};for(const[r,o]of Object.entries(l)){const s="ansi16"===r?"ansi":r;r===t?i[s]=e(n,a):"object"==typeof o&&(i[s]=e(o[t],a))}return i};Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[r,n]of Object.entries(t)){for(const[r,o]of Object.entries(n))t[r]={open:`[${o[0]}m`,close:`[${o[1]}m`},n[r]=t[r],e.set(o[0],o[1]);Object.defineProperty(t,r,{value:n,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",c(t.color,"ansi",(()=>u(n,"ansi16",i,!1))),c(t.color,"ansi256",(()=>u(o,"ansi256",i,!1))),c(t.color,"ansi16m",(()=>u(a,"rgb",s,!1))),c(t.bgColor,"ansi",(()=>u(n,"ansi16",i,!0))),c(t.bgColor,"ansi256",(()=>u(o,"ansi256",i,!0))),c(t.bgColor,"ansi16m",(()=>u(a,"rgb",s,!0))),t}})},20223:e=>{"use strict";e.exports={stdout:!1,stderr:!1}},55603:(e,t,r)=>{"use strict";const n=r(33839),{stdout:o,stderr:a}=r(20223),{stringReplaceAll:i,stringEncaseCRLFWithFirstIndex:s}=r(5179),{isArray:c}=Array,l=["ansi","ansi","ansi256","ansi16m"],u=Object.create(null);class d{constructor(e){return f(e)}}const f=e=>{const t={};return((e,t={})=>{if(t.level&&!(Number.isInteger(t.level)&&t.level>=0&&t.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");const r=o?o.level:0;e.level=void 0===t.level?r:t.level})(t,e),t.template=(...e)=>O(t.template,...e),Object.setPrototypeOf(t,p.prototype),Object.setPrototypeOf(t.template,t),t.template.constructor=()=>{throw new Error("`chalk.constructor()` is deprecated. Use `new chalk.Instance()` instead.")},t.template.Instance=d,t.template};function p(e){return f(e)}for(const[e,t]of Object.entries(n))u[e]={get(){const r=y(this,_(t.open,t.close,this._styler),this._isEmpty);return Object.defineProperty(this,e,{value:r}),r}};u.visible={get(){const e=y(this,this._styler,!0);return Object.defineProperty(this,"visible",{value:e}),e}};const g=["rgb","hex","keyword","hsl","hsv","hwb","ansi","ansi256"];for(const e of g)u[e]={get(){const{level:t}=this;return function(...r){const o=_(n.color[l[t]][e](...r),n.color.close,this._styler);return y(this,o,this._isEmpty)}}};for(const e of g)u["bg"+e[0].toUpperCase()+e.slice(1)]={get(){const{level:t}=this;return function(...r){const o=_(n.bgColor[l[t]][e](...r),n.bgColor.close,this._styler);return y(this,o,this._isEmpty)}}};const E=Object.defineProperties((()=>{}),{...u,level:{enumerable:!0,get(){return this._generator.level},set(e){this._generator.level=e}}}),_=(e,t,r)=>{let n,o;return void 0===r?(n=e,o=t):(n=r.openAll+e,o=t+r.closeAll),{open:e,close:t,openAll:n,closeAll:o,parent:r}},y=(e,t,r)=>{const n=(...e)=>c(e[0])&&c(e[0].raw)?v(n,O(n,...e)):v(n,1===e.length?""+e[0]:e.join(" "));return Object.setPrototypeOf(n,E),n._generator=e,n._styler=t,n._isEmpty=r,n},v=(e,t)=>{if(e.level<=0||!t)return e._isEmpty?"":t;let r=e._styler;if(void 0===r)return t;const{openAll:n,closeAll:o}=r;if(-1!==t.indexOf(""))for(;void 0!==r;)t=i(t,r.close,r.open),r=r.parent;const a=t.indexOf("\n");return-1!==a&&(t=s(t,o,n,a)),n+t+o};let S;const O=(e,...t)=>{const[n]=t;if(!c(n)||!c(n.raw))return t.join(" ");const o=t.slice(1),a=[n.raw[0]];for(let e=1;e<n.length;e++)a.push(String(o[e-1]).replace(/[{}\\]/g,"\\$&"),String(n.raw[e]));return void 0===S&&(S=r(69912)),S(e,a.join(""))};Object.defineProperties(p.prototype,u);const h=p();h.supportsColor=o,h.stderr=p({level:a?a.level:0}),h.stderr.supportsColor=a,e.exports=h},69912:e=>{"use strict";const t=/(?:\\(u(?:[a-f\d]{4}|\{[a-f\d]{1,6}\})|x[a-f\d]{2}|.))|(?:\{(~)?(\w+(?:\([^)]*\))?(?:\.\w+(?:\([^)]*\))?)*)(?:[ \t]|(?=\r?\n)))|(\})|((?:.|[\r\n\f])+?)/gi,r=/(?:^|\.)(\w+)(?:\(([^)]*)\))?/g,n=/^(['"])((?:\\.|(?!\1)[^\\])*)\1$/,o=/\\(u(?:[a-f\d]{4}|{[a-f\d]{1,6}})|x[a-f\d]{2}|.)|([^\\])/gi,a=new Map([["n","\n"],["r","\r"],["t","\t"],["b","\b"],["f","\f"],["v","\v"],["0","\0"],["\\","\\"],["e",""],["a",""]]);function i(e){const t="u"===e[0],r="{"===e[1];return t&&!r&&5===e.length||"x"===e[0]&&3===e.length?String.fromCharCode(parseInt(e.slice(1),16)):t&&r?String.fromCodePoint(parseInt(e.slice(2,-1),16)):a.get(e)||e}function s(e,t){const r=[],a=t.trim().split(/\s*,\s*/g);let s;for(const t of a){const a=Number(t);if(Number.isNaN(a)){if(!(s=t.match(n)))throw new Error(`Invalid Chalk template style argument: ${t} (in style '${e}')`);r.push(s[2].replace(o,((e,t,r)=>t?i(t):r)))}else r.push(a)}return r}function c(e){r.lastIndex=0;const t=[];let n;for(;null!==(n=r.exec(e));){const e=n[1];if(n[2]){const r=s(e,n[2]);t.push([e].concat(r))}else t.push([e])}return t}function l(e,t){const r={};for(const e of t)for(const t of e.styles)r[t[0]]=e.inverse?null:t.slice(1);let n=e;for(const[e,t]of Object.entries(r))if(Array.isArray(t)){if(!(e in n))throw new Error(`Unknown Chalk style: ${e}`);n=t.length>0?n[e](...t):n[e]}return n}e.exports=(e,r)=>{const n=[],o=[];let a=[];if(r.replace(t,((t,r,s,u,d,f)=>{if(r)a.push(i(r));else if(u){const t=a.join("");a=[],o.push(0===n.length?t:l(e,n)(t)),n.push({inverse:s,styles:c(u)})}else if(d){if(0===n.length)throw new Error("Found extraneous } in Chalk template literal");o.push(l(e,n)(a.join(""))),a=[],n.pop()}else a.push(f)})),o.push(a.join("")),n.length>0){const e=`Chalk template literal is missing ${n.length} closing bracket${1===n.length?"":"s"} (\`}\`)`;throw new Error(e)}return o.join("")}},5179:e=>{"use strict";e.exports={stringReplaceAll:(e,t,r)=>{let n=e.indexOf(t);if(-1===n)return e;const o=t.length;let a=0,i="";do{i+=e.substr(a,n-a)+t+r,a=n+o,n=e.indexOf(t,a)}while(-1!==n);return i+=e.substr(a),i},stringEncaseCRLFWithFirstIndex:(e,t,r,n)=>{let o=0,a="";do{const i="\r"===e[n-1];a+=e.substr(o,(i?n-1:n)-o)+t+(i?"\r\n":"\n")+r,o=n+1,n=e.indexOf("\n",o)}while(-1!==n);return a+=e.substr(o),a}}},59246:(e,t,r)=>{const n=r(76931),o={};for(const e of Object.keys(n))o[n[e]]=e;const a={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};e.exports=a;for(const e of Object.keys(a)){if(!("channels"in a[e]))throw new Error("missing channels property: "+e);if(!("labels"in a[e]))throw new Error("missing channel labels property: "+e);if(a[e].labels.length!==a[e].channels)throw new Error("channel and label counts mismatch: "+e);const{channels:t,labels:r}=a[e];delete a[e].channels,delete a[e].labels,Object.defineProperty(a[e],"channels",{value:t}),Object.defineProperty(a[e],"labels",{value:r})}a.rgb.hsl=function(e){const t=e[0]/255,r=e[1]/255,n=e[2]/255,o=Math.min(t,r,n),a=Math.max(t,r,n),i=a-o;let s,c;a===o?s=0:t===a?s=(r-n)/i:r===a?s=2+(n-t)/i:n===a&&(s=4+(t-r)/i),s=Math.min(60*s,360),s<0&&(s+=360);const l=(o+a)/2;return c=a===o?0:l<=.5?i/(a+o):i/(2-a-o),[s,100*c,100*l]},a.rgb.hsv=function(e){let t,r,n,o,a;const i=e[0]/255,s=e[1]/255,c=e[2]/255,l=Math.max(i,s,c),u=l-Math.min(i,s,c),d=function(e){return(l-e)/6/u+.5};return 0===u?(o=0,a=0):(a=u/l,t=d(i),r=d(s),n=d(c),i===l?o=n-r:s===l?o=1/3+t-n:c===l&&(o=2/3+r-t),o<0?o+=1:o>1&&(o-=1)),[360*o,100*a,100*l]},a.rgb.hwb=function(e){const t=e[0],r=e[1];let n=e[2];const o=a.rgb.hsl(e)[0],i=1/255*Math.min(t,Math.min(r,n));return n=1-1/255*Math.max(t,Math.max(r,n)),[o,100*i,100*n]},a.rgb.cmyk=function(e){const t=e[0]/255,r=e[1]/255,n=e[2]/255,o=Math.min(1-t,1-r,1-n);return[100*((1-t-o)/(1-o)||0),100*((1-r-o)/(1-o)||0),100*((1-n-o)/(1-o)||0),100*o]},a.rgb.keyword=function(e){const t=o[e];if(t)return t;let r,a=1/0;for(const t of Object.keys(n)){const o=(s=n[t],((i=e)[0]-s[0])**2+(i[1]-s[1])**2+(i[2]-s[2])**2);o<a&&(a=o,r=t)}var i,s;return r},a.keyword.rgb=function(e){return n[e]},a.rgb.xyz=function(e){let t=e[0]/255,r=e[1]/255,n=e[2]/255;return t=t>.04045?((t+.055)/1.055)**2.4:t/12.92,r=r>.04045?((r+.055)/1.055)**2.4:r/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92,[100*(.4124*t+.3576*r+.1805*n),100*(.2126*t+.7152*r+.0722*n),100*(.0193*t+.1192*r+.9505*n)]},a.rgb.lab=function(e){const t=a.rgb.xyz(e);let r=t[0],n=t[1],o=t[2];return r/=95.047,n/=100,o/=108.883,r=r>.008856?r**(1/3):7.787*r+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,o=o>.008856?o**(1/3):7.787*o+16/116,[116*n-16,500*(r-n),200*(n-o)]},a.hsl.rgb=function(e){const t=e[0]/360,r=e[1]/100,n=e[2]/100;let o,a,i;if(0===r)return i=255*n,[i,i,i];o=n<.5?n*(1+r):n+r-n*r;const s=2*n-o,c=[0,0,0];for(let e=0;e<3;e++)a=t+1/3*-(e-1),a<0&&a++,a>1&&a--,i=6*a<1?s+6*(o-s)*a:2*a<1?o:3*a<2?s+(o-s)*(2/3-a)*6:s,c[e]=255*i;return c},a.hsl.hsv=function(e){const t=e[0];let r=e[1]/100,n=e[2]/100,o=r;const a=Math.max(n,.01);return n*=2,r*=n<=1?n:2-n,o*=a<=1?a:2-a,[t,100*(0===n?2*o/(a+o):2*r/(n+r)),(n+r)/2*100]},a.hsv.rgb=function(e){const t=e[0]/60,r=e[1]/100;let n=e[2]/100;const o=Math.floor(t)%6,a=t-Math.floor(t),i=255*n*(1-r),s=255*n*(1-r*a),c=255*n*(1-r*(1-a));switch(n*=255,o){case 0:return[n,c,i];case 1:return[s,n,i];case 2:return[i,n,c];case 3:return[i,s,n];case 4:return[c,i,n];case 5:return[n,i,s]}},a.hsv.hsl=function(e){const t=e[0],r=e[1]/100,n=e[2]/100,o=Math.max(n,.01);let a,i;i=(2-r)*n;const s=(2-r)*o;return a=r*o,a/=s<=1?s:2-s,a=a||0,i/=2,[t,100*a,100*i]},a.hwb.rgb=function(e){const t=e[0]/360;let r=e[1]/100,n=e[2]/100;const o=r+n;let a;o>1&&(r/=o,n/=o);const i=Math.floor(6*t),s=1-n;a=6*t-i,0!=(1&i)&&(a=1-a);const c=r+a*(s-r);let l,u,d;switch(i){default:case 6:case 0:l=s,u=c,d=r;break;case 1:l=c,u=s,d=r;break;case 2:l=r,u=s,d=c;break;case 3:l=r,u=c,d=s;break;case 4:l=c,u=r,d=s;break;case 5:l=s,u=r,d=c}return[255*l,255*u,255*d]},a.cmyk.rgb=function(e){const t=e[0]/100,r=e[1]/100,n=e[2]/100,o=e[3]/100;return[255*(1-Math.min(1,t*(1-o)+o)),255*(1-Math.min(1,r*(1-o)+o)),255*(1-Math.min(1,n*(1-o)+o))]},a.xyz.rgb=function(e){const t=e[0]/100,r=e[1]/100,n=e[2]/100;let o,a,i;return o=3.2406*t+-1.5372*r+-.4986*n,a=-.9689*t+1.8758*r+.0415*n,i=.0557*t+-.204*r+1.057*n,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,a=a>.0031308?1.055*a**(1/2.4)-.055:12.92*a,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),i=Math.min(Math.max(0,i),1),[255*o,255*a,255*i]},a.xyz.lab=function(e){let t=e[0],r=e[1],n=e[2];return t/=95.047,r/=100,n/=108.883,t=t>.008856?t**(1/3):7.787*t+16/116,r=r>.008856?r**(1/3):7.787*r+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,[116*r-16,500*(t-r),200*(r-n)]},a.lab.xyz=function(e){let t,r,n;r=(e[0]+16)/116,t=e[1]/500+r,n=r-e[2]/200;const o=r**3,a=t**3,i=n**3;return r=o>.008856?o:(r-16/116)/7.787,t=a>.008856?a:(t-16/116)/7.787,n=i>.008856?i:(n-16/116)/7.787,t*=95.047,r*=100,n*=108.883,[t,r,n]},a.lab.lch=function(e){const t=e[0],r=e[1],n=e[2];let o;return o=360*Math.atan2(n,r)/2/Math.PI,o<0&&(o+=360),[t,Math.sqrt(r*r+n*n),o]},a.lch.lab=function(e){const t=e[0],r=e[1],n=e[2]/360*2*Math.PI;return[t,r*Math.cos(n),r*Math.sin(n)]},a.rgb.ansi16=function(e,t=null){const[r,n,o]=e;let i=null===t?a.rgb.hsv(e)[2]:t;if(i=Math.round(i/50),0===i)return 30;let s=30+(Math.round(o/255)<<2|Math.round(n/255)<<1|Math.round(r/255));return 2===i&&(s+=60),s},a.hsv.ansi16=function(e){return a.rgb.ansi16(a.hsv.rgb(e),e[2])},a.rgb.ansi256=function(e){const t=e[0],r=e[1],n=e[2];return t===r&&r===n?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(r/255*5)+Math.round(n/255*5)},a.ansi16.rgb=function(e){let t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),t=t/10.5*255,[t,t,t];const r=.5*(1+~~(e>50));return[(1&t)*r*255,(t>>1&1)*r*255,(t>>2&1)*r*255]},a.ansi256.rgb=function(e){if(e>=232){const t=10*(e-232)+8;return[t,t,t]}let t;return e-=16,[Math.floor(e/36)/5*255,Math.floor((t=e%36)/6)/5*255,t%6/5*255]},a.rgb.hex=function(e){const t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},a.hex.rgb=function(e){const t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];let r=t[0];3===t[0].length&&(r=r.split("").map((e=>e+e)).join(""));const n=parseInt(r,16);return[n>>16&255,n>>8&255,255&n]},a.rgb.hcg=function(e){const t=e[0]/255,r=e[1]/255,n=e[2]/255,o=Math.max(Math.max(t,r),n),a=Math.min(Math.min(t,r),n),i=o-a;let s,c;return s=i<1?a/(1-i):0,c=i<=0?0:o===t?(r-n)/i%6:o===r?2+(n-t)/i:4+(t-r)/i,c/=6,c%=1,[360*c,100*i,100*s]},a.hsl.hcg=function(e){const t=e[1]/100,r=e[2]/100,n=r<.5?2*t*r:2*t*(1-r);let o=0;return n<1&&(o=(r-.5*n)/(1-n)),[e[0],100*n,100*o]},a.hsv.hcg=function(e){const t=e[1]/100,r=e[2]/100,n=t*r;let o=0;return n<1&&(o=(r-n)/(1-n)),[e[0],100*n,100*o]},a.hcg.rgb=function(e){const t=e[0]/360,r=e[1]/100,n=e[2]/100;if(0===r)return[255*n,255*n,255*n];const o=[0,0,0],a=t%1*6,i=a%1,s=1-i;let c=0;switch(Math.floor(a)){case 0:o[0]=1,o[1]=i,o[2]=0;break;case 1:o[0]=s,o[1]=1,o[2]=0;break;case 2:o[0]=0,o[1]=1,o[2]=i;break;case 3:o[0]=0,o[1]=s,o[2]=1;break;case 4:o[0]=i,o[1]=0,o[2]=1;break;default:o[0]=1,o[1]=0,o[2]=s}return c=(1-r)*n,[255*(r*o[0]+c),255*(r*o[1]+c),255*(r*o[2]+c)]},a.hcg.hsv=function(e){const t=e[1]/100,r=t+e[2]/100*(1-t);let n=0;return r>0&&(n=t/r),[e[0],100*n,100*r]},a.hcg.hsl=function(e){const t=e[1]/100,r=e[2]/100*(1-t)+.5*t;let n=0;return r>0&&r<.5?n=t/(2*r):r>=.5&&r<1&&(n=t/(2*(1-r))),[e[0],100*n,100*r]},a.hcg.hwb=function(e){const t=e[1]/100,r=t+e[2]/100*(1-t);return[e[0],100*(r-t),100*(1-r)]},a.hwb.hcg=function(e){const t=e[1]/100,r=1-e[2]/100,n=r-t;let o=0;return n<1&&(o=(r-n)/(1-n)),[e[0],100*n,100*o]},a.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},a.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},a.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},a.gray.hsl=function(e){return[0,0,e[0]]},a.gray.hsv=a.gray.hsl,a.gray.hwb=function(e){return[0,100,e[0]]},a.gray.cmyk=function(e){return[0,0,0,e[0]]},a.gray.lab=function(e){return[e[0],0,0]},a.gray.hex=function(e){const t=255&Math.round(e[0]/100*255),r=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(r.length)+r},a.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},99047:(e,t,r)=>{const n=r(59246),o=r(30802),a={};Object.keys(n).forEach((e=>{a[e]={},Object.defineProperty(a[e],"channels",{value:n[e].channels}),Object.defineProperty(a[e],"labels",{value:n[e].labels});const t=o(e);Object.keys(t).forEach((r=>{const n=t[r];a[e][r]=function(e){const t=function(...t){const r=t[0];if(null==r)return r;r.length>1&&(t=r);const n=e(t);if("object"==typeof n)for(let e=n.length,t=0;t<e;t++)n[t]=Math.round(n[t]);return n};return"conversion"in e&&(t.conversion=e.conversion),t}(n),a[e][r].raw=function(e){const t=function(...t){const r=t[0];return null==r?r:(r.length>1&&(t=r),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(n)}))})),e.exports=a},30802:(e,t,r)=>{const n=r(59246);function o(e,t){return function(r){return t(e(r))}}function a(e,t){const r=[t[e].parent,e];let a=n[t[e].parent][e],i=t[e].parent;for(;t[i].parent;)r.unshift(t[i].parent),a=o(n[t[i].parent][i],a),i=t[i].parent;return a.conversion=r,a}e.exports=function(e){const t=function(e){const t=function(){const e={},t=Object.keys(n);for(let r=t.length,n=0;n<r;n++)e[t[n]]={distance:-1,parent:null};return e}(),r=[e];for(t[e].distance=0;r.length;){const e=r.pop(),o=Object.keys(n[e]);for(let n=o.length,a=0;a<n;a++){const n=o[a],i=t[n];-1===i.distance&&(i.distance=t[e].distance+1,i.parent=e,r.unshift(n))}}return t}(e),r={},o=Object.keys(t);for(let e=o.length,n=0;n<e;n++){const e=o[n];null!==t[e].parent&&(r[e]=a(e,t))}return r}},76931:e=>{"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},28605:e=>{"use strict";var t="%[a-f0-9]{2}",r=new RegExp("("+t+")|([^%]+?)","gi"),n=new RegExp("("+t+")+","gi");function o(e,t){try{return[decodeURIComponent(e.join(""))]}catch(e){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],o(r),o(n))}function a(e){try{return decodeURIComponent(e)}catch(a){for(var t=e.match(r)||[],n=1;n<t.length;n++)t=(e=o(t,n).join("")).match(r)||[];return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=n.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch(e){var o=a(r[0]);o!==r[0]&&(t[r[0]]=o)}r=n.exec(e)}t["%C2"]="�";for(var i=Object.keys(t),s=0;s<i.length;s++){var c=i[s];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}}},90028:e=>{"use strict";e.exports=function(e,t){for(var r={},n=Object.keys(e),o=Array.isArray(t),a=0;a<n.length;a++){var i=n[a],s=e[i];(o?-1!==t.indexOf(i):t(i,s,e))&&(r[i]=s)}return r}},78958:e=>{"use strict";e.exports=function(e,t,r,n,o,a,i,s){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[r,n,o,a,i,s],u=0;(c=new Error(t.replace(/%s/g,(function(){return l[u++]})))).name="Invariant Violation"}throw c.framesToPop=1,c}}},57224:e=>{e.exports=function(e,t){return function r(){null==t&&(t=e.length);var n=[].slice.call(arguments);return n.length>=t?e.apply(this,n):function(){return r.apply(this,n.concat([].slice.call(arguments)))}}}},33103:(e,t,r)=>{var n=r(94715)(r(78942),"DataView");e.exports=n},25098:(e,t,r)=>{var n=r(23305),o=r(39361),a=r(11112),i=r(25276),s=r(57452);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=o,c.prototype.get=a,c.prototype.has=i,c.prototype.set=s,e.exports=c},57553:(e,t,r)=>{var n=r(39747),o=r(75962);function a(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}a.prototype=n(o.prototype),a.prototype.constructor=a,e.exports=a},1386:(e,t,r)=>{var n=r(12393),o=r(62049),a=r(7144),i=r(7452),s=r(13964);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=o,c.prototype.get=a,c.prototype.has=i,c.prototype.set=s,e.exports=c},528:(e,t,r)=>{var n=r(39747),o=r(75962);function a(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}a.prototype=n(o.prototype),a.prototype.constructor=a,e.exports=a},19770:(e,t,r)=>{var n=r(94715)(r(78942),"Map");e.exports=n},68250:(e,t,r)=>{var n=r(49753),o=r(5681),a=r(80088),i=r(54732),s=r(59068);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=o,c.prototype.get=a,c.prototype.has=i,c.prototype.set=s,e.exports=c},89413:(e,t,r)=>{var n=r(94715)(r(78942),"Promise");e.exports=n},64512:(e,t,r)=>{var n=r(94715)(r(78942),"Set");e.exports=n},23212:(e,t,r)=>{var n=r(68250),o=r(1877),a=r(8006);function i(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new n;++t<r;)this.add(e[t])}i.prototype.add=i.prototype.push=o,i.prototype.has=a,e.exports=i},51340:(e,t,r)=>{var n=r(1386),o=r(64103),a=r(21779),i=r(34162),s=r(7462),c=r(96638);function l(e){var t=this.__data__=new n(e);this.size=t.size}l.prototype.clear=o,l.prototype.delete=a,l.prototype.get=i,l.prototype.has=s,l.prototype.set=c,e.exports=l},65650:(e,t,r)=>{var n=r(78942).Symbol;e.exports=n},31623:(e,t,r)=>{var n=r(78942).Uint8Array;e.exports=n},19270:(e,t,r)=>{var n=r(94715)(r(78942),"WeakMap");e.exports=n},86912:e=>{e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},79968:e=>{e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}},79847:e=>{e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a}},59756:(e,t,r)=>{var n=r(2478);e.exports=function(e,t){return!(null==e||!e.length)&&n(e,t,0)>-1}},43316:e=>{e.exports=function(e,t,r){for(var n=-1,o=null==e?0:e.length;++n<o;)if(r(t,e[n]))return!0;return!1}},10358:(e,t,r)=>{var n=r(26137),o=r(3283),a=r(53142),i=r(75853),s=r(69632),c=r(8666),l=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=a(e),u=!r&&o(e),d=!r&&!u&&i(e),f=!r&&!u&&!d&&c(e),p=r||u||d||f,g=p?n(e.length,String):[],E=g.length;for(var _ in e)!t&&!l.call(e,_)||p&&("length"==_||d&&("offset"==_||"parent"==_)||f&&("buffer"==_||"byteLength"==_||"byteOffset"==_)||s(_,E))||g.push(_);return g}},65111:e=>{e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}},11129:e=>{e.exports=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}},36465:e=>{e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}},52837:e=>{e.exports=function(e){return e.split("")}},24810:(e,t,r)=>{var n=r(57073),o=r(46285);e.exports=function(e,t,r){(void 0!==r&&!o(e[t],r)||void 0===r&&!(t in e))&&n(e,t,r)}},3422:(e,t,r)=>{var n=r(57073),o=r(46285),a=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){var i=e[t];a.call(e,t)&&o(i,r)&&(void 0!==r||t in e)||n(e,t,r)}},97034:(e,t,r)=>{var n=r(46285);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},37930:(e,t,r)=>{var n=r(39032),o=r(81211);e.exports=function(e,t){return e&&n(t,o(t),e)}},30125:(e,t,r)=>{var n=r(39032),o=r(25288);e.exports=function(e,t){return e&&n(t,o(t),e)}},57073:(e,t,r)=>{var n=r(72532);e.exports=function(e,t,r){"__proto__"==t&&n?n(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}},69334:(e,t,r)=>{var n=r(51340),o=r(79968),a=r(3422),i=r(37930),s=r(30125),c=r(17099),l=r(84354),u=r(83546),d=r(24733),f=r(80393),p=r(93650),g=r(28486),E=r(97350),_=r(50424),y=r(75964),v=r(53142),S=r(75853),O=r(37681),h=r(41580),T=r(83943),I=r(81211),C=r(25288),m="[object Arguments]",A="[object Function]",b="[object Object]",R={};R[m]=R["[object Array]"]=R["[object ArrayBuffer]"]=R["[object DataView]"]=R["[object Boolean]"]=R["[object Date]"]=R["[object Float32Array]"]=R["[object Float64Array]"]=R["[object Int8Array]"]=R["[object Int16Array]"]=R["[object Int32Array]"]=R["[object Map]"]=R["[object Number]"]=R[b]=R["[object RegExp]"]=R["[object Set]"]=R["[object String]"]=R["[object Symbol]"]=R["[object Uint8Array]"]=R["[object Uint8ClampedArray]"]=R["[object Uint16Array]"]=R["[object Uint32Array]"]=!0,R["[object Error]"]=R[A]=R["[object WeakMap]"]=!1,e.exports=function e(t,r,N,P,w,M){var L,D=1&r,k=2&r,j=4&r;if(N&&(L=w?N(t,P,w,M):N(t)),void 0!==L)return L;if(!h(t))return t;var F=v(t);if(F){if(L=E(t),!D)return l(t,L)}else{var x=g(t),H=x==A||"[object GeneratorFunction]"==x;if(S(t))return c(t,D);if(x==b||x==m||H&&!w){if(L=k||H?{}:y(t),!D)return k?d(t,s(L,t)):u(t,i(L,t))}else{if(!R[x])return w?t:{};L=_(t,x,D)}}M||(M=new n);var U=M.get(t);if(U)return U;M.set(t,L),T(t)?t.forEach((function(n){L.add(e(n,r,N,n,t,M))})):O(t)&&t.forEach((function(n,o){L.set(o,e(n,r,N,o,t,M))}));var W=F?void 0:(j?k?p:f:k?C:I)(t);return o(W||t,(function(n,o){W&&(n=t[o=n]),a(L,o,e(n,r,N,o,t,M))})),L}},39747:(e,t,r)=>{var n=r(41580),o=Object.create,a=function(){function e(){}return function(t){if(!n(t))return{};if(o)return o(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();e.exports=a},96576:(e,t,r)=>{var n=r(23212),o=r(59756),a=r(43316),i=r(65111),s=r(49460),c=r(65568);e.exports=function(e,t,r,l){var u=-1,d=o,f=!0,p=e.length,g=[],E=t.length;if(!p)return g;r&&(t=i(t,s(r))),l?(d=a,f=!1):t.length>=200&&(d=c,f=!1,t=new n(t));e:for(;++u<p;){var _=e[u],y=null==r?_:r(_);if(_=l||0!==_?_:0,f&&y==y){for(var v=E;v--;)if(t[v]===y)continue e;g.push(_)}else d(t,y,l)||g.push(_)}return g}},84570:(e,t,r)=>{var n=r(47170),o=r(45770)(n);e.exports=o},37250:e=>{e.exports=function(e,t,r,n){for(var o=e.length,a=r+(n?1:-1);n?a--:++a<o;)if(t(e[a],a,e))return a;return-1}},90313:(e,t,r)=>{var n=r(11129),o=r(20714);e.exports=function e(t,r,a,i,s){var c=-1,l=t.length;for(a||(a=o),s||(s=[]);++c<l;){var u=t[c];r>0&&a(u)?r>1?e(u,r-1,a,i,s):n(s,u):i||(s[s.length]=u)}return s}},35636:(e,t,r)=>{var n=r(86596)();e.exports=n},47170:(e,t,r)=>{var n=r(35636),o=r(81211);e.exports=function(e,t){return e&&n(e,t,o)}},57923:(e,t,r)=>{var n=r(93526),o=r(66040);e.exports=function(e,t){for(var r=0,a=(t=n(t,e)).length;null!=e&&r<a;)e=e[o(t[r++])];return r&&r==a?e:void 0}},48244:(e,t,r)=>{var n=r(11129),o=r(53142);e.exports=function(e,t,r){var a=t(e);return o(e)?a:n(a,r(e))}},87379:(e,t,r)=>{var n=r(65650),o=r(8870),a=r(29005),i=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?o(e):a(e)}},43636:e=>{e.exports=function(e,t){return null!=e&&t in Object(e)}},2478:(e,t,r)=>{var n=r(37250),o=r(69454),a=r(97706);e.exports=function(e,t,r){return t==t?a(e,t,r):n(e,o,r)}},56027:(e,t,r)=>{var n=r(87379),o=r(80547);e.exports=function(e){return o(e)&&"[object Arguments]"==n(e)}},94687:(e,t,r)=>{var n=r(90353),o=r(80547);e.exports=function e(t,r,a,i,s){return t===r||(null==t||null==r||!o(t)&&!o(r)?t!=t&&r!=r:n(t,r,a,i,e,s))}},90353:(e,t,r)=>{var n=r(51340),o=r(33934),a=r(88861),i=r(31182),s=r(28486),c=r(53142),l=r(75853),u=r(8666),d="[object Arguments]",f="[object Array]",p="[object Object]",g=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,E,_,y){var v=c(e),S=c(t),O=v?f:s(e),h=S?f:s(t),T=(O=O==d?p:O)==p,I=(h=h==d?p:h)==p,C=O==h;if(C&&l(e)){if(!l(t))return!1;v=!0,T=!1}if(C&&!T)return y||(y=new n),v||u(e)?o(e,t,r,E,_,y):a(e,t,O,r,E,_,y);if(!(1&r)){var m=T&&g.call(e,"__wrapped__"),A=I&&g.call(t,"__wrapped__");if(m||A){var b=m?e.value():e,R=A?t.value():t;return y||(y=new n),_(b,R,r,E,y)}}return!!C&&(y||(y=new n),i(e,t,r,E,_,y))}},80777:(e,t,r)=>{var n=r(28486),o=r(80547);e.exports=function(e){return o(e)&&"[object Map]"==n(e)}},38330:(e,t,r)=>{var n=r(51340),o=r(94687);e.exports=function(e,t,r,a){var i=r.length,s=i,c=!a;if(null==e)return!s;for(e=Object(e);i--;){var l=r[i];if(c&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++i<s;){var u=(l=r[i])[0],d=e[u],f=l[1];if(c&&l[2]){if(void 0===d&&!(u in e))return!1}else{var p=new n;if(a)var g=a(d,f,u,e,t,p);if(!(void 0===g?o(f,d,3,a,p):g))return!1}}return!0}},69454:e=>{e.exports=function(e){return e!=e}},89624:(e,t,r)=>{var n=r(93655),o=r(64759),a=r(41580),i=r(64066),s=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,u=c.toString,d=l.hasOwnProperty,f=RegExp("^"+u.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||o(e))&&(n(e)?f:s).test(i(e))}},81935:(e,t,r)=>{var n=r(28486),o=r(80547);e.exports=function(e){return o(e)&&"[object Set]"==n(e)}},70674:(e,t,r)=>{var n=r(87379),o=r(65387),a=r(80547),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&o(e.length)&&!!i[n(e)]}},3334:(e,t,r)=>{var n=r(36526),o=r(12343),a=r(22053),i=r(53142),s=r(43282);e.exports=function(e){return"function"==typeof e?e:null==e?a:"object"==typeof e?i(e)?o(e[0],e[1]):n(e):s(e)}},195:(e,t,r)=>{var n=r(84882),o=r(98121),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return o(e);var t=[];for(var r in Object(e))a.call(e,r)&&"constructor"!=r&&t.push(r);return t}},57200:(e,t,r)=>{var n=r(41580),o=r(84882),a=r(38546),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return a(e);var t=o(e),r=[];for(var s in e)("constructor"!=s||!t&&i.call(e,s))&&r.push(s);return r}},75962:e=>{e.exports=function(){}},41393:(e,t,r)=>{var n=r(84570),o=r(36529);e.exports=function(e,t){var r=-1,a=o(e)?Array(e.length):[];return n(e,(function(e,n,o){a[++r]=t(e,n,o)})),a}},36526:(e,t,r)=>{var n=r(38330),o=r(24367),a=r(23904);e.exports=function(e){var t=o(e);return 1==t.length&&t[0][2]?a(t[0][0],t[0][1]):function(r){return r===e||n(r,e,t)}}},12343:(e,t,r)=>{var n=r(94687),o=r(46123),a=r(27276),i=r(65187),s=r(67267),c=r(23904),l=r(66040);e.exports=function(e,t){return i(e)&&s(t)?c(l(e),t):function(r){var i=o(r,e);return void 0===i&&i===t?a(r,e):n(t,i,3)}}},40091:(e,t,r)=>{var n=r(51340),o=r(24810),a=r(35636),i=r(26885),s=r(41580),c=r(25288),l=r(78763);e.exports=function e(t,r,u,d,f){t!==r&&a(r,(function(a,c){if(f||(f=new n),s(a))i(t,r,c,u,e,d,f);else{var p=d?d(l(t,c),a,c+"",t,r,f):void 0;void 0===p&&(p=a),o(t,c,p)}}),c)}},26885:(e,t,r)=>{var n=r(24810),o=r(17099),a=r(92264),i=r(84354),s=r(75964),c=r(3283),l=r(53142),u=r(65406),d=r(75853),f=r(93655),p=r(41580),g=r(48360),E=r(8666),_=r(78763),y=r(64207);e.exports=function(e,t,r,v,S,O,h){var T=_(e,r),I=_(t,r),C=h.get(I);if(C)n(e,r,C);else{var m=O?O(T,I,r+"",e,t,h):void 0,A=void 0===m;if(A){var b=l(I),R=!b&&d(I),N=!b&&!R&&E(I);m=I,b||R||N?l(T)?m=T:u(T)?m=i(T):R?(A=!1,m=o(I,!0)):N?(A=!1,m=a(I,!0)):m=[]:g(I)||c(I)?(m=T,c(T)?m=y(T):p(T)&&!f(T)||(m=s(I))):A=!1}A&&(h.set(I,m),S(m,I,v,O,h),h.delete(I)),n(e,r,m)}}},70310:(e,t,r)=>{var n=r(65111),o=r(57923),a=r(3334),i=r(41393),s=r(50642),c=r(49460),l=r(46775),u=r(22053),d=r(53142);e.exports=function(e,t,r){t=t.length?n(t,(function(e){return d(e)?function(t){return o(t,1===e.length?e[0]:e)}:e})):[u];var f=-1;t=n(t,c(a));var p=i(e,(function(e,r,o){return{criteria:n(t,(function(t){return t(e)})),index:++f,value:e}}));return s(p,(function(e,t){return l(e,t,r)}))}},12762:e=>{e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},98880:(e,t,r)=>{var n=r(57923);e.exports=function(e){return function(t){return n(t,e)}}},16653:(e,t,r)=>{var n=r(81586),o=r(69632),a=Array.prototype.splice;e.exports=function(e,t){for(var r=e?t.length:0,i=r-1;r--;){var s=t[r];if(r==i||s!==c){var c=s;o(s)?a.call(e,s,1):n(e,s)}}return e}},23945:(e,t,r)=>{var n=r(22053),o=r(75234),a=r(80796);e.exports=function(e,t){return a(o(e,t,n),e+"")}},87655:(e,t,r)=>{var n=r(3422),o=r(93526),a=r(69632),i=r(41580),s=r(66040);e.exports=function(e,t,r,c){if(!i(e))return e;for(var l=-1,u=(t=o(t,e)).length,d=u-1,f=e;null!=f&&++l<u;){var p=s(t[l]),g=r;if("__proto__"===p||"constructor"===p||"prototype"===p)return e;if(l!=d){var E=f[p];void 0===(g=c?c(E,p,f):void 0)&&(g=i(E)?E:a(t[l+1])?[]:{})}n(f,p,g),f=f[p]}return e}},4943:(e,t,r)=>{var n=r(22053),o=r(46065),a=o?function(e,t){return o.set(e,t),e}:n;e.exports=a},47403:(e,t,r)=>{var n=r(82619),o=r(72532),a=r(22053),i=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:a;e.exports=i},73501:e=>{e.exports=function(e,t,r){var n=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(r=r>o?o:r)<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(o);++n<o;)a[n]=e[n+t];return a}},50642:e=>{e.exports=function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}},26137:e=>{e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},63435:(e,t,r)=>{var n=r(51187);e.exports=function(e){return"number"==typeof e?e:n(e)?NaN:+e}},52291:(e,t,r)=>{var n=r(65650),o=r(65111),a=r(53142),i=r(51187),s=n?n.prototype:void 0,c=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(a(t))return o(t,e)+"";if(i(t))return c?c.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r}},86403:(e,t,r)=>{var n=r(62945),o=/^\s+/;e.exports=function(e){return e?e.slice(0,n(e)+1).replace(o,""):e}},49460:e=>{e.exports=function(e){return function(t){return e(t)}}},15630:(e,t,r)=>{var n=r(23212),o=r(59756),a=r(43316),i=r(65568),s=r(36208),c=r(49828);e.exports=function(e,t,r){var l=-1,u=o,d=e.length,f=!0,p=[],g=p;if(r)f=!1,u=a;else if(d>=200){var E=t?null:s(e);if(E)return c(E);f=!1,u=i,g=new n}else g=t?[]:p;e:for(;++l<d;){var _=e[l],y=t?t(_):_;if(_=r||0!==_?_:0,f&&y==y){for(var v=g.length;v--;)if(g[v]===y)continue e;t&&g.push(y),p.push(_)}else u(g,y,r)||(g!==p&&g.push(y),p.push(_))}return p}},81586:(e,t,r)=>{var n=r(93526),o=r(98087),a=r(13398),i=r(66040);e.exports=function(e,t){return t=n(t,e),null==(e=a(e,t))||delete e[i(o(t))]}},53674:(e,t,r)=>{var n=r(57923),o=r(87655);e.exports=function(e,t,r,a){return o(e,t,r(n(e,t)),a)}},3905:(e,t,r)=>{var n=r(65111);e.exports=function(e,t){return n(t,(function(t){return e[t]}))}},65568:e=>{e.exports=function(e,t){return e.has(t)}},23997:(e,t,r)=>{var n=r(22053);e.exports=function(e){return"function"==typeof e?e:n}},93526:(e,t,r)=>{var n=r(53142),o=r(65187),a=r(96493),i=r(95243);e.exports=function(e,t){return n(e)?e:o(e,t)?[e]:a(i(e))}},28931:(e,t,r)=>{var n=r(73501);e.exports=function(e,t,r){var o=e.length;return r=void 0===r?o:r,!t&&r>=o?e:n(e,t,r)}},28774:(e,t,r)=>{var n=r(2478);e.exports=function(e,t){for(var r=e.length;r--&&n(t,e[r],0)>-1;);return r}},17905:(e,t,r)=>{var n=r(2478);e.exports=function(e,t){for(var r=-1,o=e.length;++r<o&&n(t,e[r],0)>-1;);return r}},58898:(e,t,r)=>{var n=r(31623);e.exports=function(e){var t=new e.constructor(e.byteLength);return new n(t).set(new n(e)),t}},17099:(e,t,r)=>{e=r.nmd(e);var n=r(78942),o=t&&!t.nodeType&&t,a=o&&e&&!e.nodeType&&e,i=a&&a.exports===o?n.Buffer:void 0,s=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=s?s(r):new e.constructor(r);return e.copy(n),n}},92480:(e,t,r)=>{var n=r(58898);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}},78340:e=>{var t=/\w*$/;e.exports=function(e){var r=new e.constructor(e.source,t.exec(e));return r.lastIndex=e.lastIndex,r}},18069:(e,t,r)=>{var n=r(65650),o=n?n.prototype:void 0,a=o?o.valueOf:void 0;e.exports=function(e){return a?Object(a.call(e)):{}}},92264:(e,t,r)=>{var n=r(58898);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}},63521:(e,t,r)=>{var n=r(51187);e.exports=function(e,t){if(e!==t){var r=void 0!==e,o=null===e,a=e==e,i=n(e),s=void 0!==t,c=null===t,l=t==t,u=n(t);if(!c&&!u&&!i&&e>t||i&&s&&l&&!c&&!u||o&&s&&l||!r&&l||!a)return 1;if(!o&&!i&&!u&&e<t||u&&r&&a&&!o&&!i||c&&r&&a||!s&&a||!l)return-1}return 0}},46775:(e,t,r)=>{var n=r(63521);e.exports=function(e,t,r){for(var o=-1,a=e.criteria,i=t.criteria,s=a.length,c=r.length;++o<s;){var l=n(a[o],i[o]);if(l)return o>=c?l:l*("desc"==r[o]?-1:1)}return e.index-t.index}},4977:e=>{var t=Math.max;e.exports=function(e,r,n,o){for(var a=-1,i=e.length,s=n.length,c=-1,l=r.length,u=t(i-s,0),d=Array(l+u),f=!o;++c<l;)d[c]=r[c];for(;++a<s;)(f||a<i)&&(d[n[a]]=e[a]);for(;u--;)d[c++]=e[a++];return d}},85755:e=>{var t=Math.max;e.exports=function(e,r,n,o){for(var a=-1,i=e.length,s=-1,c=n.length,l=-1,u=r.length,d=t(i-c,0),f=Array(d+u),p=!o;++a<d;)f[a]=e[a];for(var g=a;++l<u;)f[g+l]=r[l];for(;++s<c;)(p||a<i)&&(f[g+n[s]]=e[a++]);return f}},84354:e=>{e.exports=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}},39032:(e,t,r)=>{var n=r(3422),o=r(57073);e.exports=function(e,t,r,a){var i=!r;r||(r={});for(var s=-1,c=t.length;++s<c;){var l=t[s],u=a?a(r[l],e[l],l,r,e):void 0;void 0===u&&(u=e[l]),i?o(r,l,u):n(r,l,u)}return r}},83546:(e,t,r)=>{var n=r(39032),o=r(77979);e.exports=function(e,t){return n(e,o(e),t)}},24733:(e,t,r)=>{var n=r(39032),o=r(85832);e.exports=function(e,t){return n(e,o(e),t)}},41950:(e,t,r)=>{var n=r(78942)["__core-js_shared__"];e.exports=n},3816:e=>{e.exports=function(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}},77848:(e,t,r)=>{var n=r(23945),o=r(74535);e.exports=function(e){return n((function(t,r){var n=-1,a=r.length,i=a>1?r[a-1]:void 0,s=a>2?r[2]:void 0;for(i=e.length>3&&"function"==typeof i?(a--,i):void 0,s&&o(r[0],r[1],s)&&(i=a<3?void 0:i,a=1),t=Object(t);++n<a;){var c=r[n];c&&e(t,c,n,i)}return t}))}},45770:(e,t,r)=>{var n=r(36529);e.exports=function(e,t){return function(r,o){if(null==r)return r;if(!n(r))return e(r,o);for(var a=r.length,i=t?a:-1,s=Object(r);(t?i--:++i<a)&&!1!==o(s[i],i,s););return r}}},86596:e=>{e.exports=function(e){return function(t,r,n){for(var o=-1,a=Object(t),i=n(t),s=i.length;s--;){var c=i[e?s:++o];if(!1===r(a[c],c,a))break}return t}}},56713:(e,t,r)=>{var n=r(64364),o=r(78942);e.exports=function(e,t,r){var a=1&t,i=n(e);return function t(){return(this&&this!==o&&this instanceof t?i:e).apply(a?r:this,arguments)}}},64364:(e,t,r)=>{var n=r(39747),o=r(41580);e.exports=function(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=n(e.prototype),a=e.apply(r,t);return o(a)?a:r}}},42443:(e,t,r)=>{var n=r(86912),o=r(64364),a=r(23504),i=r(34216),s=r(36850),c=r(8813),l=r(78942);e.exports=function(e,t,r){var u=o(e);return function o(){for(var d=arguments.length,f=Array(d),p=d,g=s(o);p--;)f[p]=arguments[p];var E=d<3&&f[0]!==g&&f[d-1]!==g?[]:c(f,g);return(d-=E.length)<r?i(e,t,a,o.placeholder,void 0,f,E,void 0,void 0,r-d):n(this&&this!==l&&this instanceof o?u:e,this,f)}}},77317:(e,t,r)=>{var n=r(3334),o=r(36529),a=r(81211);e.exports=function(e){return function(t,r,i){var s=Object(t);if(!o(t)){var c=n(r,3);t=a(t),r=function(e){return c(s[e],e,s)}}var l=e(t,r,i);return l>-1?s[c?t[l]:l]:void 0}}},51942:(e,t,r)=>{var n=r(528),o=r(41439),a=r(65196),i=r(50961),s=r(53142),c=r(46648);e.exports=function(e){return o((function(t){var r=t.length,o=r,l=n.prototype.thru;for(e&&t.reverse();o--;){var u=t[o];if("function"!=typeof u)throw new TypeError("Expected a function");if(l&&!d&&"wrapper"==i(u))var d=new n([],!0)}for(o=d?o:r;++o<r;){u=t[o];var f=i(u),p="wrapper"==f?a(u):void 0;d=p&&c(p[0])&&424==p[1]&&!p[4].length&&1==p[9]?d[i(p[0])].apply(d,p[3]):1==u.length&&c(u)?d[f]():d.thru(u)}return function(){var e=arguments,n=e[0];if(d&&1==e.length&&s(n))return d.plant(n).value();for(var o=0,a=r?t[o].apply(this,e):n;++o<r;)a=t[o].call(this,a);return a}}))}},23504:(e,t,r)=>{var n=r(4977),o=r(85755),a=r(3816),i=r(64364),s=r(34216),c=r(36850),l=r(26591),u=r(8813),d=r(78942);e.exports=function e(t,r,f,p,g,E,_,y,v,S){var O=128&r,h=1&r,T=2&r,I=24&r,C=512&r,m=T?void 0:i(t);return function A(){for(var b=arguments.length,R=Array(b),N=b;N--;)R[N]=arguments[N];if(I)var P=c(A),w=a(R,P);if(p&&(R=n(R,p,g,I)),E&&(R=o(R,E,_,I)),b-=w,I&&b<S){var M=u(R,P);return s(t,r,e,A.placeholder,f,R,M,y,v,S-b)}var L=h?f:this,D=T?L[t]:t;return b=R.length,y?R=l(R,y):C&&b>1&&R.reverse(),O&&v<b&&(R.length=v),this&&this!==d&&this instanceof A&&(D=m||i(D)),D.apply(L,R)}}},54883:(e,t,r)=>{var n=r(63435),o=r(52291);e.exports=function(e,t){return function(r,a){var i;if(void 0===r&&void 0===a)return t;if(void 0!==r&&(i=r),void 0!==a){if(void 0===i)return a;"string"==typeof r||"string"==typeof a?(r=o(r),a=o(a)):(r=n(r),a=n(a)),i=e(r,a)}return i}}},56341:(e,t,r)=>{var n=r(86912),o=r(64364),a=r(78942);e.exports=function(e,t,r,i){var s=1&t,c=o(e);return function t(){for(var o=-1,l=arguments.length,u=-1,d=i.length,f=Array(d+l),p=this&&this!==a&&this instanceof t?c:e;++u<d;)f[u]=i[u];for(;l--;)f[u++]=arguments[++o];return n(p,s?r:this,f)}}},34216:(e,t,r)=>{var n=r(46648),o=r(65512),a=r(5620);e.exports=function(e,t,r,i,s,c,l,u,d,f){var p=8&t;t|=p?32:64,4&(t&=~(p?64:32))||(t&=-4);var g=[e,t,s,p?c:void 0,p?l:void 0,p?void 0:c,p?void 0:l,u,d,f],E=r.apply(void 0,g);return n(e)&&o(E,g),E.placeholder=i,a(E,e,t)}},36208:(e,t,r)=>{var n=r(64512),o=r(79071),a=r(49828),i=n&&1/a(new n([,-0]))[1]==1/0?function(e){return new n(e)}:o;e.exports=i},58638:(e,t,r)=>{var n=r(4943),o=r(56713),a=r(42443),i=r(23504),s=r(56341),c=r(65196),l=r(47028),u=r(65512),d=r(5620),f=r(67642),p=Math.max;e.exports=function(e,t,r,g,E,_,y,v){var S=2&t;if(!S&&"function"!=typeof e)throw new TypeError("Expected a function");var O=g?g.length:0;if(O||(t&=-97,g=E=void 0),y=void 0===y?y:p(f(y),0),v=void 0===v?v:f(v),O-=E?E.length:0,64&t){var h=g,T=E;g=E=void 0}var I=S?void 0:c(e),C=[e,t,r,g,E,h,T,_,y,v];if(I&&l(C,I),e=C[0],t=C[1],r=C[2],g=C[3],E=C[4],!(v=C[9]=void 0===C[9]?S?0:e.length:p(C[9]-O,0))&&24&t&&(t&=-25),t&&1!=t)m=8==t||16==t?a(e,t,v):32!=t&&33!=t||E.length?i.apply(void 0,C):s(e,t,r,g);else var m=o(e,t,r);return d((I?n:u)(m,C),e,t)}},52107:(e,t,r)=>{var n=r(40091),o=r(41580);e.exports=function e(t,r,a,i,s,c){return o(t)&&o(r)&&(c.set(r,t),n(t,r,void 0,e,c),c.delete(r)),t}},29259:(e,t,r)=>{var n=r(48360);e.exports=function(e){return n(e)?void 0:e}},72532:(e,t,r)=>{var n=r(94715),o=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},33934:(e,t,r)=>{var n=r(23212),o=r(36465),a=r(65568);e.exports=function(e,t,r,i,s,c){var l=1&r,u=e.length,d=t.length;if(u!=d&&!(l&&d>u))return!1;var f=c.get(e),p=c.get(t);if(f&&p)return f==t&&p==e;var g=-1,E=!0,_=2&r?new n:void 0;for(c.set(e,t),c.set(t,e);++g<u;){var y=e[g],v=t[g];if(i)var S=l?i(v,y,g,t,e,c):i(y,v,g,e,t,c);if(void 0!==S){if(S)continue;E=!1;break}if(_){if(!o(t,(function(e,t){if(!a(_,t)&&(y===e||s(y,e,r,i,c)))return _.push(t)}))){E=!1;break}}else if(y!==v&&!s(y,v,r,i,c)){E=!1;break}}return c.delete(e),c.delete(t),E}},88861:(e,t,r)=>{var n=r(65650),o=r(31623),a=r(46285),i=r(33934),s=r(95894),c=r(49828),l=n?n.prototype:void 0,u=l?l.valueOf:void 0;e.exports=function(e,t,r,n,l,d,f){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!d(new o(e),new o(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return a(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var p=s;case"[object Set]":var g=1&n;if(p||(p=c),e.size!=t.size&&!g)return!1;var E=f.get(e);if(E)return E==t;n|=2,f.set(e,t);var _=i(p(e),p(t),n,l,d,f);return f.delete(e),_;case"[object Symbol]":if(u)return u.call(e)==u.call(t)}return!1}},31182:(e,t,r)=>{var n=r(80393),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,a,i,s){var c=1&r,l=n(e),u=l.length;if(u!=n(t).length&&!c)return!1;for(var d=u;d--;){var f=l[d];if(!(c?f in t:o.call(t,f)))return!1}var p=s.get(e),g=s.get(t);if(p&&g)return p==t&&g==e;var E=!0;s.set(e,t),s.set(t,e);for(var _=c;++d<u;){var y=e[f=l[d]],v=t[f];if(a)var S=c?a(v,y,f,t,e,s):a(y,v,f,e,t,s);if(!(void 0===S?y===v||i(y,v,r,a,s):S)){E=!1;break}_||(_="constructor"==f)}if(E&&!_){var O=e.constructor,h=t.constructor;O==h||!("constructor"in e)||!("constructor"in t)||"function"==typeof O&&O instanceof O&&"function"==typeof h&&h instanceof h||(E=!1)}return s.delete(e),s.delete(t),E}},41439:(e,t,r)=>{var n=r(75857),o=r(75234),a=r(80796);e.exports=function(e){return a(o(e,void 0,n),e+"")}},74967:(e,t,r)=>{var n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=n},80393:(e,t,r)=>{var n=r(48244),o=r(77979),a=r(81211);e.exports=function(e){return n(e,a,o)}},93650:(e,t,r)=>{var n=r(48244),o=r(85832),a=r(25288);e.exports=function(e){return n(e,a,o)}},65196:(e,t,r)=>{var n=r(46065),o=r(79071),a=n?function(e){return n.get(e)}:o;e.exports=a},50961:(e,t,r)=>{var n=r(83476),o=Object.prototype.hasOwnProperty;e.exports=function(e){for(var t=e.name+"",r=n[t],a=o.call(n,t)?r.length:0;a--;){var i=r[a],s=i.func;if(null==s||s==e)return i.name}return t}},36850:e=>{e.exports=function(e){return e.placeholder}},44700:(e,t,r)=>{var n=r(79067);e.exports=function(e,t){var r=e.__data__;return n(t)?r["string"==typeof t?"string":"hash"]:r.map}},24367:(e,t,r)=>{var n=r(67267),o=r(81211);e.exports=function(e){for(var t=o(e),r=t.length;r--;){var a=t[r],i=e[a];t[r]=[a,i,n(i)]}return t}},94715:(e,t,r)=>{var n=r(89624),o=r(20155);e.exports=function(e,t){var r=o(e,t);return n(r)?r:void 0}},74784:(e,t,r)=>{var n=r(3766)(Object.getPrototypeOf,Object);e.exports=n},8870:(e,t,r)=>{var n=r(65650),o=Object.prototype,a=o.hasOwnProperty,i=o.toString,s=n?n.toStringTag:void 0;e.exports=function(e){var t=a.call(e,s),r=e[s];try{e[s]=void 0;var n=!0}catch(e){}var o=i.call(e);return n&&(t?e[s]=r:delete e[s]),o}},77979:(e,t,r)=>{var n=r(79847),o=r(99306),a=Object.prototype.propertyIsEnumerable,i=Object.getOwnPropertySymbols,s=i?function(e){return null==e?[]:(e=Object(e),n(i(e),(function(t){return a.call(e,t)})))}:o;e.exports=s},85832:(e,t,r)=>{var n=r(11129),o=r(74784),a=r(77979),i=r(99306),s=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)n(t,a(e)),e=o(e);return t}:i;e.exports=s},28486:(e,t,r)=>{var n=r(33103),o=r(19770),a=r(89413),i=r(64512),s=r(19270),c=r(87379),l=r(64066),u="[object Map]",d="[object Promise]",f="[object Set]",p="[object WeakMap]",g="[object DataView]",E=l(n),_=l(o),y=l(a),v=l(i),S=l(s),O=c;(n&&O(new n(new ArrayBuffer(1)))!=g||o&&O(new o)!=u||a&&O(a.resolve())!=d||i&&O(new i)!=f||s&&O(new s)!=p)&&(O=function(e){var t=c(e),r="[object Object]"==t?e.constructor:void 0,n=r?l(r):"";if(n)switch(n){case E:return g;case _:return u;case y:return d;case v:return f;case S:return p}return t}),e.exports=O},20155:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},98788:e=>{var t=/\{\n\/\* \[wrapped with (.+)\] \*/,r=/,? & /;e.exports=function(e){var n=e.match(t);return n?n[1].split(r):[]}},85899:(e,t,r)=>{var n=r(93526),o=r(3283),a=r(53142),i=r(69632),s=r(65387),c=r(66040);e.exports=function(e,t,r){for(var l=-1,u=(t=n(t,e)).length,d=!1;++l<u;){var f=c(t[l]);if(!(d=null!=e&&r(e,f)))break;e=e[f]}return d||++l!=u?d:!!(u=null==e?0:e.length)&&s(u)&&i(f,u)&&(a(e)||o(e))}},83417:e=>{var t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return t.test(e)}},23305:(e,t,r)=>{var n=r(94497);e.exports=function(){this.__data__=n?n(null):{},this.size=0}},39361:e=>{e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},11112:(e,t,r)=>{var n=r(94497),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(n){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return o.call(t,e)?t[e]:void 0}},25276:(e,t,r)=>{var n=r(94497),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:o.call(t,e)}},57452:(e,t,r)=>{var n=r(94497);e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n&&void 0===t?"__lodash_hash_undefined__":t,this}},97350:e=>{var t=Object.prototype.hasOwnProperty;e.exports=function(e){var r=e.length,n=new e.constructor(r);return r&&"string"==typeof e[0]&&t.call(e,"index")&&(n.index=e.index,n.input=e.input),n}},50424:(e,t,r)=>{var n=r(58898),o=r(92480),a=r(78340),i=r(18069),s=r(92264);e.exports=function(e,t,r){var c=e.constructor;switch(t){case"[object ArrayBuffer]":return n(e);case"[object Boolean]":case"[object Date]":return new c(+e);case"[object DataView]":return o(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(e,r);case"[object Map]":case"[object Set]":return new c;case"[object Number]":case"[object String]":return new c(e);case"[object RegExp]":return a(e);case"[object Symbol]":return i(e)}}},75964:(e,t,r)=>{var n=r(39747),o=r(74784),a=r(84882);e.exports=function(e){return"function"!=typeof e.constructor||a(e)?{}:n(o(e))}},49141:e=>{var t=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;e.exports=function(e,r){var n=r.length;if(!n)return e;var o=n-1;return r[o]=(n>1?"& ":"")+r[o],r=r.join(n>2?", ":" "),e.replace(t,"{\n/* [wrapped with "+r+"] */\n")}},20714:(e,t,r)=>{var n=r(65650),o=r(3283),a=r(53142),i=n?n.isConcatSpreadable:void 0;e.exports=function(e){return a(e)||o(e)||!!(i&&e&&e[i])}},69632:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,r){var n=typeof e;return!!(r=null==r?9007199254740991:r)&&("number"==n||"symbol"!=n&&t.test(e))&&e>-1&&e%1==0&&e<r}},74535:(e,t,r)=>{var n=r(46285),o=r(36529),a=r(69632),i=r(41580);e.exports=function(e,t,r){if(!i(r))return!1;var s=typeof t;return!!("number"==s?o(r)&&a(t,r.length):"string"==s&&t in r)&&n(r[t],e)}},65187:(e,t,r)=>{var n=r(53142),o=r(51187),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,i=/^\w*$/;e.exports=function(e,t){if(n(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!o(e))||i.test(e)||!a.test(e)||null!=t&&e in Object(t)}},79067:e=>{e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},46648:(e,t,r)=>{var n=r(57553),o=r(65196),a=r(50961),i=r(93321);e.exports=function(e){var t=a(e),r=i[t];if("function"!=typeof r||!(t in n.prototype))return!1;if(e===r)return!0;var s=o(r);return!!s&&e===s[0]}},64759:(e,t,r)=>{var n,o=r(41950),a=(n=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!a&&a in e}},84882:e=>{var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},67267:(e,t,r)=>{var n=r(41580);e.exports=function(e){return e==e&&!n(e)}},12393:e=>{e.exports=function(){this.__data__=[],this.size=0}},62049:(e,t,r)=>{var n=r(97034),o=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=n(t,e);return!(r<0||(r==t.length-1?t.pop():o.call(t,r,1),--this.size,0))}},7144:(e,t,r)=>{var n=r(97034);e.exports=function(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}},7452:(e,t,r)=>{var n=r(97034);e.exports=function(e){return n(this.__data__,e)>-1}},13964:(e,t,r)=>{var n=r(97034);e.exports=function(e,t){var r=this.__data__,o=n(r,e);return o<0?(++this.size,r.push([e,t])):r[o][1]=t,this}},49753:(e,t,r)=>{var n=r(25098),o=r(1386),a=r(19770);e.exports=function(){this.size=0,this.__data__={hash:new n,map:new(a||o),string:new n}}},5681:(e,t,r)=>{var n=r(44700);e.exports=function(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}},80088:(e,t,r)=>{var n=r(44700);e.exports=function(e){return n(this,e).get(e)}},54732:(e,t,r)=>{var n=r(44700);e.exports=function(e){return n(this,e).has(e)}},59068:(e,t,r)=>{var n=r(44700);e.exports=function(e,t){var r=n(this,e),o=r.size;return r.set(e,t),this.size+=r.size==o?0:1,this}},95894:e=>{e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}},23904:e=>{e.exports=function(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}}},76853:(e,t,r)=>{var n=r(69011);e.exports=function(e){var t=n(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}},47028:(e,t,r)=>{var n=r(4977),o=r(85755),a=r(8813),i="__lodash_placeholder__",s=Math.min;e.exports=function(e,t){var r=e[1],c=t[1],l=r|c,u=l<131,d=128==c&&8==r||128==c&&256==r&&e[7].length<=t[8]||384==c&&t[7].length<=t[8]&&8==r;if(!u&&!d)return e;1&c&&(e[2]=t[2],l|=1&r?0:4);var f=t[3];if(f){var p=e[3];e[3]=p?n(p,f,t[4]):f,e[4]=p?a(e[3],i):t[4]}return(f=t[5])&&(p=e[5],e[5]=p?o(p,f,t[6]):f,e[6]=p?a(e[5],i):t[6]),(f=t[7])&&(e[7]=f),128&c&&(e[8]=null==e[8]?t[8]:s(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}},46065:(e,t,r)=>{var n=r(19270),o=n&&new n;e.exports=o},94497:(e,t,r)=>{var n=r(94715)(Object,"create");e.exports=n},98121:(e,t,r)=>{var n=r(3766)(Object.keys,Object);e.exports=n},38546:e=>{e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},2306:(e,t,r)=>{e=r.nmd(e);var n=r(74967),o=t&&!t.nodeType&&t,a=o&&e&&!e.nodeType&&e,i=a&&a.exports===o&&n.process,s=function(){try{return a&&a.require&&a.require("util").types||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=s},29005:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},3766:e=>{e.exports=function(e,t){return function(r){return e(t(r))}}},75234:(e,t,r)=>{var n=r(86912),o=Math.max;e.exports=function(e,t,r){return t=o(void 0===t?e.length-1:t,0),function(){for(var a=arguments,i=-1,s=o(a.length-t,0),c=Array(s);++i<s;)c[i]=a[t+i];i=-1;for(var l=Array(t+1);++i<t;)l[i]=a[i];return l[t]=r(c),n(e,this,l)}}},13398:(e,t,r)=>{var n=r(57923),o=r(73501);e.exports=function(e,t){return t.length<2?e:n(e,o(t,0,-1))}},83476:e=>{e.exports={}},26591:(e,t,r)=>{var n=r(84354),o=r(69632),a=Math.min;e.exports=function(e,t){for(var r=e.length,i=a(t.length,r),s=n(e);i--;){var c=t[i];e[i]=o(c,r)?s[c]:void 0}return e}},8813:e=>{var t="__lodash_placeholder__";e.exports=function(e,r){for(var n=-1,o=e.length,a=0,i=[];++n<o;){var s=e[n];s!==r&&s!==t||(e[n]=t,i[a++]=n)}return i}},78942:(e,t,r)=>{var n=r(74967),o="object"==typeof self&&self&&self.Object===Object&&self,a=n||o||Function("return this")();e.exports=a},78763:e=>{e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},1877:e=>{e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},8006:e=>{e.exports=function(e){return this.__data__.has(e)}},65512:(e,t,r)=>{var n=r(4943),o=r(3316)(n);e.exports=o},49828:e=>{e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}},80796:(e,t,r)=>{var n=r(47403),o=r(3316)(n);e.exports=o},5620:(e,t,r)=>{var n=r(98788),o=r(49141),a=r(80796),i=r(60033);e.exports=function(e,t,r){var s=t+"";return a(e,o(s,i(n(s),r)))}},3316:e=>{var t=Date.now;e.exports=function(e){var r=0,n=0;return function(){var o=t(),a=16-(o-n);if(n=o,a>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},64103:(e,t,r)=>{var n=r(1386);e.exports=function(){this.__data__=new n,this.size=0}},21779:e=>{e.exports=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}},34162:e=>{e.exports=function(e){return this.__data__.get(e)}},7462:e=>{e.exports=function(e){return this.__data__.has(e)}},96638:(e,t,r)=>{var n=r(1386),o=r(19770),a=r(68250);e.exports=function(e,t){var r=this.__data__;if(r instanceof n){var i=r.__data__;if(!o||i.length<199)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new a(i)}return r.set(e,t),this.size=r.size,this}},97706:e=>{e.exports=function(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1}},82237:(e,t,r)=>{var n=r(52837),o=r(83417),a=r(92013);e.exports=function(e){return o(e)?a(e):n(e)}},96493:(e,t,r)=>{var n=r(76853),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,i=n((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(o,(function(e,r,n,o){t.push(n?o.replace(a,"$1"):r||e)})),t}));e.exports=i},66040:(e,t,r)=>{var n=r(51187);e.exports=function(e){if("string"==typeof e||n(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},64066:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},62945:e=>{var t=/\s/;e.exports=function(e){for(var r=e.length;r--&&t.test(e.charAt(r)););return r}},92013:e=>{var t="\\ud800-\\udfff",r="["+t+"]",n="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",o="\\ud83c[\\udffb-\\udfff]",a="[^"+t+"]",i="(?:\\ud83c[\\udde6-\\uddff]){2}",s="[\\ud800-\\udbff][\\udc00-\\udfff]",c="(?:"+n+"|"+o+")?",l="[\\ufe0e\\ufe0f]?",u=l+c+"(?:\\u200d(?:"+[a,i,s].join("|")+")"+l+c+")*",d="(?:"+[a+n+"?",n,i,s,r].join("|")+")",f=RegExp(o+"(?="+o+")|"+d+u,"g");e.exports=function(e){return e.match(f)||[]}},60033:(e,t,r)=>{var n=r(79968),o=r(59756),a=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];e.exports=function(e,t){return n(a,(function(r){var n="_."+r[0];t&r[1]&&!o(e,n)&&e.push(n)})),e.sort()}},63410:(e,t,r)=>{var n=r(57553),o=r(528),a=r(84354);e.exports=function(e){if(e instanceof n)return e.clone();var t=new o(e.__wrapped__,e.__chain__);return t.__actions__=a(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}},26744:(e,t,r)=>{var n=r(54883)((function(e,t){return e+t}),0);e.exports=n},45353:(e,t,r)=>{var n=r(58638);e.exports=function(e,t,r){return t=r?void 0:t,t=e&&null==t?e.length:t,n(e,128,void 0,void 0,void 0,void 0,t)}},72846:(e,t,r)=>{var n=r(69334);e.exports=function(e){return n(e,4)}},46108:(e,t,r)=>{var n=r(69334);e.exports=function(e){return n(e,5)}},64871:(e,t,r)=>{var n=r(11129),o=r(90313),a=r(84354),i=r(53142);e.exports=function(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),r=arguments[0],s=e;s--;)t[s-1]=arguments[s];return n(i(r)?a(r):[r],o(t,1))}},82619:e=>{e.exports=function(e){return function(){return e}}},37336:(e,t,r)=>{var n=r(58638);function o(e,t,r){var a=n(e,8,void 0,void 0,void 0,void 0,void 0,t=r?void 0:t);return a.placeholder=o.placeholder,a}o.placeholder={},e.exports=o},12784:(e,t,r)=>{var n=r(41580),o=r(94495),a=r(6131),i=Math.max,s=Math.min;e.exports=function(e,t,r){var c,l,u,d,f,p,g=0,E=!1,_=!1,y=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function v(t){var r=c,n=l;return c=l=void 0,g=t,d=e.apply(n,r)}function S(e){var r=e-p;return void 0===p||r>=t||r<0||_&&e-g>=u}function O(){var e=o();if(S(e))return h(e);f=setTimeout(O,function(e){var r=t-(e-p);return _?s(r,u-(e-g)):r}(e))}function h(e){return f=void 0,y&&c?v(e):(c=l=void 0,d)}function T(){var e=o(),r=S(e);if(c=arguments,l=this,p=e,r){if(void 0===f)return function(e){return g=e,f=setTimeout(O,t),E?v(e):d}(p);if(_)return clearTimeout(f),f=setTimeout(O,t),v(p)}return void 0===f&&(f=setTimeout(O,t)),d}return t=a(t)||0,n(r)&&(E=!!r.leading,u=(_="maxWait"in r)?i(a(r.maxWait)||0,t):u,y="trailing"in r?!!r.trailing:y),T.cancel=function(){void 0!==f&&clearTimeout(f),g=0,c=p=l=f=void 0},T.flush=function(){return void 0===f?d:h(o())},T}},32293:(e,t,r)=>{var n=r(23945),o=r(46285),a=r(74535),i=r(25288),s=Object.prototype,c=s.hasOwnProperty,l=n((function(e,t){e=Object(e);var r=-1,n=t.length,l=n>2?t[2]:void 0;for(l&&a(t[0],t[1],l)&&(n=1);++r<n;)for(var u=t[r],d=i(u),f=-1,p=d.length;++f<p;){var g=d[f],E=e[g];(void 0===E||o(E,s[g])&&!c.call(e,g))&&(e[g]=u[g])}return e}));e.exports=l},69383:(e,t,r)=>{var n=r(86912),o=r(23945),a=r(52107),i=r(48875),s=o((function(e){return e.push(void 0,a),n(i,void 0,e)}));e.exports=s},65707:(e,t,r)=>{var n=r(96576),o=r(90313),a=r(23945),i=r(65406),s=a((function(e,t){return i(e)?n(e,o(t,1,i,!0)):[]}));e.exports=s},46285:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},81936:(e,t,r)=>{var n=r(77317)(r(92154));e.exports=n},92154:(e,t,r)=>{var n=r(37250),o=r(3334),a=r(67642),i=Math.max;e.exports=function(e,t,r){var s=null==e?0:e.length;if(!s)return-1;var c=null==r?0:a(r);return c<0&&(c=i(s+c,0)),n(e,o(t,3),c)}},66652:(e,t,r)=>{var n=r(90313),o=r(40105);e.exports=function(e,t){return n(o(e,t),1)}},75857:(e,t,r)=>{var n=r(90313);e.exports=function(e){return null!=e&&e.length?n(e,1):[]}},73741:(e,t,r)=>{var n=r(51942)(!0);e.exports=n},25666:(e,t,r)=>{e.exports=r(22991)},93579:(e,t,r)=>{var n=r(43565),o=r(22991),a=Array.prototype.push;function i(e,t){return 2==t?function(t,r){return e(t,r)}:function(t){return e(t)}}function s(e){for(var t=e?e.length:0,r=Array(t);t--;)r[t]=e[t];return r}function c(e,t){return function(){var r=arguments.length;if(r){for(var n=Array(r);r--;)n[r]=arguments[r];var o=n[0]=t.apply(void 0,n);return e.apply(void 0,n),o}}}e.exports=function e(t,r,l,u){var d="function"==typeof r,f=r===Object(r);if(f&&(u=l,l=r,r=void 0),null==l)throw new TypeError;u||(u={});var p={cap:!("cap"in u)||u.cap,curry:!("curry"in u)||u.curry,fixed:!("fixed"in u)||u.fixed,immutable:!("immutable"in u)||u.immutable,rearg:!("rearg"in u)||u.rearg},g=d?l:o,E="curry"in u&&u.curry,_="fixed"in u&&u.fixed,y="rearg"in u&&u.rearg,v=d?l.runInContext():void 0,S=d?l:{ary:t.ary,assign:t.assign,clone:t.clone,curry:t.curry,forEach:t.forEach,isArray:t.isArray,isError:t.isError,isFunction:t.isFunction,isWeakMap:t.isWeakMap,iteratee:t.iteratee,keys:t.keys,rearg:t.rearg,toInteger:t.toInteger,toPath:t.toPath},O=S.ary,h=S.assign,T=S.clone,I=S.curry,C=S.forEach,m=S.isArray,A=S.isError,b=S.isFunction,R=S.isWeakMap,N=S.keys,P=S.rearg,w=S.toInteger,M=S.toPath,L=N(n.aryMethod),D={castArray:function(e){return function(){var t=arguments[0];return m(t)?e(s(t)):e.apply(void 0,arguments)}},iteratee:function(e){return function(){var t=arguments[1],r=e(arguments[0],t),n=r.length;return p.cap&&"number"==typeof t?(t=t>2?t-2:1,n&&n<=t?r:i(r,t)):r}},mixin:function(e){return function(t){var r=this;if(!b(r))return e(r,Object(t));var n=[];return C(N(t),(function(e){b(t[e])&&n.push([e,r.prototype[e]])})),e(r,Object(t)),C(n,(function(e){var t=e[1];b(t)?r.prototype[e[0]]=t:delete r.prototype[e[0]]})),r}},nthArg:function(e){return function(t){var r=t<0?1:w(t)+1;return I(e(t),r)}},rearg:function(e){return function(t,r){var n=r?r.length:0;return I(e(t,r),n)}},runInContext:function(r){return function(n){return e(t,r(n),u)}}};function k(e,t,r){if(p.fixed&&(_||!n.skipFixed[e])){var o=n.methodSpread[e],i=o&&o.start;return void 0===i?O(t,r):function(e,t){return function(){for(var r=arguments.length,n=r-1,o=Array(r);r--;)o[r]=arguments[r];var i=o[t],s=o.slice(0,t);return i&&a.apply(s,i),t!=n&&a.apply(s,o.slice(t+1)),e.apply(this,s)}}(t,i)}return t}function j(e,t,r){return p.rearg&&r>1&&(y||!n.skipRearg[e])?P(t,n.methodRearg[e]||n.aryRearg[r]):t}function F(e,t){for(var r=-1,n=(t=M(t)).length,o=n-1,a=T(Object(e)),i=a;null!=i&&++r<n;){var s=t[r],c=i[s];null==c||b(c)||A(c)||R(c)||(i[s]=T(r==o?c:Object(c))),i=i[s]}return a}function x(t,r){var o=n.aliasToReal[t]||t,a=n.remap[o]||o,i=u;return function(t){var n=d?v:S,s=d?v[a]:r,c=h(h({},i),t);return e(n,o,s,c)}}function H(e,t){return function(){var r=arguments.length;if(!r)return e();for(var n=Array(r);r--;)n[r]=arguments[r];var o=p.rearg?0:r-1;return n[o]=t(n[o]),e.apply(void 0,n)}}function U(e,t,r){var o,a=n.aliasToReal[e]||e,l=t,u=D[a];return u?l=u(t):p.immutable&&(n.mutate.array[a]?l=c(t,s):n.mutate.object[a]?l=c(t,function(e){return function(t){return e({},t)}}(t)):n.mutate.set[a]&&(l=c(t,F))),C(L,(function(e){return C(n.aryMethod[e],(function(t){if(a==t){var r=n.methodSpread[a],s=r&&r.afterRearg;return o=s?k(a,j(a,l,e),e):j(a,k(a,l,e),e),o=function(e,t,r){return E||p.curry&&r>1?I(t,r):t}(0,o=function(e,t){if(p.cap){var r=n.iterateeRearg[e];if(r)return function(e,t){return H(e,(function(e){var r=t.length;return function(e,t){return 2==t?function(t,r){return e.apply(void 0,arguments)}:function(t){return e.apply(void 0,arguments)}}(P(i(e,r),t),r)}))}(t,r);var o=!d&&n.iterateeAry[e];if(o)return function(e,t){return H(e,(function(e){return"function"==typeof e?i(e,t):e}))}(t,o)}return t}(a,o),e),!1}})),!o})),o||(o=l),o==t&&(o=E?I(o,1):function(){return t.apply(this,arguments)}),o.convert=x(a,t),o.placeholder=t.placeholder=r,o}if(!f)return U(r,l,g);var W=l,G=[];return C(L,(function(e){C(n.aryMethod[e],(function(e){var t=W[n.remap[e]||e];t&&G.push([e,U(e,t,W)])}))})),C(N(W),(function(e){var t=W[e];if("function"==typeof t){for(var r=G.length;r--;)if(G[r][0]==e)return;t.convert=x(e,t),G.push([e,t])}})),C(G,(function(e){W[e[0]]=e[1]})),W.convert=function(e){return W.runInContext.convert(e)(void 0)},W.placeholder=W,C(N(W),(function(e){C(n.realToAlias[e]||[],(function(t){W[t]=W[e]}))})),W}},76648:e=>{e.exports={cap:!1,curry:!1,fixed:!1,immutable:!1,rearg:!1}},43565:(e,t)=>{t.aliasToReal={each:"forEach",eachRight:"forEachRight",entries:"toPairs",entriesIn:"toPairsIn",extend:"assignIn",extendAll:"assignInAll",extendAllWith:"assignInAllWith",extendWith:"assignInWith",first:"head",conforms:"conformsTo",matches:"isMatch",property:"get",__:"placeholder",F:"stubFalse",T:"stubTrue",all:"every",allPass:"overEvery",always:"constant",any:"some",anyPass:"overSome",apply:"spread",assoc:"set",assocPath:"set",complement:"negate",compose:"flowRight",contains:"includes",dissoc:"unset",dissocPath:"unset",dropLast:"dropRight",dropLastWhile:"dropRightWhile",equals:"isEqual",identical:"eq",indexBy:"keyBy",init:"initial",invertObj:"invert",juxt:"over",omitAll:"omit",nAry:"ary",path:"get",pathEq:"matchesProperty",pathOr:"getOr",paths:"at",pickAll:"pick",pipe:"flow",pluck:"map",prop:"get",propEq:"matchesProperty",propOr:"getOr",props:"at",symmetricDifference:"xor",symmetricDifferenceBy:"xorBy",symmetricDifferenceWith:"xorWith",takeLast:"takeRight",takeLastWhile:"takeRightWhile",unapply:"rest",unnest:"flatten",useWith:"overArgs",where:"conformsTo",whereEq:"isMatch",zipObj:"zipObject"},t.aryMethod={1:["assignAll","assignInAll","attempt","castArray","ceil","create","curry","curryRight","defaultsAll","defaultsDeepAll","floor","flow","flowRight","fromPairs","invert","iteratee","memoize","method","mergeAll","methodOf","mixin","nthArg","over","overEvery","overSome","rest","reverse","round","runInContext","spread","template","trim","trimEnd","trimStart","uniqueId","words","zipAll"],2:["add","after","ary","assign","assignAllWith","assignIn","assignInAllWith","at","before","bind","bindAll","bindKey","chunk","cloneDeepWith","cloneWith","concat","conformsTo","countBy","curryN","curryRightN","debounce","defaults","defaultsDeep","defaultTo","delay","difference","divide","drop","dropRight","dropRightWhile","dropWhile","endsWith","eq","every","filter","find","findIndex","findKey","findLast","findLastIndex","findLastKey","flatMap","flatMapDeep","flattenDepth","forEach","forEachRight","forIn","forInRight","forOwn","forOwnRight","get","groupBy","gt","gte","has","hasIn","includes","indexOf","intersection","invertBy","invoke","invokeMap","isEqual","isMatch","join","keyBy","lastIndexOf","lt","lte","map","mapKeys","mapValues","matchesProperty","maxBy","meanBy","merge","mergeAllWith","minBy","multiply","nth","omit","omitBy","overArgs","pad","padEnd","padStart","parseInt","partial","partialRight","partition","pick","pickBy","propertyOf","pull","pullAll","pullAt","random","range","rangeRight","rearg","reject","remove","repeat","restFrom","result","sampleSize","some","sortBy","sortedIndex","sortedIndexOf","sortedLastIndex","sortedLastIndexOf","sortedUniqBy","split","spreadFrom","startsWith","subtract","sumBy","take","takeRight","takeRightWhile","takeWhile","tap","throttle","thru","times","trimChars","trimCharsEnd","trimCharsStart","truncate","union","uniqBy","uniqWith","unset","unzipWith","without","wrap","xor","zip","zipObject","zipObjectDeep"],3:["assignInWith","assignWith","clamp","differenceBy","differenceWith","findFrom","findIndexFrom","findLastFrom","findLastIndexFrom","getOr","includesFrom","indexOfFrom","inRange","intersectionBy","intersectionWith","invokeArgs","invokeArgsMap","isEqualWith","isMatchWith","flatMapDepth","lastIndexOfFrom","mergeWith","orderBy","padChars","padCharsEnd","padCharsStart","pullAllBy","pullAllWith","rangeStep","rangeStepRight","reduce","reduceRight","replace","set","slice","sortedIndexBy","sortedLastIndexBy","transform","unionBy","unionWith","update","xorBy","xorWith","zipWith"],4:["fill","setWith","updateWith"]},t.aryRearg={2:[1,0],3:[2,0,1],4:[3,2,0,1]},t.iterateeAry={dropRightWhile:1,dropWhile:1,every:1,filter:1,find:1,findFrom:1,findIndex:1,findIndexFrom:1,findKey:1,findLast:1,findLastFrom:1,findLastIndex:1,findLastIndexFrom:1,findLastKey:1,flatMap:1,flatMapDeep:1,flatMapDepth:1,forEach:1,forEachRight:1,forIn:1,forInRight:1,forOwn:1,forOwnRight:1,map:1,mapKeys:1,mapValues:1,partition:1,reduce:2,reduceRight:2,reject:1,remove:1,some:1,takeRightWhile:1,takeWhile:1,times:1,transform:2},t.iterateeRearg={mapKeys:[1],reduceRight:[1,0]},t.methodRearg={assignInAllWith:[1,0],assignInWith:[1,2,0],assignAllWith:[1,0],assignWith:[1,2,0],differenceBy:[1,2,0],differenceWith:[1,2,0],getOr:[2,1,0],intersectionBy:[1,2,0],intersectionWith:[1,2,0],isEqualWith:[1,2,0],isMatchWith:[2,1,0],mergeAllWith:[1,0],mergeWith:[1,2,0],padChars:[2,1,0],padCharsEnd:[2,1,0],padCharsStart:[2,1,0],pullAllBy:[2,1,0],pullAllWith:[2,1,0],rangeStep:[1,2,0],rangeStepRight:[1,2,0],setWith:[3,1,2,0],sortedIndexBy:[2,1,0],sortedLastIndexBy:[2,1,0],unionBy:[1,2,0],unionWith:[1,2,0],updateWith:[3,1,2,0],xorBy:[1,2,0],xorWith:[1,2,0],zipWith:[1,2,0]},t.methodSpread={assignAll:{start:0},assignAllWith:{start:0},assignInAll:{start:0},assignInAllWith:{start:0},defaultsAll:{start:0},defaultsDeepAll:{start:0},invokeArgs:{start:2},invokeArgsMap:{start:2},mergeAll:{start:0},mergeAllWith:{start:0},partial:{start:1},partialRight:{start:1},without:{start:1},zipAll:{start:0}},t.mutate={array:{fill:!0,pull:!0,pullAll:!0,pullAllBy:!0,pullAllWith:!0,pullAt:!0,remove:!0,reverse:!0},object:{assign:!0,assignAll:!0,assignAllWith:!0,assignIn:!0,assignInAll:!0,assignInAllWith:!0,assignInWith:!0,assignWith:!0,defaults:!0,defaultsAll:!0,defaultsDeep:!0,defaultsDeepAll:!0,merge:!0,mergeAll:!0,mergeAllWith:!0,mergeWith:!0},set:{set:!0,setWith:!0,unset:!0,update:!0,updateWith:!0}},t.realToAlias=function(){var e=Object.prototype.hasOwnProperty,r=t.aliasToReal,n={};for(var o in r){var a=r[o];e.call(n,a)?n[a].push(o):n[a]=[o]}return n}(),t.remap={assignAll:"assign",assignAllWith:"assignWith",assignInAll:"assignIn",assignInAllWith:"assignInWith",curryN:"curry",curryRightN:"curryRight",defaultsAll:"defaults",defaultsDeepAll:"defaultsDeep",findFrom:"find",findIndexFrom:"findIndex",findLastFrom:"findLast",findLastIndexFrom:"findLastIndex",getOr:"get",includesFrom:"includes",indexOfFrom:"indexOf",invokeArgs:"invoke",invokeArgsMap:"invokeMap",lastIndexOfFrom:"lastIndexOf",mergeAll:"merge",mergeAllWith:"mergeWith",padChars:"pad",padCharsEnd:"padEnd",padCharsStart:"padStart",propertyOf:"get",rangeStep:"range",rangeStepRight:"rangeRight",restFrom:"rest",spreadFrom:"spread",trimChars:"trim",trimCharsEnd:"trimEnd",trimCharsStart:"trimStart",zipAll:"zip"},t.skipFixed={castArray:!0,flow:!0,flowRight:!0,iteratee:!0,mixin:!0,rearg:!0,runInContext:!0},t.skipRearg={add:!0,assign:!0,assignIn:!0,bind:!0,bindKey:!0,concat:!0,difference:!0,divide:!0,eq:!0,gt:!0,gte:!0,isEqual:!0,lt:!0,lte:!0,matchesProperty:!0,merge:!0,multiply:!0,overArgs:!0,partial:!0,partialRight:!0,propertyOf:!0,random:!0,range:!0,rangeRight:!0,subtract:!0,zip:!0,zipObject:!0,zipObjectDeep:!0}},48055:(e,t,r)=>{e.exports={ary:r(45353),assign:r(37930),clone:r(72846),curry:r(37336),forEach:r(79968),isArray:r(53142),isError:r(60441),isFunction:r(93655),isWeakMap:r(67769),iteratee:r(32590),keys:r(195),rearg:r(864),toInteger:r(67642),toPath:r(42613)}},20481:(e,t,r)=>{var n=r(92673)("add",r(26744));n.placeholder=r(22991),e.exports=n},89321:(e,t,r)=>{var n=r(92673)("cloneDeep",r(46108),r(76648));n.placeholder=r(22991),e.exports=n},93054:(e,t,r)=>{e.exports=r(91856)},35968:(e,t,r)=>{var n=r(92673)("concat",r(64871));n.placeholder=r(22991),e.exports=n},82549:(e,t,r)=>{e.exports=r(50593)},92673:(e,t,r)=>{var n=r(93579),o=r(48055);e.exports=function(e,t,r){return n(o,e,t,r)}},4255:(e,t,r)=>{var n=r(92673)("debounce",r(12784));n.placeholder=r(22991),e.exports=n},38142:(e,t,r)=>{var n=r(92673)("defaults",r(32293));n.placeholder=r(22991),e.exports=n},1036:(e,t,r)=>{var n=r(92673)("defaultsDeep",r(69383));n.placeholder=r(22991),e.exports=n},37011:(e,t,r)=>{var n=r(92673)("difference",r(65707));n.placeholder=r(22991),e.exports=n},5215:(e,t,r)=>{var n=r(92673)("find",r(81936));n.placeholder=r(22991),e.exports=n},8637:(e,t,r)=>{var n=r(92673)("flatMap",r(66652));n.placeholder=r(22991),e.exports=n},91856:(e,t,r)=>{var n=r(92673)("flowRight",r(73741));n.placeholder=r(22991),e.exports=n},50593:(e,t,r)=>{var n=r(92673)("includes",r(87526));n.placeholder=r(22991),e.exports=n},90283:(e,t,r)=>{var n=r(92673)("isArray",r(53142),r(76648));n.placeholder=r(22991),e.exports=n},22202:(e,t,r)=>{var n=r(92673)("isElement",r(59191),r(76648));n.placeholder=r(22991),e.exports=n},84499:(e,t,r)=>{var n=r(92673)("isEmpty",r(3514),r(76648));n.placeholder=r(22991),e.exports=n},36582:(e,t,r)=>{var n=r(92673)("isEqual",r(46343));n.placeholder=r(22991),e.exports=n},30524:(e,t,r)=>{var n=r(92673)("isFunction",r(93655),r(76648));n.placeholder=r(22991),e.exports=n},7977:(e,t,r)=>{var n=r(92673)("isNil",r(3668),r(76648));n.placeholder=r(22991),e.exports=n},64181:(e,t,r)=>{var n=r(92673)("isNull",r(49310),r(76648));n.placeholder=r(22991),e.exports=n},17174:(e,t,r)=>{var n=r(92673)("isNumber",r(60986),r(76648));n.placeholder=r(22991),e.exports=n},36705:(e,t,r)=>{var n=r(92673)("isPlainObject",r(48360),r(76648));n.placeholder=r(22991),e.exports=n},73173:(e,t,r)=>{var n=r(92673)("isString",r(8138),r(76648));n.placeholder=r(22991),e.exports=n},54502:(e,t,r)=>{var n=r(92673)("isUndefined",r(58771),r(76648));n.placeholder=r(22991),e.exports=n},80880:(e,t,r)=>{var n=r(92673)("join",r(9991));n.placeholder=r(22991),e.exports=n},5968:(e,t,r)=>{var n=r(92673)("map",r(40105));n.placeholder=r(22991),e.exports=n},96042:(e,t,r)=>{var n=r(92673)("merge",r(82451));n.placeholder=r(22991),e.exports=n},81175:(e,t,r)=>{var n=r(92673)("mergeAllWith",r(48875));n.placeholder=r(22991),e.exports=n},14017:(e,t,r)=>{var n=r(92673)("omit",r(3326));n.placeholder=r(22991),e.exports=n},97679:(e,t,r)=>{var n=r(92673)("partial",r(50578));n.placeholder=r(22991),e.exports=n},22991:e=>{e.exports={}},90636:(e,t,r)=>{var n=r(92673)("remove",r(65079));n.placeholder=r(22991),e.exports=n},27748:(e,t,r)=>{var n=r(92673)("reverse",r(6609));n.placeholder=r(22991),e.exports=n},15353:(e,t,r)=>{var n=r(92673)("sortBy",r(40074));n.placeholder=r(22991),e.exports=n},59419:(e,t,r)=>{var n=r(92673)("trimCharsStart",r(90959));n.placeholder=r(22991),e.exports=n},68015:(e,t,r)=>{var n=r(92673)("trimEnd",r(17426));n.placeholder=r(22991),e.exports=n},43813:(e,t,r)=>{var n=r(92673)("union",r(55620));n.placeholder=r(22991),e.exports=n},3e4:(e,t,r)=>{var n=r(92673)("unionBy",r(74133));n.placeholder=r(22991),e.exports=n},37273:(e,t,r)=>{var n=r(92673)("unionWith",r(77484));n.placeholder=r(22991),e.exports=n},65891:(e,t,r)=>{var n=r(92673)("unset",r(73450));n.placeholder=r(22991),e.exports=n},49549:(e,t,r)=>{var n=r(92673)("update",r(29570));n.placeholder=r(22991),e.exports=n},30186:(e,t,r)=>{var n=r(92673)("values",r(39817),r(76648));n.placeholder=r(22991),e.exports=n},6022:(e,t,r)=>{var n=r(92673)("without",r(30795));n.placeholder=r(22991),e.exports=n},46123:(e,t,r)=>{var n=r(57923);e.exports=function(e,t,r){var o=null==e?void 0:n(e,t);return void 0===o?r:o}},27276:(e,t,r)=>{var n=r(43636),o=r(85899);e.exports=function(e,t){return null!=e&&o(e,t,n)}},22053:e=>{e.exports=function(e){return e}},87526:(e,t,r)=>{var n=r(2478),o=r(36529),a=r(8138),i=r(67642),s=r(39817),c=Math.max;e.exports=function(e,t,r,l){e=o(e)?e:s(e),r=r&&!l?i(r):0;var u=e.length;return r<0&&(r=c(u+r,0)),a(e)?r<=u&&e.indexOf(t,r)>-1:!!u&&n(e,t,r)>-1}},3283:(e,t,r)=>{var n=r(56027),o=r(80547),a=Object.prototype,i=a.hasOwnProperty,s=a.propertyIsEnumerable,c=n(function(){return arguments}())?n:function(e){return o(e)&&i.call(e,"callee")&&!s.call(e,"callee")};e.exports=c},53142:e=>{var t=Array.isArray;e.exports=t},36529:(e,t,r)=>{var n=r(93655),o=r(65387);e.exports=function(e){return null!=e&&o(e.length)&&!n(e)}},65406:(e,t,r)=>{var n=r(36529),o=r(80547);e.exports=function(e){return o(e)&&n(e)}},75853:(e,t,r)=>{e=r.nmd(e);var n=r(78942),o=r(34772),a=t&&!t.nodeType&&t,i=a&&e&&!e.nodeType&&e,s=i&&i.exports===a?n.Buffer:void 0,c=(s?s.isBuffer:void 0)||o;e.exports=c},59191:(e,t,r)=>{var n=r(80547),o=r(48360);e.exports=function(e){return n(e)&&1===e.nodeType&&!o(e)}},3514:(e,t,r)=>{var n=r(195),o=r(28486),a=r(3283),i=r(53142),s=r(36529),c=r(75853),l=r(84882),u=r(8666),d=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(s(e)&&(i(e)||"string"==typeof e||"function"==typeof e.splice||c(e)||u(e)||a(e)))return!e.length;var t=o(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(l(e))return!n(e).length;for(var r in e)if(d.call(e,r))return!1;return!0}},46343:(e,t,r)=>{var n=r(94687);e.exports=function(e,t){return n(e,t)}},60441:(e,t,r)=>{var n=r(87379),o=r(80547),a=r(48360);e.exports=function(e){if(!o(e))return!1;var t=n(e);return"[object Error]"==t||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!a(e)}},93655:(e,t,r)=>{var n=r(87379),o=r(41580);e.exports=function(e){if(!o(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},65387:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},37681:(e,t,r)=>{var n=r(80777),o=r(49460),a=r(2306),i=a&&a.isMap,s=i?o(i):n;e.exports=s},3668:e=>{e.exports=function(e){return null==e}},49310:e=>{e.exports=function(e){return null===e}},60986:(e,t,r)=>{var n=r(87379),o=r(80547);e.exports=function(e){return"number"==typeof e||o(e)&&"[object Number]"==n(e)}},41580:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},80547:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},48360:(e,t,r)=>{var n=r(87379),o=r(74784),a=r(80547),i=Function.prototype,s=Object.prototype,c=i.toString,l=s.hasOwnProperty,u=c.call(Object);e.exports=function(e){if(!a(e)||"[object Object]"!=n(e))return!1;var t=o(e);if(null===t)return!0;var r=l.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&c.call(r)==u}},83943:(e,t,r)=>{var n=r(81935),o=r(49460),a=r(2306),i=a&&a.isSet,s=i?o(i):n;e.exports=s},8138:(e,t,r)=>{var n=r(87379),o=r(53142),a=r(80547);e.exports=function(e){return"string"==typeof e||!o(e)&&a(e)&&"[object String]"==n(e)}},51187:(e,t,r)=>{var n=r(87379),o=r(80547);e.exports=function(e){return"symbol"==typeof e||o(e)&&"[object Symbol]"==n(e)}},8666:(e,t,r)=>{var n=r(70674),o=r(49460),a=r(2306),i=a&&a.isTypedArray,s=i?o(i):n;e.exports=s},58771:e=>{e.exports=function(e){return void 0===e}},67769:(e,t,r)=>{var n=r(28486),o=r(80547);e.exports=function(e){return o(e)&&"[object WeakMap]"==n(e)}},32590:(e,t,r)=>{var n=r(69334),o=r(3334);e.exports=function(e){return o("function"==typeof e?e:n(e,1))}},9991:e=>{var t=Array.prototype.join;e.exports=function(e,r){return null==e?"":t.call(e,r)}},81211:(e,t,r)=>{var n=r(10358),o=r(195),a=r(36529);e.exports=function(e){return a(e)?n(e):o(e)}},25288:(e,t,r)=>{var n=r(10358),o=r(57200),a=r(36529);e.exports=function(e){return a(e)?n(e,!0):o(e)}},98087:e=>{e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},40105:(e,t,r)=>{var n=r(65111),o=r(3334),a=r(41393),i=r(53142);e.exports=function(e,t){return(i(e)?n:a)(e,o(t,3))}},69011:(e,t,r)=>{var n=r(68250);function o(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var i=e.apply(this,n);return r.cache=a.set(o,i)||a,i};return r.cache=new(o.Cache||n),r}o.Cache=n,e.exports=o},82451:(e,t,r)=>{var n=r(40091),o=r(77848)((function(e,t,r){n(e,t,r)}));e.exports=o},48875:(e,t,r)=>{var n=r(40091),o=r(77848)((function(e,t,r,o){n(e,t,r,o)}));e.exports=o},79071:e=>{e.exports=function(){}},94495:(e,t,r)=>{var n=r(78942);e.exports=function(){return n.Date.now()}},3326:(e,t,r)=>{var n=r(65111),o=r(69334),a=r(81586),i=r(93526),s=r(39032),c=r(29259),l=r(41439),u=r(93650),d=l((function(e,t){var r={};if(null==e)return r;var l=!1;t=n(t,(function(t){return t=i(t,e),l||(l=t.length>1),t})),s(e,u(e),r),l&&(r=o(r,7,c));for(var d=t.length;d--;)a(r,t[d]);return r}));e.exports=d},50578:(e,t,r)=>{var n=r(23945),o=r(58638),a=r(36850),i=r(8813),s=n((function(e,t){var r=i(t,a(s));return o(e,32,void 0,t,r)}));s.placeholder={},e.exports=s},43282:(e,t,r)=>{var n=r(12762),o=r(98880),a=r(65187),i=r(66040);e.exports=function(e){return a(e)?n(i(e)):o(e)}},864:(e,t,r)=>{var n=r(58638),o=r(41439)((function(e,t){return n(e,256,void 0,void 0,void 0,t)}));e.exports=o},65079:(e,t,r)=>{var n=r(3334),o=r(16653);e.exports=function(e,t){var r=[];if(!e||!e.length)return r;var a=-1,i=[],s=e.length;for(t=n(t,3);++a<s;){var c=e[a];t(c,a,e)&&(r.push(c),i.push(a))}return o(e,i),r}},6609:e=>{var t=Array.prototype.reverse;e.exports=function(e){return null==e?e:t.call(e)}},40074:(e,t,r)=>{var n=r(90313),o=r(70310),a=r(23945),i=r(74535),s=a((function(e,t){if(null==e)return[];var r=t.length;return r>1&&i(e,t[0],t[1])?t=[]:r>2&&i(t[0],t[1],t[2])&&(t=[t[0]]),o(e,n(t,1),[])}));e.exports=s},99306:e=>{e.exports=function(){return[]}},34772:e=>{e.exports=function(){return!1}},43301:(e,t,r)=>{var n=r(6131);e.exports=function(e){return e?Infinity===(e=n(e))||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},67642:(e,t,r)=>{var n=r(43301);e.exports=function(e){var t=n(e),r=t%1;return t==t?r?t-r:t:0}},6131:(e,t,r)=>{var n=r(86403),o=r(41580),a=r(51187),i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(a(e))return NaN;if(o(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=o(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=n(e);var r=s.test(e);return r||c.test(e)?l(e.slice(2),r?2:8):i.test(e)?NaN:+e}},42613:(e,t,r)=>{var n=r(65111),o=r(84354),a=r(53142),i=r(51187),s=r(96493),c=r(66040),l=r(95243);e.exports=function(e){return a(e)?n(e,c):i(e)?[e]:o(s(l(e)))}},64207:(e,t,r)=>{var n=r(39032),o=r(25288);e.exports=function(e){return n(e,o(e))}},95243:(e,t,r)=>{var n=r(52291);e.exports=function(e){return null==e?"":n(e)}},17426:(e,t,r)=>{var n=r(52291),o=r(28931),a=r(28774),i=r(82237),s=r(95243),c=r(62945);e.exports=function(e,t,r){if((e=s(e))&&(r||void 0===t))return e.slice(0,c(e)+1);if(!e||!(t=n(t)))return e;var l=i(e),u=a(l,i(t))+1;return o(l,0,u).join("")}},90959:(e,t,r)=>{var n=r(52291),o=r(28931),a=r(17905),i=r(82237),s=r(95243),c=/^\s+/;e.exports=function(e,t,r){if((e=s(e))&&(r||void 0===t))return e.replace(c,"");if(!e||!(t=n(t)))return e;var l=i(e),u=a(l,i(t));return o(l,u).join("")}},55620:(e,t,r)=>{var n=r(90313),o=r(23945),a=r(15630),i=r(65406),s=o((function(e){return a(n(e,1,i,!0))}));e.exports=s},74133:(e,t,r)=>{var n=r(90313),o=r(3334),a=r(23945),i=r(15630),s=r(65406),c=r(98087),l=a((function(e){var t=c(e);return s(t)&&(t=void 0),i(n(e,1,s,!0),o(t,2))}));e.exports=l},77484:(e,t,r)=>{var n=r(90313),o=r(23945),a=r(15630),i=r(65406),s=r(98087),c=o((function(e){var t=s(e);return t="function"==typeof t?t:void 0,a(n(e,1,i,!0),void 0,t)}));e.exports=c},73450:(e,t,r)=>{var n=r(81586);e.exports=function(e,t){return null==e||n(e,t)}},29570:(e,t,r)=>{var n=r(53674),o=r(23997);e.exports=function(e,t,r){return null==e?e:n(e,t,o(r))}},39817:(e,t,r)=>{var n=r(3905),o=r(81211);e.exports=function(e){return null==e?[]:n(e,o(e))}},30795:(e,t,r)=>{var n=r(96576),o=r(23945),a=r(65406),i=o((function(e,t){return a(e)?n(e,t):[]}));e.exports=i},93321:(e,t,r)=>{var n=r(57553),o=r(528),a=r(75962),i=r(53142),s=r(80547),c=r(63410),l=Object.prototype.hasOwnProperty;function u(e){if(s(e)&&!i(e)&&!(e instanceof n)){if(e instanceof o)return e;if(l.call(e,"__wrapped__"))return c(e)}return new o(e)}u.prototype=a.prototype,u.prototype.constructor=u,e.exports=u},68032:(e,t,r)=>{"use strict";const n=r(7269),o=r(28605),a=r(72851),i=r(90028),s=Symbol("encodeFragmentIdentifier");function c(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function l(e,t){return t.encode?t.strict?n(e):encodeURIComponent(e):e}function u(e,t){return t.decode?o(e):e}function d(e){return Array.isArray(e)?e.sort():"object"==typeof e?d(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function f(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function p(e){const t=(e=f(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function g(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function E(e,t){c((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,n)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===n[e]&&(n[e]={}),n[e][t[1]]=r):n[e]=r};case"bracket":return(e,r,n)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],r):n[e]=[r]:n[e]=r};case"colon-list-separator":return(e,r,n)=>{t=/(:list)$/.exec(e),e=e.replace(/:list$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],r):n[e]=[r]:n[e]=r};case"comma":case"separator":return(t,r,n)=>{const o="string"==typeof r&&r.includes(e.arrayFormatSeparator),a="string"==typeof r&&!o&&u(r,e).includes(e.arrayFormatSeparator);r=a?u(r,e):r;const i=o||a?r.split(e.arrayFormatSeparator).map((t=>u(t,e))):null===r?r:u(r,e);n[t]=i};case"bracket-separator":return(t,r,n)=>{const o=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!o)return void(n[t]=r?u(r,e):r);const a=null===r?[]:r.split(e.arrayFormatSeparator).map((t=>u(t,e)));void 0!==n[t]?n[t]=[].concat(n[t],a):n[t]=a};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[].concat(r[e],t):r[e]=t}}}(t),n=Object.create(null);if("string"!=typeof e)return n;if(!(e=e.trim().replace(/^[?#&]/,"")))return n;for(const o of e.split("&")){if(""===o)continue;let[e,i]=a(t.decode?o.replace(/\+/g," "):o,"=");i=void 0===i?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?i:u(i,t),r(u(e,t),i,n)}for(const e of Object.keys(n)){const r=n[e];if("object"==typeof r&&null!==r)for(const e of Object.keys(r))r[e]=g(r[e],t);else n[e]=g(r,t)}return!1===t.sort?n:(!0===t.sort?Object.keys(n).sort():Object.keys(n).sort(t.sort)).reduce(((e,t)=>{const r=n[t];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?e[t]=d(r):e[t]=r,e}),Object.create(null))}t.extract=p,t.parse=E,t.stringify=(e,t)=>{if(!e)return"";c((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const r=r=>t.skipNull&&null==e[r]||t.skipEmptyString&&""===e[r],n=function(e){switch(e.arrayFormat){case"index":return t=>(r,n)=>{const o=r.length;return void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[l(t,e),"[",o,"]"].join("")]:[...r,[l(t,e),"[",l(o,e),"]=",l(n,e)].join("")]};case"bracket":return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[l(t,e),"[]"].join("")]:[...r,[l(t,e),"[]=",l(n,e)].join("")];case"colon-list-separator":return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[l(t,e),":list="].join("")]:[...r,[l(t,e),":list=",l(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return r=>(n,o)=>void 0===o||e.skipNull&&null===o||e.skipEmptyString&&""===o?n:(o=null===o?"":o,0===n.length?[[l(r,e),t,l(o,e)].join("")]:[[n,l(o,e)].join(e.arrayFormatSeparator)])}default:return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,l(t,e)]:[...r,[l(t,e),"=",l(n,e)].join("")]}}(t),o={};for(const t of Object.keys(e))r(t)||(o[t]=e[t]);const a=Object.keys(o);return!1!==t.sort&&a.sort(t.sort),a.map((r=>{const o=e[r];return void 0===o?"":null===o?l(r,t):Array.isArray(o)?0===o.length&&"bracket-separator"===t.arrayFormat?l(r,t)+"[]":o.reduce(n(r),[]).join("&"):l(r,t)+"="+l(o,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[r,n]=a(e,"#");return Object.assign({url:r.split("?")[0]||"",query:E(p(e),t)},t&&t.parseFragmentIdentifier&&n?{fragmentIdentifier:u(n,t)}:{})},t.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[s]:!0},r);const n=f(e.url).split("?")[0]||"",o=t.extract(e.url),a=t.parse(o,{sort:!1}),i=Object.assign(a,e.query);let c=t.stringify(i,r);c&&(c=`?${c}`);let u=function(e){let t="";const r=e.indexOf("#");return-1!==r&&(t=e.slice(r)),t}(e.url);return e.fragmentIdentifier&&(u=`#${r[s]?l(e.fragmentIdentifier,r):e.fragmentIdentifier}`),`${n}${c}${u}`},t.pick=(e,r,n)=>{n=Object.assign({parseFragmentIdentifier:!0,[s]:!1},n);const{url:o,query:a,fragmentIdentifier:c}=t.parseUrl(e,n);return t.stringifyUrl({url:o,query:i(a,r),fragmentIdentifier:c},n)},t.exclude=(e,r,n)=>{const o=Array.isArray(r)?e=>!r.includes(e):(e,t)=>!r(e,t);return t.pick(e,o,n)}},45775:(e,t,r)=>{"use strict";r.r(t),r.d(t,{combineActions:()=>p,createAction:()=>_,createActions:()=>L,createCurriedAction:()=>x,handleAction:()=>U,handleActions:()=>B});var n=r(78958),o=r.n(n);const a=function(e){return"function"==typeof e},i=function(e){return"symbol"==typeof e||"object"==typeof e&&"[object Symbol]"===Object.prototype.toString.call(e)},s=function(e){return 0===e.length},c=function(e){return e.toString()},l=function(e){return"string"==typeof e};var u="/",d="||";function f(e){return l(e)||a(e)||i(e)}function p(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;o()(!s(n=t)&&n.every(f),"Expected action types to be strings, symbols, or action creators");var a=t.map(c).join(d);return{toString:function(){return a}}}const g=function(e){return e},E=function(e){return null===e};function _(e,t,r){void 0===t&&(t=g),o()(a(t)||E(t),"Expected payloadCreator to be a function, undefined or null");var n=E(t)||t===g?g:function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return e instanceof Error?e:t.apply(void 0,[e].concat(n))},i=a(r),s=e.toString(),c=function(){var t=n.apply(void 0,arguments),o={type:e};return t instanceof Error&&(o.error=!0),void 0!==t&&(o.payload=t),i&&(o.meta=r.apply(void 0,arguments)),o};return c.toString=function(){return s},c}const y=function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},v=function(e){return Array.isArray(e)},S=function(e){return null==e},O=function(e){return e[e.length-1]};var h=r(97935),T=r.n(h);const I=function(e){return-1===e.indexOf("/")?T()(e):e.split("/").map(T()).join("/")},C=function(e,t){return e.reduce((function(e,r){return t(e,r)}),{})},m=function(e){return"undefined"!=typeof Map&&e instanceof Map};function A(e){if(m(e))return Array.from(e.keys());if("undefined"!=typeof Reflect&&"function"==typeof Reflect.ownKeys)return Reflect.ownKeys(e);var t=Object.getOwnPropertyNames(e);return"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(e))),t}function b(e,t){return m(t)?t.get(e):t[e]}const R=function(e){return function t(r,n,o,a){var i=void 0===n?{}:n,s=i.namespace,c=void 0===s?u:s,l=i.prefix;return void 0===o&&(o={}),void 0===a&&(a=""),A(r).forEach((function(n){var i=function(e){return a||!l||l&&new RegExp("^"+l+c).test(e)?e:""+l+c+e}(function(e){var t;if(!a)return e;var r=e.toString().split(d),n=a.split(d);return(t=[]).concat.apply(t,n.map((function(e){return r.map((function(t){return""+e+c+t}))}))).join(d)}(n)),s=b(n,r);e(s)?t(s,{namespace:c,prefix:l},o,i):o[i]=s})),o}},N=R(y);function P(e,t){var r=void 0===t?{}:t,n=r.namespace,o=void 0===n?u:n,a=r.prefix;function i(t,r,n){var o=I(n.shift());s(n)?r[o]=e[t]:(r[o]||(r[o]={}),i(t,r[o],n))}var c={};return Object.getOwnPropertyNames(e).forEach((function(e){var t=a?e.replace(""+a+o,""):e;return i(e,c,t.split(o))})),c}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){M(e,t,r[t])}))}return e}function M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function L(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var a=y(O(r))?r.pop():{};return o()(r.every(l)&&(l(e)||y(e)),"Expected optional object followed by string action types"),l(e)?k([e].concat(r),a):w({},function(e,t){return P(D(N(e,t)),t)}(e,a),k(r,a))}function D(e,t){var r=void 0===t?{}:t,n=r.prefix,i=r.namespace,s=void 0===i?u:i;return C(Object.keys(e),(function(t,r){var i,c=e[r];o()(function(e){if(a(e)||S(e))return!0;if(v(e)){var t=e[0],r=void 0===t?g:t,n=e[1];return a(r)&&a(n)}return!1}(c),"Expected function, undefined, null, or array with payload and meta functions for "+r);var l=n?""+n+s+r:r,u=v(c)?_.apply(void 0,[l].concat(c)):_(l,c);return w({},t,((i={})[r]=u,i))}))}function k(e,t){var r=D(C(e,(function(e,t){var r;return w({},e,((r={})[t]=g,r))})),t);return C(Object.keys(r),(function(e,t){var n;return w({},e,((n={})[I(t)]=r[t],n))}))}var j=r(57224),F=r.n(j);const x=function(e,t){return F()(_(e,t),t.length)},H=function(e){return void 0===e};function U(e,t,r){void 0===t&&(t=g);var n=c(e).split(d);o()(!H(r),"defaultState for reducer handling "+n.join(", ")+" should be defined"),o()(a(t)||y(t),"Expected reducer to be a function or object with next and throw reducers");var i=a(t)?[t,t]:[t.next,t.throw].map((function(e){return S(e)?g:e})),s=i[0],l=i[1];return function(e,t){void 0===e&&(e=r);var o=t.type;return o&&-1!==n.indexOf(c(o))?(!0===t.error?l:s)(e,t):e}}const W=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n="function"!=typeof t[t.length-1]&&t.pop(),o=t;if(void 0===n)throw new TypeError("The initial state may not be undefined. If you do not want to set a value for this reducer, you can use null instead of undefined.");return function(e,t){for(var r=arguments.length,a=Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];var s=void 0===e,c=void 0===t;return s&&c&&n?n:o.reduce((function(e,r){return r.apply(void 0,[e,t].concat(a))}),s&&!c&&n?n:e)}},G=R((function(e){return(y(e)||m(e))&&(r=(t=A(e)).every((function(e){return"next"===e||"throw"===e})),!(t.length&&t.length<=2&&r));var t,r}));function B(e,t,r){void 0===r&&(r={}),o()(y(e)||m(e),"Expected handlers to be a plain object.");var n=G(e,r),a=A(n).map((function(e){return U(e,b(e,n),t)})),i=W.apply(void 0,a.concat([t]));return function(e,r){return void 0===e&&(e=t),i(e,r)}}},88185:(e,t,r)=>{"use strict";var n=r(14848).compose;t.__esModule=!0,t.composeWithDevTools="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?n:n.apply(null,arguments)},t.devToolsEnhancer="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?window.__REDUX_DEVTOOLS_EXTENSION__:function(){return function(e){return e}}},17783:function(e,t,r){!function(e){"use strict";function t(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function n(e,t){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),t&&t.length&&Object.defineProperty(this,"path",{value:t,enumerable:!0})}function o(e,t,r){o.super_.call(this,"E",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:r,enumerable:!0})}function a(e,t){a.super_.call(this,"N",e),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function i(e,t){i.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0})}function s(e,t,r){s.super_.call(this,"A",e),Object.defineProperty(this,"index",{value:t,enumerable:!0}),Object.defineProperty(this,"item",{value:r,enumerable:!0})}function c(e,t,r){var n=e.slice((r||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,n),e}function l(e){var t=void 0===e?"undefined":m(e);return"object"!==t?t:e===Math?"math":null===e?"null":Array.isArray(e)?"array":"[object Date]"===Object.prototype.toString.call(e)?"date":"function"==typeof e.toString&&/^\/.*\//.test(e.toString())?"regexp":"object"}function u(e,t,r,n,d,f,p){p=p||[];var g=(d=d||[]).slice(0);if(void 0!==f){if(n){if("function"==typeof n&&n(g,f))return;if("object"===(void 0===n?"undefined":m(n))){if(n.prefilter&&n.prefilter(g,f))return;if(n.normalize){var E=n.normalize(g,f,e,t);E&&(e=E[0],t=E[1])}}}g.push(f)}"regexp"===l(e)&&"regexp"===l(t)&&(e=e.toString(),t=t.toString());var _=void 0===e?"undefined":m(e),y=void 0===t?"undefined":m(t),v="undefined"!==_||p&&p[p.length-1].lhs&&p[p.length-1].lhs.hasOwnProperty(f),S="undefined"!==y||p&&p[p.length-1].rhs&&p[p.length-1].rhs.hasOwnProperty(f);if(!v&&S)r(new a(g,t));else if(!S&&v)r(new i(g,e));else if(l(e)!==l(t))r(new o(g,e,t));else if("date"===l(e)&&e-t!=0)r(new o(g,e,t));else if("object"===_&&null!==e&&null!==t)if(p.filter((function(t){return t.lhs===e})).length)e!==t&&r(new o(g,e,t));else{if(p.push({lhs:e,rhs:t}),Array.isArray(e)){var O;for(e.length,O=0;O<e.length;O++)O>=t.length?r(new s(g,O,new i(void 0,e[O]))):u(e[O],t[O],r,n,g,O,p);for(;O<t.length;)r(new s(g,O,new a(void 0,t[O++])))}else{var h=Object.keys(e),T=Object.keys(t);h.forEach((function(o,a){var i=T.indexOf(o);i>=0?(u(e[o],t[o],r,n,g,o,p),T=c(T,i)):u(e[o],void 0,r,n,g,o,p)})),T.forEach((function(e){u(void 0,t[e],r,n,g,e,p)}))}p.length=p.length-1}else e!==t&&("number"===_&&isNaN(e)&&isNaN(t)||r(new o(g,e,t)))}function d(e,t,r,n){return n=n||[],u(e,t,(function(e){e&&n.push(e)}),r),n.length?n:void 0}function f(e,t,r){if(r.path&&r.path.length){var n,o=e[t],a=r.path.length-1;for(n=0;n<a;n++)o=o[r.path[n]];switch(r.kind){case"A":f(o[r.path[n]],r.index,r.item);break;case"D":delete o[r.path[n]];break;case"E":case"N":o[r.path[n]]=r.rhs}}else switch(r.kind){case"A":f(e[t],r.index,r.item);break;case"D":e=c(e,t);break;case"E":case"N":e[t]=r.rhs}return e}function p(e,t,r){if(e&&t&&r&&r.kind){for(var n=e,o=-1,a=r.path?r.path.length-1:0;++o<a;)void 0===n[r.path[o]]&&(n[r.path[o]]="number"==typeof r.path[o]?[]:{}),n=n[r.path[o]];switch(r.kind){case"A":f(r.path?n[r.path[o]]:n,r.index,r.item);break;case"D":delete n[r.path[o]];break;case"E":case"N":n[r.path[o]]=r.rhs}}}function g(e,t,r){if(r.path&&r.path.length){var n,o=e[t],a=r.path.length-1;for(n=0;n<a;n++)o=o[r.path[n]];switch(r.kind){case"A":g(o[r.path[n]],r.index,r.item);break;case"D":case"E":o[r.path[n]]=r.lhs;break;case"N":delete o[r.path[n]]}}else switch(r.kind){case"A":g(e[t],r.index,r.item);break;case"D":case"E":e[t]=r.lhs;break;case"N":e=c(e,t)}return e}function E(e){return"color: "+R[e].color+"; font-weight: bold"}function _(e,t,r,n){var o=d(e,t);try{n?r.groupCollapsed("diff"):r.group("diff")}catch(e){r.log("diff")}o?o.forEach((function(e){var t=e.kind,n=function(e){var t=e.kind,r=e.path,n=e.lhs,o=e.rhs,a=e.index,i=e.item;switch(t){case"E":return[r.join("."),n,"→",o];case"N":return[r.join("."),o];case"D":return[r.join(".")];case"A":return[r.join(".")+"["+a+"]",i];default:return[]}}(e);r.log.apply(r,["%c "+R[t].text,E(t)].concat(A(n)))})):r.log("—— no diff ——");try{r.groupEnd()}catch(e){r.log("—— diff end —— ")}}function y(e,t,r,n){switch(void 0===e?"undefined":m(e)){case"object":return"function"==typeof e[n]?e[n].apply(e,A(r)):e[n];case"function":return e(t);default:return e}}function v(e,t){var r=t.logger,n=t.actionTransformer,o=t.titleFormatter,a=void 0===o?function(e){var t=e.timestamp,r=e.duration;return function(e,n,o){var a=["action"];return a.push("%c"+String(e.type)),t&&a.push("%c@ "+n),r&&a.push("%c(in "+o.toFixed(2)+" ms)"),a.join(" ")}}(t):o,i=t.collapsed,s=t.colors,c=t.level,l=t.diff,u=void 0===t.titleFormatter;e.forEach((function(o,d){var f=o.started,p=o.startedTime,g=o.action,E=o.prevState,v=o.error,S=o.took,O=o.nextState,h=e[d+1];h&&(O=h.prevState,S=h.started-f);var T=n(g),C="function"==typeof i?i((function(){return O}),g,o):i,m=I(p),A=s.title?"color: "+s.title(T)+";":"",b=["color: gray; font-weight: lighter;"];b.push(A),t.timestamp&&b.push("color: gray; font-weight: lighter;"),t.duration&&b.push("color: gray; font-weight: lighter;");var R=a(T,m,S);try{C?s.title&&u?r.groupCollapsed.apply(r,["%c "+R].concat(b)):r.groupCollapsed(R):s.title&&u?r.group.apply(r,["%c "+R].concat(b)):r.group(R)}catch(e){r.log(R)}var N=y(c,T,[E],"prevState"),P=y(c,T,[T],"action"),w=y(c,T,[v,E],"error"),M=y(c,T,[O],"nextState");if(N)if(s.prevState){var L="color: "+s.prevState(E)+"; font-weight: bold";r[N]("%c prev state",L,E)}else r[N]("prev state",E);if(P)if(s.action){var D="color: "+s.action(T)+"; font-weight: bold";r[P]("%c action    ",D,T)}else r[P]("action    ",T);if(v&&w)if(s.error){var k="color: "+s.error(v,E)+"; font-weight: bold;";r[w]("%c error     ",k,v)}else r[w]("error     ",v);if(M)if(s.nextState){var j="color: "+s.nextState(O)+"; font-weight: bold";r[M]("%c next state",j,O)}else r[M]("next state",O);l&&_(E,O,r,C);try{r.groupEnd()}catch(e){r.log("—— log end ——")}}))}function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},N,e),r=t.logger,n=t.stateTransformer,o=t.errorTransformer,a=t.predicate,i=t.logErrors,s=t.diffPredicate;if(void 0===r)return function(){return function(e){return function(t){return e(t)}}};if(e.getState&&e.dispatch)return console.error("[redux-logger] redux-logger not installed. Make sure to pass logger instance as middleware:\n// Logger with default options\nimport { logger } from 'redux-logger'\nconst store = createStore(\n  reducer,\n  applyMiddleware(logger)\n)\n// Or you can create your own logger with custom options http://bit.ly/redux-logger-options\nimport createLogger from 'redux-logger'\nconst logger = createLogger({\n  // ...options\n});\nconst store = createStore(\n  reducer,\n  applyMiddleware(logger)\n)\n"),function(){return function(e){return function(t){return e(t)}}};var c=[];return function(e){var r=e.getState;return function(e){return function(l){if("function"==typeof a&&!a(r,l))return e(l);var u={};c.push(u),u.started=C.now(),u.startedTime=new Date,u.prevState=n(r()),u.action=l;var d=void 0;if(i)try{d=e(l)}catch(e){u.error=o(e)}else d=e(l);u.took=C.now()-u.started,u.nextState=n(r());var f=t.diff&&"function"==typeof s?s(r,l):t.diff;if(v(c,Object.assign({},t,{diff:f})),c.length=0,u.error)throw u.error;return d}}}}var O,h,T=function(e,t){return function(e,t){return new Array(t+1).join(e)}("0",t-e.toString().length)+e},I=function(e){return T(e.getHours(),2)+":"+T(e.getMinutes(),2)+":"+T(e.getSeconds(),2)+"."+T(e.getMilliseconds(),3)},C="undefined"!=typeof performance&&null!==performance&&"function"==typeof performance.now?performance:Date,m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},b=[];O="object"===(void 0===r.g?"undefined":m(r.g))&&r.g?r.g:"undefined"!=typeof window?window:{},(h=O.DeepDiff)&&b.push((function(){void 0!==h&&O.DeepDiff===d&&(O.DeepDiff=h,h=void 0)})),t(o,n),t(a,n),t(i,n),t(s,n),Object.defineProperties(d,{diff:{value:d,enumerable:!0},observableDiff:{value:u,enumerable:!0},applyDiff:{value:function(e,t,r){e&&t&&u(e,t,(function(n){r&&!r(e,t,n)||p(e,t,n)}))},enumerable:!0},applyChange:{value:p,enumerable:!0},revertChange:{value:function(e,t,r){if(e&&t&&r&&r.kind){var n,o,a=e;for(o=r.path.length-1,n=0;n<o;n++)void 0===a[r.path[n]]&&(a[r.path[n]]={}),a=a[r.path[n]];switch(r.kind){case"A":g(a[r.path[n]],r.index,r.item);break;case"D":case"E":a[r.path[n]]=r.lhs;break;case"N":delete a[r.path[n]]}}},enumerable:!0},isConflict:{value:function(){return void 0!==h},enumerable:!0},noConflict:{value:function(){return b&&(b.forEach((function(e){e()})),b=null),d},enumerable:!0}});var R={E:{color:"#2196F3",text:"CHANGED:"},N:{color:"#4CAF50",text:"ADDED:"},D:{color:"#F44336",text:"DELETED:"},A:{color:"#2196F3",text:"ARRAY:"}},N={level:"log",logger:console,logErrors:!0,collapsed:void 0,predicate:void 0,duration:!1,timestamp:!0,stateTransformer:function(e){return e},actionTransformer:function(e){return e},errorTransformer:function(e){return e},colors:{title:function(){return"inherit"},prevState:function(){return"#9E9E9E"},action:function(){return"#03A9F4"},nextState:function(){return"#4CAF50"},error:function(){return"#F20404"}},diff:!1,diffPredicate:void 0,transformer:void 0},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dispatch,r=e.getState;return"function"==typeof t||"function"==typeof r?S()({dispatch:t,getState:r}):void console.error("\n[redux-logger v3] BREAKING CHANGE\n[redux-logger v3] Since 3.0.0 redux-logger exports by default logger with default settings.\n[redux-logger v3] Change\n[redux-logger v3] import createLogger from 'redux-logger'\n[redux-logger v3] to\n[redux-logger v3] import { createLogger } from 'redux-logger'\n")};e.defaults=N,e.createLogger=S,e.logger=P,e.default=P,Object.defineProperty(e,"__esModule",{value:!0})}(t)},14848:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){var n,a,i;n=e,a=t,i=r[t],(a=o(a))in n?Object.defineProperty(n,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[a]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}r.r(t),r.d(t,{__DO_NOT_USE__ActionTypes:()=>u,applyMiddleware:()=>y,bindActionCreators:()=>E,combineReducers:()=>p,compose:()=>_,createStore:()=>d,legacy_createStore:()=>f});var c="function"==typeof Symbol&&Symbol.observable||"@@observable",l=function(){return Math.random().toString(36).substring(7).split("").join(".")},u={INIT:"@@redux/INIT"+l(),REPLACE:"@@redux/REPLACE"+l(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+l()}};function d(e,t,r){var n;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error(s(0));if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error(s(1));return r(d)(e,t)}if("function"!=typeof e)throw new Error(s(2));var o=e,a=t,i=[],l=i,f=!1;function p(){l===i&&(l=i.slice())}function g(){if(f)throw new Error(s(3));return a}function E(e){if("function"!=typeof e)throw new Error(s(4));if(f)throw new Error(s(5));var t=!0;return p(),l.push(e),function(){if(t){if(f)throw new Error(s(6));t=!1,p();var r=l.indexOf(e);l.splice(r,1),i=null}}}function _(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw new Error(s(7));if(void 0===e.type)throw new Error(s(8));if(f)throw new Error(s(9));try{f=!0,a=o(a,e)}finally{f=!1}for(var t=i=l,r=0;r<t.length;r++)(0,t[r])();return e}return _({type:u.INIT}),(n={dispatch:_,subscribe:E,getState:g,replaceReducer:function(e){if("function"!=typeof e)throw new Error(s(10));o=e,_({type:u.REPLACE})}})[c]=function(){var e,t=E;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(s(11));function r(){e.next&&e.next(g())}return r(),{unsubscribe:t(r)}}})[c]=function(){return this},e},n}var f=d;function p(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var o=t[n];"function"==typeof e[o]&&(r[o]=e[o])}var a,i=Object.keys(r);try{!function(e){Object.keys(e).forEach((function(t){var r=e[t];if(void 0===r(void 0,{type:u.INIT}))throw new Error(s(12));if(void 0===r(void 0,{type:u.PROBE_UNKNOWN_ACTION()}))throw new Error(s(13))}))}(r)}catch(e){a=e}return function(e,t){if(void 0===e&&(e={}),a)throw a;for(var n=!1,o={},c=0;c<i.length;c++){var l=i[c],u=r[l],d=e[l],f=u(d,t);if(void 0===f)throw t&&t.type,new Error(s(14));o[l]=f,n=n||f!==d}return(n=n||i.length!==Object.keys(e).length)?o:e}}function g(e,t){return function(){return t(e.apply(this,arguments))}}function E(e,t){if("function"==typeof e)return g(e,t);if("object"!=typeof e||null===e)throw new Error(s(16));var r={};for(var n in e){var o=e[n];"function"==typeof o&&(r[n]=g(o,t))}return r}function _(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function y(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw new Error(s(15))},o={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},a=t.map((function(e){return e(o)}));return n=_.apply(void 0,a)(r.dispatch),i(i({},r),{},{dispatch:n})}}}},9323:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},54722:(e,t,r)=>{var n=r(2427),o=r(923);t.write=o,t.parse=n.parse,t.parseParams=n.parseParams,t.parseFmtpConfig=n.parseFmtpConfig,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},2427:(e,t,r)=>{var n=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,r){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:o?t[e.name]:t;!function(e,t,r,o){if(o&&!r)t[o]=n(e[1]);else for(var a=0;a<r.length;a+=1)null!=e[a+1]&&(t[r[a]]=n(e[a+1]))}(r.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=r(9323),i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(i))return o(c,n,i)}})),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),o=0;o<r.length;o+=3)t.push({component:r[o],ip:r[o+1],port:r[o+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},923:(e,t,r)=>{var n=r(9323),o=/%[sdv%]/g,a=function(e){var t=1,r=arguments,n=r.length;return e.replace(o,(function(e){if(t>=n)return e;var o=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}}))},i=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var i=t.names[o];t.name?n.push(r[t.name][i]):n.push(r[t.names[o]])}else n.push(r[t.name]);return a.apply(null,n)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||s,o=t.innerOrder||c,a=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(i(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(i(t,r,e))}))}))})),e.media.forEach((function(e){a.push(i("m",n.m[0],e)),o.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(i(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(i(t,r,e))}))}))}))})),a.join("\r\n")+"\r\n"}},39986:e=>{"use strict";const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){const r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter((e=>0===e.indexOf(r)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const r={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":r.relatedAddress=t[e+1];break;case"rport":r.relatedPort=parseInt(t[e+1],10);break;case"tcptype":r.tcpType=t[e+1];break;case"ufrag":r.ufrag=t[e+1],r.usernameFragment=t[e+1];break;default:void 0===r[t[e]]&&(r[t[e]]=t[e+1])}return r},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let r;const n=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<n.length;e++)r=n[e].trim().split("="),t[r[0].trim()]=r[1];return t},t.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,t),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substring(t+1,n),r.value=e.substring(n+1)):r.attribute=e.substring(t+1),r},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){const n=t.matchPrefix(e+r,"a=ice-ufrag:")[0],o=t.matchPrefix(e+r,"a=ice-pwd:")[0];return n&&o?{usernameFragment:n.substring(12),password:o.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" ");r.profile=n[2];for(let o=3;o<n.length;o++){const a=n[o],i=t.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(i){const n=t.parseRtpMap(i),o=t.matchPrefix(e,"a=fmtp:"+a+" ");switch(n.parameters=o.length?t.parseFmtp(o[0]):{},n.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),r.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(n.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{r.headerExtensions.push(t.parseExtmap(e))}));const o=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach((e=>{o.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),r},t.writeRtpDescription=function(e,r){let n="";n+="m="+e+" ",n+=r.codecs.length>0?"9":"0",n+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=r.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach((e=>{n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)}));let o=0;return r.codecs.forEach((e=>{e.maxptime>o&&(o=e.maxptime)})),o>0&&(n+="a=maxptime:"+o+"\r\n"),r.headerExtensions&&r.headerExtensions.forEach((e=>{n+=t.writeExtmap(e)})),n},t.parseRtpEncodingParameters=function(e){const r=[],n=t.parseRtpParameters(e),o=-1!==n.fecMechanisms.indexOf("RED"),a=-1!==n.fecMechanisms.indexOf("ULPFEC"),i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=i.length>0&&i[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),n.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),r.push(t),o&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:a?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&s&&r.push({ssrc:s});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,r.forEach((e=>{e.maxBitrate=u}))),r},t.parseRtcpParameters=function(e){const r={},n=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const o=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=0===o.length;const a=t.matchPrefix(e,"a=rtcp-mux");return r.mux=a.length>0,r},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let r;const n=t.matchPrefix(e,"a=msid:");if(1===n.length)return r=n[0].substring(7).split(" "),{stream:r[0],track:r[1]};const o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return o.length>0?(r=o[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(e){const r=t.parseMLine(e),n=t.matchPrefix(e,"a=max-message-size:");let o;n.length>0&&(o=parseInt(n[0].substring(19),10)),isNaN(o)&&(o=65536);const a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:o};const i=t.matchPrefix(e,"a=sctpmap:");if(i.length>0){const e=i[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:o}}},t.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,r,n){let o;const a=void 0!==r?r:2;return o=e||t.generateSessionId(),"v=0\r\no="+(n||"thisisadapterortc")+" "+o+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,r){const n=t.splitLines(e);for(let e=0;e<n.length;e++)switch(n[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[e].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const r=t.splitLines(e)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){const r=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const r=t.splitLines(e);for(let e=0;e<r.length;e++)if(r[e].length<2||"="!==r[e].charAt(1))return!1;return!0},e.exports=t},72851:e=>{"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]}},7269:e=>{"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},97935:(e,t,r)=>{var n=r(44139);e.exports=function(e){return n(e).replace(/\s(\w)/g,(function(e,t){return t.toUpperCase()}))}},46536:e=>{e.exports=function(e){return t.test(e)?e.toLowerCase():r.test(e)?(function(e){return e.replace(o,(function(e,t){return t?" "+t:""}))}(e)||e).toLowerCase():n.test(e)?function(e){return e.replace(a,(function(e,t,r){return t+" "+r.toLowerCase().split("").join(" ")}))}(e).toLowerCase():e.toLowerCase()};var t=/\s/,r=/(_|-|\.|:)/,n=/([a-z][A-Z]|[A-Z][a-z])/,o=/[\W_]+(.|$)/g,a=/(.)([A-Z]+)/g},44139:(e,t,r)=>{var n=r(46536);e.exports=function(e){return n(e).replace(/[\W_]+(.|$)/g,(function(e,t){return t?" "+t:""})).trim()}},82094:(e,t)=>{!function(e){var t,r,n,o=String.fromCharCode;function a(e){for(var t,r,n=[],o=0,a=e.length;o<a;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<a?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}function i(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function s(e,t){return o(e>>t&63|128)}function c(e){if(0==(4294967168&e))return o(e);var t="";return 0==(4294965248&e)?t=o(e>>6&31|192):0==(4294901760&e)?(i(e),t=o(e>>12&15|224),t+=s(e,6)):0==(4292870144&e)&&(t=o(e>>18&7|240),t+=s(e,12),t+=s(e,6)),t+o(63&e|128)}function l(){if(n>=r)throw Error("Invalid byte index");var e=255&t[n];if(n++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function u(){var e,o;if(n>r)throw Error("Invalid byte index");if(n==r)return!1;if(e=255&t[n],n++,0==(128&e))return e;if(192==(224&e)){if((o=(31&e)<<6|l())>=128)return o;throw Error("Invalid continuation byte")}if(224==(240&e)){if((o=(15&e)<<12|l()<<6|l())>=2048)return i(o),o;throw Error("Invalid continuation byte")}if(240==(248&e)&&(o=(7&e)<<18|l()<<12|l()<<6|l())>=65536&&o<=1114111)return o;throw Error("Invalid UTF-8 detected")}e.version="3.0.0",e.encode=function(e){for(var t=a(e),r=t.length,n=-1,o="";++n<r;)o+=c(t[n]);return o},e.decode=function(e){t=a(e),r=t.length,n=0;for(var i,s=[];!1!==(i=u());)s.push(i);return function(e){for(var t,r=e.length,n=-1,a="";++n<r;)(t=e[n])>65535&&(a+=o((t-=65536)>>>10&1023|55296),t=56320|1023&t),a+=o(t);return a}(s)}}(t)},84596:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return c.default}});var n=f(r(74603)),o=f(r(99917)),a=f(r(42712)),i=f(r(93423)),s=f(r(35911)),c=f(r(24072)),l=f(r(4564)),u=f(r(46585)),d=f(r(29975));function f(e){return e&&e.__esModule?e:{default:e}}},72668:(e,t)=>{"use strict";function r(e){return 14+(e+64>>>9<<4)+1}function n(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function o(e,t,r,o,a,i){return n((s=n(n(t,e),n(o,i)))<<(c=a)|s>>>32-c,r);var s,c}function a(e,t,r,n,a,i,s){return o(t&r|~t&n,e,t,a,i,s)}function i(e,t,r,n,a,i,s){return o(t&n|r&~n,e,t,a,i,s)}function s(e,t,r,n,a,i,s){return o(t^r^n,e,t,a,i,s)}function c(e,t,r,n,a,i,s){return o(r^(t|~n),e,t,a,i,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){const t=[],r=32*e.length,n="0123456789abcdef";for(let o=0;o<r;o+=8){const r=e[o>>5]>>>o%32&255,a=parseInt(n.charAt(r>>>4&15)+n.charAt(15&r),16);t.push(a)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[r(t)-1]=t;let o=1732584193,l=-271733879,u=-1732584194,d=271733878;for(let t=0;t<e.length;t+=16){const r=o,f=l,p=u,g=d;o=a(o,l,u,d,e[t],7,-680876936),d=a(d,o,l,u,e[t+1],12,-389564586),u=a(u,d,o,l,e[t+2],17,606105819),l=a(l,u,d,o,e[t+3],22,-1044525330),o=a(o,l,u,d,e[t+4],7,-176418897),d=a(d,o,l,u,e[t+5],12,1200080426),u=a(u,d,o,l,e[t+6],17,-1473231341),l=a(l,u,d,o,e[t+7],22,-45705983),o=a(o,l,u,d,e[t+8],7,1770035416),d=a(d,o,l,u,e[t+9],12,-1958414417),u=a(u,d,o,l,e[t+10],17,-42063),l=a(l,u,d,o,e[t+11],22,-1990404162),o=a(o,l,u,d,e[t+12],7,1804603682),d=a(d,o,l,u,e[t+13],12,-40341101),u=a(u,d,o,l,e[t+14],17,-1502002290),l=a(l,u,d,o,e[t+15],22,1236535329),o=i(o,l,u,d,e[t+1],5,-165796510),d=i(d,o,l,u,e[t+6],9,-1069501632),u=i(u,d,o,l,e[t+11],14,643717713),l=i(l,u,d,o,e[t],20,-373897302),o=i(o,l,u,d,e[t+5],5,-701558691),d=i(d,o,l,u,e[t+10],9,38016083),u=i(u,d,o,l,e[t+15],14,-660478335),l=i(l,u,d,o,e[t+4],20,-405537848),o=i(o,l,u,d,e[t+9],5,568446438),d=i(d,o,l,u,e[t+14],9,-1019803690),u=i(u,d,o,l,e[t+3],14,-187363961),l=i(l,u,d,o,e[t+8],20,1163531501),o=i(o,l,u,d,e[t+13],5,-1444681467),d=i(d,o,l,u,e[t+2],9,-51403784),u=i(u,d,o,l,e[t+7],14,1735328473),l=i(l,u,d,o,e[t+12],20,-1926607734),o=s(o,l,u,d,e[t+5],4,-378558),d=s(d,o,l,u,e[t+8],11,-2022574463),u=s(u,d,o,l,e[t+11],16,1839030562),l=s(l,u,d,o,e[t+14],23,-35309556),o=s(o,l,u,d,e[t+1],4,-1530992060),d=s(d,o,l,u,e[t+4],11,1272893353),u=s(u,d,o,l,e[t+7],16,-155497632),l=s(l,u,d,o,e[t+10],23,-1094730640),o=s(o,l,u,d,e[t+13],4,681279174),d=s(d,o,l,u,e[t],11,-358537222),u=s(u,d,o,l,e[t+3],16,-722521979),l=s(l,u,d,o,e[t+6],23,76029189),o=s(o,l,u,d,e[t+9],4,-640364487),d=s(d,o,l,u,e[t+12],11,-421815835),u=s(u,d,o,l,e[t+15],16,530742520),l=s(l,u,d,o,e[t+2],23,-995338651),o=c(o,l,u,d,e[t],6,-198630844),d=c(d,o,l,u,e[t+7],10,1126891415),u=c(u,d,o,l,e[t+14],15,-1416354905),l=c(l,u,d,o,e[t+5],21,-57434055),o=c(o,l,u,d,e[t+12],6,1700485571),d=c(d,o,l,u,e[t+3],10,-1894986606),u=c(u,d,o,l,e[t+10],15,-1051523),l=c(l,u,d,o,e[t+1],21,-2054922799),o=c(o,l,u,d,e[t+8],6,1873313359),d=c(d,o,l,u,e[t+15],10,-30611744),u=c(u,d,o,l,e[t+6],15,-1560198380),l=c(l,u,d,o,e[t+13],21,1309151649),o=c(o,l,u,d,e[t+4],6,-145523070),d=c(d,o,l,u,e[t+11],10,-1120210379),u=c(u,d,o,l,e[t+2],15,718787259),l=c(l,u,d,o,e[t+9],21,-343485551),o=n(o,r),l=n(l,f),u=n(u,p),d=n(d,g)}return[o,l,u,d]}(function(e){if(0===e.length)return[];const t=8*e.length,n=new Uint32Array(r(t));for(let r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))}},40193:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};t.default=r},35911:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="00000000-0000-0000-0000-000000000000"},29975:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(4564))&&n.__esModule?n:{default:n};t.default=function(e){if(!(0,o.default)(e))throw TypeError("Invalid UUID");let t;const r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}},16635:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},74089:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!r&&(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(n)};const n=new Uint8Array(16)},34271:(e,t)=>{"use strict";function r(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:case 3:return t^r^n;case 2:return t&r^t&n^r&n}}function n(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){const t=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const a=e.length/4+2,i=Math.ceil(a/16),s=new Array(i);for(let t=0;t<i;++t){const r=new Uint32Array(16);for(let n=0;n<16;++n)r[n]=e[64*t+4*n]<<24|e[64*t+4*n+1]<<16|e[64*t+4*n+2]<<8|e[64*t+4*n+3];s[t]=r}s[i-1][14]=8*(e.length-1)/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<i;++e){const a=new Uint32Array(80);for(let t=0;t<16;++t)a[t]=s[e][t];for(let e=16;e<80;++e)a[e]=n(a[e-3]^a[e-8]^a[e-14]^a[e-16],1);let i=o[0],c=o[1],l=o[2],u=o[3],d=o[4];for(let e=0;e<80;++e){const o=Math.floor(e/20),s=n(i,5)+r(o,c,l,u)+d+t[o]+a[e]>>>0;d=u,u=l,l=n(c,30)>>>0,c=i,i=s}o[0]=o[0]+i>>>0,o[1]=o[1]+c>>>0,o[2]=o[2]+l>>>0,o[3]=o[3]+u>>>0,o[4]=o[4]+d>>>0}return[o[0]>>24&255,o[0]>>16&255,o[0]>>8&255,255&o[0],o[1]>>24&255,o[1]>>16&255,o[1]>>8&255,255&o[1],o[2]>>24&255,o[2]>>16&255,o[2]>>8&255,255&o[2],o[3]>>24&255,o[3]>>16&255,o[3]>>8&255,255&o[3],o[4]>>24&255,o[4]>>16&255,o[4]>>8&255,255&o[4]]}},46585:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.unsafeStringify=i;var n,o=(n=r(4564))&&n.__esModule?n:{default:n};const a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));function i(e,t=0){return a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]}t.default=function(e,t=0){const r=i(e,t);if(!(0,o.default)(r))throw TypeError("Stringified UUID is invalid");return r}},74603:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(74089))&&n.__esModule?n:{default:n},a=r(46585);let i,s,c=0,l=0;t.default=function(e,t,r){let n=t&&r||0;const u=t||new Array(16);let d=(e=e||{}).node||i,f=void 0!==e.clockseq?e.clockseq:s;if(null==d||null==f){const t=e.random||(e.rng||o.default)();null==d&&(d=i=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==f&&(f=s=16383&(t[6]<<8|t[7]))}let p=void 0!==e.msecs?e.msecs:Date.now(),g=void 0!==e.nsecs?e.nsecs:l+1;const E=p-c+(g-l)/1e4;if(E<0&&void 0===e.clockseq&&(f=f+1&16383),(E<0||p>c)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=p,l=g,s=f,p+=122192928e5;const _=(1e4*(268435455&p)+g)%4294967296;u[n++]=_>>>24&255,u[n++]=_>>>16&255,u[n++]=_>>>8&255,u[n++]=255&_;const y=p/4294967296*1e4&268435455;u[n++]=y>>>8&255,u[n++]=255&y,u[n++]=y>>>24&15|16,u[n++]=y>>>16&255,u[n++]=f>>>8|128,u[n++]=255&f;for(let e=0;e<6;++e)u[n+e]=d[e];return t||(0,a.unsafeStringify)(u)}},99917:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(14782)),o=a(r(72668));function a(e){return e&&e.__esModule?e:{default:e}}var i=(0,n.default)("v3",48,o.default);t.default=i},14782:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0,t.default=function(e,t,r){function n(e,n,i,s){var c;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof n&&(n=(0,a.default)(n)),16!==(null===(c=n)||void 0===c?void 0:c.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let l=new Uint8Array(16+e.length);if(l.set(n),l.set(e,n.length),l=r(l),l[6]=15&l[6]|t,l[8]=63&l[8]|128,i){s=s||0;for(let e=0;e<16;++e)i[s+e]=l[e];return i}return(0,o.unsafeStringify)(l)}try{n.name=e}catch(e){}return n.DNS=i,n.URL=s,n};var n,o=r(46585),a=(n=r(29975))&&n.__esModule?n:{default:n};const i="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=i;const s="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=s},42712:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(40193)),o=i(r(74089)),a=r(46585);function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,r){if(n.default.randomUUID&&!t&&!e)return n.default.randomUUID();const i=(e=e||{}).random||(e.rng||o.default)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=i[e];return t}return(0,a.unsafeStringify)(i)}},93423:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(14782)),o=a(r(34271));function a(e){return e&&e.__esModule?e:{default:e}}var i=(0,n.default)("v5",80,o.default);t.default=i},4564:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(16635))&&n.__esModule?n:{default:n};t.default=function(e){return"string"==typeof e&&o.default.test(e)}},24072:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(4564))&&n.__esModule?n:{default:n};t.default=function(e){if(!(0,o.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},87014:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>T});var n=function(e,t,r,n){this.name=e,this.fn=t,this.args=r,this.modifiers=n};function o(e,t){return void 0===t&&(t="simple"),"object"==typeof e?e[t]:e}function a(e,t,r){if(e.length){var n=e.shift(),i=a(e,t,r);return n.perform(i,r)}return o(t)}function i(e,t,r){if(e.length){var n=e.shift(),a=i(e,t,r);return n.performAsync(a,r)}return function(e){return Promise.resolve(o(t,"async")(e))}}n.prototype._test=function(e){var t=this.fn;try{a(this.modifiers.slice(),t,this)(e)}catch(e){t=function(){return!1}}try{return a(this.modifiers.slice(),t,this)(e)}catch(e){return!1}},n.prototype._check=function(e){try{a(this.modifiers.slice(),this.fn,this)(e)}catch(e){if(a(this.modifiers.slice(),(function(e){return e}),this)(!1))return}if(!a(this.modifiers.slice(),this.fn,this)(e))throw null},n.prototype._testAsync=function(e){var t=this;return new Promise((function(r,n){i(t.modifiers.slice(),t.fn,t)(e).then((function(t){t?r(e):n(null)})).catch((function(e){return n(e)}))}))};var s=function(e,t,r){this.name=e,this.perform=t,this.performAsync=r},c=function(e){function t(r,n,o,a){for(var i=[],s=arguments.length-4;s-- >0;)i[s]=arguments[s+4];e.call(this,i),e.captureStackTrace&&e.captureStackTrace(this,t),this.rule=r,this.value=n,this.cause=o,this.target=a}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),l=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.chain=e,this.nextRuleModifiers=t};function u(e,t,r,n){if(t.length){var o=t.shift();o._testAsync(e).then((function(){u(e,t,r,n)}),(function(t){n(new c(o,e,t))}))}else r(e)}l.prototype._applyRule=function(e,t){var r=this;return function(){for(var o=[],a=arguments.length;a--;)o[a]=arguments[a];return r.chain.push(new n(t,e.apply(r,o),o,r.nextRuleModifiers)),r.nextRuleModifiers=[],r}},l.prototype._applyModifier=function(e,t){return this.nextRuleModifiers.push(new s(t,e.simple,e.async)),this},l.prototype._clone=function(){return new l(this.chain.slice(),this.nextRuleModifiers.slice())},l.prototype.test=function(e){return this.chain.every((function(t){return t._test(e)}))},l.prototype.testAll=function(e){var t=[];return this.chain.forEach((function(r){try{r._check(e)}catch(n){t.push(new c(r,e,n))}})),t},l.prototype.check=function(e){this.chain.forEach((function(t){try{t._check(e)}catch(r){throw new c(t,e,r)}}))},l.prototype.testAsync=function(e){var t=this;return new Promise((function(r,n){u(e,t.chain.slice(),r,n)}))};var d=function(e,t){return!(!t||"string"!=typeof e||0!==e.trim().length)||null==e};function f(){return"undefined"!=typeof Proxy?g(new l):E(new l)}var p={};function g(e){return new Proxy(e,{get:function(t,r){if(r in t)return t[r];var n=g(e._clone());return r in _?n._applyModifier(_[r],r):r in p?n._applyRule(p[r],r):r in S?n._applyRule(S[r],r):void 0}})}function E(e){var t=function(e,t){return Object.keys(e).forEach((function(r){t[r]=function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];return E(t._clone())._applyRule(e[r],r).apply(void 0,n)}})),t},r=t(S,e),n=t(p,r);return Object.keys(_).forEach((function(e){Object.defineProperty(n,e,{get:function(){return E(n._clone())._applyModifier(_[e],e)}})})),n}f.extend=function(e){Object.assign(p,e)},f.clearCustomRules=function(){p={}};var _={not:{simple:function(e){return function(t){return!e(t)}},async:function(e){return function(t){return Promise.resolve(e(t)).then((function(e){return!e})).catch((function(){return!0}))}}},some:{simple:function(e){return function(t){return v(t).some((function(t){try{return e(t)}catch(e){return!1}}))}},async:function(e){return function(t){return Promise.all(v(t).map((function(t){try{return e(t).catch((function(){return!1}))}catch(e){return!1}}))).then((function(e){return e.some(Boolean)}))}}},every:{simple:function(e){return function(t){return!1!==t&&v(t).every(e)}},async:function(e){return function(t){return Promise.all(v(t).map(e)).then((function(e){return e.every(Boolean)}))}}},strict:{simple:function(e,t){return function(r){return y(t)&&r&&"object"==typeof r?Object.keys(t.args[0]).length===Object.keys(r).length&&e(r):e(r)}},async:function(e,t){return function(r){return Promise.resolve(e(r)).then((function(e){return y(t)&&r&&"object"==typeof r?Object.keys(t.args[0]).length===Object.keys(r).length&&e:e})).catch((function(){return!1}))}}}};function y(e){return e&&"schema"===e.name&&e.args.length>0&&"object"==typeof e.args[0]}function v(e){return"string"==typeof e?e.split(""):e}var S={equal:function(e){return function(t){return t==e}},exact:function(e){return function(t){return t===e}},number:function(e){return void 0===e&&(e=!0),function(t){return"number"==typeof t&&(e||isFinite(t))}},integer:function(){return function(e){return(Number.isInteger||h)(e)}},numeric:function(){return function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},string:function(){return O("string")},boolean:function(){return O("boolean")},undefined:function(){return O("undefined")},null:function(){return O("null")},array:function(){return O("array")},object:function(){return O("object")},instanceOf:function(e){return function(t){return t instanceof e}},pattern:function(e){return function(t){return e.test(t)}},lowercase:function(){return function(e){return"boolean"==typeof e||e===e.toLowerCase()&&""!==e.trim()}},uppercase:function(){return function(e){return e===e.toUpperCase()&&""!==e.trim()}},vowel:function(){return function(e){return/^[aeiou]+$/i.test(e)}},consonant:function(){return function(e){return/^(?=[^aeiou])([a-z]+)$/i.test(e)}},first:function(e){return function(t){return t[0]==e}},last:function(e){return function(t){return t[t.length-1]==e}},empty:function(){return function(e){return 0===e.length}},length:function(e,t){return function(r){return r.length>=e&&r.length<=(t||e)}},minLength:function(e){return function(t){return t.length>=e}},maxLength:function(e){return function(t){return t.length<=e}},negative:function(){return function(e){return e<0}},positive:function(){return function(e){return e>=0}},between:function(e,t){return function(r){return r>=e&&r<=t}},range:function(e,t){return function(r){return r>=e&&r<=t}},lessThan:function(e){return function(t){return t<e}},lessThanOrEqual:function(e){return function(t){return t<=e}},greaterThan:function(e){return function(t){return t>e}},greaterThanOrEqual:function(e){return function(t){return t>=e}},even:function(){return function(e){return e%2==0}},odd:function(){return function(e){return e%2!=0}},includes:function(e){return function(t){return~t.indexOf(e)}},schema:function(e){return function(e){return{simple:function(t){var r=[];if(Object.keys(e).forEach((function(n){var o=e[n];try{o.check((t||{})[n])}catch(e){e.target=n,r.push(e)}})),r.length>0)throw r;return!0},async:function(t){var r=[],n=Object.keys(e).map((function(n){return e[n].testAsync((t||{})[n]).catch((function(e){e.target=n,r.push(e)}))}));return Promise.all(n).then((function(){if(r.length>0)throw r;return!0}))}}}(e)},passesAnyOf:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return function(t){return e.some((function(e){return e.test(t)}))}},optional:function(e,t){return void 0===t&&(t=!1),{simple:function(r){return d(r,t)||void 0===e.check(r)},async:function(r){return d(r,t)||e.testAsync(r)}}}};function O(e){return function(t){return Array.isArray(t)&&"array"===e||null===t&&"null"===e||typeof t===e}}function h(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}const T=f},94574:(e,t,r)=>{"use strict";var n=r(55603),o={modified:"yellow",added:"green",removed:"red"},a={indent:"  ",newLine:"\n",wrap:function(e,t){return n[o[e]](t)},color:!0};function i(e){return"object"==typeof e&&e&&!Array.isArray(e)}function s(e){return"function"==typeof e?e.toString().replace(/\{.+\}/,"{}"):"object"!=typeof e&&"string"!=typeof e||e instanceof RegExp?""+e:JSON.stringify(e)}function c(e,t,r){return r.indent+e+": "+function(e,t){return e.split(t.newLine).map((function(e,r){return 0===r?e:t.indent+e})).join(t.newLine)}(t,r)+r.newLine}function l(e,t,r){return r.wrap("removed","- "+e+": "+s(t))+r.newLine}function u(e,t,r){return r.wrap("added","+ "+e+": "+s(t))+r.newLine}function d(e,t,r){var n,o,a="",f=!1,p="";if(Array.isArray(e)&&Array.isArray(t)){for(var g=0;g<e.length;g++)g<t.length?(n=d(e[g],t[g],r)).changed&&(p+=c(g,n.text,r),f=!0):(p+=l(g,e[g],r),f=!0);if(t.length>e.length){for(;g<t.length;g++)p+=u(g,t[g],r);f=!0}f&&(a="["+r.newLine+p+"]")}else if(i(e)&&i(t)){o=Object.keys(e);var E,_=Object.assign({},t);for(o.sort(),g=0;g<o.length;g++)E=o[g],t.hasOwnProperty(E)?((n=d(e[E],t[E],r)).changed&&(p+=c(E,n.text,r),f=!0),delete _[E]):(p+=l(E,e[E],r),f=!0);var y=Object.keys(_);for(g=0;g<y.length;g++)p+=u(y[g],t[y[g]],r),f=!0;f&&(a="{"+r.newLine+p+"}")}else e!==t&&(a=r.wrap("modified",s(e)+" => "+s(t)),f=!0);return{changed:f,text:a}}e.exports=function(e,t,r){if(!(r=r||{}).color&&r.wrap)throw new Error("Can't specify wrap and color options together.");var n=Object.assign({},a,r);return n.color||(n.wrap=function(e,t){return t}),d(e,t,n)}},89339:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>se});var n={};r.r(n),r.d(n,{fixNegotiationNeeded:()=>R,shimAddTrackRemoveTrack:()=>A,shimAddTrackRemoveTrackWithNative:()=>m,shimGetSendersWithDtmf:()=>I,shimGetUserMedia:()=>O,shimMediaStream:()=>h,shimOnTrack:()=>T,shimPeerConnection:()=>b,shimSenderReceiverGetStats:()=>C});var o={};r.r(o),r.d(o,{shimAddTransceiver:()=>F,shimCreateAnswer:()=>U,shimCreateOffer:()=>H,shimGetDisplayMedia:()=>P,shimGetParameters:()=>x,shimGetUserMedia:()=>N,shimOnTrack:()=>w,shimPeerConnection:()=>M,shimRTCDataChannel:()=>j,shimReceiverGetStats:()=>D,shimRemoveStream:()=>k,shimSenderGetStats:()=>L});var a={};r.r(a),r.d(a,{shimAudioContext:()=>z,shimCallbacksAPI:()=>B,shimConstraints:()=>V,shimCreateOfferLegacy:()=>Y,shimGetUserMedia:()=>$,shimLocalStreamsAPI:()=>W,shimRTCIceServerUrls:()=>K,shimRemoteStreamsAPI:()=>G,shimTrackEventTransceiver:()=>q});var i={};r.r(i),r.d(i,{removeExtmapAllowMixed:()=>ne,shimAddIceCandidateNullOrEmpty:()=>oe,shimConnectionState:()=>re,shimMaxMessageSize:()=>ee,shimParameterlessSetLocalDescription:()=>ae,shimRTCIceCandidate:()=>X,shimRTCIceCandidateRelayProtocol:()=>Z,shimSendThrowTypeError:()=>te});let s=!0,c=!0;function l(e,t,r){const n=e.match(t);return n&&n.length>=r&&parseFloat(n[r],10)}function u(e,t,r){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,o=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return o.apply(this,arguments);const a=e=>{const t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,a),o.apply(this,[e,a])};const a=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(r))return a.apply(this,arguments);const n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function d(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(s=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function f(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(c=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function p(){if("object"==typeof window){if(s)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function g(e,t){c&&console.warn(e+" is deprecated, please use "+t+" instead.")}function E(e){return"[object Object]"===Object.prototype.toString.call(e)}function _(e){return E(e)?Object.keys(e).reduce((function(t,r){const n=E(e[r]),o=n?_(e[r]):e[r],a=n&&!Object.keys(o).length;return void 0===o||a?t:Object.assign(t,{[r]:o})}),{}):e}function y(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((n=>{n.endsWith("Id")?y(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((t=>{y(e,e.get(t),r)}))})))}function v(e,t,r){const n=r?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;const a=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((t=>{e.forEach((r=>{r.type===n&&r.trackId===t.id&&y(e,r,o)}))})),o}const S=p;function O(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;const n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);const o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"==typeof n.ideal?(e[o("min",r)]=n.ideal,t.optional.push(e),e={},e[o("max",r)]=n.ideal,t.optional.push(e)):(e[o("",r)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",r)]=n.exact):["min","max"].forEach((e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,r)]=n[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,o){if(t.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){let a=e.video.facingMode;a=a&&("object"==typeof a?a:{ideal:a});const i=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||i)){let t;if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?t=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(t=["front"]),t)return r.mediaDevices.enumerateDevices().then((r=>{let i=(r=r.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!i&&r.length&&t.includes("back")&&(i=r[r.length-1]),i&&(e.video.deviceId=a.exact?{exact:i.deviceId}:{ideal:i.deviceId}),e.video=n(e.video),S("chrome: "+JSON.stringify(e)),o(e)}))}e.video=n(e.video)}return S("chrome: "+JSON.stringify(e)),o(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,n){o(e,(e=>{r.webkitGetUserMedia(e,t,(e=>{n&&n(a(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){const e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return o(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(a(e))))))}}}function h(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function T(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.track.id)):{track:r.track};const o=new Event("track");o.track=r.track,o.receiver=n,o.transceiver={receiver:n},o.streams=[t.stream],this.dispatchEvent(o)})),t.stream.getTracks().forEach((r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.id)):{track:r};const o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=[t.stream],this.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else u(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function I(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let o=r.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function C(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>v(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),u(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>v(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,r,n;return this.getSenders().forEach((r=>{r.track===e&&(t?n=!0:t=r)})),this.getReceivers().forEach((t=>(t.track===e&&(r?n=!0:r=t),t.track===e))),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function m(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();r.apply(this,arguments);const n=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),o.apply(this,arguments)}}function A(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return m(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}n.apply(this,[t])};const o=e.RTCPeerConnection.prototype.removeStream;function a(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(o.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const n=new e.MediaStream([t]);this._streams[r.id]=n,this._reverseStreams[n.id]=r,this.addStream(n)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[t=>{const r=a(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then((e=>a(this,e)))}};e.RTCPeerConnection.prototype[t]=n[t]}));const i=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),o.id)})),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),i.apply(this,arguments)):i.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((r=>{this._streams[r].getTracks().find((t=>e.track===t))&&(t=this._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function b(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}))}function R(e,t){u(e,"negotiationneeded",(e=>{const r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}function N(e,t){const r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){g("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"==typeof r&&"object"==typeof r.audio&&(r=JSON.parse(JSON.stringify(r)),e(r.audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"==typeof r&&(r=JSON.parse(JSON.stringify(r)),e(r,"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function P(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function w(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function M(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}));const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,o,a]=arguments;return n.apply(this,[e||null]).then((e=>{if(t.version<53&&!o)try{e.forEach((e=>{e.type=r[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,n)=>{e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))}))}return e})).then(o,a)}}function L(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function D(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),u(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function k(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){g("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function j(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function F(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const r=e.length>0;r&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const n=t.apply(this,arguments);if(r){const{sender:t}=n,r=t.getParameters();(!("encodings"in r)||1===r.encodings.length&&0===Object.keys(r.encodings[0]).length)&&(r.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(r).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return n})}function x(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function H(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function U(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function W(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((r=>t.call(this,r,e))),e.getVideoTracks().forEach((r=>t.call(this,r,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const r=e.getTracks();this.getSenders().forEach((e=>{r.includes(e.track)&&this.removeTrack(e)}))})}}function G(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}))}),t.apply(e,arguments)}}}function B(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,o=t.setLocalDescription,a=t.setRemoteDescription,i=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o};let s=function(e,t,r){const n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){const n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){const n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}function $(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(V(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function V(e){return e&&void 0!==e.video?Object.assign({},e,{video:_(e.video)}):e}function K(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){const t=[];for(let r=0;r<e.iceServers.length;r++){let n=e.iceServers[r];void 0===n.urls&&n.url?(g("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function q(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Y(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const r=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function z(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var J=r(39986),Q=r.n(J);function X(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const r=new t(e),n=Q().parseCandidate(e.candidate);for(const e in n)e in r||Object.defineProperty(r,e,{value:n[e]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,u(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Z(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||u(e,"icecandidate",(e=>{if(e.candidate){const t=Q().parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function ee(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Q().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Q().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),r=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r}(e),n=function(e,r){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const o=Q().matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?n=parseInt(o[0].substring(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n}(arguments[0],e);let o;o=0===r&&0===n?Number.POSITIVE_INFINITY:0===r||0===n?Math.max(r,n):Math.min(r,n);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>o}),this._sctp=a}return r.apply(this,arguments)}}function te(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const r=e.send;e.send=function(){const n=arguments[0],o=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=r.apply(this,arguments);return t(e,this),e},u(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function re(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}function ne(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t._safariVersion>=13.1)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const r=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function oe(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ae(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return r.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?r.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>r.apply(this,[e])))})}const ie=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=p,s=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:r}=e;if(r.userAgentData&&r.userAgentData.brands){const e=r.userAgentData.brands.find((e=>"Chromium"===e.brand));if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(r.mozGetUserMedia)t.browser="firefox",t.version=parseInt(l(r.userAgent,/Firefox\/(\d+)\./,1));else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(l(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=parseInt(l(r.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=l(r.userAgent,/Version\/(\d+(\.?\d+))/,1)}return t}(e),c={browserDetails:s,commonShim:i,extractVersion:l,disableLog:d,disableWarnings:f,sdp:J};switch(s.browser){case"chrome":if(!n||!b||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),c;if(null===s.version)return r("Chrome shim can not determine version, not shimming."),c;r("adapter.js shimming chrome."),c.browserShim=n,oe(e,s),ae(e),O(e,s),h(e),b(e,s),T(e),A(e,s),I(e),C(e),R(e,s),X(e),Z(e),re(e),ee(e,s),te(e),ne(e,s);break;case"firefox":if(!o||!M||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=o,oe(e,s),ae(e),N(e,s),M(e,s),w(e),k(e),L(e),D(e),j(e),F(e),x(e),H(e),U(e),X(e),re(e),ee(e,s),te(e);break;case"safari":if(!a||!t.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=a,oe(e,s),ae(e),K(e),Y(e),B(e),W(e),G(e),q(e),$(e),z(e),X(e),Z(e),ee(e,s),te(e),ne(e,s);break;default:r("Unsupported browser!")}return c}({window:"undefined"==typeof window?void 0:window}),se=ie},44977:(e,t,r)=>{"use strict";var n=r(14188),o=r(13174),a=TypeError;e.exports=function(e){if(n(e))return e;throw new a(o(e)+" is not a function")}},74121:(e,t,r)=>{"use strict";var n=r(16712),o=String,a=TypeError;e.exports=function(e){if(n(e))return e;throw new a("Can't set "+o(e)+" as a prototype")}},42937:(e,t,r)=>{"use strict";var n=r(33243).has;e.exports=function(e){return n(e),e}},95458:(e,t,r)=>{"use strict";var n=r(4282),o=r(77065),a=r(64466).f,i=n("unscopables"),s=Array.prototype;void 0===s[i]&&a(s,i,{configurable:!0,value:o(null)}),e.exports=function(e){s[i][e]=!0}},40286:(e,t,r)=>{"use strict";var n=r(4578),o=TypeError;e.exports=function(e,t){if(n(t,e))return e;throw new o("Incorrect invocation")}},3770:(e,t,r)=>{"use strict";var n=r(80831),o=String,a=TypeError;e.exports=function(e){if(n(e))return e;throw new a(o(e)+" is not an object")}},81458:(e,t,r)=>{"use strict";var n=r(10380),o=r(70675),a=r(69389),i=function(e){return function(t,r,i){var s=n(t),c=a(s);if(0===c)return!e&&-1;var l,u=o(i,c);if(e&&r!=r){for(;c>u;)if((l=s[u++])!=l)return!0}else for(;c>u;u++)if((e||u in s)&&s[u]===r)return e||u||0;return!e&&-1}};e.exports={includes:i(!0),indexOf:i(!1)}},14224:(e,t,r)=>{"use strict";var n=r(96893),o=r(26719),a=TypeError,i=Object.getOwnPropertyDescriptor,s=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=s?function(e,t){if(o(e)&&!i(e,"length").writable)throw new a("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},38689:(e,t,r)=>{"use strict";var n=r(16881),o=n({}.toString),a=n("".slice);e.exports=function(e){return a(o(e),8,-1)}},65438:(e,t,r)=>{"use strict";var n=r(79345),o=r(14188),a=r(38689),i=r(4282)("toStringTag"),s=Object,c="Arguments"===a(function(){return arguments}());e.exports=n?a:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=s(e),i))?r:c?a(t):"Object"===(n=a(t))&&o(t.callee)?"Arguments":n}},98657:(e,t,r)=>{"use strict";var n=r(74418),o=r(73168),a=r(9304),i=r(64466);e.exports=function(e,t,r){for(var s=o(t),c=i.f,l=a.f,u=0;u<s.length;u++){var d=s[u];n(e,d)||r&&n(r,d)||c(e,d,l(t,d))}}},88088:(e,t,r)=>{"use strict";var n=r(96893),o=r(64466),a=r(39123);e.exports=n?function(e,t,r){return o.f(e,t,a(1,r))}:function(e,t,r){return e[t]=r,e}},39123:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},10997:(e,t,r)=>{"use strict";var n=r(74530),o=r(64466);e.exports=function(e,t,r){return r.get&&n(r.get,t,{getter:!0}),r.set&&n(r.set,t,{setter:!0}),o.f(e,t,r)}},97509:(e,t,r)=>{"use strict";var n=r(14188),o=r(64466),a=r(74530),i=r(14798);e.exports=function(e,t,r,s){s||(s={});var c=s.enumerable,l=void 0!==s.name?s.name:t;if(n(r)&&a(r,l,s),s.global)c?e[t]=r:i(t,r);else{try{s.unsafe?e[t]&&(c=!0):delete e[t]}catch(e){}c?e[t]=r:o.f(e,t,{value:r,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return e}},14798:(e,t,r)=>{"use strict";var n=r(79117),o=Object.defineProperty;e.exports=function(e,t){try{o(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},96893:(e,t,r)=>{"use strict";var n=r(5234);e.exports=!n((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},65926:(e,t,r)=>{"use strict";var n=r(79117),o=r(80831),a=n.document,i=o(a)&&o(a.createElement);e.exports=function(e){return i?a.createElement(e):{}}},14578:e=>{"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},38015:e=>{"use strict";e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},61274:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},98060:(e,t,r)=>{"use strict";var n=r(79117).navigator,o=n&&n.userAgent;e.exports=o?String(o):""},63008:(e,t,r)=>{"use strict";var n,o,a=r(79117),i=r(98060),s=a.process,c=a.Deno,l=s&&s.versions||c&&c.version,u=l&&l.v8;u&&(o=(n=u.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!o&&i&&(!(n=i.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=i.match(/Chrome\/(\d+)/))&&(o=+n[1]),e.exports=o},87308:(e,t,r)=>{"use strict";var n=r(16881),o=Error,a=n("".replace),i=String(new o("zxcasd").stack),s=/\n\s*at [^:]*:[^\n]*/,c=s.test(i);e.exports=function(e,t){if(c&&"string"==typeof e&&!o.prepareStackTrace)for(;t--;)e=a(e,s,"");return e}},75382:(e,t,r)=>{"use strict";var n=r(88088),o=r(87308),a=r(14582),i=Error.captureStackTrace;e.exports=function(e,t,r,s){a&&(i?i(e,t):n(e,"stack",o(r,s)))}},14582:(e,t,r)=>{"use strict";var n=r(5234),o=r(39123);e.exports=!n((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",o(1,7)),7!==e.stack)}))},5613:(e,t,r)=>{"use strict";var n=r(79117),o=r(9304).f,a=r(88088),i=r(97509),s=r(14798),c=r(98657),l=r(68489);e.exports=function(e,t){var r,u,d,f,p,g=e.target,E=e.global,_=e.stat;if(r=E?n:_?n[g]||s(g,{}):n[g]&&n[g].prototype)for(u in t){if(f=t[u],d=e.dontCallGetSet?(p=o(r,u))&&p.value:r[u],!l(E?u:g+(_?".":"#")+u,e.forced)&&void 0!==d){if(typeof f==typeof d)continue;c(f,d)}(e.sham||d&&d.sham)&&a(f,"sham",!0),i(r,u,f,e)}}},5234:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},40646:(e,t,r)=>{"use strict";var n=r(89055),o=Function.prototype,a=o.apply,i=o.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?i.bind(a):function(){return i.apply(a,arguments)})},89055:(e,t,r)=>{"use strict";var n=r(5234);e.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},39944:(e,t,r)=>{"use strict";var n=r(89055),o=Function.prototype.call;e.exports=n?o.bind(o):function(){return o.apply(o,arguments)}},92735:(e,t,r)=>{"use strict";var n=r(96893),o=r(74418),a=Function.prototype,i=n&&Object.getOwnPropertyDescriptor,s=o(a,"name"),c=s&&"something"===function(){}.name,l=s&&(!n||n&&i(a,"name").configurable);e.exports={EXISTS:s,PROPER:c,CONFIGURABLE:l}},71025:(e,t,r)=>{"use strict";var n=r(16881),o=r(44977);e.exports=function(e,t,r){try{return n(o(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}}},16881:(e,t,r)=>{"use strict";var n=r(89055),o=Function.prototype,a=o.call,i=n&&o.bind.bind(a,a);e.exports=n?i:function(e){return function(){return a.apply(e,arguments)}}},5604:(e,t,r)=>{"use strict";var n=r(79117),o=r(14188);e.exports=function(e,t){return arguments.length<2?(r=n[e],o(r)?r:void 0):n[e]&&n[e][t];var r}},96002:e=>{"use strict";e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},12913:(e,t,r)=>{"use strict";var n=r(44977),o=r(44318);e.exports=function(e,t){var r=e[t];return o(r)?void 0:n(r)}},55558:(e,t,r)=>{"use strict";var n=r(44977),o=r(3770),a=r(39944),i=r(76744),s=r(96002),c="Invalid size",l=RangeError,u=TypeError,d=Math.max,f=function(e,t){this.set=e,this.size=d(t,0),this.has=n(e.has),this.keys=n(e.keys)};f.prototype={getIterator:function(){return s(o(a(this.keys,this.set)))},includes:function(e){return a(this.has,this.set,e)}},e.exports=function(e){o(e);var t=+e.size;if(t!=t)throw new u(c);var r=i(t);if(r<0)throw new l(c);return new f(e,r)}},79117:function(e,t,r){"use strict";var n=function(e){return e&&e.Math===Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||n("object"==typeof this&&this)||function(){return this}()||Function("return this")()},74418:(e,t,r)=>{"use strict";var n=r(16881),o=r(83628),a=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return a(o(e),t)}},67588:e=>{"use strict";e.exports={}},67458:(e,t,r)=>{"use strict";var n=r(5604);e.exports=n("document","documentElement")},39622:(e,t,r)=>{"use strict";var n=r(96893),o=r(5234),a=r(65926);e.exports=!n&&!o((function(){return 7!==Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))},47568:(e,t,r)=>{"use strict";var n=r(16881),o=r(5234),a=r(38689),i=Object,s=n("".split);e.exports=o((function(){return!i("z").propertyIsEnumerable(0)}))?function(e){return"String"===a(e)?s(e,""):i(e)}:i},44166:(e,t,r)=>{"use strict";var n=r(14188),o=r(80831),a=r(5054);e.exports=function(e,t,r){var i,s;return a&&n(i=t.constructor)&&i!==r&&o(s=i.prototype)&&s!==r.prototype&&a(e,s),e}},13029:(e,t,r)=>{"use strict";var n=r(16881),o=r(14188),a=r(62694),i=n(Function.toString);o(a.inspectSource)||(a.inspectSource=function(e){return i(e)}),e.exports=a.inspectSource},98257:(e,t,r)=>{"use strict";var n=r(80831),o=r(88088);e.exports=function(e,t){n(t)&&"cause"in t&&o(e,"cause",t.cause)}},43086:(e,t,r)=>{"use strict";var n,o,a,i=r(45945),s=r(79117),c=r(80831),l=r(88088),u=r(74418),d=r(62694),f=r(40168),p=r(67588),g="Object already initialized",E=s.TypeError,_=s.WeakMap;if(i||d.state){var y=d.state||(d.state=new _);y.get=y.get,y.has=y.has,y.set=y.set,n=function(e,t){if(y.has(e))throw new E(g);return t.facade=e,y.set(e,t),t},o=function(e){return y.get(e)||{}},a=function(e){return y.has(e)}}else{var v=f("state");p[v]=!0,n=function(e,t){if(u(e,v))throw new E(g);return t.facade=e,l(e,v,t),t},o=function(e){return u(e,v)?e[v]:{}},a=function(e){return u(e,v)}}e.exports={set:n,get:o,has:a,enforce:function(e){return a(e)?o(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=o(t)).type!==e)throw new E("Incompatible receiver, "+e+" required");return r}}}},26719:(e,t,r)=>{"use strict";var n=r(38689);e.exports=Array.isArray||function(e){return"Array"===n(e)}},14188:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},68489:(e,t,r)=>{"use strict";var n=r(5234),o=r(14188),a=/#|\.prototype\./,i=function(e,t){var r=c[s(e)];return r===u||r!==l&&(o(t)?n(t):!!t)},s=i.normalize=function(e){return String(e).replace(a,".").toLowerCase()},c=i.data={},l=i.NATIVE="N",u=i.POLYFILL="P";e.exports=i},44318:e=>{"use strict";e.exports=function(e){return null==e}},80831:(e,t,r)=>{"use strict";var n=r(14188);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},16712:(e,t,r)=>{"use strict";var n=r(80831);e.exports=function(e){return n(e)||null===e}},1942:e=>{"use strict";e.exports=!1},6032:(e,t,r)=>{"use strict";var n=r(5604),o=r(14188),a=r(4578),i=r(89809),s=Object;e.exports=i?function(e){return"symbol"==typeof e}:function(e){var t=n("Symbol");return o(t)&&a(t.prototype,s(e))}},37032:(e,t,r)=>{"use strict";var n=r(39944);e.exports=function(e,t,r){for(var o,a,i=r?e:e.iterator,s=e.next;!(o=n(s,i)).done;)if(void 0!==(a=t(o.value)))return a}},88500:(e,t,r)=>{"use strict";var n=r(39944),o=r(3770),a=r(12913);e.exports=function(e,t,r){var i,s;o(e);try{if(!(i=a(e,"return"))){if("throw"===t)throw r;return r}i=n(i,e)}catch(e){s=!0,i=e}if("throw"===t)throw r;if(s)throw i;return o(i),r}},69389:(e,t,r)=>{"use strict";var n=r(97611);e.exports=function(e){return n(e.length)}},74530:(e,t,r)=>{"use strict";var n=r(16881),o=r(5234),a=r(14188),i=r(74418),s=r(96893),c=r(92735).CONFIGURABLE,l=r(13029),u=r(43086),d=u.enforce,f=u.get,p=String,g=Object.defineProperty,E=n("".slice),_=n("".replace),y=n([].join),v=s&&!o((function(){return 8!==g((function(){}),"length",{value:8}).length})),S=String(String).split("String"),O=e.exports=function(e,t,r){"Symbol("===E(p(t),0,7)&&(t="["+_(p(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!i(e,"name")||c&&e.name!==t)&&(s?g(e,"name",{value:t,configurable:!0}):e.name=t),v&&r&&i(r,"arity")&&e.length!==r.arity&&g(e,"length",{value:r.arity});try{r&&i(r,"constructor")&&r.constructor?s&&g(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var n=d(e);return i(n,"source")||(n.source=y(S,"string"==typeof t?t:"")),e};Function.prototype.toString=O((function(){return a(this)&&f(this).source||l(this)}),"toString")},60142:e=>{"use strict";var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var n=+e;return(n>0?r:t)(n)}},69866:(e,t,r)=>{"use strict";var n=r(92618);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:n(e)}},77065:(e,t,r)=>{"use strict";var n,o=r(3770),a=r(30),i=r(61274),s=r(67588),c=r(67458),l=r(65926),u=r(40168),d="prototype",f="script",p=u("IE_PROTO"),g=function(){},E=function(e){return"<"+f+">"+e+"</"+f+">"},_=function(e){e.write(E("")),e.close();var t=e.parentWindow.Object;return e=null,t},y=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;y="undefined"!=typeof document?document.domain&&n?_(n):(t=l("iframe"),r="java"+f+":",t.style.display="none",c.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(E("document.F=Object")),e.close(),e.F):_(n);for(var o=i.length;o--;)delete y[d][i[o]];return y()};s[p]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(g[d]=o(e),r=new g,g[d]=null,r[p]=e):r=y(),void 0===t?r:a.f(r,t)}},30:(e,t,r)=>{"use strict";var n=r(96893),o=r(23315),a=r(64466),i=r(3770),s=r(10380),c=r(57137);t.f=n&&!o?Object.defineProperties:function(e,t){i(e);for(var r,n=s(t),o=c(t),l=o.length,u=0;l>u;)a.f(e,r=o[u++],n[r]);return e}},64466:(e,t,r)=>{"use strict";var n=r(96893),o=r(39622),a=r(23315),i=r(3770),s=r(42344),c=TypeError,l=Object.defineProperty,u=Object.getOwnPropertyDescriptor,d="enumerable",f="configurable",p="writable";t.f=n?a?function(e,t,r){if(i(e),t=s(t),i(r),"function"==typeof e&&"prototype"===t&&"value"in r&&p in r&&!r[p]){var n=u(e,t);n&&n[p]&&(e[t]=r.value,r={configurable:f in r?r[f]:n[f],enumerable:d in r?r[d]:n[d],writable:!1})}return l(e,t,r)}:l:function(e,t,r){if(i(e),t=s(t),i(r),o)try{return l(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new c("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},9304:(e,t,r)=>{"use strict";var n=r(96893),o=r(39944),a=r(74416),i=r(39123),s=r(10380),c=r(42344),l=r(74418),u=r(39622),d=Object.getOwnPropertyDescriptor;t.f=n?d:function(e,t){if(e=s(e),t=c(t),u)try{return d(e,t)}catch(e){}if(l(e,t))return i(!o(a.f,e,t),e[t])}},25629:(e,t,r)=>{"use strict";var n=r(21843),o=r(61274).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,o)}},30156:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},4578:(e,t,r)=>{"use strict";var n=r(16881);e.exports=n({}.isPrototypeOf)},21843:(e,t,r)=>{"use strict";var n=r(16881),o=r(74418),a=r(10380),i=r(81458).indexOf,s=r(67588),c=n([].push);e.exports=function(e,t){var r,n=a(e),l=0,u=[];for(r in n)!o(s,r)&&o(n,r)&&c(u,r);for(;t.length>l;)o(n,r=t[l++])&&(~i(u,r)||c(u,r));return u}},57137:(e,t,r)=>{"use strict";var n=r(21843),o=r(61274);e.exports=Object.keys||function(e){return n(e,o)}},74416:(e,t)=>{"use strict";var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,o=n&&!r.call({1:2},1);t.f=o?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},5054:(e,t,r)=>{"use strict";var n=r(71025),o=r(80831),a=r(39509),i=r(74121);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return a(r),i(n),o(r)?(t?e(r,n):r.__proto__=n,r):r}}():void 0)},2287:(e,t,r)=>{"use strict";var n=r(39944),o=r(14188),a=r(80831),i=TypeError;e.exports=function(e,t){var r,s;if("string"===t&&o(r=e.toString)&&!a(s=n(r,e)))return s;if(o(r=e.valueOf)&&!a(s=n(r,e)))return s;if("string"!==t&&o(r=e.toString)&&!a(s=n(r,e)))return s;throw new i("Can't convert object to primitive value")}},73168:(e,t,r)=>{"use strict";var n=r(5604),o=r(16881),a=r(25629),i=r(30156),s=r(3770),c=o([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=a.f(s(e)),r=i.f;return r?c(t,r(e)):t}},78679:(e,t,r)=>{"use strict";var n=r(64466).f;e.exports=function(e,t,r){r in e||n(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})}},39509:(e,t,r)=>{"use strict";var n=r(44318),o=TypeError;e.exports=function(e){if(n(e))throw new o("Can't call method on "+e);return e}},679:(e,t,r)=>{"use strict";var n=r(33243),o=r(29800),a=n.Set,i=n.add;e.exports=function(e){var t=new a;return o(e,(function(e){i(t,e)})),t}},37059:(e,t,r)=>{"use strict";var n=r(42937),o=r(33243),a=r(679),i=r(87173),s=r(55558),c=r(29800),l=r(37032),u=o.has,d=o.remove;e.exports=function(e){var t=n(this),r=s(e),o=a(t);return i(t)<=r.size?c(t,(function(e){r.includes(e)&&d(o,e)})):l(r.getIterator(),(function(e){u(t,e)&&d(o,e)})),o}},33243:(e,t,r)=>{"use strict";var n=r(16881),o=Set.prototype;e.exports={Set,add:n(o.add),has:n(o.has),remove:n(o.delete),proto:o}},13721:(e,t,r)=>{"use strict";var n=r(42937),o=r(33243),a=r(87173),i=r(55558),s=r(29800),c=r(37032),l=o.Set,u=o.add,d=o.has;e.exports=function(e){var t=n(this),r=i(e),o=new l;return a(t)>r.size?c(r.getIterator(),(function(e){d(t,e)&&u(o,e)})):s(t,(function(e){r.includes(e)&&u(o,e)})),o}},99978:(e,t,r)=>{"use strict";var n=r(42937),o=r(33243).has,a=r(87173),i=r(55558),s=r(29800),c=r(37032),l=r(88500);e.exports=function(e){var t=n(this),r=i(e);if(a(t)<=r.size)return!1!==s(t,(function(e){if(r.includes(e))return!1}),!0);var u=r.getIterator();return!1!==c(u,(function(e){if(o(t,e))return l(u,"normal",!1)}))}},94361:(e,t,r)=>{"use strict";var n=r(42937),o=r(87173),a=r(29800),i=r(55558);e.exports=function(e){var t=n(this),r=i(e);return!(o(t)>r.size)&&!1!==a(t,(function(e){if(!r.includes(e))return!1}),!0)}},97528:(e,t,r)=>{"use strict";var n=r(42937),o=r(33243).has,a=r(87173),i=r(55558),s=r(37032),c=r(88500);e.exports=function(e){var t=n(this),r=i(e);if(a(t)<r.size)return!1;var l=r.getIterator();return!1!==s(l,(function(e){if(!o(t,e))return c(l,"normal",!1)}))}},29800:(e,t,r)=>{"use strict";var n=r(16881),o=r(37032),a=r(33243),i=a.Set,s=a.proto,c=n(s.forEach),l=n(s.keys),u=l(new i).next;e.exports=function(e,t,r){return r?o({iterator:l(e),next:u},t):c(e,t)}},54471:(e,t,r)=>{"use strict";var n=r(5604),o=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};e.exports=function(e){var t=n("Set");try{(new t)[e](o(0));try{return(new t)[e](o(-1)),!1}catch(e){return!0}}catch(e){return!1}}},87173:(e,t,r)=>{"use strict";var n=r(71025),o=r(33243);e.exports=n(o.proto,"size","get")||function(e){return e.size}},31657:(e,t,r)=>{"use strict";var n=r(42937),o=r(33243),a=r(679),i=r(55558),s=r(37032),c=o.add,l=o.has,u=o.remove;e.exports=function(e){var t=n(this),r=i(e).getIterator(),o=a(t);return s(r,(function(e){l(t,e)?u(o,e):c(o,e)})),o}},65077:(e,t,r)=>{"use strict";var n=r(42937),o=r(33243).add,a=r(679),i=r(55558),s=r(37032);e.exports=function(e){var t=n(this),r=i(e).getIterator(),c=a(t);return s(r,(function(e){o(c,e)})),c}},40168:(e,t,r)=>{"use strict";var n=r(10746),o=r(66209),a=n("keys");e.exports=function(e){return a[e]||(a[e]=o(e))}},62694:(e,t,r)=>{"use strict";var n=r(1942),o=r(79117),a=r(14798),i="__core-js_shared__",s=e.exports=o[i]||a(i,{});(s.versions||(s.versions=[])).push({version:"3.38.1",mode:n?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.1/LICENSE",source:"https://github.com/zloirock/core-js"})},10746:(e,t,r)=>{"use strict";var n=r(62694);e.exports=function(e,t){return n[e]||(n[e]=t||{})}},48944:(e,t,r)=>{"use strict";var n=r(63008),o=r(5234),a=r(79117).String;e.exports=!!Object.getOwnPropertySymbols&&!o((function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},70675:(e,t,r)=>{"use strict";var n=r(76744),o=Math.max,a=Math.min;e.exports=function(e,t){var r=n(e);return r<0?o(r+t,0):a(r,t)}},10380:(e,t,r)=>{"use strict";var n=r(47568),o=r(39509);e.exports=function(e){return n(o(e))}},76744:(e,t,r)=>{"use strict";var n=r(60142);e.exports=function(e){var t=+e;return t!=t||0===t?0:n(t)}},97611:(e,t,r)=>{"use strict";var n=r(76744),o=Math.min;e.exports=function(e){var t=n(e);return t>0?o(t,9007199254740991):0}},83628:(e,t,r)=>{"use strict";var n=r(39509),o=Object;e.exports=function(e){return o(n(e))}},30290:(e,t,r)=>{"use strict";var n=r(39944),o=r(80831),a=r(6032),i=r(12913),s=r(2287),c=r(4282),l=TypeError,u=c("toPrimitive");e.exports=function(e,t){if(!o(e)||a(e))return e;var r,c=i(e,u);if(c){if(void 0===t&&(t="default"),r=n(c,e,t),!o(r)||a(r))return r;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}},42344:(e,t,r)=>{"use strict";var n=r(30290),o=r(6032);e.exports=function(e){var t=n(e,"string");return o(t)?t:t+""}},79345:(e,t,r)=>{"use strict";var n={};n[r(4282)("toStringTag")]="z",e.exports="[object z]"===String(n)},92618:(e,t,r)=>{"use strict";var n=r(65438),o=String;e.exports=function(e){if("Symbol"===n(e))throw new TypeError("Cannot convert a Symbol value to a string");return o(e)}},13174:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},66209:(e,t,r)=>{"use strict";var n=r(16881),o=0,a=Math.random(),i=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+i(++o+a,36)}},89809:(e,t,r)=>{"use strict";var n=r(48944);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},23315:(e,t,r)=>{"use strict";var n=r(96893),o=r(5234);e.exports=n&&o((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},89445:e=>{"use strict";var t=TypeError;e.exports=function(e,r){if(e<r)throw new t("Not enough arguments");return e}},45945:(e,t,r)=>{"use strict";var n=r(79117),o=r(14188),a=n.WeakMap;e.exports=o(a)&&/native code/.test(String(a))},4282:(e,t,r)=>{"use strict";var n=r(79117),o=r(10746),a=r(74418),i=r(66209),s=r(48944),c=r(89809),l=n.Symbol,u=o("wks"),d=c?l.for||l:l&&l.withoutSetter||i;e.exports=function(e){return a(u,e)||(u[e]=s&&a(l,e)?l[e]:d("Symbol."+e)),u[e]}},76208:(e,t,r)=>{"use strict";var n=r(5604),o=r(74418),a=r(88088),i=r(4578),s=r(5054),c=r(98657),l=r(78679),u=r(44166),d=r(69866),f=r(98257),p=r(75382),g=r(96893),E=r(1942);e.exports=function(e,t,r,_){var y="stackTraceLimit",v=_?2:1,S=e.split("."),O=S[S.length-1],h=n.apply(null,S);if(h){var T=h.prototype;if(!E&&o(T,"cause")&&delete T.cause,!r)return h;var I=n("Error"),C=t((function(e,t){var r=d(_?t:e,void 0),n=_?new h(e):new h;return void 0!==r&&a(n,"message",r),p(n,C,n.stack,2),this&&i(T,this)&&u(n,this,C),arguments.length>v&&f(n,arguments[v]),n}));if(C.prototype=T,"Error"!==O?s?s(C,I):c(C,I,{name:!0}):g&&y in h&&(l(C,h,y),l(C,h,"prepareStackTrace")),c(C,h),!E)try{T.name!==O&&a(T,"name",O),T.constructor=C}catch(e){}return C}}},62234:(e,t,r)=>{"use strict";var n=r(5613),o=r(81458).includes,a=r(5234),i=r(95458);n({target:"Array",proto:!0,forced:a((function(){return!Array(1).includes()}))},{includes:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),i("includes")},69375:(e,t,r)=>{"use strict";var n=r(5613),o=r(83628),a=r(69389),i=r(14224),s=r(14578);n({target:"Array",proto:!0,arity:1,forced:r(5234)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}()},{push:function(e){var t=o(this),r=a(t),n=arguments.length;s(r+n);for(var c=0;c<n;c++)t[r]=arguments[c],r++;return i(t,r),r}})},97107:(e,t,r)=>{"use strict";var n=r(5613),o=r(79117),a=r(40646),i=r(76208),s="WebAssembly",c=o[s],l=7!==new Error("e",{cause:7}).cause,u=function(e,t){var r={};r[e]=i(e,t,l),n({global:!0,constructor:!0,arity:1,forced:l},r)},d=function(e,t){if(c&&c[e]){var r={};r[e]=i(s+"."+e,t,l),n({target:s,stat:!0,constructor:!0,arity:1,forced:l},r)}};u("Error",(function(e){return function(t){return a(e,this,arguments)}})),u("EvalError",(function(e){return function(t){return a(e,this,arguments)}})),u("RangeError",(function(e){return function(t){return a(e,this,arguments)}})),u("ReferenceError",(function(e){return function(t){return a(e,this,arguments)}})),u("SyntaxError",(function(e){return function(t){return a(e,this,arguments)}})),u("TypeError",(function(e){return function(t){return a(e,this,arguments)}})),u("URIError",(function(e){return function(t){return a(e,this,arguments)}})),d("CompileError",(function(e){return function(t){return a(e,this,arguments)}})),d("LinkError",(function(e){return function(t){return a(e,this,arguments)}})),d("RuntimeError",(function(e){return function(t){return a(e,this,arguments)}}))},69033:(e,t,r)=>{"use strict";var n=r(5613),o=r(37059);n({target:"Set",proto:!0,real:!0,forced:!r(54471)("difference")},{difference:o})},68903:(e,t,r)=>{"use strict";var n=r(5613),o=r(5234),a=r(13721);n({target:"Set",proto:!0,real:!0,forced:!r(54471)("intersection")||o((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}))},{intersection:a})},21018:(e,t,r)=>{"use strict";var n=r(5613),o=r(99978);n({target:"Set",proto:!0,real:!0,forced:!r(54471)("isDisjointFrom")},{isDisjointFrom:o})},1415:(e,t,r)=>{"use strict";var n=r(5613),o=r(94361);n({target:"Set",proto:!0,real:!0,forced:!r(54471)("isSubsetOf")},{isSubsetOf:o})},4448:(e,t,r)=>{"use strict";var n=r(5613),o=r(97528);n({target:"Set",proto:!0,real:!0,forced:!r(54471)("isSupersetOf")},{isSupersetOf:o})},58871:(e,t,r)=>{"use strict";var n=r(5613),o=r(31657);n({target:"Set",proto:!0,real:!0,forced:!r(54471)("symmetricDifference")},{symmetricDifference:o})},56539:(e,t,r)=>{"use strict";var n=r(5613),o=r(65077);n({target:"Set",proto:!0,real:!0,forced:!r(54471)("union")},{union:o})},57182:(e,t,r)=>{"use strict";var n=r(5613),o=r(79117),a=r(5604),i=r(39123),s=r(64466).f,c=r(74418),l=r(40286),u=r(44166),d=r(69866),f=r(38015),p=r(87308),g=r(96893),E=r(1942),_="DOMException",y=a("Error"),v=a(_),S=function(){l(this,O);var e=arguments.length,t=d(e<1?void 0:arguments[0]),r=d(e<2?void 0:arguments[1],"Error"),n=new v(t,r),o=new y(t);return o.name=_,s(n,"stack",i(1,p(o.stack,1))),u(n,this,S),n},O=S.prototype=v.prototype,h="stack"in new y(_),T="stack"in new v(1,2),I=v&&g&&Object.getOwnPropertyDescriptor(o,_),C=!(!I||I.writable&&I.configurable),m=h&&!C&&!T;n({global:!0,constructor:!0,forced:E||m},{DOMException:m?S:v});var A=a(_),b=A.prototype;if(b.constructor!==A)for(var R in E||s(b,"constructor",i(1,A)),f)if(c(f,R)){var N=f[R],P=N.s;c(A,P)||s(A,P,i(6,N.c))}},61412:(e,t,r)=>{"use strict";var n=r(97509),o=r(16881),a=r(92618),i=r(89445),s=URLSearchParams,c=s.prototype,l=o(c.append),u=o(c.delete),d=o(c.forEach),f=o([].push),p=new s("a=1&a=2&b=3");p.delete("a",1),p.delete("b",void 0),p+""!="a=2"&&n(c,"delete",(function(e){var t=arguments.length,r=t<2?void 0:arguments[1];if(t&&void 0===r)return u(this,e);var n=[];d(this,(function(e,t){f(n,{key:t,value:e})})),i(t,1);for(var o,s=a(e),c=a(r),p=0,g=0,E=!1,_=n.length;p<_;)o=n[p++],E||o.key===s?(E=!0,u(this,o.key)):g++;for(;g<_;)(o=n[g++]).key===s&&o.value===c||l(this,o.key,o.value)}),{enumerable:!0,unsafe:!0})},91883:(e,t,r)=>{"use strict";var n=r(97509),o=r(16881),a=r(92618),i=r(89445),s=URLSearchParams,c=s.prototype,l=o(c.getAll),u=o(c.has),d=new s("a=1");!d.has("a",2)&&d.has("a",void 0)||n(c,"has",(function(e){var t=arguments.length,r=t<2?void 0:arguments[1];if(t&&void 0===r)return u(this,e);var n=l(this,e);i(t,1);for(var o=a(r),s=0;s<n.length;)if(n[s++]===o)return!0;return!1}),{enumerable:!0,unsafe:!0})},70286:(e,t,r)=>{"use strict";var n=r(96893),o=r(16881),a=r(10997),i=URLSearchParams.prototype,s=o(i.forEach);n&&!("size"in i)&&a(i,"size",{get:function(){var e=0;return s(this,(function(){e++})),e},configurable:!0,enumerable:!0})}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}return r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r(81948)})()));
//# sourceMappingURL=webrtc.js.map